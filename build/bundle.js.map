{"version":3,"file":"bundle.js","sources":["../node_modules/preact/src/vnode.js","../node_modules/preact/src/options.js","../node_modules/preact/src/h.js","../node_modules/preact/src/util.js","../node_modules/preact/src/constants.js","../node_modules/preact/src/linked-state.js","../node_modules/preact/src/render-queue.js","../node_modules/preact/src/vdom/functional-component.js","../node_modules/preact/src/vdom/index.js","../node_modules/preact/src/dom/index.js","../node_modules/preact/src/dom/recycler.js","../node_modules/preact/src/vdom/diff.js","../node_modules/preact/src/vdom/component-recycler.js","../node_modules/preact/src/vdom/component.js","../node_modules/preact/src/component.js","../node_modules/preact/src/render.js","../src/utils.js","../src/Sidebar/tabBar/tab/tab.js","../src/Sidebar/tabBar/tabBar.js","../src/UiKit/Header/index.js","../src/UiKit/Button/index.js","../src/Sidebar/views/home/index.js","../src/Sidebar/views/about/index.js","../src/Sidebar/views/yourSelection/index.js","../src/Sidebar/views/current/index.js","../src/UiKit/LegendItem/index.js","../src/Sidebar/views/legend/index.js","../src/Sidebar/views/story/index.js","../src/Sidebar/Sidebar.js","../src/Ripplemap/state.js","../src/Ripplemap/net.js","../src/Ripplemap/fun.js","../src/Ripplemap/model.js","../src/Ripplemap/convo.js","../src/Ripplemap/dom.js","../src/Ripplemap/render.js","../src/Ripplemap/graph.js","../src/Ripplemap/main.js","../src/main.js"],"sourcesContent":["/** Virtual DOM Node */\nexport function VNode(nodeName, attributes, children) {\n\t/** @type {string|function} */\n\tthis.nodeName = nodeName;\n\n\t/** @type {object<string>|undefined} */\n\tthis.attributes = attributes;\n\n\t/** @type {array<VNode>|undefined} */\n\tthis.children = children;\n\n\t/** Reference to the given key. */\n\tthis.key = attributes && attributes.key;\n}\n","/** Global options\n *\t@public\n *\t@namespace options {Object}\n */\nexport default {\n\n\t/** If `true`, `prop` changes trigger synchronous component updates.\n\t *\t@name syncComponentUpdates\n\t *\t@type Boolean\n\t *\t@default true\n\t */\n\t//syncComponentUpdates: true,\n\n\t/** Processes all created VNodes.\n\t *\t@param {VNode} vnode\tA newly-created VNode to normalize/process\n\t */\n\t//vnode(vnode) { }\n\n\t/** Hook invoked after a component is mounted. */\n\t// afterMount(component) { }\n\n\t/** Hook invoked after the DOM is updated with a component's latest render. */\n\t// afterUpdate(component) { }\n\n\t/** Hook invoked immediately before a component is unmounted. */\n\t// beforeUnmount(component) { }\n};\n","import { VNode } from './vnode';\nimport options from './options';\n\n\nconst stack = [];\n\nconst EMPTY_CHILDREN = [];\n\n/** JSX/hyperscript reviver\n*\tBenchmarks: https://esbench.com/bench/57ee8f8e330ab09900a1a1a0\n *\t@see http://jasonformat.com/wtf-is-jsx\n *\t@public\n *  @example\n *  /** @jsx h *\\/\n *  import { render, h } from 'preact';\n *  render(<span>foo</span>, document.body);\n */\nexport function h(nodeName, attributes) {\n\tlet children, lastSimple, child, simple, i;\n\tfor (i=arguments.length; i-- > 2; ) {\n\t\tstack.push(arguments[i]);\n\t}\n\tif (attributes && attributes.children) {\n\t\tif (!stack.length) stack.push(attributes.children);\n\t\tdelete attributes.children;\n\t}\n\twhile (stack.length) {\n\t\tif ((child = stack.pop()) instanceof Array) {\n\t\t\tfor (i=child.length; i--; ) stack.push(child[i]);\n\t\t}\n\t\telse if (child!=null && child!==true && child!==false) {\n\t\t\tif (typeof child=='number') child = String(child);\n\t\t\tsimple = typeof child=='string';\n\t\t\tif (simple && lastSimple) {\n\t\t\t\tchildren[children.length-1] += child;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t(children || (children = [])).push(child);\n\t\t\t\tlastSimple = simple;\n\t\t\t}\n\t\t}\n\t}\n\n\tlet p = new VNode(nodeName, attributes || undefined, children || EMPTY_CHILDREN);\n\n\t// if a \"vnode hook\" is defined, pass every created VNode to it\n\tif (options.vnode) options.vnode(p);\n\n\treturn p;\n}\n","/** Copy own-properties from `props` onto `obj`.\n *\t@returns obj\n *\t@private\n */\nexport function extend(obj, props) {\n\tif (props) {\n\t\tfor (let i in props) obj[i] = props[i];\n\t}\n\treturn obj;\n}\n\n\n/** Fast clone. Note: does not filter out non-own properties.\n *\t@see https://esbench.com/bench/56baa34f45df6895002e03b6\n */\nexport function clone(obj) {\n\treturn extend({}, obj);\n}\n\n\n/** Get a deep property value from the given object, expressed in dot-notation.\n *\t@private\n */\nexport function delve(obj, key) {\n\tfor (let p=key.split('.'), i=0; i<p.length && obj; i++) {\n\t\tobj = obj[p[i]];\n\t}\n\treturn obj;\n}\n\n\n/** @private is the given object a Function? */\nexport function isFunction(obj) {\n\treturn 'function'===typeof obj;\n}\n\n\n/** @private is the given object a String? */\nexport function isString(obj) {\n\treturn 'string'===typeof obj;\n}\n\n\n/** Convert a hashmap of CSS classes to a space-delimited className string\n *\t@private\n */\nexport function hashToClassName(c) {\n\tlet str = '';\n\tfor (let prop in c) {\n\t\tif (c[prop]) {\n\t\t\tif (str) str += ' ';\n\t\t\tstr += prop;\n\t\t}\n\t}\n\treturn str;\n}\n\n\n/** Just a memoized String#toLowerCase */\nlet lcCache = {};\nexport const toLowerCase = s => lcCache[s] || (lcCache[s] = s.toLowerCase());\n\n\n/** Call a function asynchronously, as soon as possible.\n *\t@param {Function} callback\n */\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout;\n","// render modes\n\nexport const NO_RENDER = 0;\nexport const SYNC_RENDER = 1;\nexport const FORCE_RENDER = 2;\nexport const ASYNC_RENDER = 3;\n\nexport const EMPTY = {};\n\nexport const ATTR_KEY = typeof Symbol!=='undefined' ? Symbol.for('preactattr') : '__preactattr_';\n\n// DOM properties that should NOT have \"px\" added when numeric\nexport const NON_DIMENSION_PROPS = {\n\tboxFlex:1, boxFlexGroup:1, columnCount:1, fillOpacity:1, flex:1, flexGrow:1,\n\tflexPositive:1, flexShrink:1, flexNegative:1, fontWeight:1, lineClamp:1, lineHeight:1,\n\topacity:1, order:1, orphans:1, strokeOpacity:1, widows:1, zIndex:1, zoom:1\n};\n\n// DOM event types that do not bubble and should be attached via useCapture\nexport const NON_BUBBLING_EVENTS = { blur:1, error:1, focus:1, load:1, resize:1, scroll:1 };\n","import { isString, delve } from './util';\n\n/** Create an Event handler function that sets a given state property.\n *\t@param {Component} component\tThe component whose state should be updated\n *\t@param {string} key\t\t\t\tA dot-notated key path to update in the component's state\n *\t@param {string} eventPath\t\tA dot-notated key path to the value that should be retrieved from the Event or component\n *\t@returns {function} linkedStateHandler\n *\t@private\n */\nexport function createLinkedState(component, key, eventPath) {\n\tlet path = key.split('.');\n\treturn function(e) {\n\t\tlet t = e && e.target || this,\n\t\t\tstate = {},\n\t\t\tobj = state,\n\t\t\tv = isString(eventPath) ? delve(e, eventPath) : t.nodeName ? (t.type.match(/^che|rad/) ? t.checked : t.value) : e,\n\t\t\ti = 0;\n\t\tfor ( ; i<path.length-1; i++) {\n\t\t\tobj = obj[path[i]] || (obj[path[i]] = !i && component.state[path[i]] || {});\n\t\t}\n\t\tobj[path[i]] = v;\n\t\tcomponent.setState(state);\n\t};\n}\n","import options from './options';\nimport { defer } from './util';\nimport { renderComponent } from './vdom/component';\n\n/** Managed queue of dirty components to be re-rendered */\n\n// items/itemsOffline swap on each rerender() call (just a simple pool technique)\nlet items = [];\n\nexport function enqueueRender(component) {\n\tif (!component._dirty && (component._dirty = true) && items.push(component)==1) {\n\t\t(options.debounceRendering || defer)(rerender);\n\t}\n}\n\n\nexport function rerender() {\n\tlet p, list = items;\n\titems = [];\n\twhile ( (p = list.pop()) ) {\n\t\tif (p._dirty) renderComponent(p);\n\t}\n}\n","import { EMPTY } from '../constants';\nimport { getNodeProps } from './index';\nimport { isFunction } from '../util';\n\n\n/** Check if a VNode is a reference to a stateless functional component.\n *\tA function component is represented as a VNode whose `nodeName` property is a reference to a function.\n *\tIf that function is not a Component (ie, has no `.render()` method on a prototype), it is considered a stateless functional component.\n *\t@param {VNode} vnode\tA VNode\n *\t@private\n */\nexport function isFunctionalComponent(vnode) {\n\tlet nodeName = vnode && vnode.nodeName;\n\treturn nodeName && isFunction(nodeName) && !(nodeName.prototype && nodeName.prototype.render);\n}\n\n\n\n/** Construct a resultant VNode from a VNode referencing a stateless functional component.\n *\t@param {VNode} vnode\tA VNode with a `nodeName` property that is a reference to a function.\n *\t@private\n */\nexport function buildFunctionalComponent(vnode, context) {\n\treturn vnode.nodeName(getNodeProps(vnode), context || EMPTY);\n}\n","import { clone, isString, isFunction, toLowerCase } from '../util';\nimport { isFunctionalComponent } from './functional-component';\n\n\n/** Check if two nodes are equivalent.\n *\t@param {Element} node\n *\t@param {VNode} vnode\n *\t@private\n */\nexport function isSameNodeType(node, vnode) {\n\tif (isString(vnode)) {\n\t\treturn node instanceof Text;\n\t}\n\tif (isString(vnode.nodeName)) {\n\t\treturn !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n\t}\n\tif (isFunction(vnode.nodeName)) {\n\t\treturn (node._componentConstructor ? node._componentConstructor===vnode.nodeName : true) || isFunctionalComponent(vnode);\n\t}\n}\n\n\nexport function isNamedNode(node, nodeName) {\n\treturn node.normalizedNodeName===nodeName || toLowerCase(node.nodeName)===toLowerCase(nodeName);\n}\n\n\n/**\n * Reconstruct Component-style `props` from a VNode.\n * Ensures default/fallback values from `defaultProps`:\n * Own-properties of `defaultProps` not present in `vnode.attributes` are added.\n * @param {VNode} vnode\n * @returns {Object} props\n */\nexport function getNodeProps(vnode) {\n\tlet props = clone(vnode.attributes);\n\tprops.children = vnode.children;\n\n\tlet defaultProps = vnode.nodeName.defaultProps;\n\tif (defaultProps) {\n\t\tfor (let i in defaultProps) {\n\t\t\tif (props[i]===undefined) {\n\t\t\t\tprops[i] = defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn props;\n}\n","import { NON_DIMENSION_PROPS, NON_BUBBLING_EVENTS } from '../constants';\nimport options from '../options';\nimport { toLowerCase, isString, isFunction, hashToClassName } from '../util';\n\n\n\n\n/** Removes a given DOM Node from its parent. */\nexport function removeNode(node) {\n\tlet p = node.parentNode;\n\tif (p) p.removeChild(node);\n}\n\n\n/** Set a named attribute on the given Node, with special behavior for some names and event handlers.\n *\tIf `value` is `null`, the attribute/handler will be removed.\n *\t@param {Element} node\tAn element to mutate\n *\t@param {string} name\tThe name/key to set, such as an event or attribute name\n *\t@param {any} old\tThe last value that was set for this name/node pair\n *\t@param {any} value\tAn attribute value, such as a function to be used as an event handler\n *\t@param {Boolean} isSvg\tAre we currently diffing inside an svg?\n *\t@private\n */\nexport function setAccessor(node, name, old, value, isSvg) {\n\n\tif (name==='className') name = 'class';\n\n\tif (name==='class' && value && typeof value==='object') {\n\t\tvalue = hashToClassName(value);\n\t}\n\n\tif (name==='key') {\n\t\t// ignore\n\t}\n\telse if (name==='class' && !isSvg) {\n\t\tnode.className = value || '';\n\t}\n\telse if (name==='style') {\n\t\tif (!value || isString(value) || isString(old)) {\n\t\t\tnode.style.cssText = value || '';\n\t\t}\n\t\tif (value && typeof value==='object') {\n\t\t\tif (!isString(old)) {\n\t\t\t\tfor (let i in old) if (!(i in value)) node.style[i] = '';\n\t\t\t}\n\t\t\tfor (let i in value) {\n\t\t\t\tnode.style[i] = typeof value[i]==='number' && !NON_DIMENSION_PROPS[i] ? (value[i]+'px') : value[i];\n\t\t\t}\n\t\t}\n\t}\n\telse if (name==='dangerouslySetInnerHTML') {\n\t\tif (value) node.innerHTML = value.__html || '';\n\t}\n\telse if (name[0]=='o' && name[1]=='n') {\n\t\tlet l = node._listeners || (node._listeners = {});\n\t\tname = toLowerCase(name.substring(2));\n\t\t// @TODO: this might be worth it later, un-breaks focus/blur bubbling in IE9:\n\t\t// if (node.attachEvent) name = name=='focus'?'focusin':name=='blur'?'focusout':name;\n\t\tif (value) {\n\t\t\tif (!l[name]) node.addEventListener(name, eventProxy, !!NON_BUBBLING_EVENTS[name]);\n\t\t}\n\t\telse if (l[name]) {\n\t\t\tnode.removeEventListener(name, eventProxy, !!NON_BUBBLING_EVENTS[name]);\n\t\t}\n\t\tl[name] = value;\n\t}\n\telse if (name!=='list' && name!=='type' && !isSvg && name in node) {\n\t\tsetProperty(node, name, value==null ? '' : value);\n\t\tif (value==null || value===false) node.removeAttribute(name);\n\t}\n\telse {\n\t\tlet ns = isSvg && name.match(/^xlink\\:?(.+)/);\n\t\tif (value==null || value===false) {\n\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', toLowerCase(ns[1]));\n\t\t\telse node.removeAttribute(name);\n\t\t}\n\t\telse if (typeof value!=='object' && !isFunction(value)) {\n\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', toLowerCase(ns[1]), value);\n\t\t\telse node.setAttribute(name, value);\n\t\t}\n\t}\n}\n\n\n/** Attempt to set a DOM property to the given value.\n *\tIE & FF throw for certain property-value combinations.\n */\nfunction setProperty(node, name, value) {\n\ttry {\n\t\tnode[name] = value;\n\t} catch (e) { }\n}\n\n\n/** Proxy an event to hooked event handlers\n *\t@private\n */\nfunction eventProxy(e) {\n\treturn this._listeners[e.type](options.event && options.event(e) || e);\n}\n","import { toLowerCase } from '../util';\nimport { removeNode } from './index';\n\n/** DOM node pool, keyed on nodeName. */\n\nconst nodes = {};\n\nexport function collectNode(node) {\n\tremoveNode(node);\n\n\tif (node instanceof Element) {\n\t\tnode._component = node._componentConstructor = null;\n\n\t\tlet name = node.normalizedNodeName || toLowerCase(node.nodeName);\n\t\t(nodes[name] || (nodes[name] = [])).push(node);\n\t}\n}\n\n\nexport function createNode(nodeName, isSvg) {\n\tlet name = toLowerCase(nodeName),\n\t\tnode = nodes[name] && nodes[name].pop() || (isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName));\n\tnode.normalizedNodeName = name;\n\treturn node;\n}\n","import { ATTR_KEY } from '../constants';\nimport { isString, isFunction } from '../util';\nimport { isSameNodeType, isNamedNode } from './index';\nimport { isFunctionalComponent, buildFunctionalComponent } from './functional-component';\nimport { buildComponentFromVNode } from './component';\nimport { setAccessor, removeNode } from '../dom/index';\nimport { createNode, collectNode } from '../dom/recycler';\nimport { unmountComponent } from './component';\nimport options from '../options';\n\n\n/** Queue of components that have been mounted and are awaiting componentDidMount */\nexport const mounts = [];\n\n/** Diff recursion count, used to track the end of the diff cycle. */\nexport let diffLevel = 0;\n\n/** Global flag indicating if the diff is currently within an SVG */\nlet isSvgMode = false;\n\n/** Global flag indicating if the diff is performing hydration */\nlet hydrating = false;\n\n/** Invoke queued componentDidMount lifecycle methods */\nexport function flushMounts() {\n\tlet c;\n\twhile ((c=mounts.pop())) {\n\t\tif (options.afterMount) options.afterMount(c);\n\t\tif (c.componentDidMount) c.componentDidMount();\n\t}\n}\n\n\n/** Apply differences in a given vnode (and it's deep children) to a real DOM Node.\n *\t@param {Element} [dom=null]\t\tA DOM node to mutate into the shape of the `vnode`\n *\t@param {VNode} vnode\t\t\tA VNode (with descendants forming a tree) representing the desired DOM structure\n *\t@returns {Element} dom\t\t\tThe created/mutated element\n *\t@private\n */\nexport function diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\t// diffLevel having been 0 here indicates initial entry into the diff (not a subdiff)\n\tif (!diffLevel++) {\n\t\t// when first starting the diff, check if we're diffing an SVG or within an SVG\n\t\tisSvgMode = parent && typeof parent.ownerSVGElement!=='undefined';\n\n\t\t// hydration is inidicated by the existing element to be diffed not having a prop cache\n\t\thydrating = dom && !(ATTR_KEY in dom);\n\t}\n\n\tlet ret = idiff(dom, vnode, context, mountAll);\n\n\t// append the element if its a new parent\n\tif (parent && ret.parentNode!==parent) parent.appendChild(ret);\n\n\t// diffLevel being reduced to 0 means we're exiting the diff\n\tif (!--diffLevel) {\n\t\thydrating = false;\n\t\t// invoke queued componentDidMount lifecycle methods\n\t\tif (!componentRoot) flushMounts();\n\t}\n\n\treturn ret;\n}\n\n\nfunction idiff(dom, vnode, context, mountAll) {\n\tlet ref = vnode && vnode.attributes && vnode.attributes.ref;\n\n\n\t// Resolve ephemeral Pure Functional Components\n\twhile (isFunctionalComponent(vnode)) {\n\t\tvnode = buildFunctionalComponent(vnode, context);\n\t}\n\n\n\t// empty values (null & undefined) render as empty Text nodes\n\tif (vnode==null) vnode = '';\n\n\n\t// Fast case: Strings create/update Text nodes.\n\tif (isString(vnode)) {\n\t\t// update if it's already a Text node\n\t\tif (dom && dom instanceof Text && dom.parentNode) {\n\t\t\tif (dom.nodeValue!=vnode) {\n\t\t\t\tdom.nodeValue = vnode;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// it wasn't a Text node: replace it with one and recycle the old Element\n\t\t\tif (dom) recollectNodeTree(dom);\n\t\t\tdom = document.createTextNode(vnode);\n\t\t}\n\n\t\treturn dom;\n\t}\n\n\n\t// If the VNode represents a Component, perform a component diff.\n\tif (isFunction(vnode.nodeName)) {\n\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t}\n\n\n\tlet out = dom,\n\t\tnodeName = String(vnode.nodeName),\t// @TODO this masks undefined component errors as `<undefined>`\n\t\tprevSvgMode = isSvgMode,\n\t\tvchildren = vnode.children;\n\n\n\t// SVGs have special namespace stuff.\n\t// This tracks entering and exiting that namespace when descending through the tree.\n\tisSvgMode = nodeName==='svg' ? true : nodeName==='foreignObject' ? false : isSvgMode;\n\n\n\tif (!dom) {\n\t\t// case: we had no element to begin with\n\t\t// - create an element with the nodeName from VNode\n\t\tout = createNode(nodeName, isSvgMode);\n\t}\n\telse if (!isNamedNode(dom, nodeName)) {\n\t\t// case: Element and VNode had different nodeNames\n\t\t// - need to create the correct Element to match VNode\n\t\t// - then migrate children from old to new\n\n\t\tout = createNode(nodeName, isSvgMode);\n\n\t\t// move children into the replacement node\n\t\twhile (dom.firstChild) out.appendChild(dom.firstChild);\n\n\t\t// if the previous Element was mounted into the DOM, replace it inline\n\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t// recycle the old element (skips non-Element node types)\n\t\trecollectNodeTree(dom);\n\t}\n\n\n\tlet fc = out.firstChild,\n\t\tprops = out[ATTR_KEY];\n\n\t// Attribute Hydration: if there is no prop cache on the element,\n\t// ...create it and populate it with the element's attributes.\n\tif (!props) {\n\t\tout[ATTR_KEY] = props = {};\n\t\tfor (let a=out.attributes, i=a.length; i--; ) props[a[i].name] = a[i].value;\n\t}\n\n\t// Optimization: fast-path for elements containing a single TextNode:\n\tif (!hydrating && vchildren && vchildren.length===1 && typeof vchildren[0]==='string' && fc && fc instanceof Text && !fc.nextSibling) {\n\t\tif (fc.nodeValue!=vchildren[0]) {\n\t\t\tfc.nodeValue = vchildren[0];\n\t\t}\n\t}\n\t// otherwise, if there are existing or new children, diff them:\n\telse if (vchildren && vchildren.length || fc) {\n\t\tinnerDiffNode(out, vchildren, context, mountAll, !!props.dangerouslySetInnerHTML);\n\t}\n\n\n\t// Apply attributes/props from VNode to the DOM Element:\n\tdiffAttributes(out, vnode.attributes, props);\n\n\n\t// invoke original ref (from before resolving Pure Functional Components):\n\tif (ref) {\n\t\t(props.ref = ref)(out);\n\t}\n\n\tisSvgMode = prevSvgMode;\n\n\treturn out;\n}\n\n\n/** Apply child and attribute changes between a VNode and a DOM Node to the DOM.\n *\t@param {Element} dom\t\tElement whose children should be compared & mutated\n *\t@param {Array} vchildren\tArray of VNodes to compare to `dom.childNodes`\n *\t@param {Object} context\t\tImplicitly descendant context object (from most recent `getChildContext()`)\n *\t@param {Boolean} mountAll\n *\t@param {Boolean} absorb\t\tIf `true`, consumes externally created elements similar to hydration\n */\nfunction innerDiffNode(dom, vchildren, context, mountAll, absorb) {\n\tlet originalChildren = dom.childNodes,\n\t\tchildren = [],\n\t\tkeyed = {},\n\t\tkeyedLen = 0,\n\t\tmin = 0,\n\t\tlen = originalChildren.length,\n\t\tchildrenLen = 0,\n\t\tvlen = vchildren && vchildren.length,\n\t\tj, c, vchild, child;\n\n\tif (len) {\n\t\tfor (let i=0; i<len; i++) {\n\t\t\tlet child = originalChildren[i],\n\t\t\t\tprops = child[ATTR_KEY],\n\t\t\t\tkey = vlen ? ((c = child._component) ? c.__key : props ? props.key : null) : null;\n\t\t\tif (key!=null) {\n\t\t\t\tkeyedLen++;\n\t\t\t\tkeyed[key] = child;\n\t\t\t}\n\t\t\telse if (hydrating || absorb || props || child instanceof Text) {\n\t\t\t\tchildren[childrenLen++] = child;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (vlen) {\n\t\tfor (let i=0; i<vlen; i++) {\n\t\t\tvchild = vchildren[i];\n\t\t\tchild = null;\n\n\t\t\t// if (isFunctionalComponent(vchild)) {\n\t\t\t// \tvchild = buildFunctionalComponent(vchild);\n\t\t\t// }\n\n\t\t\t// attempt to find a node based on key matching\n\t\t\tlet key = vchild.key;\n\t\t\tif (key!=null) {\n\t\t\t\tif (keyedLen && key in keyed) {\n\t\t\t\t\tchild = keyed[key];\n\t\t\t\t\tkeyed[key] = undefined;\n\t\t\t\t\tkeyedLen--;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// attempt to pluck a node of the same type from the existing children\n\t\t\telse if (!child && min<childrenLen) {\n\t\t\t\tfor (j=min; j<childrenLen; j++) {\n\t\t\t\t\tc = children[j];\n\t\t\t\t\tif (c && isSameNodeType(c, vchild)) {\n\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\tif (j===childrenLen-1) childrenLen--;\n\t\t\t\t\t\tif (j===min) min++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// morph the matched/found/created DOM child to match vchild (deep)\n\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\tif (child && child!==dom) {\n\t\t\t\tif (i>=len) {\n\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t}\n\t\t\t\telse if (child!==originalChildren[i]) {\n\t\t\t\t\tif (child===originalChildren[i+1]) {\n\t\t\t\t\t\tremoveNode(originalChildren[i]);\n\t\t\t\t\t}\n\t\t\t\t\tdom.insertBefore(child, originalChildren[i] || null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tif (keyedLen) {\n\t\tfor (let i in keyed) if (keyed[i]) recollectNodeTree(keyed[i]);\n\t}\n\n\t// remove orphaned children\n\twhile (min<=childrenLen) {\n\t\tchild = children[childrenLen--];\n\t\tif (child) recollectNodeTree(child);\n\t}\n}\n\n\n\n/** Recursively recycle (or just unmount) a node an its descendants.\n *\t@param {Node} node\t\t\t\t\t\tDOM node to start unmount/removal from\n *\t@param {Boolean} [unmountOnly=false]\tIf `true`, only triggers unmount lifecycle, skips removal\n */\nexport function recollectNodeTree(node, unmountOnly) {\n\tlet component = node._component;\n\tif (component) {\n\t\t// if node is owned by a Component, unmount that component (ends up recursing back here)\n\t\tunmountComponent(component, !unmountOnly);\n\t}\n\telse {\n\t\t// If the node's VNode had a ref function, invoke it with null here.\n\t\t// (this is part of the React spec, and smart for unsetting references)\n\t\tif (node[ATTR_KEY] && node[ATTR_KEY].ref) node[ATTR_KEY].ref(null);\n\n\t\tif (!unmountOnly) {\n\t\t\tcollectNode(node);\n\t\t}\n\n\t\t// Recollect/unmount all children.\n\t\t// - we use .lastChild here because it causes less reflow than .firstChild\n\t\t// - it's also cheaper than accessing the .childNodes Live NodeList\n\t\tlet c;\n\t\twhile ((c=node.lastChild)) recollectNodeTree(c, unmountOnly);\n\t}\n}\n\n\n\n/** Apply differences in attributes from a VNode to the given DOM Element.\n *\t@param {Element} dom\t\tElement with attributes to diff `attrs` against\n *\t@param {Object} attrs\t\tThe desired end-state key-value attribute pairs\n *\t@param {Object} old\t\t\tCurrent/previous attributes (from previous VNode or element's prop cache)\n */\nfunction diffAttributes(dom, attrs, old) {\n\t// remove attributes no longer present on the vnode by setting them to undefined\n\tlet name;\n\tfor (name in old) {\n\t\tif (!(attrs && name in attrs) && old[name]!=null) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t}\n\t}\n\n\t// add new & update changed attributes\n\tif (attrs) {\n\t\tfor (name in attrs) {\n\t\t\tif (name!=='children' && name!=='innerHTML' && (!(name in old) || attrs[name]!==(name==='value' || name==='checked' ? dom[name] : old[name]))) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Component } from '../component';\n\n/** Retains a pool of Components for re-use, keyed on component name.\n *\tNote: since component names are not unique or even necessarily available, these are primarily a form of sharding.\n *\t@private\n */\nconst components = {};\n\n\nexport function collectComponent(component) {\n\tlet name = component.constructor.name,\n\t\tlist = components[name];\n\tif (list) list.push(component);\n\telse components[name] = [component];\n}\n\n\nexport function createComponent(Ctor, props, context) {\n\tlet inst = new Ctor(props, context),\n\t\tlist = components[Ctor.name];\n\tComponent.call(inst, props, context);\n\tif (list) {\n\t\tfor (let i=list.length; i--; ) {\n\t\t\tif (list[i].constructor===Ctor) {\n\t\t\t\tinst.nextBase = list[i].nextBase;\n\t\t\t\tlist.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn inst;\n}\n","import { SYNC_RENDER, NO_RENDER, FORCE_RENDER, ASYNC_RENDER, ATTR_KEY } from '../constants';\nimport options from '../options';\nimport { isFunction, clone, extend } from '../util';\nimport { enqueueRender } from '../render-queue';\nimport { getNodeProps } from './index';\nimport { diff, mounts, diffLevel, flushMounts, recollectNodeTree } from './diff';\nimport { isFunctionalComponent, buildFunctionalComponent } from './functional-component';\nimport { createComponent, collectComponent } from './component-recycler';\nimport { removeNode } from '../dom/index';\n\n\n\n/** Set a component's `props` (generally derived from JSX attributes).\n *\t@param {Object} props\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.renderSync=false]\tIf `true` and {@link options.syncComponentUpdates} is `true`, triggers synchronous rendering.\n *\t@param {boolean} [opts.render=true]\t\t\tIf `false`, no render will be triggered.\n */\nexport function setComponentProps(component, props, opts, context, mountAll) {\n\tif (component._disable) return;\n\tcomponent._disable = true;\n\n\tif ((component.__ref = props.ref)) delete props.ref;\n\tif ((component.__key = props.key)) delete props.key;\n\n\tif (!component.base || mountAll) {\n\t\tif (component.componentWillMount) component.componentWillMount();\n\t}\n\telse if (component.componentWillReceiveProps) {\n\t\tcomponent.componentWillReceiveProps(props, context);\n\t}\n\n\tif (context && context!==component.context) {\n\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\tcomponent.context = context;\n\t}\n\n\tif (!component.prevProps) component.prevProps = component.props;\n\tcomponent.props = props;\n\n\tcomponent._disable = false;\n\n\tif (opts!==NO_RENDER) {\n\t\tif (opts===SYNC_RENDER || options.syncComponentUpdates!==false || !component.base) {\n\t\t\trenderComponent(component, SYNC_RENDER, mountAll);\n\t\t}\n\t\telse {\n\t\t\tenqueueRender(component);\n\t\t}\n\t}\n\n\tif (component.__ref) component.__ref(component);\n}\n\n\n\n/** Render a Component, triggering necessary lifecycle events and taking High-Order Components into account.\n *\t@param {Component} component\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.build=false]\t\tIf `true`, component will build and store a DOM node if not already associated with one.\n *\t@private\n */\nexport function renderComponent(component, opts, mountAll, isChild) {\n\tif (component._disable) return;\n\n\tlet skip, rendered,\n\t\tprops = component.props,\n\t\tstate = component.state,\n\t\tcontext = component.context,\n\t\tpreviousProps = component.prevProps || props,\n\t\tpreviousState = component.prevState || state,\n\t\tpreviousContext = component.prevContext || context,\n\t\tisUpdate = component.base,\n\t\tnextBase = component.nextBase,\n\t\tinitialBase = isUpdate || nextBase,\n\t\tinitialChildComponent = component._component,\n\t\tinst, cbase;\n\n\t// if updating\n\tif (isUpdate) {\n\t\tcomponent.props = previousProps;\n\t\tcomponent.state = previousState;\n\t\tcomponent.context = previousContext;\n\t\tif (opts!==FORCE_RENDER\n\t\t\t&& component.shouldComponentUpdate\n\t\t\t&& component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\tskip = true;\n\t\t}\n\t\telse if (component.componentWillUpdate) {\n\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t}\n\t\tcomponent.props = props;\n\t\tcomponent.state = state;\n\t\tcomponent.context = context;\n\t}\n\n\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\tcomponent._dirty = false;\n\n\tif (!skip) {\n\t\tif (component.render) rendered = component.render(props, state, context);\n\n\t\t// context to pass to the child, can be updated via (grand-)parent component\n\t\tif (component.getChildContext) {\n\t\t\tcontext = extend(clone(context), component.getChildContext());\n\t\t}\n\n\t\twhile (isFunctionalComponent(rendered)) {\n\t\t\trendered = buildFunctionalComponent(rendered, context);\n\t\t}\n\n\t\tlet childComponent = rendered && rendered.nodeName,\n\t\t\ttoUnmount, base;\n\n\t\tif (isFunction(childComponent)) {\n\t\t\t// set up high order component link\n\n\t\t\tlet childProps = getNodeProps(rendered);\n\t\t\tinst = initialChildComponent;\n\n\t\t\tif (inst && inst.constructor===childComponent && childProps.key==inst.__key) {\n\t\t\t\tsetComponentProps(inst, childProps, SYNC_RENDER, context);\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttoUnmount = inst;\n\n\t\t\t\tinst = createComponent(childComponent, childProps, context);\n\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\tinst._parentComponent = component;\n\t\t\t\tcomponent._component = inst;\n\t\t\t\tsetComponentProps(inst, childProps, NO_RENDER, context);\n\t\t\t\trenderComponent(inst, SYNC_RENDER, mountAll, true);\n\t\t\t}\n\n\t\t\tbase = inst.base;\n\t\t}\n\t\telse {\n\t\t\tcbase = initialBase;\n\n\t\t\t// destroy high order component link\n\t\t\ttoUnmount = initialChildComponent;\n\t\t\tif (toUnmount) {\n\t\t\t\tcbase = component._component = null;\n\t\t\t}\n\n\t\t\tif (initialBase || opts===SYNC_RENDER) {\n\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t}\n\t\t}\n\n\t\tif (initialBase && base!==initialBase && inst!==initialChildComponent) {\n\t\t\tlet baseParent = initialBase.parentNode;\n\t\t\tif (baseParent && base!==baseParent) {\n\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\tif (!toUnmount) {\n\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\trecollectNodeTree(initialBase);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (toUnmount) {\n\t\t\tunmountComponent(toUnmount, base!==initialBase);\n\t\t}\n\n\t\tcomponent.base = base;\n\t\tif (base && !isChild) {\n\t\t\tlet componentRef = component,\n\t\t\t\tt = component;\n\t\t\twhile ((t=t._parentComponent)) {\n\t\t\t\t(componentRef = t).base = base;\n\t\t\t}\n\t\t\tbase._component = componentRef;\n\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t}\n\t}\n\n\tif (!isUpdate || mountAll) {\n\t\tmounts.unshift(component);\n\t}\n\telse if (!skip) {\n\t\tif (component.componentDidUpdate) {\n\t\t\tcomponent.componentDidUpdate(previousProps, previousState, previousContext);\n\t\t}\n\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t}\n\n\tlet cb = component._renderCallbacks, fn;\n\tif (cb) while ( (fn = cb.pop()) ) fn.call(component);\n\n\tif (!diffLevel && !isChild) flushMounts();\n}\n\n\n\n/** Apply the Component referenced by a VNode to the DOM.\n *\t@param {Element} dom\tThe DOM node to mutate\n *\t@param {VNode} vnode\tA Component-referencing VNode\n *\t@returns {Element} dom\tThe created/mutated element\n *\t@private\n */\nexport function buildComponentFromVNode(dom, vnode, context, mountAll) {\n\tlet c = dom && dom._component,\n\t\toriginalComponent = c,\n\t\toldDom = dom,\n\t\tisDirectOwner = c && dom._componentConstructor===vnode.nodeName,\n\t\tisOwner = isDirectOwner,\n\t\tprops = getNodeProps(vnode);\n\twhile (c && !isOwner && (c=c._parentComponent)) {\n\t\tisOwner = c.constructor===vnode.nodeName;\n\t}\n\n\tif (c && isOwner && (!mountAll || c._component)) {\n\t\tsetComponentProps(c, props, ASYNC_RENDER, context, mountAll);\n\t\tdom = c.base;\n\t}\n\telse {\n\t\tif (originalComponent && !isDirectOwner) {\n\t\t\tunmountComponent(originalComponent, true);\n\t\t\tdom = oldDom = null;\n\t\t}\n\n\t\tc = createComponent(vnode.nodeName, props, context);\n\t\tif (dom && !c.nextBase) {\n\t\t\tc.nextBase = dom;\n\t\t\t// passing dom/oldDom as nextBase will recycle it if unused, so bypass recycling on L241:\n\t\t\toldDom = null;\n\t\t}\n\t\tsetComponentProps(c, props, SYNC_RENDER, context, mountAll);\n\t\tdom = c.base;\n\n\t\tif (oldDom && dom!==oldDom) {\n\t\t\toldDom._component = null;\n\t\t\trecollectNodeTree(oldDom);\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n\n\n/** Remove a component from the DOM and recycle it.\n *\t@param {Element} dom\t\t\tA DOM node from which to unmount the given Component\n *\t@param {Component} component\tThe Component instance to unmount\n *\t@private\n */\nexport function unmountComponent(component, remove) {\n\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\t// console.log(`${remove?'Removing':'Unmounting'} component: ${component.constructor.name}`);\n\tlet base = component.base;\n\n\tcomponent._disable = true;\n\n\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\tcomponent.base = null;\n\n\t// recursively tear down & recollect high-order component children:\n\tlet inner = component._component;\n\tif (inner) {\n\t\tunmountComponent(inner, remove);\n\t}\n\telse if (base) {\n\t\tif (base[ATTR_KEY] && base[ATTR_KEY].ref) base[ATTR_KEY].ref(null);\n\n\t\tcomponent.nextBase = base;\n\n\t\tif (remove) {\n\t\t\tremoveNode(base);\n\t\t\tcollectComponent(component);\n\t\t}\n\t\tlet c;\n\t\twhile ((c=base.lastChild)) recollectNodeTree(c, !remove);\n\t\t// removeOrphanedChildren(base.childNodes, true);\n\t}\n\n\tif (component.__ref) component.__ref(null);\n\tif (component.componentDidUnmount) component.componentDidUnmount();\n}\n","import { FORCE_RENDER } from './constants';\nimport { extend, clone, isFunction } from './util';\nimport { createLinkedState } from './linked-state';\nimport { renderComponent } from './vdom/component';\nimport { enqueueRender } from './render-queue';\n\n/** Base Component class, for the ES6 Class method of creating Components\n *\t@public\n *\n *\t@example\n *\tclass MyFoo extends Component {\n *\t\trender(props, state) {\n *\t\t\treturn <div />;\n *\t\t}\n *\t}\n */\nexport function Component(props, context) {\n\t/** @private */\n\tthis._dirty = true;\n\t// /** @public */\n\t// this._disableRendering = false;\n\t// /** @public */\n\t// this.prevState = this.prevProps = this.prevContext = this.base = this.nextBase = this._parentComponent = this._component = this.__ref = this.__key = this._linkedStates = this._renderCallbacks = null;\n\t/** @public */\n\tthis.context = context;\n\t/** @type {object} */\n\tthis.props = props;\n\t/** @type {object} */\n\tif (!this.state) this.state = {};\n}\n\n\nextend(Component.prototype, {\n\n\t/** Returns a `boolean` value indicating if the component should re-render when receiving the given `props` and `state`.\n\t *\t@param {object} nextProps\n\t *\t@param {object} nextState\n\t *\t@param {object} nextContext\n\t *\t@returns {Boolean} should the component re-render\n\t *\t@name shouldComponentUpdate\n\t *\t@function\n\t */\n\t// shouldComponentUpdate() {\n\t// \treturn true;\n\t// },\n\n\n\t/** Returns a function that sets a state property when called.\n\t *\tCalling linkState() repeatedly with the same arguments returns a cached link function.\n\t *\n\t *\tProvides some built-in special cases:\n\t *\t\t- Checkboxes and radio buttons link their boolean `checked` value\n\t *\t\t- Inputs automatically link their `value` property\n\t *\t\t- Event paths fall back to any associated Component if not found on an element\n\t *\t\t- If linked value is a function, will invoke it and use the result\n\t *\n\t *\t@param {string} key\t\tThe path to set - can be a dot-notated deep key\n\t *\t@param {string} [eventPath]\tIf set, attempts to find the new state value at a given dot-notated path within the object passed to the linkedState setter.\n\t *\t@returns {function} linkStateSetter(e)\n\t *\n\t *\t@example Update a \"text\" state value when an input changes:\n\t *\t\t<input onChange={ this.linkState('text') } />\n\t *\n\t *\t@example Set a deep state value on click\n\t *\t\t<button onClick={ this.linkState('touch.coords', 'touches.0') }>Tap</button\n\t */\n\tlinkState(key, eventPath) {\n\t\tlet c = this._linkedStates || (this._linkedStates = {});\n\t\treturn c[key+eventPath] || (c[key+eventPath] = createLinkedState(this, key, eventPath));\n\t},\n\n\n\t/** Update component state by copying properties from `state` to `this.state`.\n\t *\t@param {object} state\t\tA hash of state properties to update with new values\n\t */\n\tsetState(state, callback) {\n\t\tlet s = this.state;\n\t\tif (!this.prevState) this.prevState = clone(s);\n\t\textend(s, isFunction(state) ? state(s, this.props) : state);\n\t\tif (callback) (this._renderCallbacks = (this._renderCallbacks || [])).push(callback);\n\t\tenqueueRender(this);\n\t},\n\n\n\t/** Immediately perform a synchronous re-render of the component.\n\t *\t@private\n\t */\n\tforceUpdate() {\n\t\trenderComponent(this, FORCE_RENDER);\n\t},\n\n\n\t/** Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n\t *\tVirtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n\t *\t@param {object} props\t\tProps (eg: JSX attributes) received from parent element/component\n\t *\t@param {object} state\t\tThe component's current state\n\t *\t@param {object} context\t\tContext object (if a parent component has provided context)\n\t *\t@returns VNode\n\t */\n\trender() {}\n\n});\n","import { diff } from './vdom/diff';\n\n/** Render JSX into a `parent` Element.\n *\t@param {VNode} vnode\t\tA (JSX) VNode to render\n *\t@param {Element} parent\t\tDOM element to render into\n *\t@param {Element} [merge]\tAttempt to re-use an existing DOM tree rooted at `merge`\n *\t@public\n *\n *\t@example\n *\t// render a div into <body>:\n *\trender(<div id=\"hello\">hello!</div>, document.body);\n *\n *\t@example\n *\t// render a \"Thing\" component into #foo:\n *\tconst Thing = ({ name }) => <span>{ name }</span>;\n *\trender(<Thing name=\"one\" />, document.querySelector('#foo'));\n */\nexport function render(vnode, parent, merge) {\n\treturn diff(merge, vnode, {}, false, parent);\n}\n","// for making conditional class making easier in react\nexport const classMaker = (a, b, class_1, class_2) => a === b ? class_1: class_2 \n\n// check if a string is a date for applying condition formatting to years.\n// I should use indexOf to check against an array of dates but ¯\\_(ツ)_/¯ \nexport function isDate(str) {\n  for (var i = 2006; i < 2050; i++) {\n    if (str === i) return true\n  }\n  return false\n}","import { h, render, Component } from 'preact';\nimport './Tab.css'\nimport {classMaker} from '../../../utils';\n\nconst Tab = ({id, name, currentView, icon, changeView}) => {\n\n  const tabClasses = classMaker(currentView, id, 'Tab selected', 'Tab')\n  const iconClasses = classMaker(currentView, id, `${icon} tab-icon selected`, `${icon} tab-icon`)\n\n  return (\n    <button class={tabClasses} onClick={() => changeView(id)}>\n      <icon class={iconClasses} />\n      {name}\n    </button>\n  );\n};\n\nexport default Tab;","import { h, render, Component } from 'preact';\nimport './tabBar.css'\nimport Tab from './tab/tab';\n\n/**\n * List to iterate over and generate tab commponents with.\n */\nconst tabs = [\n  {name: \"Home\", id: \"home\", icon: \"fa fa-home\"},\n  {name: \"Add A Story\", id: \"story\", icon: \"fa fa-commenting-o\"},\n  {name: \"Filters / Legend\", id: \"legend\", icon: \"fa fa-map-marker\"},\n  {name: \"Currently Showing\", id: \"currently_showing\", icon: \"fa fa-eye\"},\n  {name: \"Your Selection\", id: \"your_selection\", icon: \"fa fa-commenting\"},\n  {name: \"About\", id:\"about\", icon: \"fa fa-clone\"},\n]\n\n\n/**\n * Constructs the menu tabs that are clickable. \n */\nconst TabBar = props => {\n  const renderTabs = () => {\n    return tabs.map(tab => {\n      return <Tab {...tab} currentView={props.currentView} changeView={props.changeView} />\n    })\n  }\n\n  return (\n    <div class=\"Tabbar\">\n      {renderTabs()}\n      <div class=\"Tabbar__fillspace\"></div>\n    </div>\n\n  );\n};\n\nexport default TabBar;","import { h, render } from 'preact';\nimport './styles.css'\n\nconst Header = props => {\n  const genClassName = () => {\n    switch(props.type){\n      case 'large':\n        return 'Header large'\n      default: \n        return 'Header'\n    }\n  }\n\n\n  return (\n    <div class={genClassName()} style={props.style}>\n     {props.children} \n    </div>\n  );\n};\n\nexport default Header;","import { h, render } from 'preact';\nimport './styles.css'\n\nconst Button = props => {\n  const genClassName = () => {\n    switch(props.type){\n      case 'large':\n        return 'Button large'\n      default: \n        return 'Button'\n    }\n  }\n\n\n  return (\n    <button \n      onClick={props.onClick}\n      class={genClassName()} \n      style={props.style}>\n     {props.children} \n    </button>\n  );\n};\n\nexport default Button;","import { h, render } from 'preact';\nimport './styles.css'\nimport Header from '../../../UiKit/Header/index';\nimport Button from '../../../UiKit/Button/index';\n\nconst Home = ({changeView}) => {\n  return (\n    <div>\n\n      {/* General Welcome Message  */}\n      <section class=\"Home__welcome\">\n        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Veniam quidem voluptatem laudantium fuga iste nulla eligendi mollitia velit amet laborum, quia blanditiis rerum, eius nobis quod ipsam sit recusandae ratione!\n      </section>\n\n      {/* Add a story CTA */}\n      <section class=\"Home__cta-addstory\">\n        <p>We'd love to hear your stories!</p>\n        <Button onClick={() => changeView('story')}>Add a story ▶</Button>\n      </section>\n\n    </div>\n  );\n};\n\nexport default Home;\n","import { h, render } from 'preact';\nimport Header from '../../../UiKit/Header/index';\n\nconst About = () => {\n  return (\n    <div>\n      <Header>About</Header>\n      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nesciunt culpa, iste repellendus a, provident saepe! Illum exercitationem, ipsa! Magnam consequatur, nam, atque tempore nihil perspiciatis? Reiciendis sequi est reprehenderit veniam.</p>\n      <p>Doloribus, perferendis ipsa veritatis vitae consequuntur ut autem! Repellendus odit cum cupiditate ab eum laudantium, voluptas hic libero eaque distinctio dolor, nesciunt error eligendi tenetur itaque earum aut ipsa aliquid.</p>\n      <p>Quaerat doloremque suscipit aperiam, velit, perspiciatis mollitia officia ad vero reprehenderit veritatis dolores blanditiis reiciendis iusto quisquam, quasi, incidunt ab hic. Fugit necessitatibus tempore cupiditate aspernatur quaerat. Itaque, labore, provident.</p>\n      <p>Aspernatur, error. Consequatur eos, laudantium unde vitae ipsam voluptatem neque ea quod et velit voluptatum nihil, aperiam. Quod tenetur, rem consequuntur itaque dignissimos saepe est? Modi laudantium delectus tempora ut.</p>\n      <p>Unde a neque laudantium beatae voluptas tenetur, expedita consequuntur nemo quos dolorem quasi, amet quo perspiciatis! Aspernatur nesciunt modi perspiciatis ea nisi iste quam voluptate veritatis. Facilis minus aperiam, perspiciatis.</p>\n\n      <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nesciunt culpa, iste repellendus a, provident saepe! Illum exercitationem, ipsa! Magnam consequatur, nam, atque tempore nihil perspiciatis? Reiciendis sequi est reprehenderit veniam.</p>\n      <p>Doloribus, perferendis ipsa veritatis vitae consequuntur ut autem! Repellendus odit cum cupiditate ab eum laudantium, voluptas hic libero eaque distinctio dolor, nesciunt error eligendi tenetur itaque earum aut ipsa aliquid.</p>\n      <p>Quaerat doloremque suscipit aperiam, velit, perspiciatis mollitia officia ad vero reprehenderit veritatis dolores blanditiis reiciendis iusto quisquam, quasi, incidunt ab hic. Fugit necessitatibus tempore cupiditate aspernatur quaerat. Itaque, labore, provident.</p>\n      <p>Aspernatur, error. Consequatur eos, laudantium unde vitae ipsam voluptatem neque ea quod et velit voluptatum nihil, aperiam. Quod tenetur, rem consequuntur itaque dignissimos saepe est? Modi laudantium delectus tempora ut.</p>\n      <p>Unde a neque laudantium beatae voluptas tenetur, expedita consequuntur nemo quos dolorem quasi, amet quo perspiciatis! Aspernatur nesciunt modi perspiciatis ea nisi iste quam voluptate veritatis. Facilis minus aperiam, perspiciatis.</p>\n     <Header> Documentation </Header> \n    </div>\n  );\n};\n\nexport default About;","import { h, render } from 'preact';\nimport Header from '../../../UiKit/Header/index';\nimport Button from '../../../UiKit/Button/index';\n\nconst YourSelection = ({changeView}) => {\n  return (\n    <div>\n      <Header>Your Selection</Header>\n\n      {/* Add a story CTA */}\n      <section class=\"YourSelection__cta-addstory\">\n        <p>Ready to add your own story?</p>\n        <Button onClick={() => changeView('story')}>Add a story ▶</Button>\n      </section>\n\n      <h3>Click any story to edit</h3>\n      <div id=\"sentences\"> </div>\n\n    </div>\n  );\n};\n\nexport default YourSelection;\n","import { h, render } from 'preact';\nimport Header from '../../../UiKit/Header/index';\n\nconst Current = () => {\n  return (\n    <div>\n      <Header>Currently Showing</Header>\n      <h3>Click any story to edit</h3>\n      <div id=\"sentences\"> </div>\n    </div>\n  );\n};\n\nexport default Current;\n","import { h, render } from 'preact';\nimport './styles.css'\n\nconst LegendItem = (props) => {\n  let filter_is_on = props.currentFilters.indexOf(props.filter_key)\n\n  const containerStyles = {\n    display: 'flex',\n    alignItems: 'center',\n    margin: '1rem 0',\n    cursor: 'pointer',\n  }\n\n  const circleStyles = { \n    display: 'inline-block',\n    width: props.size || '0px',\n    height: props.size ||'0px',\n    background: filter_is_on !== -1 ? props.selected : props.color,\n    borderRadius: '50%',\n    marginRight: '1rem',\n    borderBottom: filter_is_on !== -1 ? '1px solid black' : '0',\n  }\n\n  const textStyles = {\n    borderBottom: filter_is_on !== -1 ? '1px solid black' : '0',\n  }\n\n  return (\n    <div style={containerStyles}>\n      <div style={circleStyles}/>\n      <span onClick={() => props.toggleFilter(props.filter_key)} style={textStyles}>{props.children}</span>\n    </div>\n  );\n}\n\nexport default LegendItem;","import { h, render, Component } from 'preact';\nimport Header from '../../../UiKit/Header'\nimport './styles.css'\nimport LegendItem from '../../../UiKit/LegendItem';\nimport Button from '../../../UiKit/Button'\n\n// TODO: find out if EDGES need to be filterable (like NODES are clickable to toggle)\nconst LegendNodes = [{\n        name: 'Event',\n        color: '#FF1E3A',\n        selected: 'grey',\n        filter_key: 'event',\n    },\n    {\n        name: 'Individual',\n        color: '#00A3D8',\n        selected: 'grey',\n        filter_key: 'person',\n    },\n    {\n        name: 'Group',\n        color: '#00AE57',\n        selected: 'grey',\n        filter_key: 'org',\n    },\n    {\n        name: 'Outcome',\n        color: '#FFE98F',\n        selected: 'grey',\n        filter_key: 'outcome',\n    },\n]\n\nconst LegendEdges = [{\n        name: 'Participated',\n        filter_key: 'participated',\n        color: 'rgba(52, 73, 94, 0.7)'\n    },\n    {\n        name: 'Lead',\n        filter_key: 'lead',\n        color: 'rgba(231, 76, 60, 0.7)'\n    },\n    {\n        name: 'Inspired',\n        filter_key: 'inspired',\n        color: 'rgba(241, 196, 15, 0.7)'\n    },\n    {\n        name: 'Organized',\n        filter_key: 'organized',\n        color: \"rgba(141, 196, 215, 0.7)\"\n    },\n    {\n        name: 'Met',\n        filter_key: 'met',\n        color: 'rgba(102, 39, 239, 0.7)'\n    },\n]\n\n\n/* ----- Preact Jams ----- */\n\nclass Legend extends Component {\n  state = {\n    currentFilters: [],\n  }\n\n\n  toggleFilter = (filter) => {\n    let cur_filters = this.state.currentFilters\n    let filter_exists = cur_filters.indexOf(filter)\n\n    // if filter already exists, remove it\n    if (filter_exists !== -1) {\n      cur_filters.splice(filter_exists, 1)\n      this.setState({currentFilters: cur_filters})\n    }\n    else {\n      this.setState({\n        ...this.state,\n        currentFilters: [...this.state.currentFilters, filter]\n      })\n    }\n\n    // FIXME: this is leaking into the global space\n    window.filter_poo = this.state.currentFilters\n    window.rm_render()\n  }\n\n  renderNodes = () => {\n    return LegendNodes.map(node => (\n      <LegendItem\n        {...node}\n        size=\"15px\"\n        toggleFilter={this.toggleFilter}\n        currentFilters = {this.state.currentFilters}\n      >\n        {node.name}\n      </LegendItem>)\n  )}\n\n  renderEdges = () => {\n    return LegendEdges.map(node => (\n      <LegendItem\n        {...node}\n        size=\"15px\"\n        currentFilters = {this.state.currentFilters}\n        toggleFilter={this.toggleFilter}\n      >\n        {node.name}\n      </LegendItem>\n    ))\n  }\n\n  render() {\n    return (\n      <div class=\"Legend\">\n\n        {/* Render the \"Nodes\" column (with colored legend items */}\n        <section class=\"Legend__columns\" >\n          <section class=\"Legend__column\" style={{paddingRight: '10px'}}>\n            <Header>Nodes</Header>\n            {this.renderNodes()}\n          </section>\n\n        {/* Render the \"Edges\" column (and \"Hide all\"\" button) */}\n          <section class=\"Legend__column\" style={{paddingLeft: '10px'}}>\n            <Header>Edges</Header>\n            {this.renderEdges()}\n            {/* <Button><icon class=\"fa fa-eye-slash\" style={{paddingRight: '1rem'}} />Hide all </Button> */}\n          </section>\n        </section>\n\n        {/* Years Section */}\n        <section class=\"Legend__years\">\n          <Header> Years </Header>\n          {/* TODO: year slider */}\n        </section>\n\n        {/* Keys Section */}\n        <section class=\"Legend__keys\">\n          <Header> Keys </Header>\n          <p>'←' for previous year</p>\n          <p>'→' for next year</p>\n          <p>'e' toggles recent connections</p>\n          <p>'f' toggles filter stories by year</p>\n          <p>'l' for legend edges</p>\n        </section>\n\n      </div>\n    );\n  }\n}\n\nexport default Legend;\n","import { h, render } from 'preact';\nimport Header from '../../../UiKit/Header/index';\n\nconst Story = () => {\n  return (\n    <div>\n      <Header>Add a story</Header>\n\n      <div id=\"signup\">\n        <form id=\"login\">\n          <p>We'd love to hear your stories! Let's start with your contact info:</p>\n          <input name=\"email\" id=\"email\" type=\"text\" placeholder=\"email\" class=\"typeahead\" />\n        </form>\n      </div>\n\n      <div id=\"storytime\" class=\"hide\">\n        <h3>Want to add something to the map?</h3>\n        <form id=\"the-conversation\"></form>\n      </div>\n\n      {/* TODO: give this a top-border */}\n      {/* TODO: connect this to form submission */}\n      <NextButton>Next &gt;</NextButton>\n\n    </div>\n  );\n};\n\nexport default Story;\n","import { h, render, Component } from 'preact';\nimport './sidebar.css'\nimport TabBar from './tabBar/tabBar';\nimport Home from './views/home/index';\nimport About from './views/about/index';\nimport YourSelection from './views/yourSelection/index';\nimport Current from './views/current/index';\nimport Legend from './views/legend/index';\nimport Story from './views/story/index';\n\n/**\n * Sidebar layout and state\n */\nclass Sidebar extends Component {\n  state = {\n    currentView: 'home'\n  }\n\n  componentDidMount() {\n    window.do_the_glue()\n  }\n\n  componentDidUpdate() {\n    window.render_all()\n    window.do_the_glue()\n  }\n\n  changeView = (view_id) => {\n    this.setState({\n      currentView: view_id\n    })\n    // on transitioning to different component sub views... run glue?\n    window.do_the_glue()\n  }\n\n  renderSelectedView = () => {\n    switch(this.state.currentView){\n\n      case 'home':\n        return (<Home changeView={this.changeView} />)\n\n      case 'story':\n        return <Story />\n\n      case 'legend':\n        return <Legend />\n\n      case 'currently_showing':\n        return (<Current />)\n\n      case 'your_selection':\n        return (<YourSelection changeView={this.changeView}/>)\n\n      case 'about':\n        return <About />\n\n      default:\n        return <Home />\n    }\n  }\n\n  render() {\n    return (\n      <aside class=\"Sidebar\">\n\n        {/* Render different views based on which section is selected*/}\n        <section class=\"Sidebar__container\">\n          <h3 class=\"Sidebar__header\">AMC Ripple Map</h3>\n          {this.renderSelectedView()}\n        </section>\n\n        <TabBar currentView={this.state.currentView} changeView={this.changeView} />\n\n      </aside>\n    );\n  }\n}\n\nexport default Sidebar;\n","const state = {}\nexport default state\n\nstate.tags = [] // THINK: default to ['plain']?\nstate.facts = []\nstate.tagkeys = {}\nstate.query = {}\n\nstate.safe_mode = false\nstate.loading = true // TODO: fix this\n\nstate.all_edges        = true  // awkward... :(\nstate.admin_mode       = false // yep another hack w00t\nstate.my_maxyear       = 2017  // total hackery...\nstate.my_minyear       = 2008  // hack hack hack\nstate.show_labels      = false // yup\nstate.current_year     = 2017  // more hacks\nstate.filter_sentences = false // awkward... :(\nstate.ring_radius      = 40    // lalala\n","import {G} from 'graph'\nimport state from 'state'\n\nexport {add_to_server_facts, persist, get_facts_from_server}\n\n\n\n\nfunction add_to_server_facts(type, live_item) {\n  if(state.loading)\n    return undefined\n\n  /*\n\n   data model:\n   user: id\n   action: add/remove/edit\n   type: node/edge\n   tags: [...]\n   [maybe other stats can live here?]\n   data:\n     node: {id, name, type, cat...}\n     edge: {_in, _out, type, label}\n\n   */\n\n  // var item = JSON.parse(JSON.stringify(live_item))\n  var item = Object.keys(live_item).reduce(function(acc, key) {\n        if(['_in', '_out'].indexOf(key) !== -1) return acc\n        acc[key] = live_item[key]\n        return acc\n      }, {})\n\n  if(type === 'edge') {\n    item._out = live_item._out._id\n    item._in  = live_item._in._id\n  }\n\n  // FIXME: present splash page of some kind\n\n  var fact = { email: state.email\n             , action: 'add'\n             , type: type\n             , tags: state.tags\n             , data: item\n             }\n\n  send_data_to_server(fact)\n}\n\nfunction persist() {\n  // THINK: do we still need localstorage caching?\n  Dagoba.persist(G, 'rripplemap')\n}\n\npersist = debounce(persist, 1000)\n\nfunction debounce(func, wait, immediate) {\n  // via underscore, needs cleaning\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n\n  var timeout\n  return function() {\n    var context = this, args = arguments\n    var later = function() {\n          timeout = null\n          if (!immediate) func.apply(context, args)\n        }\n    var callNow = immediate && !timeout\n    clearTimeout(timeout)\n    timeout = setTimeout(later, wait)\n    if (callNow) func.apply(context, args)\n  }\n}\n\nfunction send_data_to_server(data, cb) {\n  var url = 'http://ripplemap.io:8888'\n\n  if(state.safe_mode === 'daring') {\n    url = 'http://localhost:8888'\n  }\n  else if(state.safe_mode) {\n    return console.log(G)\n  }\n\n  fetch(url, { method: 'post'\n             , body: JSON.stringify(data)\n  }).then(function(response) {\n    return response.json()\n  }).then(function(result) {\n    if(cb)\n      cb(result)\n  })\n}\n\nfunction get_facts_from_server(cb) {\n  var url = 'http://ripplemap.io:8888'\n\n  // local shunt for airplane mode\n  if(state.safe_mode === 'local')\n    return cb(JSON.parse(localStorage['DAGOBA::ripmapdata']))\n\n  if(state.safe_mode === 'daring') {\n    url = 'http://localhost:8888'\n  }\n\n  fetch(url, {\n    method: 'get'\n  }).then(function(response) {\n    return response.json()\n  }).then(function(data) {\n    cb(data)\n  }).catch(function(err) {\n    console.log('lalalal', err)\n  })\n}\n","// Some fun functions that help or something\n\nexport {noop, not, eq, unique, strip, comp, prop, cp_prop, clone, truncate, push_it, pipe, error}\n\n\nfunction noop() {}\n\nfunction not(fun) {return function() {return !fun.apply(null, arguments)}}\n\nfunction eq(attr, val) {return function(obj) {return obj[attr] === val}}\n\nfunction unique(v, k, list) {return list.indexOf(v) === k}\n\nfunction strip(attr) {return function(obj) { delete obj[attr]; return obj }}\n\nfunction comp(f, g) {return function() { var args = [].slice.call(arguments); return f(g.apply(null, args)) }}\n\nfunction prop (attr) {return function(obj) {return obj[attr]}}\n\nfunction cp_prop(from_attr, to_attr) {return function(obj) {obj[to_attr] = obj[from_attr]; return obj}}\n\nfunction clone(obj) {return JSON.parse(JSON.stringify(obj))}\n\nfunction truncate(str, to) {\n  if(!to || str.length <= to) return str\n  return str.substr(0, to-2) + '...'\n}\n\nfunction push_it(list, key, val) {\n  if(!list[key])\n    return list[key] = [val]\n\n  list[key].push(val)\n  return list[key]\n}\n\nfunction pipe() {\n  var all_funs = [].slice.call(arguments)\n\n  function magic_pipe(data) {\n    var funs = all_funs.slice()\n    var fun\n\n    function inner() {\n      while(fun = funs.shift()) {\n        if(fun.async) {              // fun is async\n          return fun.async(data, cb)\n        } else {                     // fun is a function\n          data = fun(data)\n        }\n      }\n    }\n\n    function cb(new_data) {\n      data = new_data\n      inner()\n    }\n\n    // TODO: this should return a promise for data\n    inner()\n    return true\n  }\n\n  return magic_pipe\n}\n\nfunction error(mess) {\n  console.log(arguments, mess)\n}\n","import {G} from 'graph'\nimport {error, clone} from 'fun'\nimport {add_to_server_facts} from 'net'\n\nexport const cats = {} // ripplemap categories\nexport {add_thing, add_action, add_edge}\n\n/* INTERFACES FOR RIPPLE MODEL\n *\n * There are four categories: Thing, Action, Effect, and Happening\n *\n * Each category has multiple types associated with it. Each node has a category and type.\n *\n * Each node also tracks its cron, the adding user, and some type of 'confidence interval' (later)\n *\n * Each edge has a type, which is its label. Nodes expect edges of certain types.\n *\n */\n\ncats.thing = {}\ncats.action = {}\ncats.effect = {}\ncats.happening = {}\n\nfunction get_node(catstr, typestr, props) {\n  var node = convert_props(props)\n\n  var cat = cats[catstr]\n  if(!cat)\n    return error('that is not a valid cat', catstr)\n\n  var type = cat[typestr]\n  if(!type)\n    return error('that is not a valid ' + catstr + ' type', typestr)\n\n  // TODO: check props again the cattype's property list\n\n  node.cat  = catstr\n  node.type = typestr\n  node.name = props.name || typestr // TODO: remove (or something...)\n\n  return node\n}\n\nfunction add_alias(catstr, typestr, alias) {\n  // TODO: check alias\n\n  // add an alias to anything\n  var cat = cats[catstr]\n  if(!cat)\n    return error('Invalid cat', catstr)\n\n  var type = cat[typestr]\n  if(!type)\n    return error('That is not a valid thing type', typestr)\n\n  // add alias\n  type.aliases.push(alias)\n\n  // add type to list\n  cat[alias] = type\n\n  // THINK: alias rules?\n}\n\n\nfunction add_thing(type, props, persist) {\n  var node = get_node('thing', type, props)\n  if(!node) return false\n\n  node.priority = 1 // bbq???\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n\n  return node\n}\n\nfunction add_action(type, props, persist) {\n  var node = get_node('action', type, props)\n  if(!node) return false\n\n  node.priority = 1 // bbq???\n\n  // TODO: check props against type (what does this mean?)\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n\n  return node\n}\n\nfunction add_effect(type, props, persist) {\n  var node = get_node('effect', type, props)\n  if(!node) return undefined\n\n  node.priority = 0.5 // bbq???\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n}\n\nfunction add_happening(type, props, persist) {\n  var node = get_node('happening', type, props)\n  if(!node) return undefined\n\n  node.priority = 0.4\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n}\n\n\n\nfunction new_thing_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.thing[type]\n  if(cattype)\n    return error('That thing type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // add properties.cc\n  cattype.cc = properties.cc || {}\n\n  // add default props for all things\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.props.name = {}\n  cattype.props.start = {} // THINK: these have both fuzziness and confidence issues (how sure is the user of the time, how sure are we of the user)\n  cattype.props.end = {}\n\n  // TODO: add questions\n\n  // put in place\n  cats.thing[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('thing', type, alias)\n    })\n  }\n}\n\nfunction new_action_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.action[type]\n  if(cattype)\n    return error('That action type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.did = {dir: 'in',  plural: 0, label: 'did', types: ['person'], aliases: []}\n  cattype.edges.to  = {dir: 'in',  plural: 0, label: 'to',  types: ['effect'], aliases: []}\n  cattype.edges.the = {dir: 'out', plural: 0, label: 'the', types: ['thing'],  aliases: []}\n\n  // add default props for all actions\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.action[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('action', type, alias)\n    })\n  }\n}\n\nfunction new_effect_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.effect[type]\n  if(cattype)\n    return error('That effect type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.to     = {dir: 'out', plural: 0, label: 'to',     types: ['action'],    aliases: []}\n  cattype.edges.by     = {dir: 'in',  plural: 1, label: 'by',     types: ['thing'],     aliases: []}\n  cattype.edges.was    = {dir: 'in',  plural: 1, label: 'was',    types: ['person'],    aliases: []}\n  cattype.edges.during = {dir: 'out', plural: 0, label: 'during', types: ['happening'], aliases: []}\n\n  // add default props for all effects\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.effect[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('effect', type, alias)\n    })\n  }\n}\n\nfunction new_happening_type(type, properties) {\n  // what properties do happenings have?\n  // an edge type can have an alias for storytelling purposes\n\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.happening[type]\n  if(cattype)\n    return error('That happening type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.at     = {dir: 'out', plural: 0, label: 'at',     types: ['place',   'event'], aliases: []}\n  cattype.edges.the    = {dir: 'out', plural: 1, label: 'the',    types: ['outcome', 'event'], aliases: []}\n  cattype.edges.did    = {dir: 'in',  plural: 1, label: 'did',    types: ['person'],           aliases: []}\n  cattype.edges.during = {dir: 'in',  plural: 0, label: 'during', types: ['effect'],           aliases: []}\n\n  // add default props for all happenings\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.happening[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('happening', type, alias)\n    })\n  }\n}\n\n\nfunction new_edge_type(type, properties) {\n  // what properties do edges have?\n}\n\nfunction add_edge(type, from, to, props, persist) {\n  var edge = {}\n\n  // check from and to\n  // check type against from and to interfaces\n  // publish in dagoba + persist\n\n  edge = convert_props(props)\n  edge._in = to\n  edge._out = from\n  edge.type = type\n  edge.label = type\n\n  // THINK: if Dagoba supported proper subgraphs, we could have RM.facts and RM.G and keep them fully in sync, instead of limiting RM.G to just the \"viewable\" facts. we'll need a new RM.GG or something for the currently viewable subgraph. this would also help with all the duplicate node warning messages, cut down on allocations, and allow a pipeline based around building new graphs (or extending/syncing the main graph from the factbase). so facts_to_graph would take a graph and some facts and put them together, or something. or as you add new facts they're automatically ramified into the graph. or fizzlemorts.\n\n  add_to_graph('edge', edge)\n  if(persist)\n    add_to_server_facts('edge', edge)\n}\n\nfunction import_graph(V, E) {\n  // add V things\n  // add V happenings\n  // add edges\n}\n\nfunction extract_story(V, E) {\n  // given a subgraph, extract a \"story\"\n}\n\nfunction story_to_text(story) {\n  // what is a story?\n  // how do we turn it into text?\n}\n\nfunction subgraph_of(thing1, thing2) {\n  // find all the paths between them, and their attached bits\n}\n\n\n// SET UP CATEGORIES AND EDGES\n\nnew_thing_type('person',  {})\nnew_thing_type('org',     {cc: ['org']})\nnew_thing_type('place',   {cc: ['place', 'event']})\nnew_thing_type('event',   {cc: ['event', 'outcome'], timerange: true}) // already has start and end, so... ?\nnew_thing_type('outcome', {cc: ['outcome'], aliases: ['artwork', 'session']}) // local vs ubiquitous outcomes -- they're structurally different\n\nnew_action_type('pass',      {aliases: []})\nnew_action_type('join',      {aliases: []})\nnew_action_type('leave',     {aliases: []})\nnew_action_type('create',    {aliases: []})\nnew_action_type('attend',    {aliases: ['participate in']})\nnew_action_type('manage',    {aliases: ['run', 'lead', 'facilitate', 'coordinate', 'organize']})\nnew_action_type('assist',    {aliases: ['help', 'host', 'contribute']})\nnew_action_type('present',   {aliases: []})\nnew_action_type('represent', {aliases: []})\nnew_action_type('fund',      {aliases: []})\nnew_action_type('inspire',   {aliases: []})\nnew_action_type('invite',    {aliases: []})\n\nnew_effect_type('inspire',   {aliases: ['influenced']})\nnew_effect_type('convince',  {aliases: ['ask']})\nnew_effect_type('introduce', {aliases: ['meet']})\n\nnew_happening_type('conversation', {aliases: []})\nnew_happening_type('experience',   {aliases: ['see', 'hear', 'watch', 'attend']})\n\n\n\n// MODEL HELPERS\n\n\nfunction add_to_graph(type, item) {\n  if(type === 'node') {\n    // TODO: this is kind of a hack, but also kind of not\n    if(!item._id)\n      item._id = get_new_id()\n    G.addVertex(item)\n  }\n\n  if(type === 'edge') {\n    G.addEdge(item)\n  }\n}\n\nfunction get_new_id() {\n  // TODO: swap this out for maybe a mongo_id implementation\n  return (\"\" + Math.random()).slice(2)\n}\n\nfunction convert_props(props) {\n  if(typeof props !== 'object')\n    return {}\n\n  if(Array.isArray(props))\n    return {}\n\n  return clone(props)\n}\n","import {add_thing, add_action, add_edge} from 'model'\nimport * as dom from 'dom'\nimport {G} from 'graph'\nimport {render} from 'render'\nimport {error} from 'fun'\n\n\nexport let convo = new_conversation()\nexport {join_conversation}\n\nfunction join_conversation(conversation) {\n  var conversation = conversation || convo\n\n  var wants = conversation.current.slots[0].key\n  var value = dom.el(wants).value\n\n  convo = fulfill_desire(conversation, value)\n\n  return convo\n}\n\nfunction new_sentence() {\n  var slots = [ {key: 'subject', type: 'word', cat: 'thing'}\n              , {key: 'verb', type: 'word', cat: 'action'}\n              , {key: 'object', type: 'word', cat: 'thing'}\n              , {key: 'date', type: 'date'}\n              ]\n  return {slots: slots, filled: []}\n}\n\nfunction new_conversation() {\n  var sentence = new_sentence()\n  return {sentences: [sentence], current: sentence}\n}\n\nfunction fulfill_desire(conversation, value) {\n  var conversation = conversation || convo\n\n  var sentence = give_word(conversation.current, value)\n\n  // TODO: allow multi-sentence conversations\n\n\n  if(!sentence.slots.length) {\n    var subject, verb, object, date\n    sentence.filled.forEach(function(slot) {\n      if(slot.type === 'gettype') {\n        var thing = add_thing(slot.value, {name: slot.name}, true)\n        if(slot.oldkey === 'subject') subject = thing\n        if(slot.oldkey === 'object' ) object  = thing\n      }\n      else if(slot.type === 'date') {\n        date = slot.value\n      }\n      else if(slot.key === 'subject') {\n        subject = slot.word\n      }\n      else if(slot.key === 'object') {\n        object = slot.word\n      }\n      else if(slot.key === 'verb') {\n        verb = (slot.word||{}).type || slot.value\n      }\n    })\n\n    if(subject && verb && object) {\n      verb = add_action(verb, {time: new Date(date).getTime() }, true)\n      add_edge('the', verb._id, object._id, 0, true)\n      add_edge('did', subject._id, verb._id, 0, true)\n    }\n\n    // start over\n    // TODO: show the sentence\n    conversation = new_conversation()\n    render() // THINK: this should queue or something... rAF?\n  }\n\n  return conversation\n}\n\nfunction give_word(sentence, value) {\n  var slot = sentence.slots.shift()\n  if(!slot)\n    return error('This sentence is finished')\n\n  // TODO: check this logic modularly\n  if(slot.type === 'word') {\n    var word = G.v({name: value, cat: slot.cat}).run()[0]\n    if(word) {\n      slot.word = word\n    }\n  }\n\n  if(slot.cat === 'thing') {\n    if(slot.type === 'word') {\n      if(!slot.word) {\n        sentence.slots.unshift({key: 'type', type: 'gettype', name: value, cat: slot.cat, oldkey: slot.key})\n      }\n    }\n    else if(slot.type === 'gettype') {\n      // var nameslot = sentence.filled[sentence.filled.length-1]\n    }\n  }\n\n  // fix it in post\n  slot.value = value\n  sentence.filled.push(slot)\n\n  return sentence\n}\n","// this does some dom things\n\nimport state from 'state'\nimport {G, addtag, removetag} from 'graph'\nimport {join_conversation} from 'convo'\nimport {error, noop} from 'fun'\nimport {persist} from 'net'\nimport {render, whatsnext} from 'render'\n\nexport {set_el, append_el}\n\nexport const el = function() {\n  const els = {}\n  const default_el = {addEventListener: noop, removeEventListener: noop}\n\n  return function(el_id) {\n    // NOTE: removing caching for now to deal with vdom\n    // if(els[el_id])\n    //   return els[el_id]\n    els[el_id] = document.getElementById(el_id) || default_el\n    return els[el_id]\n  }\n}()\n\nfunction set_el(el_id, val) {\n  el(el_id).innerHTML = val\n}\n\nfunction append_el(el_id, val) {\n  el(el_id).innerHTML += val\n}\n\n\n\n// LOGIN/ORG/TAG STUFF\n\nexport function login(e) {\n  e.preventDefault()\n  state.email = el('email').value\n  el('login').classList.add('hide')\n  el('storytime').classList.remove('hide')\n}\n\n// SOME HIGHLIGHTING OR SOMETHING\n\nvar highlight_fun, highlight_target\n\nexport function activate_highlighter() {\n  highlight_fun = el('sentences').addEventListener('mousemove', highlighter)\n}\n\nexport function deactivate_highlighter() {\n  el('sentences').removeEventListener('mousemove', highlight_fun)\n}\n\nfunction highlighter(e) {\n  for(var t=e.target; t && t.matches; t = t.parentNode) {\n    if(t.matches('.sentence')) {\n      if(highlight_target === t)\n        return undefined\n\n      highlight_target = t\n      var ids = [].slice.call(t.children).map(node => node.dataset.id).filter(Boolean)\n      var fun = function(v) {return ~ids.indexOf(v._id)}\n      // ids.forEach(id => G.v(id).run()[0].highlight = true)\n      // render()\n      highlight(fun)\n      return undefined\n    }\n  }\n}\n\nexport function highlight(o_or_f) {\n  var current = G.v({highlight: true}).run()\n  current.forEach(function(node) {\n    // node.highlight = false\n    delete node.highlight // better when collapsing\n  })\n\n  if(!o_or_f) {\n    render()\n    return undefined\n  }\n\n  if(typeof o_or_f === 'function') {\n    current = G.v().filter(o_or_f).run()\n  } else {\n    current = G.v(o_or_f).run()\n  }\n\n  current.forEach(function(node) {\n    node.highlight = true\n  })\n\n  render()\n}\n\n\n// INTERACTIONS & DOM BINDINGS\n\nexport function click_tagnames(ev) {\n  ev.preventDefault()\n  var target = ev.target\n  var tag = target.innerText\n  if(!tag) return undefined\n  removetag(tag)\n}\n\nexport function mouseover_tagnames(ev) {\n  var target = ev.target\n  var tag = target.innerText\n\n  if(!tag)\n    return undefined\n\n  if(highlight_target === tag)\n    return undefined\n\n  highlight_target = tag\n  highlight(function(v) { return ~v.tags.indexOf(tag) })\n}\n\nexport function mouseout_tagnames(ev) {\n  if(!highlight_target)\n    return undefined\n\n  highlight_target = false\n  highlight()\n}\n\nexport function global_keydown(ev) {\n  // TODO: clean this up (prevent span hijacking)\n  if( ev.target.tagName === 'SPAN'\n   || ev.target.tagName === 'INPUT'\n   || ev.target.tagName === 'SELECT'\n   || ev.target.tagName === 'TEXTAREA'\n    )\n    return true\n\n  var key = ev.keyCode || ev.which\n\n  // var key_a = 97\n  var key_e = 69\n  var key_f = 70\n  var key_l = 76\n  var key_n = 78\n  var key_p = 80\n  // var key_s = 115\n  var tilde = 126\n  var larro = 37\n  var uarro = 38\n  var rarro = 39\n  var darro = 40\n  // var langl = 60\n  // var rangl = 62\n\n  if(key === larro || key === darro || key === key_p) {\n    ev.preventDefault()\n    if(state.current_year <= state.my_minyear) return false\n    state.current_year--\n    render()\n  }\n\n  if(key === rarro || key === uarro || key === key_n) {\n    ev.preventDefault()\n    if(state.current_year >= state.my_maxyear) return false\n    state.current_year++\n    render()\n  }\n\n  if(key === key_f) {\n    state.filter_sentences = !state.filter_sentences\n    render()\n  }\n\n  if(key === key_e) {\n    state.all_edges = !state.all_edges\n    render()\n  }\n\n  if(key === key_l) {\n    state.show_labels = !state.show_labels\n    render()\n  }\n\n  if(key === tilde) {\n    state.admin_mode = !state.admin_mode\n    render()\n  }\n}\n\nexport function submit_addtag(ev) {\n  ev.preventDefault()\n  addtag(el('othertags').value)\n}\n\nexport function keyup_sentences(ev) {\n  // var key = ev.keyCode || ev.which\n  var span = ev.target\n  var type = span.classList.contains('edge') ? 'edge' : 'cat'\n  var val = span.textContent\n  var id = span.getAttribute('data-id')\n\n  // TODO: trap return for special effects\n  // TODO: maybe trap tab also\n\n  // ev.preventDefault()\n\n  // handle the node case\n  if(type === 'cat' && id && val) {\n    var node = G.vertexIndex[id]\n    if(node && node.name !== val) {\n      // update the name/label in the real graph\n      node.name = val\n      pub(id)\n    }\n  }\n\n  // handle the edge case\n  if(type === 'edge') {\n    var id1 = span.getAttribute('data-id1')\n    var id2 = span.getAttribute('data-id2')\n\n    var node1 = G.vertexIndex[id1]\n    var edges = node1._in.concat(node1._out)\n    var edge = edges.filter\n      (function(edge)\n        {return ( edge._in._id === id1 && edge._out._id === id2 )\n             || ( edge._in._id === id2 && edge._out._id === id1 ) })[0]\n\n    if(!edge) return undefined\n\n    edge.label = val\n    edge.type = val\n\n    // pub(id1 + '-' + id2)\n    // Dagoba.persist(G, 'rripplemap')\n    persist()\n  }\n\n  function pub(id) {\n    // publish the change\n    // Dagoba.persist(G, 'rripplemap')\n    persist()\n\n    // update all other sentences\n    var spans = document.querySelectorAll('span.node-' + id)\n    for(var i = 0; i < spans.length; i++) {\n      if(spans[i] !== span)\n        spans[i].textContent = val\n    }\n\n    // rerender the graph\n    render(0)\n  }\n\n}\n\nexport function click_sentences(ev) {\n  var target = ev.target\n  if(target.nodeName !== 'BUTTON')\n    return true\n\n  var id = target.getAttribute('data-id')\n  var node = G.vertexIndex[id]\n\n  if(!node)\n    return error('That node does not exist')\n\n  if(node.cat === 'action') { // remove \"sentence\"\n    G.removeVertex(node)\n  }\n  else {\n    G.removeVertex(node) // THINK: is this really reasonable?\n  }\n\n  persist()\n  render()\n}\n\nexport function submit_convo(ev) {\n  ev.preventDefault()\n\n  whatsnext(G, join_conversation())\n\n  return false\n}\n","import {G} from 'graph'\nimport {unique, eq, prop, clone, truncate, push_it, pipe} from 'fun'\nimport * as dom from 'dom'\nimport {convo as conversation} from 'convo'\nimport {cats} from 'model'\nimport state from 'state'\nimport {isDate} from '../utils';\n\nexport {init, render, render_all, whatsnext}\n\n\nconst ctx = dom.el('ripples').getContext('2d')\n\nvar viz_pipe, word_pipe\n\n\n// RENDER PIPELINE\n\nfunction init() {\n  // TODO: consider a workflow for managing this tripartite pipeline, so we can auto-cache etc\n  viz_pipe = pipe( mod('data', sg_compact)\n                 , mod('data', likenamed)\n                 , mod('data', cluster)\n                 , mod('data', Dagoba.cloneflat)\n                   // layout:\n                 , set_year\n                 , data_to_graph\n                 , add_fakes\n                 , set_coords\n                 , set_score\n                 , minimize_edge_length\n                 , remove_fakes\n                 , unique_y_pos\n                 , filter_by_year\n                 , filter_nodes\n                   // shapes:\n                 , add_rings\n                 , add_ring_labels\n                 , copy_edges\n                 , copy_nodes\n                 , add_node_labels\n                 , add_edge_labels\n                   // rendering:\n                 , clear_it_svg\n                 , draw_it_svg\n                 , draw_metadata\n                 )\n\n  word_pipe = pipe( get_actions\n                  , filter_actions\n                  , make_sentences\n                  , write_sentences\n                  )\n}\n\nfunction render() {\n  // TODO: cloning is inefficient: make lazy subgraphs\n  var env = { data: Dagoba.clone(G)\n            , svg: {head: '', body: '', tail: ''}\n            , params: { my_maxyear: state.my_maxyear\n                      , my_minyear: state.my_minyear\n                      , filters: window.filter_poo\n                      }\n            , shapes: []\n            , ctx: ctx\n            }\n\n  viz_pipe(env)\n  word_pipe(env)\n\n  // if(n === undefined)\n  //   state.pipelines.forEach(function(pipeline) { pipeline(env) })\n  // else\n  //   state.pipelines[n](env)\n}\n\n\n\n// COMPACTIONS\n\nfunction sg_compact(g) {\n  // so... this is pretty silly i guess or something. use subgraphs instead.\n  var newg = Dagoba.graph()\n  var edges = []\n\n  g.v().run().forEach(function(node) {\n    if(node.time)\n      return undefined\n\n    var others = g.v(node._id).both().run()\n    others.forEach(function(other) {\n      if(other.time)\n        node.time = Math.min(node.time||Infinity, other.time)\n\n      var oo = g.v(other._id).both().run()\n      if(oo.length < 2)\n        return undefined\n\n      var edge = {_in: oo[0]._id, _out: oo[1]._id, label: other.name || \"\"}\n\n      if(!edges.some(x => x._in === edge._in && x._out === edge._out))\n        edges.push(edge)\n\n      newg.addVertex(node)\n    })\n  })\n\n  edges.forEach(function(edge) {\n    newg.addEdge(edge)\n  })\n\n  return newg\n}\n\nfunction likenamed(g) {\n  var namemap = {}\n\n  g.v().run().forEach(function(node) {\n    if(!node.name)\n      return undefined\n\n    if(!namemap[node.name]) {\n      namemap[node.name] = [node]\n    }\n    else {\n      namemap[node.name].push(node)\n    }\n  })\n\n  Object.keys(namemap).forEach(function(name) {\n    if(namemap[name].length > 1)\n      g.mergeVertices(namemap[name])\n  })\n\n  return g\n}\n\n\n/// modularize this:\n\nlet clusters = [ ['AMC', 'amc', 'Allied Media Conference', 'allied media conference', 'Allied media Conference']\n              , ['AMP', 'amp', 'Allied Media Projects', 'allied media projects']\n              , ['AMC2016 Coordinators Weekend', 'AMC 2016 Coordinators Meeting']\n              , ['jayy dodd', 'jayy']\n              ]\n\nfunction cluster(g) {\n  clusters.map(function(names) {\n    return names.reduce(function(acc, name) {\n      return acc.concat(g.v({name: name}).run())\n    }, [])\n  }).forEach(g.mergeVertices.bind(g))\n\n  return g\n}\n\n// LAYOUT\n\nfunction mod(prop, fun) {\n  return function(env) {\n    env[prop] = fun(env[prop])\n    return env\n  }\n}\n\nfunction set_year(env) {\n  var minyear = Infinity\n  var maxyear = 0\n  var list = env.params.years = {}\n\n  env.data.V = env.data.V.map(function(node) {\n\n    if(node.time < 1199161600000) return node // HACK: remove me!!!\n\n    var year = (new Date(node.time+100000000)).getFullYear()\n    if(year < minyear) minyear = year // effectful :(\n    if(year > maxyear) maxyear = year // effectful :(\n\n    node.year = year // mutation :(\n    push_it(list, node.year, node) //, G.vertexIndex[node._id])\n\n    return node\n  })\n\n  // env.params.minyear = minyear\n  // env.params.maxyear = maxyear\n  env.params.minyear = state.my_minyear\n  env.params.maxyear = state.my_maxyear\n\n  return env\n}\n\nfunction data_to_graph(env) {\n  // THINK: this is kind of weird... we could probably get more leverage by just using G itself\n  env.params.graph = Dagoba.graph(env.data.V, env.data.E)\n  env.data.V = env.params.graph.vertices\n  env.data.E = env.params.graph.edges\n  return env\n}\n\nfunction add_fakes(env) {\n  var years = env.params.years\n\n  Object.keys(years).forEach(function(yearstr) {\n    var year = years[yearstr]\n    var fake = {type: 'fake', year: yearstr, name: 'fake', _in: [], _out: []}\n    // var copies = 3 + Math.ceil(year.length / 5)\n    var copies = 10 - year.length < 0 ? 2 : 10 - year.length\n    // var fakes = [clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake)]\n    var fakes = []\n    for(var i = 0; i < copies; i++) {\n      fakes.push(clone(fake))\n    }\n\n    Array.prototype.push.apply(year, fakes)\n    Array.prototype.push.apply(env.data.V, fakes)\n  })\n\n  return env\n}\n\nfunction set_coords(env) {\n  var years = env.params.years\n\n  env.data.V.forEach(function(node) {\n    if(node.x) return node\n\n    var offset = node.year - env.params.my_minyear + 1\n    var radius = offset * state.ring_radius // HACK: remove this!\n\n    var nabes = years[node.year]\n    // var gnode = G.vertexIndex[node._id]\n\n    if(!nabes) return false\n\n    var index = nabes.indexOf(node)\n    var arc = 2 * Math.PI / nabes.length\n\n    var deg = offset + index * arc\n    var cx  = radius * Math.cos(deg)\n    var cy  = radius * Math.sin(deg)\n    var edge_count = node._in.length + node._out.length\n\n    node.shape = 'circle'\n    node.x = cx\n    node.y = cy\n    node.r = 4 + 2*Math.min(5, edge_count / 2) //Math.floor(node.name.charCodeAt(0)/20)\n\n    return node\n  })\n\n  return env\n}\n\nfunction set_score(env) {\n  env.data.V = env.data.V.map(function(node) { node.score = score(node); return node })\n  return env\n}\n\nfunction minimize_edge_length(env) {\n  var years = env.params.years\n\n  Object.keys(years).sort().forEach(function(key) {\n    var peers = years[key]\n    peers.sort(score_sort)\n    peers.forEach(function(node) {\n      peers.forEach(function(peer) {\n        swap(node, peer)\n        var new_node_score = score(node)\n        var new_peer_score = score(peer)\n        if(node.score + peer.score < new_node_score + new_peer_score) {\n          swap(node, peer)\n        } else {\n          node.score = new_node_score\n          peer.score = new_peer_score\n        }\n      })\n    })\n  })\n\n  return env\n\n  function swap(n1, n2) {\n    var x = n1.x, y = n1.y\n    n1.x = n2.x; n1.y = n2.y\n    n2.x = x;    n2.y = y\n  }\n\n  function score_sort(n1, n2) {\n    return n1.score - n2.score\n  }\n}\n\nfunction score(node) {\n  return [].concat(node._in||[], node._out||[]).reduce(function(acc, edge) {return acc + score_edge(edge, node)}, 0)\n\n  function score_edge(edge, self) {\n    //// TODO: if other end is \"older\" than this end, don't count it...\n    if(edge._in  === node && edge._out.year > node.year) return 0\n    if(edge._out === node && edge._in. year > node.year) return 0\n\n    // return edge._in.x + edge._out.x\n\n    var dx = Math.abs(edge._in.x - edge._out.x)\n    var dy = Math.abs(edge._in.y - edge._out.y)\n\n    return Math.sqrt(dx*dx + dy*dy)\n  }\n}\n\nfunction remove_fakes(env) {\n  env.data.V = env.data.V.filter(function(node) {\n    return node.type !== 'fake'\n  })\n  return env\n}\n\nfunction unique_y_pos(env) {\n  var threshold = 6\n  // var node_radius = 5\n  var arc = Math.PI / 100\n  var years = env.params.years\n  var ys = []\n\n  Object.keys(years).sort().forEach(function(key) {\n    var peers = years[key]\n    peers.forEach(function(node) {\n      var coords, closest\n\n      if(node.type === 'fake') // le sigh\n        return\n\n      // A) do a binary search on an array of midpoints to find the closest one\n      // B) if it's within threshold walk around the circle in both directions until you find an opening\n      // C) if you reach the antipode give up\n\n      for(var da = arc; da < Math.PI; da = -1*(da + arc*(da/Math.abs(da)))) {\n        coords = modify_coords(node, da)\n        closest = find_closest(coords.y, ys)\n        if(!closest || Math.abs(closest - coords.y) > threshold)\n          break\n      }\n\n      // console.log(da, closest, coords.y, Math.abs(closest - coords.y))\n\n      node.x = coords.x\n      node.y = coords.y\n      ys.push(coords.y)\n\n      ys.sort(function(a, b) {return a - b}) // OPT: just insert coords.y in place\n    })\n  })\n\n  return env\n\n  function modify_coords(node, da) {\n    return { x: node.x * Math.cos(da) - node.y * Math.sin(da)\n           , y: node.x * Math.sin(da) + node.y * Math.cos(da)\n           }\n  }\n\n  function find_closest(n, ns) { // binary search\n    var closest\n    var index = Math.floor(ns.length / 2)\n    var item = ns[index]\n\n    if(ns.length < 5) {\n      for(var i = 0; i < ns.length; i++) {\n        if(closest === undefined || Math.abs(ns[i] - n) < Math.abs(closest - n))\n          closest = ns[i]\n      }\n      return closest\n    }\n\n    if(item === n)\n      return item\n\n    if(item > n)\n      return find_closest(n, ns.slice(0, index))\n\n    return find_closest(n, ns.slice(index + 1))\n  }\n}\n\nfunction filter_by_year(env) {\n  var max = env.params.my_maxyear\n  var min = env.params.my_minyear\n\n  // hack hack hack\n  if(state.current_year < max)\n    max = state.current_year\n\n  // TODO: do this in Dagoba so we can erase edges automatically\n  env.data.V = env.data.V.filter(function(node) {\n    // yuckyuckyuck\n    if(node.year > max || node.year < min) {\n      env.params.graph.removeVertex(node)\n      return false\n    }\n    return true\n  })\n\n  return env\n}\n\nfunction filter_nodes(env) {\n  let filters = env.params.filters\n\n  if(!filters) return env\n\n  // TODO: do this in Dagoba so we can erase edges automatically\n  env.data.V = env.data.V.filter(function(node) {\n    // yuckyuckyuck\n    if(filters.includes(node.type)) {\n      env.params.graph.removeVertex(node)\n      return false\n    }\n    return true\n  })\n\n  return env\n}\n\n\n// SHAPES\n\nfunction add_rings(env) {\n  for(var i = env.params.minyear; i <= env.params.maxyear; i++) {\n    var color = i === state.current_year ? '#999' : '#ccc'\n    var radius = state.ring_radius * (i - env.params.my_minyear + 1)\n    env.shapes.unshift({shape: 'circle', x: 0, y: 0, r: radius, stroke: color, fill: 'rgba(0, 0, 0, 0)', line: 1, type: 'ring', year: i})\n  }\n  return env\n}\n\nfunction add_ring_labels(env) {\n  var labels = []\n\n  env.shapes.filter(eq('type', 'ring')).forEach(function(shape) {\n    var fill = shape.year === state.current_year ? '#999' : '#ccc'\n    var label = {shape: 'text', str: shape.year, x: -15, y: -shape.r - 5, fill: fill, font: \"18px Raleway\" }\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\nfunction copy_edges(env) {\n  var hues = {  \"participate in\": \"rgba(52, 73, 94, 0.7)\"\n              , \"inspire\": \"rgba(241, 196, 15, 0.7)\"\n              , \"organize\": \"rgba(141, 196, 215, 0.7)\"\n              , \"lead\": \"rgba(231, 76, 60, 0.7)\"\n              , \"met\": \"rgba(102, 39, 239, 0.7)\"\n  }\n\n  env.data.E.forEach(function(edge) {\n    if(!state.all_edges && !(edge._out.year === state.current_year || edge._in.year === state.current_year)) // HACK: remove this\n      return undefined\n\n    var color = hues[edge.label]\n    var label = edge.label || \"777\"\n    var id    = edge._in._id + '-' + edge._out._id\n\n    // TODO: is this needed with hard baked colours? \n    /* var color = str_to_color(label)*/\n    /* function str_to_color(str) { return 'hsl' + (state.show_labels?'a':'') + '(' + str_to_num(str) + ',100%,40%' + (state.show_labels?',0.3':'') + ')';}*/\n    /* function str_to_color(str) { return 'hsla' + '(' + str_to_num(str) + ',30%,40%,0.' + (state.show_labels?'3':'7') + ')' }*/\n    /* function str_to_num(str) { return char_to_num(str, 0) + char_to_num(str, 1) + char_to_num(str, 2) }*/\n    /* function char_to_num(char, index) { return (char.charCodeAt(index) % 20) * 20 }*/\n\n    var line = {shape: 'line', _id: id, x1: edge._in.x, y1: edge._in.y, x2: edge._out.x, y2: edge._out.y, stroke: color, type: 'edge', label: label}\n    env.shapes.push(line)\n  })\n  return env\n}\n\nfunction copy_nodes(env) {\n  env.shapes = env.shapes.concat.apply(env.shapes, env.data.V.map(function(node) {\n    // HACK: move this elsewhere\n    if(!state.all_edges) {\n      var ghost = !node._in.concat(node._out)\n                       .map(e => [e._in.year, e._out.year])\n                       .reduce((acc, t) => acc.concat(t), [])\n                       .filter(y => y === state.current_year).length\n      if(ghost)\n        return []\n    }\n\n    // var this_year = state.all_edges || node.year === state.current_year\n    // var color =  'hsla(0,0%,20%,0.' + (this_year ? '99' : '3') + ')'\n\n    // Person: Blue\n    // Org: Green\n    // Event: Magenta\n    // Outcome: Orange\n    // Concept: Purple\n    // Labels should be black\n    // Connections should be grey\n      var hues = { outcome: \"hsla(48, 100%, 78%, 1)\"\n               // , action '20'\n                 , person: \"hsla(195, 50%, 42%, 1)\"\n                 , event: \"hsla(353, 100%, 56%, 1)\"\n                 , org: \"hsla(150, 100%, 34%, 1)\"\n               }\n\n      var color = hues[node.type]\n\n    var shape = { shape: 'circle'\n                , _id: node._id\n                , x: node.x\n                , y: node.y\n                , r: node.r\n                , name: node.name\n                , fill: color\n                }\n\n    if(!node.highlight)\n      return shape\n\n    var highlight = { shape: 'circle'\n                    , _id: node._id\n                    , x: node.x\n                    , y: node.y\n                    , r: node.r + 5\n                    , line: 0.01\n                    , fill: 'hsla(0, 80%, 100%, 0.95)'\n                    }\n\n    return [highlight, shape]\n  }))\n  return env\n}\n\nfunction add_node_labels(env) {\n  var labels = []\n\n  env.shapes.forEach(function(shape) {\n    if(!shape.name) return undefined\n    var str = truncate(shape.name, 50)\n    var label = {shape: 'text', str: str, x: shape.x + 15, y: shape.y + 5}\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\nfunction add_edge_labels(env) {\n  if(!state.show_labels)\n    return env\n\n  var labels = []\n\n  env.shapes.forEach(function(shape) {\n    if(shape.type !== 'edge') return undefined\n    var label = {shape: 'angle_text', x1: shape.x1, y1: shape.y1, x2: shape.x2, y2: shape.y2, fill: shape.stroke, str: shape.label}\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\n// RENDERING\n\n// experimental svg mode functions...\nfunction clear_it_svg(env) {\n  env.svg.head = `<svg viewBox=\"0 0 900 900\" style=\"height:900px\" xmlns=\"http://www.w3.org/2000/svg\">`\n  env.svg.tail = `</svg>`\n  return env\n}\n\nfunction draw_it_svg(env) {\n  // tees: create an array of element id's to loop over and add mouse over events too.\n  let nodes = []\n  let edges = []\n\n  env.shapes.forEach(function(node) {\n    env.svg.body += draw_shape(node)\n  })\n\n  // inject the svg node\n  document.getElementById('ripplemap-mount').innerHTML = env.svg.head + env.svg.body + env.svg.tail\n\n  // add listeners\n  function highlight_edge(e) {\n    let id = e.target.id\n    let ids = id.split('-')\n    if(!ids[0]) return undefined\n\n    var fun = function(v) {return ~ids.indexOf(v._id)}\n    dom.highlight(fun)\n  }\n\n  let edge_click = highlight_edge\n  let edge_hover = highlight_edge\n\n  let good_edges = edges.filter(id => true)\n  good_edges.map(id => dom.el(id).addEventListener('click', edge_click))\n  good_edges.map(id => dom.el(id).addEventListener('mouseover', edge_hover))\n\n\n  function highlight_node(e) {\n    let id = e.target.id\n    if(!id) return undefined\n\n    let ids = G.v(id).both().both().run().map(x => x._id).filter(unique)\n    var fun = function(v) {return ~ids.indexOf(v._id)}\n    dom.highlight(fun)\n  }\n\n  let node_click = highlight_node\n  let node_hover = highlight_node\n\n  let good_nodes = nodes.filter(id => true)\n  good_nodes.map(id => dom.el(id).addEventListener('click', node_click))\n  good_nodes.map(id => dom.el(id).addEventListener('mouseover', node_hover))\n\n  // dom.highlight(function(v) { return ~v.tags.indexOf(tag) })\n\n\n\n  return env // <----- hey look, the function ends here!\n\n\n\n\n  function draw_shape(node) {\n    var cx = 450\n    var cy = 450\n\n    if(node.shape === 'circle')\n      return draw_circle(node, cx + node.x, cy + node.y, node.r, node.stroke, node.fill, node.line)\n\n    if(node.shape === 'line')\n      return draw_line(node, cx + node.x1, cy + node.y1\n                           , cx + node.x2, cy + node.y2, node.stroke, node.line)\n\n    if(node.shape === 'text')\n      return draw_text(node, cx + node.x, cy + node.y, node.str, node.font, node.fill)\n\n    if(node.shape === 'angle_text')\n      return draw_angle_text( node, cx + node.x1, cy + node.y1\n                                  , cx + node.x2, cy + node.y2\n                                  , node.str, node.font, node.fill\n                            )\n  }\n\n  function draw_circle(node, x, y, radius, stroke_color, fill_color, line_width) {\n    if(!x || !y || !radius) return undefined\n\n    fill_color = fill_color || '#444444'\n    line_width = line_width || 2\n    stroke_color = stroke_color || '#eef'\n\n    let u_id = `${node._id}`\n    nodes.push(u_id)\n\n    return `<circle id=\"${u_id}\" class=\"${node.type || 'node'}\" cx=\"${x}\" cy=\"${y}\" r=\"${radius}\" fill=\"${fill_color}\" stroke-width=\"${line_width}\" stroke=\"${stroke_color}\"/>`\n  }\n\n  function draw_line(node, fromx, fromy, tox, toy, stroke_color, line_width) {\n    stroke_color = stroke_color || '#eef'\n    line_width = line_width || 0.5\n\n    if(fromx * fromy * tox * toy * 0 !== 0)\n      return ''\n\n    let u_id = `${node._id}`\n    edges.push(u_id)\n\n    /* return `<line id=\"${u_id}\" class=\"${node.type}\" x1=\"${fromx}\" y1=\"${fromy}\" x2=\"${tox}\" y2=\"${toy}\" stroke-width=\"5\" stroke=\"${stroke_color}\"/>`*/\n    return `\n      <g>\n        <line class= \"${node.type}\" x1=\"${fromx}\" y1=\"${fromy}\" x2=\"${tox}\" y2=\"${toy}\" stroke-width=\"5\" stroke=\"${stroke_color}\"/>\n        <line id=\"${u_id}\" class= \"${node.type}\" x1=\"${fromx}\" y1=\"${fromy}\" x2=\"${tox}\" y2=\"${toy}\" stroke-width=\"30\" stroke=\"rgba(0, 0, 0, 0)\"/>\n      </g>`\n  }\n\n  function draw_text(node, x, y, str, font, fill_color, font_size) {\n    fill_color = '#fff'\n    font = \"Archivo Narrow\"\n    font_size = '16px'\n    if(isNaN(x)) return ''\n    x = x || 0\n    y = y || 0\n    if (isDate(str)) {\n      return `<text x=\"${x}\" y=\"${y}\" font-family=\"${font}\" fill=\"#999\" letter-spacing=\"1px\" font-size=\"${font_size}\">${str}</text>`\n    }\n    return `<text x=\"${x}\" y=\"${y}\" font-family=\"${font}\" fill=\"${fill_color}\" letter-spacing=\"1px\" font-size=\"${font_size}\">${str}</text>`\n  }\n\n  function draw_angle_text(node, x1, y1, x2, y2, str, font, fill_color) {\n    return ''\n\n    // TODO: write this function\n\n    ctx.fillstyle = fill_color || '337'\n    ctx.font = font || \"14px sans-serif\"\n\n    // modified from http://phrogz.net/tmp/canvas_rotated_text.html\n\n    var padding = 5\n    var dx = x2 - x1\n    var dy = y2 - y1\n    var len = math.sqrt(dx*dx+dy*dy)\n    var avail = len - 2*padding\n    var pad = 1/2\n    var x = x1\n    var y = y1\n\n    var texttodraw = str\n    if (env.measuretext && ctx.measuretext(texttodraw).width > avail){\n      while (texttodraw && ctx.measuretext(texttodraw+\"…\").width > avail) texttodraw = texttodraw.slice(0, -1)\n      texttodraw += \"…\"\n    }\n\n    // keep text upright\n    var angle = math.atan2(dy, dx)\n    if (angle < -math.pi/2 || angle > math.pi/2){\n      x = x2\n      y = y2\n      dx *= -1\n      dy *= -1\n      angle -= math.pi\n    }\n\n    ctx.save()\n    ctx.textalign = 'center'\n    ctx.translate(x+dx*pad, y+dy*pad)\n    ctx.rotate(angle)\n    ctx.filltext(texttodraw, 0, -3)\n    ctx.restore()\n  }\n\n}\n\n\n/////////////////////////////////\n\nfunction clear_it(env) {\n  env.ctx.clearRect(0, 0, 1000, 1000)\n  return env\n}\n\nfunction draw_it(env) {\n  env.shapes.forEach(function(node) {\n    draw_shape(env.ctx, node)\n  })\n  return env\n}\n\nfunction draw_metadata(env) {\n  // el('minyear').textContent = 1900 + env.params.minyear\n  // el('maxyear').textContent = 1900 + state.current_year\n  return env\n}\n\n\n// CANVAS FUNCTIONS\n\nfunction draw_shape(ctx, node) {\n  var cx = 450\n  var cy = 450\n\n  if(node.shape === 'circle')\n    draw_circle(ctx, cx + node.x, cy + node.y, node.r, node.stroke, node.fill, node.line)\n\n  if(node.shape === 'line')\n    draw_line(ctx, cx + node.x1, cy + node.y1, cx + node.x2, cy + node.y2, node.stroke, node.line)\n\n  if(node.shape === 'text')\n    draw_text(ctx, cx + node.x, cy + node.y, node.str, node.font, node.fill)\n\n  if(node.shape === 'angle_text')\n    draw_angle_text(ctx, cx + node.x1, cy + node.y1, cx + node.x2, cy + node.y2, node.str, node.font, node.fill)\n}\n\nfunction draw_circle(ctx, x, y, radius, stroke_color, fill_color, line_width) {\n  ctx.beginpath()\n  ctx.arc(x, y, radius, 0, math.pi*2, false)\n  ctx.fillstyle = fill_color || '#444444'\n  ctx.fill()\n  ctx.linewidth = line_width || 2\n  ctx.strokestyle = stroke_color || '#eef'\n  ctx.stroke()\n}\n\nfunction draw_line(ctx, fromx, fromy, tox, toy, stroke_color, line_width) {\n  var path=new path2d()\n  path.moveto(fromx, fromy)\n  path.lineto(tox, toy)\n  ctx.strokestyle = stroke_color || '#eef'\n  ctx.linewidth = line_width || 0.5\n  ctx.stroke(path)\n}\n\nfunction draw_text(ctx, x, y, str, font, fill_color) {\n  ctx.fillstyle = fill_color || '#000'\n  ctx.font = font || \"14px raleway\"\n  if(isNaN(x)) return undefined\n  x = x || 0\n  y = y || 0\n  ctx.filltext(str, x, y)\n}\n\nfunction draw_angle_text(ctx, x1, y1, x2, y2, str, font, fill_color) {\n  ctx.fillstyle = fill_color || '337'\n  ctx.font = font || \"14px sans-serif\"\n\n  // modified from http://phrogz.net/tmp/canvas_rotated_text.html\n\n  var padding = 5\n  var dx = x2 - x1\n  var dy = y2 - y1\n  var len = math.sqrt(dx*dx+dy*dy)\n  var avail = len - 2*padding\n  var pad = 1/2\n  var x = x1\n  var y = y1\n\n  var texttodraw = str\n  if (ctx.measuretext && ctx.measuretext(texttodraw).width > avail){\n    while (texttodraw && ctx.measuretext(texttodraw+\"…\").width > avail) texttodraw = texttodraw.slice(0, -1)\n    texttodraw += \"…\"\n  }\n\n  // keep text upright\n  var angle = math.atan2(dy, dx)\n  if (angle < -math.pi/2 || angle > math.pi/2){\n    x = x2\n    y = y2\n    dx *= -1\n    dy *= -1\n    angle -= math.pi\n  }\n\n  ctx.save()\n  ctx.textalign = 'center'\n  ctx.translate(x+dx*pad, y+dy*pad)\n  ctx.rotate(angle)\n  ctx.filltext(texttodraw, 0, -3)\n  ctx.restore()\n}\n\n\n\n// SENTENCE STRUCTURES\n\nfunction get_actions(env) {\n  var actions = G.v({cat: 'action'}).run() // FIXME: use env.data, not G\n  env.params.actions = actions\n  return env\n}\n\nfunction filter_actions(env) {\n  env.params.actions = env.params.actions.map(function(action) {\n    action.year = new Date(action.time+100000000).getFullYear()\n    return action\n  })\n\n  if(!state.filter_sentences) return env\n\n  env.params.actions = env.params.actions.filter(function(action) {\n    return action.year === state.current_year\n  })\n\n  return env\n}\n\n\nfunction make_sentences(env) {\n  var sentences = env.params.actions.map(construct).filter(Boolean)\n  env.params.sentences = sentences\n  return env\n}\n\nfunction construct(action) {\n  var list = []\n  var edges = action._out.concat(action._in)\n  if(!edges[1]) return false\n  if(edges[0].label === 'the')\n    edges = [edges[1], edges[0]]\n  function notme(id, edge) { return edge._in._id === id ? edge._out : edge._in }\n  list.push(notme(action._id, edges[0]), edges[0], action, edges[1], notme(action._id, edges[1]))\n  list.year = action.year\n  return list\n}\n\nfunction write_sentences(env) {\n  dom.set_el('sentences', '')\n  var oldyear = 1\n\n  env.params.sentences.sort(function(a, b) {\n    return a.year - b.year\n  })\n\n  env.params.sentences.forEach(function(list) {\n    var sentence = ''\n    var innerwords = ''\n    var highlight_count = 0\n\n    if(list.year !== oldyear) {\n      sentence = '<h2>' + list.year + '</h2>'\n      oldyear = list.year\n    }\n\n    list.forEach(function(thing) {\n      var data\n      var word = thing.name || thing.label\n      var cat = thing.cat\n      var type = cat ? thing.type : 'edge'\n\n      var classes = [type]\n      if(cat) {\n        classes.push(cat)\n        classes.push('node-' + thing._id)\n      }\n      else {\n        classes.push('node-' +  thing._in._id + '-' + thing._out._id)\n      }\n\n      if(thing.highlight)\n        highlight_count++\n\n      if(type !== 'edge')\n        data = {id: thing._id||''}\n      else\n        data = {id1: thing._in._id, id2: thing._out._id}\n\n      if(!state.admin_mode)\n        innerwords += template(classes, data, word)\n      else\n        innerwords += admin_template(thing, type, cat, word)\n    })\n\n    var sentence_classes = 'sentence'\n    sentence_classes += highlight_count === 3 ? ' highlight' : ''\n    sentence += '<p class=\"' + sentence_classes + '\">' + innerwords + '.</p>'\n\n    dom.append_el('sentences', sentence)\n  })\n\n  function template(classes, data, text) {\n    classes.unshift('word')\n    var classtext = classes.join(' ')\n\n    var datatext = Object.keys(data).map(function(key) {return 'data-' + key + '=\"' + data[key] + '\"'}).join(' ')\n\n    return ' <span class=\"' + classtext + '\"'\n         + datatext\n         + ' contentEditable=\"true\">'\n         + text + '</span>'\n  }\n\n  function admin_template(thing, type, cat, text) {\n    var button = ''\n    var notes = ''\n\n    if(cat === 'action') {\n      button = '<button class=\"delete\" data-id=\"'+thing._id+'\">delete just this sentence</button>'\n    }\n    else if(type !== 'edge') {\n      notes = ' (' + type + ')'\n      button = '<button class=\"delete\" data-id=\"'+thing._id+'\">delete this thing and all its sentences entirely</button>'\n    }\n\n    return ' ' + text + notes + button\n  }\n\n  return env\n}\n\n\n\n\n// FORM BUILDER & FRIENDS\n\nfunction whatsnext(graph, conversation) {\n  // TODO: incorporate graph knowledge (graph is the whole world, or the relevant subgraph)\n  // THINK: what is a conversation?\n  // are we currently in a sentence? then find the highest weighted unfilled 'port'\n\n  render_conversation(conversation)\n}\n\nfunction get_cat_dat(cat, q) {\n  var substrRegex = new RegExp(q, 'i')\n  var frontRegex = new RegExp('^' + q, 'i')\n  var nodes = G.vertices.filter(function(node) {return node.cat === cat}).map(prop('name'))\n        .filter(function(name) {return substrRegex.test(name)})\n\n  nodes.sort(function(a, b) {\n    return frontRegex.test(b) - frontRegex.test(a) || a.charCodeAt() - b.charCodeAt()\n  })\n\n  return nodes\n}\n\nfunction render_conversation(conversation) {\n  var typeahead_params = {hint: true, highlight: true, minLength: 1}\n  function typeahead_source(cat) {return {name: 'states', source: function(q, cb) {cb(get_cat_dat(cat, q))}}}\n\n  var inputs = ''\n  var prelude = ''\n  var submit_button = '<input type=\"submit\" style=\"position: absolute; left: -9999px\">'\n\n  // special case the first step\n  var sentence = conversation.current\n\n  sentence.filled.forEach(function(slot, i) {\n    prelude += inject_value(slot, slot.value, i) + ' '\n  })\n\n  // display the unfilled slot\n  var slot = sentence.slots[0]\n  var input = ''\n  if(slot.type === 'word') {\n    input = inject_value(slot, make_word_input(slot.cat, slot.key))\n  }\n  else if(slot.type === 'gettype') {\n    input = inject_value(slot, make_type_input(slot.cat, slot.key))\n  }\n  else if(slot.type === 'date') {\n    input = inject_value(slot, make_date_input(slot.key))\n  }\n\n  prelude += input\n\n\n  // do the DOM\n  dom.set_el('the-conversation', prelude + inputs + submit_button)\n\n  // wiring... /sigh\n  var catnames = Object.keys(cats)\n  catnames.forEach(function(cat) {\n    $('.'+cat+'-input').typeahead(typeahead_params, typeahead_source(cat))\n  })\n\n  if(sentence.filled.length)\n    $('#' + slot.key).focus()\n\n  return false\n\n  // helper functions\n\n  function make_word_input(cat, key) {\n    var text = ''\n\n    if(cat === 'thing')\n      return '<input class=\"typeahead ' +cat+ '-input\" type=\"text\" placeholder=\"A' +mayben(cat)+ ' ' +cat+ '\" id=\"' +key+ '\">'\n    if(cat === 'action') {\n      text += '<select id=\"verb\" name=\"verb\">'\n      var options = ['participate in', 'lead', 'fund', 'organize', 'inspire', 'invite']\n      // var options = ['facilitate', 'coordinate', 'contribute', 'create', 'attend', 'manage', 'assist', 'present', 'join', 'leave']\n      options.forEach(function(option) {\n        text += '<option>' + option + '</option>'\n      })\n      text += '</select>'\n      return text\n    }\n  }\n\n  function make_type_input(cat, key) {\n    // TODO: this assumes cat is always 'thing'\n    var str = '<select id=\"'+key+'\">'\n    str += '<option value=\"person\">person</option>'\n    str += '<option value=\"org\">org</option>'\n    str += '<option value=\"event\">event</option>'\n    str += '<option value=\"outcome\">outcome</option>'\n    str += '</select>'\n    return str\n  }\n\n  function make_date_input(key) {\n    var str = '<input id=\"' +key+ '\" type=\"date\" name=\"' +key+ '\" value=\"2016-01-01\" />'\n    return str\n  }\n\n  function inject_value(slot, value, index) { // HACK: index is a huge hack, remove it.\n    var text = ''\n\n    if(slot.key === 'subject') {\n      if(slot.value) {\n        text += '<p><b>' + slot.value + '</b></p>'\n      } else {\n        text += \"Okay, let's fill in the blanks. Tell us about \"\n        text += value + ' '\n      }\n    }\n    else if(slot.key === 'verb') {\n      text += ' did '\n      text += value\n      text += ' the '\n    }\n    else if(slot.key === 'object') {\n      text += value + ' '\n    }\n    else if(slot.type === 'gettype') {\n      if(index === 1) {\n        text += ' is a'\n        text += mayben(value) + ' '\n        text += value + ' '\n        if(slot.value)\n          text += slot.value === 'person' ? 'who ' : 'which '\n      } else {\n        text += ' (a'\n        text += mayben(value) + ' '\n        text += value + ') '\n      }\n    }\n    else if(slot.type === 'date') {\n      text += ' in/on '\n      text += value + ' '\n    }\n    else {\n      text = ' ' + value + ' '\n    }\n\n    return text\n  }\n}\n\nfunction mayben(val) {\n  return /^[aeiou]/.test(val) ? 'n' : ''\n}\n\n\nfunction set_minus(xs, ys) {\n  return xs.filter(function(x) {\n    return ys.indexOf(x) === -1\n  })\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction showtags() {\n  // generate current tags\n  // hoverable span for highlight, plus clickable for remove\n  var tagwrapper = ['<span class=\"tag\">', '</span>']\n  var tagstr = state.tags.map(function(tag) { return tagwrapper[0] + tag + tagwrapper[1] }).join(', ')\n  dom.set_el('tagnames', tagstr)\n\n  // generate select box\n  var unused = set_minus(Object.keys(state.tagkeys), state.tags).sort()\n  var optionstr = '<option>' + unused.join('</option><option>') + '</option>'\n  dom.set_el('othertags', optionstr)\n}\n\n\nfunction render_all() {\n  render()\n  render_conversation(conversation)\n  showtags()\n}\n","/*global Dagoba */\n\nimport state from 'state'\nimport {get_facts_from_server} from 'net'\nimport {add_edge} from 'model'\nimport {render_all} from 'render'\n\nexport let G = Dagoba.graph()\nexport {addtag, removetag, add_data}\n\n\nfunction addtag(tag) {\n  state.tags.push(tag)\n  G = Dagoba.graph()\n  fact_to_graph(state.facts)\n  render_all()\n}\n\nfunction removetag(tag) {\n  var index = state.tags.indexOf(tag)\n  if(index === -1)\n    return undefined\n\n  state.tags.splice(index, 1)\n  G = Dagoba.graph()\n  fact_to_graph(state.facts)\n  render_all()\n}\n\n// function reset_graph() {\n//   G = Dagoba.graph()\n// }\n\nfunction add_data(cb) {\n  get_facts_from_server(function(facts) {\n    if(Array.isArray(facts))\n      cb(fact_to_graph(capture_facts(facts)))\n    else\n      cb(facts) // already a graph, from localStorage\n  })\n}\n\nfunction capture_facts(facts) {\n  state.facts = facts\n  return facts\n}\n\nfunction fact_to_graph(facts) {\n  /*\n\n   data model:\n   user: id\n   action: add/remove/edit\n   type: node/edge\n   tags: [...]\n   org: id\n   [maybe other stats can live here?]\n   data:\n   node: {id, name, type, cat...}\n   edge: {_in, _out, type, label}\n\n   */\n\n  var tree = factor_facts(filter_facts(facts))\n  state.tagkeys = get_tagkeys(facts)\n\n  tree.nodes.add.forEach(function(node) {\n    var fun = window['add_' + node.cat] // FIXME: ugh erk yuck poo\n    if(!fun) return undefined\n    fun(node.type, node)\n  })\n\n  tree.edges.add.forEach(function(edge) { // we need to delay these so the nodes are all in place (sometimes the facts get added in weird orders)\n    add_edge(edge.type, edge._out, edge._in, edge)\n  })\n\n  tree.nodes.edit.forEach(function(node) {\n    // FIXME: what on earth is this??? should it be G.edit?\n    // RM.graph.edit(node) //////\n  })\n}\n\nfunction get_tagkeys(facts) {\n  var keys = {}\n  facts.forEach(function(fact) {\n    ~(fact.tags||[]).forEach(function(tag) {\n      if(tag)\n        keys[tag] = true\n    })\n  })\n  return keys\n}\n\nfunction filter_facts(facts) {\n  facts = facts.filter(function(fact) {\n    return !!set_intersect(fact.tags, state.tags).length // THINK: this implies no empty tag arrays (so 'plain' as default?)\n  })\n\n  return facts\n}\n\nfunction factor_facts(facts) {\n  var tree = {nodes: {add: [], edit: [], remove: []}, edges: {add: [], edit: [], remove: []}}\n  facts.forEach(function(fact) {\n    // var branch = tree[fact.type+'s']\n    // var list = branch[fact.action] || []\n    // if(!branch[fact.action])\n    //   branch[fact.action] = list\n    var list = tree[fact.type+'s'][fact.action] || [] // TODO: error handling\n\n    // var item = clone(fact.data)\n    var item = fact.data // THINK: is mutating here okay?\n    item.org = fact.org\n    item.user = fact.user\n    item.tags = fact.tags\n    list.push(item)\n  })\n  return tree\n}\n\nfunction set_intersect(xs, ys) {\n  return xs.filter(function(x) {\n    return ys.indexOf(x) !== -1\n  })\n}\n","import {add_data} from './graph'\nimport {init as render_init, render, render_all} from 'render'\nimport * as dom from 'dom' // just for effects\nimport state from 'state'\n\n\nexport {init, render_all}\n\n\n\n///////////////////////// DOM GLUE ///////////////////////////////\n\n\n\nexport function do_the_glue() {\n\n  dom.el('login').addEventListener('submit', dom.login)\n\n  dom.el('addtag').addEventListener('submit', dom.submit_addtag)\n\n  dom.el('the-conversation').addEventListener('submit', dom.submit_convo)\n\n  dom.el('sentences').addEventListener('mouseover', dom.activate_highlighter)\n  dom.el('sentences').addEventListener('mouseout', dom.deactivate_highlighter)\n  dom.el('sentences').addEventListener('keyup', dom.keyup_sentences)\n  dom.el('sentences').addEventListener('click', dom.click_sentences)\n\n  dom.el('tagnames').addEventListener('click', dom.click_tagnames)\n  dom.el('tagnames').addEventListener('mouseover', dom.mouseover_tagnames)\n  dom.el('tagnames').addEventListener('mouseout', dom.mouseout_tagnames)\n\n  document.addEventListener('keydown', dom.global_keydown)\n\n  render_all()\n}\n\n\n\n\n\n///////////////////// END DOM GLUE ///////////////////////////////\n\n\n\n\n\n\n\n\n\n\n// package and expose some functionality for the view side,\n// and create outward-facing bindings to spin everything up.\n\n\n// init network load\n// expose rendering functions\n// create dom hooks on demand as html is rendered\n\n\n\n\n\n// TODO: partition incoming bleep bloops by action\n// TODO: build edit functions\n// TODO: build remove functions\n// TODO: ask user for email address\n// TODO: show current tags\n// TODO: allow changing of tags\n// TODO: allow multitag views\n// TODO: add all tags on server\n// TODO: try to get an additional compaction in\n\n// TODO: consolidate like-named nodes\n// TODO: consolidate email addresses on server\n// TODO: copy tags into url\n\n\n\n\n\n\n\n\n\n// INIT\n\n\n// TODO: break this up a little so the logic is clearer\n\nfunction init() {\n  // do_the_glue()\n\n  if(window.location.host.slice(0, 9) === \"127.0.0.1\") {\n    if(window.location.hash)\n      state.safe_mode = window.location.hash.slice(1)\n    else\n      state.safe_mode = true\n  }\n\n  if(window.location.search) {\n    state.query = window.location.search.substr(1).split('&').reduce(function(acc, pair) {\n      var p = pair.split('=')\n      acc[p[0]] = p[1]\n      return acc\n    }, {})\n    if(state.query.tag)\n      state.tags = [state.query.tag]\n    else if(state.query.tags)\n      state.tags = state.query.tags.split('|')\n  }\n\n  // G = Dagoba.graph()\n\n  // FIXME: leaking into the global space\n  window.rm_render = render_all\n\n  render_init()\n\n  function cb() {\n    render_all()\n    state.loading = false // TODO: get rid of this somehow\n  }\n\n  add_data(cb)\n\n  setTimeout(function() {\n    render()\n  }, 111)\n}\n\n// init()\n","/**\n *\n * The Entry point to all of Ripplemap. (RM)\n * Creates the sidebar for controlling the RM. (built with Preact, see src/Sidebar)\n */\n\nimport { h, render, Component } from 'preact'\nimport Sidebar from './Sidebar/Sidebar'\nimport './styles/main.css'\nimport {do_the_glue, init as rm_init, render_all as rm_render_all} from 'Ripplemap/main'\n\n\ninit()\n\nfunction init() {\n  rm_init()\n  window.do_the_glue = do_the_glue\n  window.rm_render_all = rm_render_all\n  render(<Sidebar />, document.getElementById('sidebar'))\n}\n"],"names":["VNode","nodeName","attributes","children","key","stack","EMPTY_CHILDREN","h","lastSimple","child","simple","i","arguments","length","push","pop","Array","String","p","undefined","options","vnode","extend","obj","props","clone","delve","split","isFunction","isString","hashToClassName","c","str","prop","lcCache","toLowerCase","s","resolved","Promise","resolve","defer","then","f","setTimeout","NO_RENDER","SYNC_RENDER","FORCE_RENDER","ASYNC_RENDER","EMPTY","ATTR_KEY","Symbol","for","NON_DIMENSION_PROPS","boxFlexGroup","columnCount","fillOpacity","flex","flexGrow","flexShrink","flexNegative","fontWeight","lineClamp","lineHeight","order","orphans","strokeOpacity","widows","zIndex","zoom","NON_BUBBLING_EVENTS","blur","error","focus","load","resize","scroll","createLinkedState","component","eventPath","path","e","t","target","state","v","type","match","checked","value","setState","items","enqueueRender","_dirty","debounceRendering","rerender","list","renderComponent","isFunctionalComponent","prototype","render","buildFunctionalComponent","context","getNodeProps","isSameNodeType","node","Text","_componentConstructor","isNamedNode","normalizedNodeName","defaultProps","removeNode","parentNode","removeChild","setAccessor","name","old","isSvg","className","style","cssText","innerHTML","__html","l","_listeners","substring","addEventListener","eventProxy","removeEventListener","removeAttribute","ns","removeAttributeNS","setAttributeNS","setAttribute","setProperty","event","nodes","collectNode","Element","_component","createNode","document","createElementNS","createElement","mounts","diffLevel","isSvgMode","hydrating","flushMounts","afterMount","componentDidMount","diff","dom","mountAll","parent","componentRoot","ownerSVGElement","ret","idiff","appendChild","ref","nodeValue","recollectNodeTree","createTextNode","buildComponentFromVNode","out","vchildren","firstChild","replaceChild","fc","a","nextSibling","dangerouslySetInnerHTML","prevSvgMode","innerDiffNode","absorb","originalChildren","childNodes","keyed","keyedLen","min","len","childrenLen","vlen","j","vchild","__key","insertBefore","unmountOnly","lastChild","diffAttributes","attrs","components","collectComponent","constructor","createComponent","Ctor","inst","call","nextBase","splice","setComponentProps","opts","_disable","__ref","base","componentWillMount","componentWillReceiveProps","prevContext","prevProps","syncComponentUpdates","isChild","skip","rendered","previousProps","previousState","prevState","previousContext","isUpdate","initialBase","initialChildComponent","cbase","shouldComponentUpdate","componentWillUpdate","getChildContext","childComponent","toUnmount","childProps","_parentComponent","baseParent","componentRef","unshift","componentDidUpdate","afterUpdate","cb","_renderCallbacks","fn","originalComponent","oldDom","isDirectOwner","isOwner","unmountComponent","remove","beforeUnmount","componentWillUnmount","inner","componentDidUnmount","Component","_linkedStates","callback","merge","classMaker","b","class_1","class_2","isDate","Tab","id","currentView","icon","changeView","tabClasses","iconClasses","tabs","TabBar","renderTabs","map","tab","Header","genClassName","Button","onClick","Home","About","YourSelection","Current","LegendItem","filter_is_on","currentFilters","indexOf","filter_key","containerStyles","circleStyles","size","selected","color","textStyles","toggleFilter","LegendNodes","LegendEdges","Legend","filter","cur_filters","filter_exists","filter_poo","rm_render","renderNodes","renderEdges","paddingRight","paddingLeft","Story","Sidebar","view_id","do_the_glue","renderSelectedView","render_all","tags","facts","tagkeys","query","safe_mode","loading","all_edges","admin_mode","my_maxyear","my_minyear","show_labels","current_year","filter_sentences","ring_radius","add_to_server_facts","live_item","item","Object","keys","reduce","acc","_out","_id","_in","fact","email","persist","G","debounce","func","wait","immediate","timeout","args","later","apply","callNow","send_data_to_server","data","url","console","log","method","JSON","stringify","response","json","result","get_facts_from_server","parse","localStorage","catch","err","noop","eq","attr","val","unique","k","truncate","to","substr","push_it","pipe","all_funs","slice","magic_pipe","funs","fun","shift","async","new_data","mess","cats","thing","action","effect","happening","get_node","catstr","typestr","convert_props","cat","add_alias","alias","aliases","add_thing","priority","add_action","new_thing_type","properties","cattype","cc","start","end","forEach","new_action_type","edges","did","dir","plural","label","types","the","new_effect_type","by","was","during","new_happening_type","at","add_edge","from","edge","timerange","add_to_graph","get_new_id","addVertex","addEdge","Math","random","isArray","convo","new_conversation","join_conversation","conversation","wants","current","slots","fulfill_desire","new_sentence","filled","sentence","sentences","give_word","subject","verb","object","date","slot","oldkey","word","time","Date","getTime","run","el","els","default_el","el_id","getElementById","set_el","append_el","login","preventDefault","classList","add","highlight_fun","highlight_target","activate_highlighter","highlighter","deactivate_highlighter","matches","ids","dataset","Boolean","highlight","o_or_f","click_tagnames","ev","tag","innerText","mouseover_tagnames","mouseout_tagnames","global_keydown","tagName","keyCode","which","key_e","key_f","key_l","key_n","key_p","tilde","larro","uarro","rarro","darro","submit_addtag","keyup_sentences","span","contains","textContent","getAttribute","vertexIndex","id1","id2","node1","concat","pub","spans","querySelectorAll","click_sentences","removeVertex","submit_convo","ctx","getContext","viz_pipe","word_pipe","init","mod","sg_compact","likenamed","cluster","Dagoba","cloneflat","set_year","data_to_graph","add_fakes","set_coords","set_score","minimize_edge_length","remove_fakes","unique_y_pos","filter_by_year","filter_nodes","add_rings","add_ring_labels","copy_edges","copy_nodes","add_node_labels","add_edge_labels","clear_it_svg","draw_it_svg","draw_metadata","get_actions","filter_actions","make_sentences","write_sentences","env","head","body","tail","window","g","newg","graph","others","both","other","Infinity","oo","some","x","namemap","mergeVertices","clusters","names","bind","minyear","maxyear","params","years","V","year","getFullYear","E","vertices","yearstr","fake","copies","fakes","offset","radius","nabes","index","arc","PI","deg","cx","cos","cy","sin","edge_count","shape","y","r","score","sort","peers","score_sort","peer","new_node_score","new_peer_score","swap","n1","n2","score_edge","self","dx","abs","dy","sqrt","threshold","ys","coords","closest","da","modify_coords","find_closest","n","floor","max","filters","includes","shapes","stroke","fill","line","labels","font","hues","x1","y1","x2","y2","ghost","outcome","person","svg","draw_shape","highlight_edge","edge_click","edge_hover","good_edges","highlight_node","node_click","node_hover","good_nodes","draw_circle","draw_line","draw_text","draw_angle_text","stroke_color","fill_color","line_width","u_id","fromx","fromy","tox","toy","font_size","isNaN","fillstyle","padding","math","avail","pad","texttodraw","measuretext","width","angle","atan2","pi","save","textalign","translate","rotate","filltext","restore","actions","construct","notme","oldyear","innerwords","highlight_count","classes","template","admin_template","sentence_classes","text","classtext","join","datatext","button","notes","whatsnext","get_cat_dat","q","substrRegex","RegExp","frontRegex","test","charCodeAt","render_conversation","typeahead_params","hint","minLength","typeahead_source","source","inputs","prelude","submit_button","inject_value","input","make_word_input","make_type_input","make_date_input","catnames","typeahead","$","mayben","option","set_minus","xs","showtags","tagwrapper","tagstr","unused","optionstr","addtag","removetag","add_data","fact_to_graph","capture_facts","tree","factor_facts","filter_facts","get_tagkeys","edit","set_intersect","org","user","location","host","hash","search","pair","rm_render_all"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA,AAAO,SAASA,KAAT,CAAeC,QAAf,EAAyBC,UAAzB,EAAqCC,QAArC,EAA+C;;MAEhDF,QAAL,GAAgBA,QAAhB;;;MAGKC,UAAL,GAAkBA,UAAlB;;;MAGKC,QAAL,GAAgBA,QAAhB;;;MAGKC,GAAL,GAAWF,cAAcA,WAAWE,GAApC;;;ACZD;;;;AAIA,cAAe;;;;;;;;;;;;;;;;;;;;;;CAAf;;ACAA,IAAMC,QAAQ,EAAd;;AAEA,IAAMC,iBAAiB,EAAvB;;;;;;;;;;;AAWA,AAAO,SAASC,CAAT,CAAWN,QAAX,EAAqBC,UAArB,EAAiC;KACnCC,iBAAJ;KAAcK,mBAAd;KAA0BC,cAA1B;KAAiCC,eAAjC;KAAyCC,UAAzC;MACKA,IAAEC,UAAUC,MAAjB,EAAyBF,MAAM,CAA/B,GAAoC;QAC7BG,IAAN,CAAWF,UAAUD,CAAV,CAAX;;KAEGT,cAAcA,WAAWC,QAA7B,EAAuC;MAClC,CAACE,MAAMQ,MAAX,EAAmBR,MAAMS,IAAN,CAAWZ,WAAWC,QAAtB;SACZD,WAAWC,QAAlB;;QAEME,MAAMQ,MAAb,EAAqB;MAChB,CAACJ,QAAQJ,MAAMU,GAAN,EAAT,aAAiCC,KAArC,EAA4C;QACtCL,IAAEF,MAAMI,MAAb,EAAqBF,GAArB;UAAkCG,IAAN,CAAWL,MAAME,CAAN,CAAX;;GAD7B,MAGK,IAAIF,SAAO,IAAP,IAAeA,UAAQ,IAAvB,IAA+BA,UAAQ,KAA3C,EAAkD;OAClD,OAAOA,KAAP,IAAc,QAAlB,EAA4BA,QAAQQ,OAAOR,KAAP,CAAR;YACnB,OAAOA,KAAP,IAAc,QAAvB;OACIC,UAAUF,UAAd,EAA0B;aAChBL,SAASU,MAAT,GAAgB,CAAzB,KAA+BJ,KAA/B;IADD,MAGK;KACHN,aAAaA,WAAW,EAAxB,CAAD,EAA8BW,IAA9B,CAAmCL,KAAnC;iBACaC,MAAb;;;;;KAKCQ,IAAI,IAAIlB,KAAJ,CAAUC,QAAV,EAAoBC,cAAciB,SAAlC,EAA6ChB,YAAYG,cAAzD,CAAR;;;KAGIc,QAAQC,KAAZ,EAAmBD,QAAQC,KAAR,CAAcH,CAAd;;QAEZA,CAAP;;;AChDD;;;;AAIA,AAAO,SAASI,MAAT,CAAgBC,GAAhB,EAAqBC,KAArB,EAA4B;KAC9BA,KAAJ,EAAW;OACL,IAAIb,CAAT,IAAca,KAAd;OAAyBb,CAAJ,IAASa,MAAMb,CAAN,CAAT;;;QAEfY,GAAP;;;;;;AAOD,AAAO,SAASE,KAAT,CAAeF,GAAf,EAAoB;QACnBD,OAAO,EAAP,EAAWC,GAAX,CAAP;;;;;;AAOD,AAAO,SAASG,KAAT,CAAeH,GAAf,EAAoBnB,GAApB,EAAyB;MAC1B,IAAIc,IAAEd,IAAIuB,KAAJ,CAAU,GAAV,CAAN,EAAsBhB,IAAE,CAA7B,EAAgCA,IAAEO,EAAEL,MAAJ,IAAcU,GAA9C,EAAmDZ,GAAnD,EAAwD;QACjDY,IAAIL,EAAEP,CAAF,CAAJ,CAAN;;QAEMY,GAAP;;;;AAKD,AAAO,SAASK,UAAT,CAAoBL,GAApB,EAAyB;QACxB,eAAa,OAAOA,GAA3B;;;;AAKD,AAAO,SAASM,QAAT,CAAkBN,GAAlB,EAAuB;QACtB,aAAW,OAAOA,GAAzB;;;;;;AAOD,AAAO,SAASO,eAAT,CAAyBC,CAAzB,EAA4B;KAC9BC,MAAM,EAAV;MACK,IAAIC,IAAT,IAAiBF,CAAjB,EAAoB;MACfA,EAAEE,IAAF,CAAJ,EAAa;OACRD,GAAJ,EAASA,OAAO,GAAP;UACFC,IAAP;;;QAGKD,GAAP;;;;AAKD,IAAIE,UAAU,EAAd;AACA,AAAO,IAAMC,cAAc,SAAdA,WAAc;QAAKD,QAAQE,CAAR,MAAeF,QAAQE,CAAR,IAAaA,EAAED,WAAF,EAA5B,CAAL;CAApB;;;;;AAMP,IAAIE,WAAW,OAAOC,OAAP,KAAiB,WAAjB,IAAgCA,QAAQC,OAAR,EAA/C;AACA,AAAO,IAAMC,QAAQH,WAAY,aAAK;UAAWI,IAAT,CAAcC,CAAd;CAAnB,GAA0CC,UAAxD;;ACnEP;;AAEA,AAAO,IAAMC,YAAY,CAAlB;AACP,AAAO,IAAMC,cAAc,CAApB;AACP,AAAO,IAAMC,eAAe,CAArB;AACP,AAAO,IAAMC,eAAe,CAArB;;AAEP,AAAO,IAAMC,QAAQ,EAAd;;AAEP,AAAO,IAAMC,WAAW,OAAOC,MAAP,KAAgB,WAAhB,GAA8BA,OAAOC,GAAP,CAAW,YAAX,CAA9B,GAAyD,eAA1E;;;AAGP,AAAO,IAAMC,sBAAsB;UAC1B,CAD0B,EACvBC,cAAa,CADU,EACPC,aAAY,CADL,EACQC,aAAY,CADpB,EACuBC,MAAK,CAD5B,EAC+BC,UAAS,CADxC;eAErB,CAFqB,EAElBC,YAAW,CAFO,EAEJC,cAAa,CAFT,EAEYC,YAAW,CAFvB,EAE0BC,WAAU,CAFpC,EAEuCC,YAAW,CAFlD;UAG1B,CAH0B,EAGvBC,OAAM,CAHiB,EAGdC,SAAQ,CAHM,EAGHC,eAAc,CAHX,EAGcC,QAAO,CAHrB,EAGwBC,QAAO,CAH/B,EAGkCC,MAAK;CAHnE;;;AAOP,AAAO,IAAMC,sBAAsB,EAAEC,MAAK,CAAP,EAAUC,OAAM,CAAhB,EAAmBC,OAAM,CAAzB,EAA4BC,MAAK,CAAjC,EAAoCC,QAAO,CAA3C,EAA8CC,QAAO,CAArD,EAA5B;;ACVA,SAASC,iBAAT,CAA2BC,SAA3B,EAAsCzE,GAAtC,EAA2C0E,SAA3C,EAAsD;KACxDC,OAAO3E,IAAIuB,KAAJ,CAAU,GAAV,CAAX;QACO,UAASqD,CAAT,EAAY;MACdC,IAAID,KAAKA,EAAEE,MAAP,IAAiB,IAAzB;MACCC,QAAQ,EADT;MAEC5D,MAAM4D,KAFP;MAGCC,IAAIvD,SAASiD,SAAT,IAAsBpD,MAAMsD,CAAN,EAASF,SAAT,CAAtB,GAA4CG,EAAEhF,QAAF,GAAcgF,EAAEI,IAAF,CAAOC,KAAP,CAAa,UAAb,IAA2BL,EAAEM,OAA7B,GAAuCN,EAAEO,KAAvD,GAAgER,CAHjH;MAICrE,IAAI,CAJL;SAKQA,IAAEoE,KAAKlE,MAAL,GAAY,CAAtB,EAAyBF,GAAzB,EAA8B;SACvBY,IAAIwD,KAAKpE,CAAL,CAAJ,MAAiBY,IAAIwD,KAAKpE,CAAL,CAAJ,IAAe,CAACA,CAAD,IAAMkE,UAAUM,KAAV,CAAgBJ,KAAKpE,CAAL,CAAhB,CAAN,IAAkC,EAAlE,CAAN;;MAEGoE,KAAKpE,CAAL,CAAJ,IAAeyE,CAAf;YACUK,QAAV,CAAmBN,KAAnB;EAVD;;;ACJD,IAAIO,QAAQ,EAAZ;;AAEA,AAAO,SAASC,aAAT,CAAuBd,SAAvB,EAAkC;KACpC,CAACA,UAAUe,MAAX,KAAsBf,UAAUe,MAAV,GAAmB,IAAzC,KAAkDF,MAAM5E,IAAN,CAAW+D,SAAX,KAAuB,CAA7E,EAAgF;GAC9EzD,QAAQyE,iBAAR,IAA6BrD,KAA9B,EAAqCsD,QAArC;;;;AAKF,AAAO,SAASA,QAAT,GAAoB;KACtB5E,UAAJ;KAAO6E,OAAOL,KAAd;SACQ,EAAR;QACSxE,IAAI6E,KAAKhF,GAAL,EAAb,EAA2B;MACtBG,EAAE0E,MAAN,EAAcI,gBAAgB9E,CAAhB;;;;ACTT,SAAS+E,qBAAT,CAA+B5E,KAA/B,EAAsC;MACxCpB,WAAWoB,SAASA,MAAMpB,QAA9B;SACOA,YAAY2B,WAAW3B,QAAX,CAAZ,IAAoC,EAAEA,SAASiG,SAAT,IAAsBjG,SAASiG,SAAT,CAAmBC,MAA3C,CAA3C;;;;;;;AASD,AAAO,SAASC,wBAAT,CAAkC/E,KAAlC,EAAyCgF,OAAzC,EAAkD;SACjDhF,MAAMpB,QAAN,CAAeqG,aAAajF,KAAb,CAAf,EAAoCgF,WAAWrD,KAA/C,CAAP;;;ACdM,SAASuD,cAAT,CAAwBC,IAAxB,EAA8BnF,KAA9B,EAAqC;KACvCQ,SAASR,KAAT,CAAJ,EAAqB;SACbmF,gBAAgBC,IAAvB;;KAEG5E,SAASR,MAAMpB,QAAf,CAAJ,EAA8B;SACtB,CAACuG,KAAKE,qBAAN,IAA+BC,YAAYH,IAAZ,EAAkBnF,MAAMpB,QAAxB,CAAtC;;KAEG2B,WAAWP,MAAMpB,QAAjB,CAAJ,EAAgC;SACxB,CAACuG,KAAKE,qBAAL,GAA6BF,KAAKE,qBAAL,KAA6BrF,MAAMpB,QAAhE,GAA2E,IAA5E,KAAqFgG,sBAAsB5E,KAAtB,CAA5F;;;;AAKF,AAAO,SAASsF,WAAT,CAAqBH,IAArB,EAA2BvG,QAA3B,EAAqC;QACpCuG,KAAKI,kBAAL,KAA0B3G,QAA1B,IAAsCkC,YAAYqE,KAAKvG,QAAjB,MAA6BkC,YAAYlC,QAAZ,CAA1E;;;;;;;;;;AAWD,AAAO,SAASqG,YAAT,CAAsBjF,KAAtB,EAA6B;KAC/BG,QAAQC,MAAMJ,MAAMnB,UAAZ,CAAZ;OACMC,QAAN,GAAiBkB,MAAMlB,QAAvB;;KAEI0G,eAAexF,MAAMpB,QAAN,CAAe4G,YAAlC;KACIA,YAAJ,EAAkB;OACZ,IAAIlG,CAAT,IAAckG,YAAd,EAA4B;OACvBrF,MAAMb,CAAN,MAAWQ,SAAf,EAA0B;UACnBR,CAAN,IAAWkG,aAAalG,CAAb,CAAX;;;;;QAKIa,KAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvCM,SAASsF,UAAT,CAAoBN,IAApB,EAA0B;KAC5BtF,IAAIsF,KAAKO,UAAb;KACI7F,CAAJ,EAAOA,EAAE8F,WAAF,CAAcR,IAAd;;;;;;;;;;;;AAaR,AAAO,SAASS,WAAT,CAAqBT,IAArB,EAA2BU,IAA3B,EAAiCC,GAAjC,EAAsC3B,KAAtC,EAA6C4B,KAA7C,EAAoD;;KAEtDF,SAAO,WAAX,EAAwBA,OAAO,OAAP;;KAEpBA,SAAO,OAAP,IAAkB1B,KAAlB,IAA2B,QAAOA,KAAP,yCAAOA,KAAP,OAAe,QAA9C,EAAwD;UAC/C1D,gBAAgB0D,KAAhB,CAAR;;;KAGG0B,SAAO,KAAX,EAAkB;;EAAlB,MAGK,IAAIA,SAAO,OAAP,IAAkB,CAACE,KAAvB,EAA8B;OAC7BC,SAAL,GAAiB7B,SAAS,EAA1B;EADI,MAGA,IAAI0B,SAAO,OAAX,EAAoB;MACpB,CAAC1B,KAAD,IAAU3D,SAAS2D,KAAT,CAAV,IAA6B3D,SAASsF,GAAT,CAAjC,EAAgD;QAC1CG,KAAL,CAAWC,OAAX,GAAqB/B,SAAS,EAA9B;;MAEGA,SAAS,QAAOA,KAAP,yCAAOA,KAAP,OAAe,QAA5B,EAAsC;OACjC,CAAC3D,SAASsF,GAAT,CAAL,EAAoB;SACd,IAAIxG,CAAT,IAAcwG,GAAd;SAAuB,EAAExG,KAAK6E,KAAP,CAAJ,EAAmBgB,KAAKc,KAAL,CAAW3G,CAAX,IAAgB,EAAhB;;;QAElC,IAAIA,EAAT,IAAc6E,KAAd,EAAqB;SACf8B,KAAL,CAAW3G,EAAX,IAAgB,OAAO6E,MAAM7E,EAAN,CAAP,KAAkB,QAAlB,IAA8B,CAACyC,oBAAoBzC,EAApB,CAA/B,GAAyD6E,MAAM7E,EAAN,IAAS,IAAlE,GAA0E6E,MAAM7E,EAAN,CAA1F;;;EATE,MAaA,IAAIuG,SAAO,yBAAX,EAAsC;MACtC1B,KAAJ,EAAWgB,KAAKgB,SAAL,GAAiBhC,MAAMiC,MAAN,IAAgB,EAAjC;EADP,MAGA,IAAIP,KAAK,CAAL,KAAS,GAAT,IAAgBA,KAAK,CAAL,KAAS,GAA7B,EAAkC;MAClCQ,IAAIlB,KAAKmB,UAAL,KAAoBnB,KAAKmB,UAAL,GAAkB,EAAtC,CAAR;SACOxF,YAAY+E,KAAKU,SAAL,CAAe,CAAf,CAAZ,CAAP;;;MAGIpC,KAAJ,EAAW;OACN,CAACkC,EAAER,IAAF,CAAL,EAAcV,KAAKqB,gBAAL,CAAsBX,IAAtB,EAA4BY,UAA5B,EAAwC,CAAC,CAACzD,oBAAoB6C,IAApB,CAA1C;GADf,MAGK,IAAIQ,EAAER,IAAF,CAAJ,EAAa;QACZa,mBAAL,CAAyBb,IAAzB,EAA+BY,UAA/B,EAA2C,CAAC,CAACzD,oBAAoB6C,IAApB,CAA7C;;IAECA,IAAF,IAAU1B,KAAV;EAXI,MAaA,IAAI0B,SAAO,MAAP,IAAiBA,SAAO,MAAxB,IAAkC,CAACE,KAAnC,IAA4CF,QAAQV,IAAxD,EAA8D;cACtDA,IAAZ,EAAkBU,IAAlB,EAAwB1B,SAAO,IAAP,GAAc,EAAd,GAAmBA,KAA3C;MACIA,SAAO,IAAP,IAAeA,UAAQ,KAA3B,EAAkCgB,KAAKwB,eAAL,CAAqBd,IAArB;EAF9B,MAIA;MACAe,KAAKb,SAASF,KAAK5B,KAAL,CAAW,eAAX,CAAlB;MACIE,SAAO,IAAP,IAAeA,UAAQ,KAA3B,EAAkC;OAC7ByC,EAAJ,EAAQzB,KAAK0B,iBAAL,CAAuB,8BAAvB,EAAuD/F,YAAY8F,GAAG,CAAH,CAAZ,CAAvD,EAAR,KACKzB,KAAKwB,eAAL,CAAqBd,IAArB;GAFN,MAIK,IAAI,QAAO1B,KAAP,yCAAOA,KAAP,OAAe,QAAf,IAA2B,CAAC5D,WAAW4D,KAAX,CAAhC,EAAmD;OACnDyC,EAAJ,EAAQzB,KAAK2B,cAAL,CAAoB,8BAApB,EAAoDhG,YAAY8F,GAAG,CAAH,CAAZ,CAApD,EAAwEzC,KAAxE,EAAR,KACKgB,KAAK4B,YAAL,CAAkBlB,IAAlB,EAAwB1B,KAAxB;;;;;;;;AASR,SAAS6C,WAAT,CAAqB7B,IAArB,EAA2BU,IAA3B,EAAiC1B,KAAjC,EAAwC;KACnC;OACE0B,IAAL,IAAa1B,KAAb;EADD,CAEE,OAAOR,CAAP,EAAU;;;;;;AAOb,SAAS8C,UAAT,CAAoB9C,CAApB,EAAuB;QACf,KAAK2C,UAAL,CAAgB3C,EAAEK,IAAlB,EAAwBjE,QAAQkH,KAAR,IAAiBlH,QAAQkH,KAAR,CAActD,CAAd,CAAjB,IAAqCA,CAA7D,CAAP;;;AC7FD,IAAMuD,QAAQ,EAAd;;AAEA,AAAO,SAASC,WAAT,CAAqBhC,IAArB,EAA2B;YACtBA,IAAX;;KAEIA,gBAAgBiC,OAApB,EAA6B;OACvBC,UAAL,GAAkBlC,KAAKE,qBAAL,GAA6B,IAA/C;;MAEIQ,OAAOV,KAAKI,kBAAL,IAA2BzE,YAAYqE,KAAKvG,QAAjB,CAAtC;GACCsI,MAAMrB,IAAN,MAAgBqB,MAAMrB,IAAN,IAAc,EAA9B,CAAD,EAAoCpG,IAApC,CAAyC0F,IAAzC;;;;AAKF,AAAO,SAASmC,UAAT,CAAoB1I,QAApB,EAA8BmH,KAA9B,EAAqC;KACvCF,OAAO/E,YAAYlC,QAAZ,CAAX;KACCuG,OAAO+B,MAAMrB,IAAN,KAAeqB,MAAMrB,IAAN,EAAYnG,GAAZ,EAAf,KAAqCqG,QAAQwB,SAASC,eAAT,CAAyB,4BAAzB,EAAuD5I,QAAvD,CAAR,GAA2E2I,SAASE,aAAT,CAAuB7I,QAAvB,CAAhH,CADR;MAEK2G,kBAAL,GAA0BM,IAA1B;QACOV,IAAP;;;ACXM,IAAMuC,SAAS,EAAf;;;AAGP,AAAO,IAAIC,YAAY,CAAhB;;;AAGP,IAAIC,YAAY,KAAhB;;;AAGA,IAAIC,YAAY,KAAhB;;;AAGA,AAAO,SAASC,WAAT,GAAuB;KACzBpH,UAAJ;QACQA,IAAEgH,OAAOhI,GAAP,EAAV,EAAyB;MACpBK,QAAQgI,UAAZ,EAAwBhI,QAAQgI,UAAR,CAAmBrH,CAAnB;MACpBA,EAAEsH,iBAAN,EAAyBtH,EAAEsH,iBAAF;;;;;;;;;;AAW3B,AAAO,SAASC,IAAT,CAAcC,GAAd,EAAmBlI,KAAnB,EAA0BgF,OAA1B,EAAmCmD,QAAnC,EAA6CC,MAA7C,EAAqDC,aAArD,EAAoE;;KAEtE,CAACV,WAAL,EAAkB;;cAELS,UAAU,OAAOA,OAAOE,eAAd,KAAgC,WAAtD;;;cAGYJ,OAAO,EAAEtG,YAAYsG,GAAd,CAAnB;;;KAGGK,MAAMC,MAAMN,GAAN,EAAWlI,KAAX,EAAkBgF,OAAlB,EAA2BmD,QAA3B,CAAV;;;KAGIC,UAAUG,IAAI7C,UAAJ,KAAiB0C,MAA/B,EAAuCA,OAAOK,WAAP,CAAmBF,GAAnB;;;KAGnC,IAAGZ,SAAP,EAAkB;cACL,KAAZ;;MAEI,CAACU,aAAL,EAAoBP;;;QAGdS,GAAP;;;AAID,SAASC,KAAT,CAAeN,GAAf,EAAoBlI,KAApB,EAA2BgF,OAA3B,EAAoCmD,QAApC,EAA8C;KACzCO,MAAM1I,SAASA,MAAMnB,UAAf,IAA6BmB,MAAMnB,UAAN,CAAiB6J,GAAxD;;;QAIO9D,sBAAsB5E,KAAtB,CAAP,EAAqC;UAC5B+E,yBAAyB/E,KAAzB,EAAgCgF,OAAhC,CAAR;;;;KAKGhF,SAAO,IAAX,EAAiBA,QAAQ,EAAR;;;KAIbQ,SAASR,KAAT,CAAJ,EAAqB;;MAEhBkI,OAAOA,eAAe9C,IAAtB,IAA8B8C,IAAIxC,UAAtC,EAAkD;OAC7CwC,IAAIS,SAAJ,IAAe3I,KAAnB,EAA0B;QACrB2I,SAAJ,GAAgB3I,KAAhB;;GAFF,MAKK;;OAEAkI,GAAJ,EAASU,kBAAkBV,GAAlB;SACHX,SAASsB,cAAT,CAAwB7I,KAAxB,CAAN;;;SAGMkI,GAAP;;;;KAKG3H,WAAWP,MAAMpB,QAAjB,CAAJ,EAAgC;SACxBkK,wBAAwBZ,GAAxB,EAA6BlI,KAA7B,EAAoCgF,OAApC,EAA6CmD,QAA7C,CAAP;;;KAIGY,MAAMb,GAAV;KACCtJ,WAAWgB,OAAOI,MAAMpB,QAAb,CADZ;;eAEegJ,SAFf;KAGCoB,YAAYhJ,MAAMlB,QAHnB;;;;aAQYF,aAAW,KAAX,GAAmB,IAAnB,GAA0BA,aAAW,eAAX,GAA6B,KAA7B,GAAqCgJ,SAA3E;;KAGI,CAACM,GAAL,EAAU;;;QAGHZ,WAAW1I,QAAX,EAAqBgJ,SAArB,CAAN;EAHD,MAKK,IAAI,CAACtC,YAAY4C,GAAZ,EAAiBtJ,QAAjB,CAAL,EAAiC;;;;;QAK/B0I,WAAW1I,QAAX,EAAqBgJ,SAArB,CAAN;;;SAGOM,IAAIe,UAAX;OAA2BR,WAAJ,CAAgBP,IAAIe,UAApB;GARc;MAWjCf,IAAIxC,UAAR,EAAoBwC,IAAIxC,UAAJ,CAAewD,YAAf,CAA4BH,GAA5B,EAAiCb,GAAjC;;;oBAGFA,GAAlB;;;KAIGiB,KAAKJ,IAAIE,UAAb;KACC9I,QAAQ4I,IAAInH,QAAJ,CADT;;;;KAKI,CAACzB,KAAL,EAAY;MACPyB,QAAJ,IAAgBzB,QAAQ,EAAxB;OACK,IAAIiJ,IAAEL,IAAIlK,UAAV,EAAsBS,IAAE8J,EAAE5J,MAA/B,EAAuCF,GAAvC;SAAoD8J,EAAE9J,CAAF,EAAKuG,IAAX,IAAmBuD,EAAE9J,CAAF,EAAK6E,KAAxB;;;;;KAI3C,CAAC0D,SAAD,IAAcmB,SAAd,IAA2BA,UAAUxJ,MAAV,KAAmB,CAA9C,IAAmD,OAAOwJ,UAAU,CAAV,CAAP,KAAsB,QAAzE,IAAqFG,EAArF,IAA2FA,cAAc/D,IAAzG,IAAiH,CAAC+D,GAAGE,WAAzH,EAAsI;MACjIF,GAAGR,SAAH,IAAcK,UAAU,CAAV,CAAlB,EAAgC;MAC5BL,SAAH,GAAeK,UAAU,CAAV,CAAf;;;;MAIG,IAAIA,aAAaA,UAAUxJ,MAAvB,IAAiC2J,EAArC,EAAyC;iBAC/BJ,GAAd,EAAmBC,SAAnB,EAA8BhE,OAA9B,EAAuCmD,QAAvC,EAAiD,CAAC,CAAChI,MAAMmJ,uBAAzD;;;;gBAKcP,GAAf,EAAoB/I,MAAMnB,UAA1B,EAAsCsB,KAAtC;;;KAIIuI,GAAJ,EAAS;GACPvI,MAAMuI,GAAN,GAAYA,GAAb,EAAkBK,GAAlB;;;aAGWQ,WAAZ;;QAEOR,GAAP;;;;;;;;;;AAWD,SAASS,aAAT,CAAuBtB,GAAvB,EAA4Bc,SAA5B,EAAuChE,OAAvC,EAAgDmD,QAAhD,EAA0DsB,MAA1D,EAAkE;KAC7DC,mBAAmBxB,IAAIyB,UAA3B;KACC7K,WAAW,EADZ;KAEC8K,QAAQ,EAFT;KAGCC,WAAW,CAHZ;KAICC,MAAM,CAJP;KAKCC,MAAML,iBAAiBlK,MALxB;KAMCwK,cAAc,CANf;KAOCC,OAAOjB,aAAaA,UAAUxJ,MAP/B;KAQC0K,UARD;KAQIxJ,UARJ;KAQOyJ,eARP;KAQe/K,cARf;;KAUI2K,GAAJ,EAAS;OACH,IAAIzK,IAAE,CAAX,EAAcA,IAAEyK,GAAhB,EAAqBzK,GAArB,EAA0B;OACrBF,SAAQsK,iBAAiBpK,CAAjB,CAAZ;OACCa,QAAQf,OAAMwC,QAAN,CADT;OAEC7C,MAAMkL,OAAQ,CAACvJ,IAAItB,OAAMiI,UAAX,IAAyB3G,EAAE0J,KAA3B,GAAmCjK,QAAQA,MAAMpB,GAAd,GAAoB,IAA/D,GAAuE,IAF9E;OAGIA,OAAK,IAAT,EAAe;;UAERA,GAAN,IAAaK,MAAb;IAFD,MAIK,IAAIyI,aAAa4B,MAAb,IAAuBtJ,KAAvB,IAAgCf,kBAAiBgG,IAArD,EAA2D;aACtD4E,aAAT,IAA0B5K,MAA1B;;;;;KAKC6K,IAAJ,EAAU;OACJ,IAAI3K,KAAE,CAAX,EAAcA,KAAE2K,IAAhB,EAAsB3K,IAAtB,EAA2B;YACjB0J,UAAU1J,EAAV,CAAT;WACQ,IAAR;;;;;;;OAOIP,OAAMoL,OAAOpL,GAAjB;OACIA,QAAK,IAAT,EAAe;QACV8K,YAAY9K,QAAO6K,KAAvB,EAA8B;aACrBA,MAAM7K,IAAN,CAAR;WACMA,IAAN,IAAae,SAAb;;;;;QAKG,IAAI,CAACV,KAAD,IAAU0K,MAAIE,WAAlB,EAA+B;UAC9BE,IAAEJ,GAAP,EAAYI,IAAEF,WAAd,EAA2BE,GAA3B,EAAgC;UAC3BpL,SAASoL,CAAT,CAAJ;UACIxJ,KAAKwE,eAAexE,CAAf,EAAkByJ,MAAlB,CAAT,EAAoC;eAC3BzJ,CAAR;gBACSwJ,CAAT,IAAcpK,SAAd;WACIoK,MAAIF,cAAY,CAApB,EAAuBA;WACnBE,MAAIJ,GAAR,EAAaA;;;;;;;WAORtB,MAAMpJ,KAAN,EAAa+K,MAAb,EAAqBnF,OAArB,EAA8BmD,QAA9B,CAAR;;OAEI/I,SAASA,UAAQ8I,GAArB,EAA0B;QACrB5I,MAAGyK,GAAP,EAAY;SACPtB,WAAJ,CAAgBrJ,KAAhB;KADD,MAGK,IAAIA,UAAQsK,iBAAiBpK,EAAjB,CAAZ,EAAiC;SACjCF,UAAQsK,iBAAiBpK,KAAE,CAAnB,CAAZ,EAAmC;iBACvBoK,iBAAiBpK,EAAjB,CAAX;;SAEG+K,YAAJ,CAAiBjL,KAAjB,EAAwBsK,iBAAiBpK,EAAjB,KAAuB,IAA/C;;;;;;KAOAuK,QAAJ,EAAc;OACR,IAAIvK,GAAT,IAAcsK,KAAd;OAAyBA,MAAMtK,GAAN,CAAJ,EAAcsJ,kBAAkBgB,MAAMtK,GAAN,CAAlB;;;;;QAI7BwK,OAAKE,WAAZ,EAAyB;UAChBlL,SAASkL,aAAT,CAAR;MACI5K,KAAJ,EAAWwJ,kBAAkBxJ,KAAlB;;;;;;;;AAUb,AAAO,SAASwJ,iBAAT,CAA2BzD,IAA3B,EAAiCmF,WAAjC,EAA8C;KAChD9G,YAAY2B,KAAKkC,UAArB;KACI7D,SAAJ,EAAe;;mBAEGA,SAAjB,EAA4B,CAAC8G,WAA7B;EAFD,MAIK;;;MAGAnF,KAAKvD,QAAL,KAAkBuD,KAAKvD,QAAL,EAAe8G,GAArC,EAA0CvD,KAAKvD,QAAL,EAAe8G,GAAf,CAAmB,IAAnB;;MAEtC,CAAC4B,WAAL,EAAkB;eACLnF,IAAZ;;;;;;MAMGzE,UAAJ;SACQA,IAAEyE,KAAKoF,SAAf;qBAA6C7J,CAAlB,EAAqB4J,WAArB;;;;;;;;;;AAW7B,SAASE,cAAT,CAAwBtC,GAAxB,EAA6BuC,KAA7B,EAAoC3E,GAApC,EAAyC;;KAEpCD,aAAJ;MACKA,IAAL,IAAaC,GAAb,EAAkB;MACb,EAAE2E,SAAS5E,QAAQ4E,KAAnB,KAA6B3E,IAAID,IAAJ,KAAW,IAA5C,EAAkD;eACrCqC,GAAZ,EAAiBrC,IAAjB,EAAuBC,IAAID,IAAJ,CAAvB,EAAkCC,IAAID,IAAJ,IAAY/F,SAA9C,EAAyD8H,SAAzD;;;;;KAKE6C,KAAJ,EAAW;OACL5E,IAAL,IAAa4E,KAAb,EAAoB;OACf5E,SAAO,UAAP,IAAqBA,SAAO,WAA5B,KAA4C,EAAEA,QAAQC,GAAV,KAAkB2E,MAAM5E,IAAN,OAAeA,SAAO,OAAP,IAAkBA,SAAO,SAAzB,GAAqCqC,IAAIrC,IAAJ,CAArC,GAAiDC,IAAID,IAAJ,CAAhE,CAA9D,CAAJ,EAA+I;gBAClIqC,GAAZ,EAAiBrC,IAAjB,EAAuBC,IAAID,IAAJ,CAAvB,EAAkCC,IAAID,IAAJ,IAAY4E,MAAM5E,IAAN,CAA9C,EAA2D+B,SAA3D;;;;;;ACvTJ,IAAM8C,aAAa,EAAnB;;AAGA,AAAO,SAASC,gBAAT,CAA0BnH,SAA1B,EAAqC;KACvCqC,OAAOrC,UAAUoH,WAAV,CAAsB/E,IAAjC;KACCnB,OAAOgG,WAAW7E,IAAX,CADR;KAEInB,IAAJ,EAAUA,KAAKjF,IAAL,CAAU+D,SAAV,EAAV,KACKkH,WAAW7E,IAAX,IAAmB,CAACrC,SAAD,CAAnB;;;AAIN,AAAO,SAASqH,eAAT,CAAyBC,IAAzB,EAA+B3K,KAA/B,EAAsC6E,OAAtC,EAA+C;KACjD+F,OAAO,IAAID,IAAJ,CAAS3K,KAAT,EAAgB6E,OAAhB,CAAX;KACCN,OAAOgG,WAAWI,KAAKjF,IAAhB,CADR;WAEUmF,IAAV,CAAeD,IAAf,EAAqB5K,KAArB,EAA4B6E,OAA5B;KACIN,IAAJ,EAAU;OACJ,IAAIpF,IAAEoF,KAAKlF,MAAhB,EAAwBF,GAAxB,GAA+B;OAC1BoF,KAAKpF,CAAL,EAAQsL,WAAR,KAAsBE,IAA1B,EAAgC;SAC1BG,QAAL,GAAgBvG,KAAKpF,CAAL,EAAQ2L,QAAxB;SACKC,MAAL,CAAY5L,CAAZ,EAAe,CAAf;;;;;QAKIyL,IAAP;;;ACZM,SAASI,iBAAT,CAA2B3H,SAA3B,EAAsCrD,KAAtC,EAA6CiL,IAA7C,EAAmDpG,OAAnD,EAA4DmD,QAA5D,EAAsE;KACxE3E,UAAU6H,QAAd,EAAwB;WACdA,QAAV,GAAqB,IAArB;;KAEK7H,UAAU8H,KAAV,GAAkBnL,MAAMuI,GAA7B,EAAmC,OAAOvI,MAAMuI,GAAb;KAC9BlF,UAAU4G,KAAV,GAAkBjK,MAAMpB,GAA7B,EAAmC,OAAOoB,MAAMpB,GAAb;;KAE/B,CAACyE,UAAU+H,IAAX,IAAmBpD,QAAvB,EAAiC;MAC5B3E,UAAUgI,kBAAd,EAAkChI,UAAUgI,kBAAV;EADnC,MAGK,IAAIhI,UAAUiI,yBAAd,EAAyC;YACnCA,yBAAV,CAAoCtL,KAApC,EAA2C6E,OAA3C;;;KAGGA,WAAWA,YAAUxB,UAAUwB,OAAnC,EAA4C;MACvC,CAACxB,UAAUkI,WAAf,EAA4BlI,UAAUkI,WAAV,GAAwBlI,UAAUwB,OAAlC;YAClBA,OAAV,GAAoBA,OAApB;;;KAGG,CAACxB,UAAUmI,SAAf,EAA0BnI,UAAUmI,SAAV,GAAsBnI,UAAUrD,KAAhC;WAChBA,KAAV,GAAkBA,KAAlB;;WAEUkL,QAAV,GAAqB,KAArB;;KAEID,SAAO7J,SAAX,EAAsB;MACjB6J,SAAO5J,WAAP,IAAsBzB,QAAQ6L,oBAAR,KAA+B,KAArD,IAA8D,CAACpI,UAAU+H,IAA7E,EAAmF;mBAClE/H,SAAhB,EAA2BhC,WAA3B,EAAwC2G,QAAxC;GADD,MAGK;iBACU3E,SAAd;;;;KAIEA,UAAU8H,KAAd,EAAqB9H,UAAU8H,KAAV,CAAgB9H,SAAhB;;;;;;;;;AAWtB,AAAO,SAASmB,eAAT,CAAyBnB,SAAzB,EAAoC4H,IAApC,EAA0CjD,QAA1C,EAAoD0D,OAApD,EAA6D;KAC/DrI,UAAU6H,QAAd,EAAwB;;KAEpBS,aAAJ;KAAUC,iBAAV;KACC5L,QAAQqD,UAAUrD,KADnB;KAEC2D,QAAQN,UAAUM,KAFnB;KAGCkB,UAAUxB,UAAUwB,OAHrB;KAICgH,gBAAgBxI,UAAUmI,SAAV,IAAuBxL,KAJxC;KAKC8L,gBAAgBzI,UAAU0I,SAAV,IAAuBpI,KALxC;KAMCqI,kBAAkB3I,UAAUkI,WAAV,IAAyB1G,OAN5C;KAOCoH,WAAW5I,UAAU+H,IAPtB;KAQCN,WAAWzH,UAAUyH,QARtB;KASCoB,cAAcD,YAAYnB,QAT3B;KAUCqB,wBAAwB9I,UAAU6D,UAVnC;KAWC0D,aAXD;KAWOwB,cAXP;;;KAcIH,QAAJ,EAAc;YACHjM,KAAV,GAAkB6L,aAAlB;YACUlI,KAAV,GAAkBmI,aAAlB;YACUjH,OAAV,GAAoBmH,eAApB;MACIf,SAAO3J,YAAP,IACA+B,UAAUgJ,qBADV,IAEAhJ,UAAUgJ,qBAAV,CAAgCrM,KAAhC,EAAuC2D,KAAvC,EAA8CkB,OAA9C,MAA2D,KAF/D,EAEsE;UAC9D,IAAP;GAHD,MAKK,IAAIxB,UAAUiJ,mBAAd,EAAmC;aAC7BA,mBAAV,CAA8BtM,KAA9B,EAAqC2D,KAArC,EAA4CkB,OAA5C;;YAES7E,KAAV,GAAkBA,KAAlB;YACU2D,KAAV,GAAkBA,KAAlB;YACUkB,OAAV,GAAoBA,OAApB;;;WAGS2G,SAAV,GAAsBnI,UAAU0I,SAAV,GAAsB1I,UAAUkI,WAAV,GAAwBlI,UAAUyH,QAAV,GAAqB,IAAzF;WACU1G,MAAV,GAAmB,KAAnB;;KAEI,CAACuH,IAAL,EAAW;MACNtI,UAAUsB,MAAd,EAAsBiH,WAAWvI,UAAUsB,MAAV,CAAiB3E,KAAjB,EAAwB2D,KAAxB,EAA+BkB,OAA/B,CAAX;;;MAGlBxB,UAAUkJ,eAAd,EAA+B;aACpBzM,OAAOG,MAAM4E,OAAN,CAAP,EAAuBxB,UAAUkJ,eAAV,EAAvB,CAAV;;;SAGM9H,sBAAsBmH,QAAtB,CAAP,EAAwC;cAC5BhH,yBAAyBgH,QAAzB,EAAmC/G,OAAnC,CAAX;;;MAGG2H,iBAAiBZ,YAAYA,SAASnN,QAA1C;MACCgO,kBADD;MACYrB,aADZ;;MAGIhL,WAAWoM,cAAX,CAAJ,EAAgC;;;OAG3BE,aAAa5H,aAAa8G,QAAb,CAAjB;UACOO,qBAAP;;OAEIvB,QAAQA,KAAKH,WAAL,KAAmB+B,cAA3B,IAA6CE,WAAW9N,GAAX,IAAgBgM,KAAKX,KAAtE,EAA6E;sBAC1DW,IAAlB,EAAwB8B,UAAxB,EAAoCrL,WAApC,EAAiDwD,OAAjD;IADD,MAGK;gBACQ+F,IAAZ;;WAEOF,gBAAgB8B,cAAhB,EAAgCE,UAAhC,EAA4C7H,OAA5C,CAAP;SACKiG,QAAL,GAAgBF,KAAKE,QAAL,IAAiBA,QAAjC;SACK6B,gBAAL,GAAwBtJ,SAAxB;cACU6D,UAAV,GAAuB0D,IAAvB;sBACkBA,IAAlB,EAAwB8B,UAAxB,EAAoCtL,SAApC,EAA+CyD,OAA/C;oBACgB+F,IAAhB,EAAsBvJ,WAAtB,EAAmC2G,QAAnC,EAA6C,IAA7C;;;UAGM4C,KAAKQ,IAAZ;GApBD,MAsBK;WACIc,WAAR;;;eAGYC,qBAAZ;OACIM,SAAJ,EAAe;YACNpJ,UAAU6D,UAAV,GAAuB,IAA/B;;;OAGGgF,eAAejB,SAAO5J,WAA1B,EAAuC;QAClC+K,KAAJ,EAAWA,MAAMlF,UAAN,GAAmB,IAAnB;WACJY,KAAKsE,KAAL,EAAYR,QAAZ,EAAsB/G,OAAtB,EAA+BmD,YAAY,CAACiE,QAA5C,EAAsDC,eAAeA,YAAY3G,UAAjF,EAA6F,IAA7F,CAAP;;;;MAIE2G,eAAed,SAAOc,WAAtB,IAAqCtB,SAAOuB,qBAAhD,EAAuE;OAClES,aAAaV,YAAY3G,UAA7B;OACIqH,cAAcxB,SAAOwB,UAAzB,EAAqC;eACzB7D,YAAX,CAAwBqC,IAAxB,EAA8Bc,WAA9B;;QAEI,CAACO,SAAL,EAAgB;iBACHvF,UAAZ,GAAyB,IAAzB;uBACkBgF,WAAlB;;;;;MAKCO,SAAJ,EAAe;oBACGA,SAAjB,EAA4BrB,SAAOc,WAAnC;;;YAGSd,IAAV,GAAiBA,IAAjB;MACIA,QAAQ,CAACM,OAAb,EAAsB;OACjBmB,eAAexJ,SAAnB;OACCI,IAAIJ,SADL;UAEQI,IAAEA,EAAEkJ,gBAAZ,EAA+B;KAC7BE,eAAepJ,CAAhB,EAAmB2H,IAAnB,GAA0BA,IAA1B;;QAEIlE,UAAL,GAAkB2F,YAAlB;QACK3H,qBAAL,GAA6B2H,aAAapC,WAA1C;;;;KAIE,CAACwB,QAAD,IAAajE,QAAjB,EAA2B;SACnB8E,OAAP,CAAezJ,SAAf;EADD,MAGK,IAAI,CAACsI,IAAL,EAAW;MACXtI,UAAU0J,kBAAd,EAAkC;aACvBA,kBAAV,CAA6BlB,aAA7B,EAA4CC,aAA5C,EAA2DE,eAA3D;;MAEGpM,QAAQoN,WAAZ,EAAyBpN,QAAQoN,WAAR,CAAoB3J,SAApB;;;KAGtB4J,KAAK5J,UAAU6J,gBAAnB;KAAqCC,WAArC;KACIF,EAAJ,EAAQ,OAASE,KAAKF,GAAG1N,GAAH,EAAd;KAA6BsL,IAAH,CAAQxH,SAAR;EAElC,IAAI,CAACmE,SAAD,IAAc,CAACkE,OAAnB,EAA4B/D;;;;;;;;;AAW7B,AAAO,SAASgB,uBAAT,CAAiCZ,GAAjC,EAAsClI,KAAtC,EAA6CgF,OAA7C,EAAsDmD,QAAtD,EAAgE;KAClEzH,IAAIwH,OAAOA,IAAIb,UAAnB;KACCkG,oBAAoB7M,CADrB;KAEC8M,SAAStF,GAFV;KAGCuF,gBAAgB/M,KAAKwH,IAAI7C,qBAAJ,KAA4BrF,MAAMpB,QAHxD;KAIC8O,UAAUD,aAJX;KAKCtN,QAAQ8E,aAAajF,KAAb,CALT;QAMOU,KAAK,CAACgN,OAAN,KAAkBhN,IAAEA,EAAEoM,gBAAtB,CAAP,EAAgD;YACrCpM,EAAEkK,WAAF,KAAgB5K,MAAMpB,QAAhC;;;KAGG8B,KAAKgN,OAAL,KAAiB,CAACvF,QAAD,IAAazH,EAAE2G,UAAhC,CAAJ,EAAiD;oBAC9B3G,CAAlB,EAAqBP,KAArB,EAA4BuB,YAA5B,EAA0CsD,OAA1C,EAAmDmD,QAAnD;QACMzH,EAAE6K,IAAR;EAFD,MAIK;MACAgC,qBAAqB,CAACE,aAA1B,EAAyC;oBACvBF,iBAAjB,EAAoC,IAApC;SACMC,SAAS,IAAf;;;MAGG3C,gBAAgB7K,MAAMpB,QAAtB,EAAgCuB,KAAhC,EAAuC6E,OAAvC,CAAJ;MACIkD,OAAO,CAACxH,EAAEuK,QAAd,EAAwB;KACrBA,QAAF,GAAa/C,GAAb;;YAES,IAAT;;oBAEiBxH,CAAlB,EAAqBP,KAArB,EAA4BqB,WAA5B,EAAyCwD,OAAzC,EAAkDmD,QAAlD;QACMzH,EAAE6K,IAAR;;MAEIiC,UAAUtF,QAAMsF,MAApB,EAA4B;UACpBnG,UAAP,GAAoB,IAApB;qBACkBmG,MAAlB;;;;QAIKtF,GAAP;;;;;;;;AAUD,AAAO,SAASyF,gBAAT,CAA0BnK,SAA1B,EAAqCoK,MAArC,EAA6C;KAC/C7N,QAAQ8N,aAAZ,EAA2B9N,QAAQ8N,aAAR,CAAsBrK,SAAtB;;;KAGvB+H,OAAO/H,UAAU+H,IAArB;;WAEUF,QAAV,GAAqB,IAArB;;KAEI7H,UAAUsK,oBAAd,EAAoCtK,UAAUsK,oBAAV;;WAE1BvC,IAAV,GAAiB,IAAjB;;;KAGIwC,QAAQvK,UAAU6D,UAAtB;KACI0G,KAAJ,EAAW;mBACOA,KAAjB,EAAwBH,MAAxB;EADD,MAGK,IAAIrC,IAAJ,EAAU;MACVA,KAAK3J,QAAL,KAAkB2J,KAAK3J,QAAL,EAAe8G,GAArC,EAA0C6C,KAAK3J,QAAL,EAAe8G,GAAf,CAAmB,IAAnB;;YAEhCuC,QAAV,GAAqBM,IAArB;;MAEIqC,MAAJ,EAAY;cACArC,IAAX;oBACiB/H,SAAjB;;MAEG9C,UAAJ;SACQA,IAAE6K,KAAKhB,SAAf;qBAA6C7J,CAAlB,EAAqB,CAACkN,MAAtB;GAVb;;;KAcXpK,UAAU8H,KAAd,EAAqB9H,UAAU8H,KAAV,CAAgB,IAAhB;KACjB9H,UAAUwK,mBAAd,EAAmCxK,UAAUwK,mBAAV;;;ACzQ7B,SAASC,SAAT,CAAmB9N,KAAnB,EAA0B6E,OAA1B,EAAmC;;MAEpCT,MAAL,GAAc,IAAd;;;;;;MAMKS,OAAL,GAAeA,OAAf;;MAEK7E,KAAL,GAAaA,KAAb;;KAEI,CAAC,KAAK2D,KAAV,EAAiB,KAAKA,KAAL,GAAa,EAAb;;;AAIlB7D,OAAOgO,UAAUpJ,SAAjB,EAA4B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAAA,qBAkCjB9F,GAlCiB,EAkCZ0E,SAlCY,EAkCD;MACrB/C,IAAI,KAAKwN,aAAL,KAAuB,KAAKA,aAAL,GAAqB,EAA5C,CAAR;SACOxN,EAAE3B,MAAI0E,SAAN,MAAqB/C,EAAE3B,MAAI0E,SAAN,IAAmBF,kBAAkB,IAAlB,EAAwBxE,GAAxB,EAA6B0E,SAA7B,CAAxC,CAAP;EApC0B;;;;;;SAAA,oBA2ClBK,KA3CkB,EA2CXqK,QA3CW,EA2CD;MACrBpN,IAAI,KAAK+C,KAAb;MACI,CAAC,KAAKoI,SAAV,EAAqB,KAAKA,SAAL,GAAiB9L,MAAMW,CAAN,CAAjB;SACdA,CAAP,EAAUR,WAAWuD,KAAX,IAAoBA,MAAM/C,CAAN,EAAS,KAAKZ,KAAd,CAApB,GAA2C2D,KAArD;MACIqK,QAAJ,EAAc,CAAC,KAAKd,gBAAL,GAAyB,KAAKA,gBAAL,IAAyB,EAAnD,EAAwD5N,IAAxD,CAA6D0O,QAA7D;gBACA,IAAd;EAhD0B;;;;;;YAAA,yBAuDb;kBACG,IAAhB,EAAsB1M,YAAtB;EAxD0B;;;;;;;;;;OAAA,oBAmElB;CAnEV;;ACfO,SAASqD,MAAT,CAAgB9E,KAAhB,EAAuBoI,MAAvB,EAA+BgG,KAA/B,EAAsC;SACrCnG,KAAKmG,KAAL,EAAYpO,KAAZ,EAAmB,EAAnB,EAAuB,KAAvB,EAA8BoI,MAA9B,CAAP;;;;;;;;;AClBD;AACA,AAAO,IAAMiG,aAAa,SAAbA,UAAa,CAACjF,CAAD,EAAIkF,CAAJ,EAAOC,OAAP,EAAgBC,OAAhB;SAA4BpF,MAAMkF,CAAN,GAAUC,OAAV,GAAmBC,OAA/C;CAAnB;;;;AAIP,AAAO,SAASC,MAAT,CAAgB9N,GAAhB,EAAqB;OACrB,IAAIrB,IAAI,IAAb,EAAmBA,IAAI,IAAvB,EAA6BA,GAA7B,EAAkC;QAC5BqB,QAAQrB,CAAZ,EAAe,OAAO,IAAP;;SAEV,KAAP;;;ACLF,IAAMoP,MAAM,SAANA,GAAM,OAA+C;MAA7CC,EAA6C,QAA7CA,EAA6C;MAAzC9I,IAAyC,QAAzCA,IAAyC;MAAnC+I,WAAmC,QAAnCA,WAAmC;MAAtBC,IAAsB,QAAtBA,IAAsB;MAAhBC,UAAgB,QAAhBA,UAAgB;;;MAEnDC,aAAaV,WAAWO,WAAX,EAAwBD,EAAxB,EAA4B,cAA5B,EAA4C,KAA5C,CAAnB;MACMK,cAAcX,WAAWO,WAAX,EAAwBD,EAAxB,EAA+BE,IAA/B,yBAA4DA,IAA5D,eAApB;;SAGE;;MAAQ,SAAOE,UAAf,EAA2B,SAAS;eAAMD,WAAWH,EAAX,CAAN;OAApC;gBACQ,SAAOK,WAAb,GADF;;GADF;CALF,CAaA;;ACVA,IAAMC,OAAO,CACX,EAACpJ,MAAM,MAAP,EAAe8I,IAAI,MAAnB,EAA2BE,MAAM,YAAjC,EADW,EAEX,EAAChJ,MAAM,aAAP,EAAsB8I,IAAI,OAA1B,EAAmCE,MAAM,oBAAzC,EAFW,EAGX,EAAChJ,MAAM,kBAAP,EAA2B8I,IAAI,QAA/B,EAAyCE,MAAM,kBAA/C,EAHW,EAIX,EAAChJ,MAAM,mBAAP,EAA4B8I,IAAI,mBAAhC,EAAqDE,MAAM,WAA3D,EAJW,EAKX,EAAChJ,MAAM,gBAAP,EAAyB8I,IAAI,gBAA7B,EAA+CE,MAAM,kBAArD,EALW,EAMX,EAAChJ,MAAM,OAAP,EAAgB8I,IAAG,OAAnB,EAA4BE,MAAM,aAAlC,EANW,CAAb;;;;;AAaA,IAAMK,SAAS,SAATA,MAAS,QAAS;MAChBC,aAAa,SAAbA,UAAa,GAAM;WAChBF,KAAKG,GAAL,CAAS,eAAO;aACd,EAAC,GAAD,eAASC,GAAT,IAAc,aAAalP,MAAMyO,WAAjC,EAA8C,YAAYzO,MAAM2O,UAAhE,IAAP;KADK,CAAP;GADF;;SAOE;;MAAK,SAAM,QAAX;gBAAA;eAEO,SAAM,mBAAX;GAHJ;CAPF,CAgBA;;;;;;ACjCA,IAAMQ,SAAS,SAATA,MAAS,QAAS;MAChBC,eAAe,SAAfA,YAAe,GAAM;YAClBpP,MAAM6D,IAAb;WACO,OAAL;eACS,cAAP;;eAEO,QAAP;;GALN;;SAWE;;MAAK,SAAOuL,cAAZ,EAA4B,OAAOpP,MAAM8F,KAAzC;UACQnH;GAFV;CAXF,CAkBA;;;;AClBA,IAAM0Q,SAAS,SAATA,MAAS,QAAS;MAChBD,eAAe,SAAfA,YAAe,GAAM;YAClBpP,MAAM6D,IAAb;WACO,OAAL;eACS,cAAP;;eAEO,QAAP;;GALN;;SAWE;;;eACW7D,MAAMsP,OADjB;eAESF,cAFT;aAGSpP,MAAM8F,KAHf;UAIQnH;GALV;CAXF,CAqBA;;ACnBA,IAAM4Q,OAAO,SAAPA,IAAO,OAAkB;MAAhBZ,UAAgB,QAAhBA,UAAgB;;SAE3B;;;;;QAGW,SAAM,eAAf;;KAHF;;;QAQW,SAAM,oBAAf;;;;;OAAA;;cAEE;UAAQ,SAAS;mBAAMA,WAAW,OAAX,CAAN;WAAjB;;;;GAXN;CADF,CAmBA;;ACrBA,IAAMa,QAAQ,SAARA,KAAQ,GAAM;SAEhB;;;;YACE;;;KADF;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;KAAA;;YAaC;;;;GAdH;CADF,CAoBA;;ACnBA,IAAMC,gBAAgB,SAAhBA,aAAgB,OAAkB;MAAhBd,UAAgB,QAAhBA,UAAgB;;SAEpC;;;;YACE;;;KADF;;;QAIW,SAAM,6BAAf;;;;;OAAA;;cAEE;UAAQ,SAAS;mBAAMA,WAAW,OAAX,CAAN;WAAjB;;;KANJ;;;;;KAAA;;;QAUO,IAAG,WAAR;;;GAXJ;CADF,CAkBA;;ACnBA,IAAMe,UAAU,SAAVA,OAAU,GAAM;SAElB;;;;YACE;;;KADF;;;;;KAAA;;;QAGO,IAAG,WAAR;;;GAJJ;CADF,CAUA;;;;;;ACVA,IAAMC,aAAa,SAAbA,UAAa,CAAC3P,KAAD,EAAW;MACxB4P,eAAe5P,MAAM6P,cAAN,CAAqBC,OAArB,CAA6B9P,MAAM+P,UAAnC,CAAnB;;MAEMC,kBAAkB;aACb,MADa;gBAEV,QAFU;YAGd,QAHc;YAId;GAJV;;MAOMC,eAAe;aACV,cADU;WAEZjQ,MAAMkQ,IAAN,IAAc,KAFF;YAGXlQ,MAAMkQ,IAAN,IAAa,KAHF;gBAIPN,iBAAiB,CAAC,CAAlB,GAAsB5P,MAAMmQ,QAA5B,GAAuCnQ,MAAMoQ,KAJtC;kBAKL,KALK;iBAMN,MANM;kBAOLR,iBAAiB,CAAC,CAAlB,GAAsB,iBAAtB,GAA0C;GAP1D;;MAUMS,aAAa;kBACHT,iBAAiB,CAAC,CAAlB,GAAsB,iBAAtB,GAA0C;GAD1D;;SAKE;;MAAK,OAAOI,eAAZ;eACO,OAAOC,YAAZ,GADF;;;QAEQ,SAAS;iBAAMjQ,MAAMsQ,YAAN,CAAmBtQ,MAAM+P,UAAzB,CAAN;SAAf,EAA2D,OAAOM,UAAlE;YAAqF1R;;GAHzF;CAxBF,CAgCA;;AC7BA;AACA,IAAM4R,cAAc,CAAC;QACP,OADO;SAEN,SAFM;YAGH,MAHG;cAID;CAJA,EAMhB;QACU,YADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAVA,EAYhB;QACU,OADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAhBA,EAkBhB;QACU,SADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAtBA,CAApB;;AA0BA,IAAMC,cAAc,CAAC;QACP,cADO;cAED,cAFC;SAGN;CAHK,EAKhB;QACU,MADV;cAEgB,MAFhB;SAGW;CARK,EAUhB;QACU,UADV;cAEgB,UAFhB;SAGW;CAbK,EAehB;QACU,WADV;cAEgB,WAFhB;SAGW;CAlBK,EAoBhB;QACU,KADV;cAEgB,KAFhB;SAGW;CAvBK,CAApB;;;;IA8BMC;;;;;;;;;;;;;;qLACJ9M,QAAQ;sBACU;aAIlB2M,eAAe,UAACI,MAAD,EAAY;UACrBC,cAAc,MAAKhN,KAAL,CAAWkM,cAA7B;UACIe,gBAAgBD,YAAYb,OAAZ,CAAoBY,MAApB,CAApB;;;UAGIE,kBAAkB,CAAC,CAAvB,EAA0B;oBACZ7F,MAAZ,CAAmB6F,aAAnB,EAAkC,CAAlC;cACK3M,QAAL,CAAc,EAAC4L,gBAAgBc,WAAjB,EAAd;OAFF,MAIK;cACE1M,QAAL,cACK,MAAKN,KADV;sDAEsB,MAAKA,KAAL,CAAWkM,cAA/B,IAA+Ca,MAA/C;;;;;aAKGG,UAAP,GAAoB,MAAKlN,KAAL,CAAWkM,cAA/B;aACOiB,SAAP;aAGFC,cAAc,YAAM;aACXR,YAAYtB,GAAZ,CAAgB;eACrB;oBAAA;uBACMjK,IADN;kBAEO,MAFP;0BAGgB,MAAKsL,YAHrB;4BAIoB,MAAK3M,KAAL,CAAWkM;;eAEvBnK;SAPa;OAAhB,CAAP;aAWFsL,cAAc,YAAM;aACXR,YAAYvB,GAAZ,CAAgB;eACrB;oBAAA;uBACMjK,IADN;kBAEO,MAFP;4BAGoB,MAAKrB,KAAL,CAAWkM,cAH/B;0BAIgB,MAAKS;;eAEb5K;SAPa;OAAhB,CAAP;;;;;;gCAYO;aAEL;;UAAK,SAAM,QAAX;;;YAGW,SAAM,iBAAf;;;cACW,SAAM,gBAAf,EAAgC,OAAO,EAACuL,cAAc,MAAf,EAAvC;;oBACE;;;aADF;iBAEQF,WAAL;WAHL;;;cAOW,SAAM,gBAAf,EAAgC,OAAO,EAACG,aAAa,MAAd,EAAvC;;oBACE;;;aADF;iBAEQF,WAAL;;SAZP;;;YAkBW,SAAM,eAAf;;kBACE;;;;SAnBJ;;;YAwBW,SAAM,cAAf;;kBACE;;;WADF;;;;;WAAA;;;;;WAAA;;;;;WAAA;;;;;WAAA;;;;;;;OAzBJ;;;;EArDiBlD,WA4FrB;;ACxJA,IAAMqD,QAAQ,SAARA,KAAQ,GAAM;SAEhB;;;;YACE;;;KADF;;;QAGO,IAAG,QAAR;;;UACQ,IAAG,OAAT;;;;;SAAA;qBAES,MAAK,OAAZ,EAAoB,IAAG,OAAvB,EAA+B,MAAK,MAApC,EAA2C,aAAY,OAAvD,EAA+D,SAAM,WAArE;;KANN;;;QAUO,IAAG,WAAR,EAAoB,SAAM,MAA1B;;;;;OAAA;kBAEQ,IAAG,kBAAT;KAZJ;;gBAiBE;;;;GAlBJ;CADF,CAyBA;;ICfMC;;;;;;;;;;;;;;uLACJzN,QAAQ;mBACO;aAYfgL,aAAa,UAAC0C,OAAD,EAAa;YACnBpN,QAAL,CAAc;qBACCoN;OADf;;aAIOC,WAAP;aAGFC,qBAAqB,YAAM;cAClB,MAAK5N,KAAL,CAAW8K,WAAlB;;aAEO,MAAL;iBACU,EAAC,IAAD,IAAM,YAAY,MAAKE,UAAvB,GAAR;;aAEG,OAAL;iBACS,EAAC,KAAD,OAAP;;aAEG,QAAL;iBACS,EAAC,MAAD,OAAP;;aAEG,mBAAL;iBACU,EAAC,OAAD,OAAR;;aAEG,gBAAL;iBACU,EAAC,aAAD,IAAe,YAAY,MAAKA,UAAhC,GAAR;;aAEG,OAAL;iBACS,EAAC,KAAD,OAAP;;;iBAGO,EAAC,IAAD,OAAP;;;;;;;wCAvCc;aACX2C,WAAP;;;;yCAGmB;aACZE,UAAP;aACOF,WAAP;;;;gCAqCO;aAEL;;UAAO,SAAM,SAAb;;;YAGW,SAAM,oBAAf;;;cACM,SAAM,iBAAV;;WADF;eAEQC,kBAAL;SALL;UAQG,MAAD,IAAQ,aAAa,KAAK5N,KAAL,CAAW8K,WAAhC,EAA6C,YAAY,KAAKE,UAA9D;OATJ;;;;EAjDkBb,WAiEtB;;;;AC9EA,IAAMnK,QAAQ,EAAd;AACA,AAEAA,MAAM8N,IAAN,GAAa,EAAb;AACA9N,MAAM+N,KAAN,GAAc,EAAd;AACA/N,MAAMgO,OAAN,GAAgB,EAAhB;AACAhO,MAAMiO,KAAN,GAAc,EAAd;;AAEAjO,MAAMkO,SAAN,GAAkB,KAAlB;AACAlO,MAAMmO,OAAN,GAAgB,IAAhB;;AAEAnO,MAAMoO,SAAN,GAAyB,IAAzB;AACApO,MAAMqO,UAAN,GAAyB,KAAzB;AACArO,MAAMsO,UAAN,GAAyB,IAAzB;AACAtO,MAAMuO,UAAN,GAAyB,IAAzB;AACAvO,MAAMwO,WAAN,GAAyB,KAAzB;AACAxO,MAAMyO,YAAN,GAAyB,IAAzB;AACAzO,MAAM0O,gBAAN,GAAyB,KAAzB;AACA1O,MAAM2O,WAAN,GAAyB,EAAzB;;ACVA,SAASC,mBAAT,CAA6B1O,IAA7B,EAAmC2O,SAAnC,EAA8C;MACzC7O,MAAMmO,OAAT,EACE,OAAOnS,SAAP;;;;;;;;;;;;;;;MAiBE8S,OAAOC,OAAOC,IAAP,CAAYH,SAAZ,EAAuBI,MAAvB,CAA8B,UAASC,GAAT,EAAcjU,GAAd,EAAmB;QACnD,CAAC,KAAD,EAAQ,MAAR,EAAgBkR,OAAhB,CAAwBlR,GAAxB,MAAiC,CAAC,CAArC,EAAwC,OAAOiU,GAAP;QACpCjU,GAAJ,IAAW4T,UAAU5T,GAAV,CAAX;WACOiU,GAAP;GAHK,EAIJ,EAJI,CAAX;;MAMGhP,SAAS,MAAZ,EAAoB;SACbiP,IAAL,GAAYN,UAAUM,IAAV,CAAeC,GAA3B;SACKC,GAAL,GAAYR,UAAUQ,GAAV,CAAcD,GAA1B;;;;;MAKEE,OAAO,EAAEC,OAAOvP,MAAMuP,KAAf;YACU,KADV;UAEQrP,IAFR;UAGQF,MAAM8N,IAHd;UAIQgB;GAJnB;;sBAOoBQ,IAApB;;;AAGF,SAASE,OAAT,GAAmB;;SAEVA,OAAP,CAAeC,CAAf,EAAkB,YAAlB;;;AAGFD,UAAUE,SAASF,OAAT,EAAkB,IAAlB,CAAV;;AAEA,SAASE,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,SAA9B,EAAyC;;;;;;;MAOnCC,OAAJ;SACO,YAAW;QACZ5O,UAAU,IAAd;QAAoB6O,OAAOtU,SAA3B;QACIuU,QAAQ,SAARA,KAAQ,GAAW;gBACP,IAAV;UACI,CAACH,SAAL,EAAgBF,KAAKM,KAAL,CAAW/O,OAAX,EAAoB6O,IAApB;KAFtB;QAIIG,UAAUL,aAAa,CAACC,OAA5B;iBACaA,OAAb;cACUtS,WAAWwS,KAAX,EAAkBJ,IAAlB,CAAV;QACIM,OAAJ,EAAaP,KAAKM,KAAL,CAAW/O,OAAX,EAAoB6O,IAApB;GATf;;;AAaF,SAASI,mBAAT,CAA6BC,IAA7B,EAAmC9G,EAAnC,EAAuC;MACjC+G,MAAM,0BAAV;;MAEGrQ,MAAMkO,SAAN,KAAoB,QAAvB,EAAiC;UACzB,uBAAN;GADF,MAGK,IAAGlO,MAAMkO,SAAT,EAAoB;WAChBoC,QAAQC,GAAR,CAAYd,CAAZ,CAAP;;;QAGIY,GAAN,EAAW,EAAEG,QAAQ,MAAV;UACQC,KAAKC,SAAL,CAAeN,IAAf;GADnB,EAEG9S,IAFH,CAEQ,UAASqT,QAAT,EAAmB;WAClBA,SAASC,IAAT,EAAP;GAHF,EAIGtT,IAJH,CAIQ,UAASuT,MAAT,EAAiB;QACpBvH,EAAH,EACEA,GAAGuH,MAAH;GANJ;;;AAUF,SAASC,qBAAT,CAA+BxH,EAA/B,EAAmC;MAC7B+G,MAAM,0BAAV;;;MAGGrQ,MAAMkO,SAAN,KAAoB,OAAvB,EACE,OAAO5E,GAAGmH,KAAKM,KAAL,CAAWC,aAAa,oBAAb,CAAX,CAAH,CAAP;;MAEChR,MAAMkO,SAAN,KAAoB,QAAvB,EAAiC;UACzB,uBAAN;;;QAGImC,GAAN,EAAW;YACD;GADV,EAEG/S,IAFH,CAEQ,UAASqT,QAAT,EAAmB;WAClBA,SAASC,IAAT,EAAP;GAHF,EAIGtT,IAJH,CAIQ,UAAS8S,IAAT,EAAe;OAClBA,IAAH;GALF,EAMGa,KANH,CAMS,UAASC,GAAT,EAAc;YACbX,GAAR,CAAY,SAAZ,EAAuBW,GAAvB;GAPF;;;AC7GF;;AAEA,AAGA,SAASC,IAAT,GAAgB;;AAEhB,AAEA,SAASC,EAAT,CAAYC,IAAZ,EAAkBC,GAAlB,EAAuB;SAAQ,UAASlV,GAAT,EAAc;WAAQA,IAAIiV,IAAJ,MAAcC,GAArB;GAAtB;;;AAExB,SAASC,MAAT,CAAgBtR,CAAhB,EAAmBuR,CAAnB,EAAsB5Q,IAAtB,EAA4B;SAAQA,KAAKuL,OAAL,CAAalM,CAAb,MAAoBuR,CAA3B;;;AAE7B,AAEA,AAEA,SAAS1U,IAAT,CAAeuU,IAAf,EAAqB;SAAQ,UAASjV,GAAT,EAAc;WAAQA,IAAIiV,IAAJ,CAAP;GAAtB;;;AAEtB,AAEA,SAAS/U,OAAT,CAAeF,GAAf,EAAoB;SAAQqU,KAAKM,KAAL,CAAWN,KAAKC,SAAL,CAAetU,GAAf,CAAX,CAAP;;;AAErB,SAASqV,QAAT,CAAkB5U,GAAlB,EAAuB6U,EAAvB,EAA2B;MACtB,CAACA,EAAD,IAAO7U,IAAInB,MAAJ,IAAcgW,EAAxB,EAA4B,OAAO7U,GAAP;SACrBA,IAAI8U,MAAJ,CAAW,CAAX,EAAcD,KAAG,CAAjB,IAAsB,KAA7B;;;AAGF,SAASE,OAAT,CAAiBhR,IAAjB,EAAuB3F,GAAvB,EAA4BqW,GAA5B,EAAiC;MAC5B,CAAC1Q,KAAK3F,GAAL,CAAJ,EACE,OAAO2F,KAAK3F,GAAL,IAAY,CAACqW,GAAD,CAAnB;;OAEGrW,GAAL,EAAUU,IAAV,CAAe2V,GAAf;SACO1Q,KAAK3F,GAAL,CAAP;;;AAGF,SAAS4W,IAAT,GAAgB;MACVC,WAAW,GAAGC,KAAH,CAAS7K,IAAT,CAAczL,SAAd,CAAf;;WAESuW,UAAT,CAAoB5B,IAApB,EAA0B;QACpB6B,OAAOH,SAASC,KAAT,EAAX;QACIG,GAAJ;;aAESjI,KAAT,GAAiB;aACTiI,MAAMD,KAAKE,KAAL,EAAZ,EAA0B;YACrBD,IAAIE,KAAP,EAAc;;iBACLF,IAAIE,KAAJ,CAAUhC,IAAV,EAAgB9G,EAAhB,CAAP;SADF,MAEO;;iBACE4I,IAAI9B,IAAJ,CAAP;;;;;aAKG9G,EAAT,CAAY+I,QAAZ,EAAsB;aACbA,QAAP;;;;;;WAMK,IAAP;;;SAGKL,UAAP;;;AAGF,SAAS5S,OAAT,CAAekT,IAAf,EAAqB;UACX/B,GAAR,CAAY9U,SAAZ,EAAuB6W,IAAvB;;;AC/DK,IAAMC,OAAO,EAAb;AACP,AAcAA,KAAKC,KAAL,GAAa,EAAb;AACAD,KAAKE,MAAL,GAAc,EAAd;AACAF,KAAKG,MAAL,GAAc,EAAd;AACAH,KAAKI,SAAL,GAAiB,EAAjB;;AAEA,SAASC,QAAT,CAAkBC,MAAlB,EAA0BC,OAA1B,EAAmCzW,KAAnC,EAA0C;MACpCgF,OAAO0R,cAAc1W,KAAd,CAAX;;MAEI2W,MAAMT,KAAKM,MAAL,CAAV;MACG,CAACG,GAAJ,EACE,OAAO5T,QAAM,yBAAN,EAAiCyT,MAAjC,CAAP;;MAEE3S,OAAO8S,IAAIF,OAAJ,CAAX;MACG,CAAC5S,IAAJ,EACE,OAAOd,QAAM,yBAAyByT,MAAzB,GAAkC,OAAxC,EAAiDC,OAAjD,CAAP;;;;OAIGE,GAAL,GAAYH,MAAZ;OACK3S,IAAL,GAAY4S,OAAZ;OACK/Q,IAAL,GAAY1F,MAAM0F,IAAN,IAAc+Q,OAA1B,CAfwC;;SAiBjCzR,IAAP;;;AAGF,SAAS4R,SAAT,CAAmBJ,MAAnB,EAA2BC,OAA3B,EAAoCI,KAApC,EAA2C;;;;MAIrCF,MAAMT,KAAKM,MAAL,CAAV;MACG,CAACG,GAAJ,EACE,OAAO5T,QAAM,aAAN,EAAqByT,MAArB,CAAP;;MAEE3S,OAAO8S,IAAIF,OAAJ,CAAX;MACG,CAAC5S,IAAJ,EACE,OAAOd,QAAM,gCAAN,EAAwC0T,OAAxC,CAAP;;;OAGGK,OAAL,CAAaxX,IAAb,CAAkBuX,KAAlB;;;MAGIA,KAAJ,IAAahT,IAAb;;;;;AAMF,SAASkT,SAAT,CAAmBlT,IAAnB,EAAyB7D,KAAzB,EAAgCmT,UAAhC,EAAyC;MACnCnO,OAAOuR,SAAS,OAAT,EAAkB1S,IAAlB,EAAwB7D,KAAxB,CAAX;MACG,CAACgF,IAAJ,EAAU,OAAO,KAAP;;OAELgS,QAAL,GAAgB,CAAhB,CAJuC;;eAM1B,MAAb,EAAqBhS,IAArB;MACGmO,UAAH,EACEZ,oBAAoB,MAApB,EAA4BvN,IAA5B;;SAEKA,IAAP;;;AAGF,SAASiS,UAAT,CAAoBpT,IAApB,EAA0B7D,KAA1B,EAAiCmT,UAAjC,EAA0C;MACpCnO,OAAOuR,SAAS,QAAT,EAAmB1S,IAAnB,EAAyB7D,KAAzB,CAAX;MACG,CAACgF,IAAJ,EAAU,OAAO,KAAP;;OAELgS,QAAL,GAAgB,CAAhB,CAJwC;;;;eAQ3B,MAAb,EAAqBhS,IAArB;MACGmO,UAAH,EACEZ,oBAAoB,MAApB,EAA4BvN,IAA5B;;SAEKA,IAAP;;;AAGF,AAWA,AAaA,SAASkS,cAAT,CAAwBrT,IAAxB,EAA8BsT,UAA9B,EAA0C;;;;MAIpCC,UAAUlB,KAAKC,KAAL,CAAWtS,IAAX,CAAd;MACGuT,OAAH,EACE,OAAOrU,QAAM,gCAAN,EAAwCc,IAAxC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;UACQiT,OAAR,GAAkB,EAAlB,CAXwC;;;UAchCO,EAAR,GAAaF,WAAWE,EAAX,IAAiB,EAA9B;;;UAGQrX,KAAR,GAAgB,EAAhB,CAjBwC;UAkBhCA,KAAR,CAAc0F,IAAd,GAAqB,EAArB;UACQ1F,KAAR,CAAcsX,KAAd,GAAsB,EAAtB,CAnBwC;UAoBhCtX,KAAR,CAAcuX,GAAd,GAAoB,EAApB;;;;;OAKKpB,KAAL,CAAWtS,IAAX,IAAmBuT,OAAnB;;;MAGGD,WAAWL,OAAd,EAAuB;eACVA,OAAX,CAAmBU,OAAnB,CAA2B,UAASX,KAAT,EAAgB;gBAC/B,OAAV,EAAmBhT,IAAnB,EAAyBgT,KAAzB;KADF;;;;AAMJ,SAASY,eAAT,CAAyB5T,IAAzB,EAA+BsT,UAA/B,EAA2C;;;;MAIrCC,UAAUlB,KAAKE,MAAL,CAAYvS,IAAZ,CAAd;MACGuT,OAAH,EACE,OAAOrU,QAAM,iCAAN,EAAyCc,IAAzC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQ6T,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcC,GAAd,GAAoB,EAACC,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAsCC,OAAO,CAAC,QAAD,CAA7C,EAAyDjB,SAAS,EAAlE,EAApB;UACQY,KAAR,CAAcrC,EAAd,GAAoB,EAACuC,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAsCC,OAAO,CAAC,QAAD,CAA7C,EAAyDjB,SAAS,EAAlE,EAApB;UACQY,KAAR,CAAcM,GAAd,GAAoB,EAACJ,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAsCC,OAAO,CAAC,OAAD,CAA7C,EAAyDjB,SAAS,EAAlE,EAApB;;;UAGQ9W,KAAR,GAAgB,EAAhB,CAnByC;UAoBjC8W,OAAR,GAAkB,EAAlB,CApByC;;;;;OAyBpCV,MAAL,CAAYvS,IAAZ,IAAoBuT,OAApB;;;MAGGD,WAAWL,OAAd,EAAuB;eACVA,OAAX,CAAmBU,OAAnB,CAA2B,UAASX,KAAT,EAAgB;gBAC/B,QAAV,EAAoBhT,IAApB,EAA0BgT,KAA1B;KADF;;;;AAMJ,SAASoB,eAAT,CAAyBpU,IAAzB,EAA+BsT,UAA/B,EAA2C;;;;MAIrCC,UAAUlB,KAAKG,MAAL,CAAYxS,IAAZ,CAAd;MACGuT,OAAH,EACE,OAAOrU,QAAM,iCAAN,EAAyCc,IAAzC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQ6T,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcrC,EAAd,GAAuB,EAACuC,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAA+DjB,SAAS,EAAxE,EAAvB;UACQY,KAAR,CAAcQ,EAAd,GAAuB,EAACN,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,OAAD,CAAhD,EAA+DjB,SAAS,EAAxE,EAAvB;UACQY,KAAR,CAAcS,GAAd,GAAuB,EAACP,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAA+DjB,SAAS,EAAxE,EAAvB;UACQY,KAAR,CAAcU,MAAd,GAAuB,EAACR,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,QAA/B,EAAyCC,OAAO,CAAC,WAAD,CAAhD,EAA+DjB,SAAS,EAAxE,EAAvB;;;UAGQ9W,KAAR,GAAgB,EAAhB,CApByC;UAqBjC8W,OAAR,GAAkB,EAAlB,CArByC;;;;;OA0BpCT,MAAL,CAAYxS,IAAZ,IAAoBuT,OAApB;;;MAGGD,WAAWL,OAAd,EAAuB;eACVA,OAAX,CAAmBU,OAAnB,CAA2B,UAASX,KAAT,EAAgB;gBAC/B,QAAV,EAAoBhT,IAApB,EAA0BgT,KAA1B;KADF;;;;AAMJ,SAASwB,kBAAT,CAA4BxU,IAA5B,EAAkCsT,UAAlC,EAA8C;;;;;;;MAOxCC,UAAUlB,KAAKI,SAAL,CAAezS,IAAf,CAAd;MACGuT,OAAH,EACE,OAAOrU,QAAM,oCAAN,EAA4Cc,IAA5C,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQ6T,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcY,EAAd,GAAuB,EAACV,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,OAAD,EAAY,OAAZ,CAAhD,EAAsEjB,SAAS,EAA/E,EAAvB;UACQY,KAAR,CAAcM,GAAd,GAAuB,EAACJ,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,SAAD,EAAY,OAAZ,CAAhD,EAAsEjB,SAAS,EAA/E,EAAvB;UACQY,KAAR,CAAcC,GAAd,GAAuB,EAACC,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAAsEjB,SAAS,EAA/E,EAAvB;UACQY,KAAR,CAAcU,MAAd,GAAuB,EAACR,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,QAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAAsEjB,SAAS,EAA/E,EAAvB;;;UAGQ9W,KAAR,GAAgB,EAAhB,CAvB4C;UAwBpC8W,OAAR,GAAkB,EAAlB,CAxB4C;;;;;OA6BvCR,SAAL,CAAezS,IAAf,IAAuBuT,OAAvB;;;MAGGD,WAAWL,OAAd,EAAuB;eACVA,OAAX,CAAmBU,OAAnB,CAA2B,UAASX,KAAT,EAAgB;gBAC/B,WAAV,EAAuBhT,IAAvB,EAA6BgT,KAA7B;KADF;;;;AAOJ,AAIA,SAAS0B,QAAT,CAAkB1U,IAAlB,EAAwB2U,IAAxB,EAA8BnD,EAA9B,EAAkCrV,KAAlC,EAAyCmT,UAAzC,EAAkD;MAC5CsF,OAAO,EAAX;;;;;;SAMO/B,cAAc1W,KAAd,CAAP;OACKgT,GAAL,GAAWqC,EAAX;OACKvC,IAAL,GAAY0F,IAAZ;OACK3U,IAAL,GAAYA,IAAZ;OACKiU,KAAL,GAAajU,IAAb;;;;eAIa,MAAb,EAAqB4U,IAArB;MACGtF,UAAH,EACEZ,oBAAoB,MAApB,EAA4BkG,IAA5B;;;AAGJ,AAMA,AAIA,AAKA,AAOAvB,eAAe,QAAf,EAA0B,EAA1B;AACAA,eAAe,KAAf,EAA0B,EAACG,IAAI,CAAC,KAAD,CAAL,EAA1B;AACAH,eAAe,OAAf,EAA0B,EAACG,IAAI,CAAC,OAAD,EAAU,OAAV,CAAL,EAA1B;AACAH,eAAe,OAAf,EAA0B,EAACG,IAAI,CAAC,OAAD,EAAU,SAAV,CAAL,EAA2BqB,WAAW,IAAtC,EAA1B;AACAxB,eAAe,SAAf,EAA0B,EAACG,IAAI,CAAC,SAAD,CAAL,EAAkBP,SAAS,CAAC,SAAD,EAAY,SAAZ,CAA3B,EAA1B;;AAEAW,gBAAgB,MAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,MAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,OAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,QAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,QAAhB,EAA6B,EAACX,SAAS,CAAC,gBAAD,CAAV,EAA7B;AACAW,gBAAgB,QAAhB,EAA6B,EAACX,SAAS,CAAC,KAAD,EAAQ,MAAR,EAAgB,YAAhB,EAA8B,YAA9B,EAA4C,UAA5C,CAAV,EAA7B;AACAW,gBAAgB,QAAhB,EAA6B,EAACX,SAAS,CAAC,MAAD,EAAS,MAAT,EAAiB,YAAjB,CAAV,EAA7B;AACAW,gBAAgB,SAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,WAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,MAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,SAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;AACAW,gBAAgB,QAAhB,EAA6B,EAACX,SAAS,EAAV,EAA7B;;AAEAmB,gBAAgB,SAAhB,EAA6B,EAACnB,SAAS,CAAC,YAAD,CAAV,EAA7B;AACAmB,gBAAgB,UAAhB,EAA6B,EAACnB,SAAS,CAAC,KAAD,CAAV,EAA7B;AACAmB,gBAAgB,WAAhB,EAA6B,EAACnB,SAAS,CAAC,MAAD,CAAV,EAA7B;;AAEAuB,mBAAmB,cAAnB,EAAmC,EAACvB,SAAS,EAAV,EAAnC;AACAuB,mBAAmB,YAAnB,EAAmC,EAACvB,SAAS,CAAC,KAAD,EAAQ,MAAR,EAAgB,OAAhB,EAAyB,QAAzB,CAAV,EAAnC;;;;;AAOA,SAAS6B,YAAT,CAAsB9U,IAAtB,EAA4B4O,IAA5B,EAAkC;MAC7B5O,SAAS,MAAZ,EAAoB;;QAEf,CAAC4O,KAAKM,GAAT,EACEN,KAAKM,GAAL,GAAW6F,YAAX;MACAC,SAAF,CAAYpG,IAAZ;;;MAGC5O,SAAS,MAAZ,EAAoB;MAChBiV,OAAF,CAAUrG,IAAV;;;;AAIJ,SAASmG,UAAT,GAAsB;;SAEb,CAAC,KAAKG,KAAKC,MAAL,EAAN,EAAqBtD,KAArB,CAA2B,CAA3B,CAAP;;;AAGF,SAASgB,aAAT,CAAuB1W,KAAvB,EAA8B;MACzB,QAAOA,KAAP,yCAAOA,KAAP,OAAiB,QAApB,EACE,OAAO,EAAP;;MAECR,MAAMyZ,OAAN,CAAcjZ,KAAd,CAAH,EACE,OAAO,EAAP;;SAEKC,QAAMD,KAAN,CAAP;;;ACvWK,IAAIkZ,QAAQC,kBAAZ;AACP,AAEA,SAASC,iBAAT,CAA2BC,YAA3B,EAAyC;MACnCA,eAAeA,gBAAgBH,KAAnC;;MAEII,QAAQD,aAAaE,OAAb,CAAqBC,KAArB,CAA2B,CAA3B,EAA8B5a,GAA1C;MACIoF,QAAQ+D,EAAA,CAAOuR,KAAP,EAActV,KAA1B;;UAEQyV,eAAeJ,YAAf,EAA6BrV,KAA7B,CAAR;;SAEOkV,KAAP;;;AAGF,SAASQ,YAAT,GAAwB;MAClBF,QAAQ,CAAE,EAAC5a,KAAK,SAAN,EAAiBiF,MAAM,MAAvB,EAA+B8S,KAAK,OAApC,EAAF,EACE,EAAC/X,KAAK,MAAN,EAAciF,MAAM,MAApB,EAA4B8S,KAAK,QAAjC,EADF,EAEE,EAAC/X,KAAK,QAAN,EAAgBiF,MAAM,MAAtB,EAA8B8S,KAAK,OAAnC,EAFF,EAGE,EAAC/X,KAAK,MAAN,EAAciF,MAAM,MAApB,EAHF,CAAZ;SAKO,EAAC2V,OAAOA,KAAR,EAAeG,QAAQ,EAAvB,EAAP;;;AAGF,SAASR,gBAAT,GAA4B;MACtBS,WAAWF,cAAf;SACO,EAACG,WAAW,CAACD,QAAD,CAAZ,EAAwBL,SAASK,QAAjC,EAAP;;;AAGF,SAASH,cAAT,CAAwBJ,YAAxB,EAAsCrV,KAAtC,EAA6C;MACvCqV,eAAeA,gBAAgBH,KAAnC;;MAEIU,WAAWE,UAAUT,aAAaE,OAAvB,EAAgCvV,KAAhC,CAAf;;;;;MAKG,CAAC4V,SAASJ,KAAT,CAAena,MAAnB,EAA2B;QACrB0a,OAAJ,EAAaC,IAAb,EAAmBC,MAAnB,EAA2BC,IAA3B;aACSP,MAAT,CAAgBnC,OAAhB,CAAwB,UAAS2C,IAAT,EAAe;UAClCA,KAAKtW,IAAL,KAAc,SAAjB,EAA4B;YACtBsS,QAAQY,UAAUoD,KAAKnW,KAAf,EAAsB,EAAC0B,MAAMyU,KAAKzU,IAAZ,EAAtB,EAAyC,IAAzC,CAAZ;YACGyU,KAAKC,MAAL,KAAgB,SAAnB,EAA8BL,UAAU5D,KAAV;YAC3BgE,KAAKC,MAAL,KAAgB,QAAnB,EAA8BH,SAAU9D,KAAV;OAHhC,MAKK,IAAGgE,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;eACrBsW,KAAKnW,KAAZ;OADG,MAGA,IAAGmW,KAAKvb,GAAL,KAAa,SAAhB,EAA2B;kBACpBub,KAAKE,IAAf;OADG,MAGA,IAAGF,KAAKvb,GAAL,KAAa,QAAhB,EAA0B;iBACpBub,KAAKE,IAAd;OADG,MAGA,IAAGF,KAAKvb,GAAL,KAAa,MAAhB,EAAwB;eACpB,CAACub,KAAKE,IAAL,IAAW,EAAZ,EAAgBxW,IAAhB,IAAwBsW,KAAKnW,KAApC;;KAhBJ;;QAoBG+V,WAAWC,IAAX,IAAmBC,MAAtB,EAA8B;aACrBhD,WAAW+C,IAAX,EAAiB,EAACM,MAAM,IAAIC,IAAJ,CAASL,IAAT,EAAeM,OAAf,EAAP,EAAjB,EAAoD,IAApD,CAAP;eACS,KAAT,EAAgBR,KAAKjH,GAArB,EAA0BkH,OAAOlH,GAAjC,EAAsC,CAAtC,EAAyC,IAAzC;eACS,KAAT,EAAgBgH,QAAQhH,GAAxB,EAA6BiH,KAAKjH,GAAlC,EAAuC,CAAvC,EAA0C,IAA1C;;;;;mBAKaoG,kBAAf;eA9ByB;;;SAkCpBE,YAAP;;;AAGF,SAASS,SAAT,CAAmBF,QAAnB,EAA6B5V,KAA7B,EAAoC;MAC9BmW,OAAOP,SAASJ,KAAT,CAAe1D,KAAf,EAAX;MACG,CAACqE,IAAJ,EACE,OAAOpX,QAAM,2BAAN,CAAP;;;MAGCoX,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;QACnBwW,OAAOjH,EAAExP,CAAF,CAAI,EAAC8B,MAAM1B,KAAP,EAAc2S,KAAKwD,KAAKxD,GAAxB,EAAJ,EAAkC8D,GAAlC,GAAwC,CAAxC,CAAX;QACGJ,IAAH,EAAS;WACFA,IAAL,GAAYA,IAAZ;;;;MAIDF,KAAKxD,GAAL,KAAa,OAAhB,EAAyB;QACpBwD,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;UACpB,CAACsW,KAAKE,IAAT,EAAe;iBACJb,KAAT,CAAe1M,OAAf,CAAuB,EAAClO,KAAK,MAAN,EAAciF,MAAM,SAApB,EAA+B6B,MAAM1B,KAArC,EAA4C2S,KAAKwD,KAAKxD,GAAtD,EAA2DyD,QAAQD,KAAKvb,GAAxE,EAAvB;;KAFJ,MAKK,IAAGub,KAAKtW,IAAL,KAAc,SAAjB,EAA4B;;;;;;OAM9BG,KAAL,GAAaA,KAAb;WACS2V,MAAT,CAAgBra,IAAhB,CAAqB6a,IAArB;;SAEOP,QAAP;;;AC5GF;;AAEA,AACA,AACA,AACA,AACA,AACA,AAEA,AAEA,AAAO,IAAMc,KAAK,YAAW;MACrBC,MAAM,EAAZ;MACMC,aAAa,EAACvU,kBAAkByO,IAAnB,EAAyBvO,qBAAqBuO,IAA9C,EAAnB;;SAEO,UAAS+F,KAAT,EAAgB;;;;QAIjBA,KAAJ,IAAazT,SAAS0T,cAAT,CAAwBD,KAAxB,KAAkCD,UAA/C;WACOD,IAAIE,KAAJ,CAAP;GALF;CAJgB,EAAX;;AAaP,SAASE,MAAT,CAAgBF,KAAhB,EAAuB5F,GAAvB,EAA4B;KACvB4F,KAAH,EAAU7U,SAAV,GAAsBiP,GAAtB;;;AAGF,SAAS+F,SAAT,CAAmBH,KAAnB,EAA0B5F,GAA1B,EAA+B;KAC1B4F,KAAH,EAAU7U,SAAV,IAAuBiP,GAAvB;;;;;AAOF,AAAO,SAASgG,KAAT,CAAezX,CAAf,EAAkB;IACrB0X,cAAF;QACMhI,KAAN,GAAcwH,GAAG,OAAH,EAAY1W,KAA1B;KACG,OAAH,EAAYmX,SAAZ,CAAsBC,GAAtB,CAA0B,MAA1B;KACG,WAAH,EAAgBD,SAAhB,CAA0B1N,MAA1B,CAAiC,MAAjC;;;;;AAKF,IAAI4N,aAAJ;IAAmBC,gBAAnB;;AAEA,AAAO,SAASC,oBAAT,GAAgC;kBACrBb,GAAG,WAAH,EAAgBrU,gBAAhB,CAAiC,WAAjC,EAA8CmV,WAA9C,CAAhB;;;AAGF,AAAO,SAASC,sBAAT,GAAkC;KACpC,WAAH,EAAgBlV,mBAAhB,CAAoC,WAApC,EAAiD8U,aAAjD;;;AAGF,SAASG,WAAT,CAAqBhY,CAArB,EAAwB;OAClB,IAAIC,IAAED,EAAEE,MAAZ,EAAoBD,KAAKA,EAAEiY,OAA3B,EAAoCjY,IAAIA,EAAE8B,UAA1C,EAAsD;QACjD9B,EAAEiY,OAAF,CAAU,WAAV,CAAH,EAA2B;UACtBJ,qBAAqB7X,CAAxB,EACE,OAAO9D,SAAP;;yBAEiB8D,CAAnB;UACIkY,MAAM,GAAGjG,KAAH,CAAS7K,IAAT,CAAcpH,EAAE9E,QAAhB,EAA0BsQ,GAA1B,CAA8B;eAAQjK,KAAK4W,OAAL,CAAapN,EAArB;OAA9B,EAAuDkC,MAAvD,CAA8DmL,OAA9D,CAAV;UACIhG,MAAM,SAANA,GAAM,CAASjS,CAAT,EAAY;eAAQ,CAAC+X,IAAI7L,OAAJ,CAAYlM,EAAEmP,GAAd,CAAR;OAAvB;;;gBAGU8C,GAAV;aACOlW,SAAP;;;;;AAKN,AAAO,SAASmc,SAAT,CAAmBC,MAAnB,EAA2B;MAC5BxC,UAAUnG,EAAExP,CAAF,CAAI,EAACkY,WAAW,IAAZ,EAAJ,EAAuBrB,GAAvB,EAAd;UACQjD,OAAR,CAAgB,UAASxS,IAAT,EAAe;;WAEtBA,KAAK8W,SAAZ,CAF6B;GAA/B;;MAKG,CAACC,MAAJ,EAAY;;WAEHpc,SAAP;;;MAGC,OAAOoc,MAAP,KAAkB,UAArB,EAAiC;cACrB3I,EAAExP,CAAF,GAAM8M,MAAN,CAAaqL,MAAb,EAAqBtB,GAArB,EAAV;GADF,MAEO;cACKrH,EAAExP,CAAF,CAAImY,MAAJ,EAAYtB,GAAZ,EAAV;;;UAGMjD,OAAR,CAAgB,UAASxS,IAAT,EAAe;SACxB8W,SAAL,GAAiB,IAAjB;GADF;;;;;;;AAUF,AAAO,SAASE,cAAT,CAAwBC,EAAxB,EAA4B;KAC9Bf,cAAH;MACIxX,SAASuY,GAAGvY,MAAhB;MACIwY,MAAMxY,OAAOyY,SAAjB;MACG,CAACD,GAAJ,EAAS,OAAOvc,SAAP;YACCuc,GAAV;;;AAGF,AAAO,SAASE,kBAAT,CAA4BH,EAA5B,EAAgC;MACjCvY,SAASuY,GAAGvY,MAAhB;MACIwY,MAAMxY,OAAOyY,SAAjB;;MAEG,CAACD,GAAJ,EACE,OAAOvc,SAAP;;MAEC2b,qBAAqBY,GAAxB,EACE,OAAOvc,SAAP;;qBAEiBuc,GAAnB;YACU,UAAStY,CAAT,EAAY;WAAS,CAACA,EAAE6N,IAAF,CAAO3B,OAAP,CAAeoM,GAAf,CAAR;GAAxB;;;AAGF,AAAO,SAASG,iBAAT,CAA2BJ,EAA3B,EAA+B;MACjC,CAACX,gBAAJ,EACE,OAAO3b,SAAP;;qBAEiB,KAAnB;;;;AAIF,AAAO,SAAS2c,cAAT,CAAwBL,EAAxB,EAA4B;;MAE7BA,GAAGvY,MAAH,CAAU6Y,OAAV,KAAsB,MAAtB,IACAN,GAAGvY,MAAH,CAAU6Y,OAAV,KAAsB,OADtB,IAEAN,GAAGvY,MAAH,CAAU6Y,OAAV,KAAsB,QAFtB,IAGAN,GAAGvY,MAAH,CAAU6Y,OAAV,KAAsB,UAH1B,EAKE,OAAO,IAAP;;MAEE3d,MAAMqd,GAAGO,OAAH,IAAcP,GAAGQ,KAA3B;;;MAGIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;;MAEIC,QAAQ,GAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;;;;MAIGve,QAAQoe,KAAR,IAAiBpe,QAAQue,KAAzB,IAAkCve,QAAQke,KAA7C,EAAoD;OAC/C5B,cAAH;QACGvX,MAAMyO,YAAN,IAAsBzO,MAAMuO,UAA/B,EAA2C,OAAO,KAAP;UACrCE,YAAN;;;;MAICxT,QAAQse,KAAR,IAAiBte,QAAQqe,KAAzB,IAAkCre,QAAQie,KAA7C,EAAoD;OAC/C3B,cAAH;QACGvX,MAAMyO,YAAN,IAAsBzO,MAAMsO,UAA/B,EAA2C,OAAO,KAAP;UACrCG,YAAN;;;;MAICxT,QAAQ+d,KAAX,EAAkB;UACVtK,gBAAN,GAAyB,CAAC1O,MAAM0O,gBAAhC;;;;MAICzT,QAAQ8d,KAAX,EAAkB;UACV3K,SAAN,GAAkB,CAACpO,MAAMoO,SAAzB;;;;MAICnT,QAAQge,KAAX,EAAkB;UACVzK,WAAN,GAAoB,CAACxO,MAAMwO,WAA3B;;;;MAICvT,QAAQme,KAAX,EAAkB;UACV/K,UAAN,GAAmB,CAACrO,MAAMqO,UAA1B;;;;;AAKJ,AAAO,SAASoL,aAAT,CAAuBnB,EAAvB,EAA2B;KAC7Bf,cAAH;SACOR,GAAG,WAAH,EAAgB1W,KAAvB;;;AAGF,AAAO,SAASqZ,eAAT,CAAyBpB,EAAzB,EAA6B;;MAE9BqB,OAAOrB,GAAGvY,MAAd;MACIG,OAAOyZ,KAAKnC,SAAL,CAAeoC,QAAf,CAAwB,MAAxB,IAAkC,MAAlC,GAA2C,KAAtD;MACItI,MAAMqI,KAAKE,WAAf;MACIhP,KAAK8O,KAAKG,YAAL,CAAkB,SAAlB,CAAT;;;;;;;;MAQG5Z,SAAS,KAAT,IAAkB2K,EAAlB,IAAwByG,GAA3B,EAAgC;QAC1BjQ,OAAOoO,EAAEsK,WAAF,CAAclP,EAAd,CAAX;QACGxJ,QAAQA,KAAKU,IAAL,KAAcuP,GAAzB,EAA8B;;WAEvBvP,IAAL,GAAYuP,GAAZ;UACIzG,EAAJ;;;;;MAKD3K,SAAS,MAAZ,EAAoB;QACd8Z,MAAML,KAAKG,YAAL,CAAkB,UAAlB,CAAV;QACIG,MAAMN,KAAKG,YAAL,CAAkB,UAAlB,CAAV;;QAEII,QAAQzK,EAAEsK,WAAF,CAAcC,GAAd,CAAZ;QACIjG,QAAQmG,MAAM7K,GAAN,CAAU8K,MAAV,CAAiBD,MAAM/K,IAAvB,CAAZ;QACI2F,OAAOf,MAAMhH,MAAN,CACR,UAAS+H,IAAT,EACC;aAAUA,KAAKzF,GAAL,CAASD,GAAT,KAAiB4K,GAAjB,IAAwBlF,KAAK3F,IAAL,CAAUC,GAAV,KAAkB6K,GAA5C,IACEnF,KAAKzF,GAAL,CAASD,GAAT,KAAiB6K,GAAjB,IAAwBnF,KAAK3F,IAAL,CAAUC,GAAV,KAAkB4K,GADnD;KAFM,EAGsD,CAHtD,CAAX;;QAKG,CAAClF,IAAJ,EAAU,OAAO9Y,SAAP;;SAELmY,KAAL,GAAa7C,GAAb;SACKpR,IAAL,GAAYoR,GAAZ;;;;;;;WAOO8I,GAAT,CAAavP,EAAb,EAAiB;;;;;;QAMXwP,QAAQ5W,SAAS6W,gBAAT,CAA0B,eAAezP,EAAzC,CAAZ;SACI,IAAIrP,IAAI,CAAZ,EAAeA,IAAI6e,MAAM3e,MAAzB,EAAiCF,GAAjC,EAAsC;UACjC6e,MAAM7e,CAAN,MAAame,IAAhB,EACEU,MAAM7e,CAAN,EAASqe,WAAT,GAAuBvI,GAAvB;;;;aAIG,CAAP;;;;AAKJ,AAAO,SAASiJ,eAAT,CAAyBjC,EAAzB,EAA6B;MAC9BvY,SAASuY,GAAGvY,MAAhB;MACGA,OAAOjF,QAAP,KAAoB,QAAvB,EACE,OAAO,IAAP;;MAEE+P,KAAK9K,OAAO+Z,YAAP,CAAoB,SAApB,CAAT;MACIzY,OAAOoO,EAAEsK,WAAF,CAAclP,EAAd,CAAX;;MAEG,CAACxJ,IAAJ,EACE,OAAOjC,QAAM,0BAAN,CAAP;;MAECiC,KAAK2R,GAAL,KAAa,QAAhB,EAA0B;;MACtBwH,YAAF,CAAenZ,IAAf;GADF,MAGK;MACDmZ,YAAF,CAAenZ,IAAf,EADG;;;;;;;AAQP,AAAO,SAASoZ,YAAT,CAAsBnC,EAAtB,EAA0B;KAC5Bf,cAAH;;YAEU9H,CAAV,EAAagG,mBAAb;;SAEO,KAAP;;;AClRF,IAAMiF,MAAMtW,EAAA,CAAO,SAAP,EAAkBuW,UAAlB,CAA6B,IAA7B,CAAZ;;AAEA,IAAIC,QAAJ;IAAcC,SAAd;;;;AAKA,SAASC,MAAT,GAAgB;;aAEHjJ,KAAMkJ,IAAI,MAAJ,EAAYC,UAAZ,CAAN,EACMD,IAAI,MAAJ,EAAYE,SAAZ,CADN,EAEMF,IAAI,MAAJ,EAAYG,OAAZ,CAFN,EAGMH,IAAI,MAAJ,EAAYI,OAAOC,SAAnB;;IAEAC,QALN,EAMMC,aANN,EAOMC,SAPN,EAQMC,UARN,EASMC,SATN,EAUMC,oBAVN,EAWMC,YAXN,EAYMC,YAZN,EAaMC,cAbN,EAcMC;;IAEAC,SAhBN,EAiBMC,eAjBN,EAkBMC,UAlBN,EAmBMC,UAnBN,EAoBMC,eApBN,EAqBMC;;IAEAC,YAvBN,EAwBMC,WAxBN,EAyBMC,aAzBN,CAAX;;cA4BY1K,KAAM2K,WAAN,EACMC,cADN,EAEMC,cAFN,EAGMC,eAHN,CAAZ;;;AAOF,SAAS3b,QAAT,GAAkB;;MAEZ4b,MAAM,EAAExM,MAAM+K,OAAO7e,KAAP,CAAamT,CAAb,CAAR;SACO,EAACoN,MAAM,EAAP,EAAWC,MAAM,EAAjB,EAAqBC,MAAM,EAA3B,EADP;YAEU,EAAEzO,YAAYtO,MAAMsO,UAApB;kBACctO,MAAMuO,UADpB;eAEWyO,OAAO9P;KAJ5B;YAMU,EANV;SAOOwN;GAPjB;;WAUSkC,GAAT;YACUA,GAAV;;;;;;;;;;AAYF,SAAS5B,UAAT,CAAoBiC,CAApB,EAAuB;;MAEjBC,OAAO/B,OAAOgC,KAAP,EAAX;MACIpJ,QAAQ,EAAZ;;IAEE9T,CAAF,GAAM6W,GAAN,GAAYjD,OAAZ,CAAoB,UAASxS,IAAT,EAAe;QAC9BA,KAAKsV,IAAR,EACE,OAAO3a,SAAP;;QAEEohB,SAASH,EAAEhd,CAAF,CAAIoB,KAAK+N,GAAT,EAAciO,IAAd,GAAqBvG,GAArB,EAAb;WACOjD,OAAP,CAAe,UAASyJ,KAAT,EAAgB;UAC1BA,MAAM3G,IAAT,EACEtV,KAAKsV,IAAL,GAAYvB,KAAKpP,GAAL,CAAS3E,KAAKsV,IAAL,IAAW4G,QAApB,EAA8BD,MAAM3G,IAApC,CAAZ;;UAEE6G,KAAKP,EAAEhd,CAAF,CAAIqd,MAAMlO,GAAV,EAAeiO,IAAf,GAAsBvG,GAAtB,EAAT;UACG0G,GAAG9hB,MAAH,GAAY,CAAf,EACE,OAAOM,SAAP;;UAEE8Y,OAAO,EAACzF,KAAKmO,GAAG,CAAH,EAAMpO,GAAZ,EAAiBD,MAAMqO,GAAG,CAAH,EAAMpO,GAA7B,EAAkC+E,OAAOmJ,MAAMvb,IAAN,IAAc,EAAvD,EAAX;;UAEG,CAACgS,MAAM0J,IAAN,CAAW;eAAKC,EAAErO,GAAF,KAAUyF,KAAKzF,GAAf,IAAsBqO,EAAEvO,IAAF,KAAW2F,KAAK3F,IAA3C;OAAX,CAAJ,EACE4E,MAAMpY,IAAN,CAAWmZ,IAAX;;WAEGI,SAAL,CAAe7T,IAAf;KAbF;GALF;;QAsBMwS,OAAN,CAAc,UAASiB,IAAT,EAAe;SACtBK,OAAL,CAAaL,IAAb;GADF;;SAIOoI,IAAP;;;AAGF,SAASjC,SAAT,CAAmBgC,CAAnB,EAAsB;MAChBU,UAAU,EAAd;;IAEE1d,CAAF,GAAM6W,GAAN,GAAYjD,OAAZ,CAAoB,UAASxS,IAAT,EAAe;QAC9B,CAACA,KAAKU,IAAT,EACE,OAAO/F,SAAP;;QAEC,CAAC2hB,QAAQtc,KAAKU,IAAb,CAAJ,EAAwB;cACdV,KAAKU,IAAb,IAAqB,CAACV,IAAD,CAArB;KADF,MAGK;cACKA,KAAKU,IAAb,EAAmBpG,IAAnB,CAAwB0F,IAAxB;;GARJ;;SAYO2N,IAAP,CAAY2O,OAAZ,EAAqB9J,OAArB,CAA6B,UAAS9R,IAAT,EAAe;QACvC4b,QAAQ5b,IAAR,EAAcrG,MAAd,GAAuB,CAA1B,EACEuhB,EAAEW,aAAF,CAAgBD,QAAQ5b,IAAR,CAAhB;GAFJ;;SAKOkb,CAAP;;;;;AAMF,IAAIY,WAAW,CAAE,CAAC,KAAD,EAAQ,KAAR,EAAe,yBAAf,EAA0C,yBAA1C,EAAqE,yBAArE,CAAF,EACC,CAAC,KAAD,EAAQ,KAAR,EAAe,uBAAf,EAAwC,uBAAxC,CADD,EAEC,CAAC,8BAAD,EAAiC,+BAAjC,CAFD,EAGC,CAAC,WAAD,EAAc,MAAd,CAHD,CAAf;;AAMA,SAAS3C,OAAT,CAAiB+B,CAAjB,EAAoB;WACT3R,GAAT,CAAa,UAASwS,KAAT,EAAgB;WACpBA,MAAM7O,MAAN,CAAa,UAASC,GAAT,EAAcnN,IAAd,EAAoB;aAC/BmN,IAAIiL,MAAJ,CAAW8C,EAAEhd,CAAF,CAAI,EAAC8B,MAAMA,IAAP,EAAJ,EAAkB+U,GAAlB,EAAX,CAAP;KADK,EAEJ,EAFI,CAAP;GADF,EAIGjD,OAJH,CAIWoJ,EAAEW,aAAF,CAAgBG,IAAhB,CAAqBd,CAArB,CAJX;;SAMOA,CAAP;;;;;AAKF,SAASlC,GAAT,CAAaje,OAAb,EAAmBoV,GAAnB,EAAwB;SACf,UAAS0K,GAAT,EAAc;QACf9f,OAAJ,IAAYoV,IAAI0K,IAAI9f,OAAJ,CAAJ,CAAZ;WACO8f,GAAP;GAFF;;;AAMF,SAASvB,QAAT,CAAkBuB,GAAlB,EAAuB;MACjBoB,UAAUT,QAAd;MACIU,UAAU,CAAd;MACIrd,OAAOgc,IAAIsB,MAAJ,CAAWC,KAAX,GAAmB,EAA9B;;MAEI/N,IAAJ,CAASgO,CAAT,GAAaxB,IAAIxM,IAAJ,CAASgO,CAAT,CAAW9S,GAAX,CAAe,UAASjK,IAAT,EAAe;;QAEtCA,KAAKsV,IAAL,GAAY,aAAf,EAA8B,OAAOtV,IAAP,CAFW;;QAIrCgd,OAAQ,IAAIzH,IAAJ,CAASvV,KAAKsV,IAAL,GAAU,SAAnB,CAAD,CAAgC2H,WAAhC,EAAX;QACGD,OAAOL,OAAV,EAAmBA,UAAUK,IAAV,CALsB;QAMtCA,OAAOJ,OAAV,EAAmBA,UAAUI,IAAV,CANsB;;SAQpCA,IAAL,GAAYA,IAAZ,CARyC;YASjCzd,IAAR,EAAcS,KAAKgd,IAAnB,EAAyBhd,IAAzB,EATyC;;WAWlCA,IAAP;GAXW,CAAb;;;;MAgBI6c,MAAJ,CAAWF,OAAX,GAAqBhe,MAAMuO,UAA3B;MACI2P,MAAJ,CAAWD,OAAX,GAAqBje,MAAMsO,UAA3B;;SAEOsO,GAAP;;;AAGF,SAAStB,aAAT,CAAuBsB,GAAvB,EAA4B;;MAEtBsB,MAAJ,CAAWf,KAAX,GAAmBhC,OAAOgC,KAAP,CAAaP,IAAIxM,IAAJ,CAASgO,CAAtB,EAAyBxB,IAAIxM,IAAJ,CAASmO,CAAlC,CAAnB;MACInO,IAAJ,CAASgO,CAAT,GAAaxB,IAAIsB,MAAJ,CAAWf,KAAX,CAAiBqB,QAA9B;MACIpO,IAAJ,CAASmO,CAAT,GAAa3B,IAAIsB,MAAJ,CAAWf,KAAX,CAAiBpJ,KAA9B;SACO6I,GAAP;;;AAGF,SAASrB,SAAT,CAAmBqB,GAAnB,EAAwB;MAClBuB,QAAQvB,IAAIsB,MAAJ,CAAWC,KAAvB;;SAEOnP,IAAP,CAAYmP,KAAZ,EAAmBtK,OAAnB,CAA2B,UAAS4K,OAAT,EAAkB;QACvCJ,OAAOF,MAAMM,OAAN,CAAX;QACIC,OAAO,EAACxe,MAAM,MAAP,EAAeme,MAAMI,OAArB,EAA8B1c,MAAM,MAApC,EAA4CsN,KAAK,EAAjD,EAAqDF,MAAM,EAA3D,EAAX;;QAEIwP,SAAS,KAAKN,KAAK3iB,MAAV,GAAmB,CAAnB,GAAuB,CAAvB,GAA2B,KAAK2iB,KAAK3iB,MAAlD;;QAEIkjB,QAAQ,EAAZ;SACI,IAAIpjB,IAAI,CAAZ,EAAeA,IAAImjB,MAAnB,EAA2BnjB,GAA3B,EAAgC;YACxBG,IAAN,CAAWW,QAAMoiB,IAAN,CAAX;;;UAGI3d,SAAN,CAAgBpF,IAAhB,CAAqBsU,KAArB,CAA2BoO,IAA3B,EAAiCO,KAAjC;UACM7d,SAAN,CAAgBpF,IAAhB,CAAqBsU,KAArB,CAA2B2M,IAAIxM,IAAJ,CAASgO,CAApC,EAAuCQ,KAAvC;GAZF;;SAeOhC,GAAP;;;AAGF,SAASpB,UAAT,CAAoBoB,GAApB,EAAyB;MACnBuB,QAAQvB,IAAIsB,MAAJ,CAAWC,KAAvB;;MAEI/N,IAAJ,CAASgO,CAAT,CAAWvK,OAAX,CAAmB,UAASxS,IAAT,EAAe;QAC7BA,KAAKqc,CAAR,EAAW,OAAOrc,IAAP;;QAEPwd,SAASxd,KAAKgd,IAAL,GAAYzB,IAAIsB,MAAJ,CAAW3P,UAAvB,GAAoC,CAAjD;QACIuQ,SAASD,SAAS7e,MAAM2O,WAA5B,CAJgC;;QAM5BoQ,QAAQZ,MAAM9c,KAAKgd,IAAX,CAAZ;;;QAGG,CAACU,KAAJ,EAAW,OAAO,KAAP;;QAEPC,QAAQD,MAAM5S,OAAN,CAAc9K,IAAd,CAAZ;QACI4d,MAAM,IAAI7J,KAAK8J,EAAT,GAAcH,MAAMrjB,MAA9B;;QAEIyjB,MAAMN,SAASG,QAAQC,GAA3B;QACIG,KAAMN,SAAS1J,KAAKiK,GAAL,CAASF,GAAT,CAAnB;QACIG,KAAMR,SAAS1J,KAAKmK,GAAL,CAASJ,GAAT,CAAnB;QACIK,aAAane,KAAKgO,GAAL,CAAS3T,MAAT,GAAkB2F,KAAK8N,IAAL,CAAUzT,MAA7C;;SAEK+jB,KAAL,GAAa,QAAb;SACK/B,CAAL,GAAS0B,EAAT;SACKM,CAAL,GAASJ,EAAT;SACKK,CAAL,GAAS,IAAI,IAAEvK,KAAKpP,GAAL,CAAS,CAAT,EAAYwZ,aAAa,CAAzB,CAAf,CAtBgC;;WAwBzBne,IAAP;GAxBF;;SA2BOub,GAAP;;;AAGF,SAASnB,SAAT,CAAmBmB,GAAnB,EAAwB;MAClBxM,IAAJ,CAASgO,CAAT,GAAaxB,IAAIxM,IAAJ,CAASgO,CAAT,CAAW9S,GAAX,CAAe,UAASjK,IAAT,EAAe;SAAOue,KAAL,GAAaA,MAAMve,IAAN,CAAb,CAA0B,OAAOA,IAAP;GAA1D,CAAb;SACOub,GAAP;;;AAGF,SAASlB,oBAAT,CAA8BkB,GAA9B,EAAmC;MAC7BuB,QAAQvB,IAAIsB,MAAJ,CAAWC,KAAvB;;SAEOnP,IAAP,CAAYmP,KAAZ,EAAmB0B,IAAnB,GAA0BhM,OAA1B,CAAkC,UAAS5Y,GAAT,EAAc;QAC1C6kB,QAAQ3B,MAAMljB,GAAN,CAAZ;UACM4kB,IAAN,CAAWE,UAAX;UACMlM,OAAN,CAAc,UAASxS,IAAT,EAAe;YACrBwS,OAAN,CAAc,UAASmM,IAAT,EAAe;aACtB3e,IAAL,EAAW2e,IAAX;YACIC,iBAAiBL,MAAMve,IAAN,CAArB;YACI6e,iBAAiBN,MAAMI,IAAN,CAArB;YACG3e,KAAKue,KAAL,GAAaI,KAAKJ,KAAlB,GAA0BK,iBAAiBC,cAA9C,EAA8D;eACvD7e,IAAL,EAAW2e,IAAX;SADF,MAEO;eACAJ,KAAL,GAAaK,cAAb;eACKL,KAAL,GAAaM,cAAb;;OARJ;KADF;GAHF;;SAkBOtD,GAAP;;WAESuD,IAAT,CAAcC,EAAd,EAAkBC,EAAlB,EAAsB;QAChB3C,IAAI0C,GAAG1C,CAAX;QAAcgC,IAAIU,GAAGV,CAArB;OACGhC,CAAH,GAAO2C,GAAG3C,CAAV,CAAa0C,GAAGV,CAAH,GAAOW,GAAGX,CAAV;OACVhC,CAAH,GAAOA,CAAP,CAAa2C,GAAGX,CAAH,GAAOA,CAAP;;;WAGNK,UAAT,CAAoBK,EAApB,EAAwBC,EAAxB,EAA4B;WACnBD,GAAGR,KAAH,GAAWS,GAAGT,KAArB;;;;AAIJ,SAASA,KAAT,CAAeve,IAAf,EAAqB;SACZ,GAAG8Y,MAAH,CAAU9Y,KAAKgO,GAAL,IAAU,EAApB,EAAwBhO,KAAK8N,IAAL,IAAW,EAAnC,EAAuCF,MAAvC,CAA8C,UAASC,GAAT,EAAc4F,IAAd,EAAoB;WAAQ5F,MAAMoR,WAAWxL,IAAX,EAAiBzT,IAAjB,CAAb;GAAnE,EAAyG,CAAzG,CAAP;;WAESif,UAAT,CAAoBxL,IAApB,EAA0ByL,IAA1B,EAAgC;;QAE3BzL,KAAKzF,GAAL,KAAchO,IAAd,IAAsByT,KAAK3F,IAAL,CAAUkP,IAAV,GAAiBhd,KAAKgd,IAA/C,EAAqD,OAAO,CAAP;QAClDvJ,KAAK3F,IAAL,KAAc9N,IAAd,IAAsByT,KAAKzF,GAAL,CAAUgP,IAAV,GAAiBhd,KAAKgd,IAA/C,EAAqD,OAAO,CAAP;;;;QAIjDmC,KAAKpL,KAAKqL,GAAL,CAAS3L,KAAKzF,GAAL,CAASqO,CAAT,GAAa5I,KAAK3F,IAAL,CAAUuO,CAAhC,CAAT;QACIgD,KAAKtL,KAAKqL,GAAL,CAAS3L,KAAKzF,GAAL,CAASqQ,CAAT,GAAa5K,KAAK3F,IAAL,CAAUuQ,CAAhC,CAAT;;WAEOtK,KAAKuL,IAAL,CAAUH,KAAGA,EAAH,GAAQE,KAAGA,EAArB,CAAP;;;;AAIJ,SAAS/E,YAAT,CAAsBiB,GAAtB,EAA2B;MACrBxM,IAAJ,CAASgO,CAAT,GAAaxB,IAAIxM,IAAJ,CAASgO,CAAT,CAAWrR,MAAX,CAAkB,UAAS1L,IAAT,EAAe;WACrCA,KAAKnB,IAAL,KAAc,MAArB;GADW,CAAb;SAGO0c,GAAP;;;AAGF,SAAShB,YAAT,CAAsBgB,GAAtB,EAA2B;MACrBgE,YAAY,CAAhB;;MAEI3B,MAAM7J,KAAK8J,EAAL,GAAU,GAApB;MACIf,QAAQvB,IAAIsB,MAAJ,CAAWC,KAAvB;MACI0C,KAAK,EAAT;;SAEO7R,IAAP,CAAYmP,KAAZ,EAAmB0B,IAAnB,GAA0BhM,OAA1B,CAAkC,UAAS5Y,GAAT,EAAc;QAC1C6kB,QAAQ3B,MAAMljB,GAAN,CAAZ;UACM4Y,OAAN,CAAc,UAASxS,IAAT,EAAe;UACvByf,MAAJ,EAAYC,OAAZ;;UAEG1f,KAAKnB,IAAL,KAAc,MAAjB;;;;;;;WAOI,IAAI8gB,KAAK/B,GAAb,EAAkB+B,KAAK5L,KAAK8J,EAA5B,EAAgC8B,KAAK,CAAC,CAAD,IAAIA,KAAK/B,OAAK+B,KAAG5L,KAAKqL,GAAL,CAASO,EAAT,CAAR,CAAT,CAArC,EAAsE;iBAC3DC,cAAc5f,IAAd,EAAoB2f,EAApB,CAAT;kBACUE,aAAaJ,OAAOpB,CAApB,EAAuBmB,EAAvB,CAAV;YACG,CAACE,OAAD,IAAY3L,KAAKqL,GAAL,CAASM,UAAUD,OAAOpB,CAA1B,IAA+BkB,SAA9C,EACE;;;;;WAKClD,CAAL,GAASoD,OAAOpD,CAAhB;WACKgC,CAAL,GAASoB,OAAOpB,CAAhB;SACG/jB,IAAH,CAAQmlB,OAAOpB,CAAf;;SAEGG,IAAH,CAAQ,UAASva,CAAT,EAAYkF,CAAZ,EAAe;eAAQlF,IAAIkF,CAAX;OAAxB,EAvB2B;KAA7B;GAFF;;SA6BOoS,GAAP;;WAESqE,aAAT,CAAuB5f,IAAvB,EAA6B2f,EAA7B,EAAiC;WACxB,EAAEtD,GAAGrc,KAAKqc,CAAL,GAAStI,KAAKiK,GAAL,CAAS2B,EAAT,CAAT,GAAwB3f,KAAKqe,CAAL,GAAStK,KAAKmK,GAAL,CAASyB,EAAT,CAAtC;SACK3f,KAAKqc,CAAL,GAAStI,KAAKmK,GAAL,CAASyB,EAAT,CAAT,GAAwB3f,KAAKqe,CAAL,GAAStK,KAAKiK,GAAL,CAAS2B,EAAT;KAD7C;;;WAKOE,YAAT,CAAsBC,CAAtB,EAAyBre,EAAzB,EAA6B;;QACvBie,OAAJ;QACI/B,QAAQ5J,KAAKgM,KAAL,CAAWte,GAAGpH,MAAH,GAAY,CAAvB,CAAZ;QACIoT,OAAOhM,GAAGkc,KAAH,CAAX;;QAEGlc,GAAGpH,MAAH,GAAY,CAAf,EAAkB;WACZ,IAAIF,IAAI,CAAZ,EAAeA,IAAIsH,GAAGpH,MAAtB,EAA8BF,GAA9B,EAAmC;YAC9BulB,YAAY/kB,SAAZ,IAAyBoZ,KAAKqL,GAAL,CAAS3d,GAAGtH,CAAH,IAAQ2lB,CAAjB,IAAsB/L,KAAKqL,GAAL,CAASM,UAAUI,CAAnB,CAAlD,EACEJ,UAAUje,GAAGtH,CAAH,CAAV;;aAEGulB,OAAP;;;QAGCjS,SAASqS,CAAZ,EACE,OAAOrS,IAAP;;QAECA,OAAOqS,CAAV,EACE,OAAOD,aAAaC,CAAb,EAAgBre,GAAGiP,KAAH,CAAS,CAAT,EAAYiN,KAAZ,CAAhB,CAAP;;WAEKkC,aAAaC,CAAb,EAAgBre,GAAGiP,KAAH,CAASiN,QAAQ,CAAjB,CAAhB,CAAP;;;;AAIJ,SAASnD,cAAT,CAAwBe,GAAxB,EAA6B;MACvByE,MAAMzE,IAAIsB,MAAJ,CAAW5P,UAArB;MACItI,MAAM4W,IAAIsB,MAAJ,CAAW3P,UAArB;;;MAGGvO,MAAMyO,YAAN,GAAqB4S,GAAxB,EACEA,MAAMrhB,MAAMyO,YAAZ;;;MAGE2B,IAAJ,CAASgO,CAAT,GAAaxB,IAAIxM,IAAJ,CAASgO,CAAT,CAAWrR,MAAX,CAAkB,UAAS1L,IAAT,EAAe;;QAEzCA,KAAKgd,IAAL,GAAYgD,GAAZ,IAAmBhgB,KAAKgd,IAAL,GAAYrY,GAAlC,EAAuC;UACjCkY,MAAJ,CAAWf,KAAX,CAAiB3C,YAAjB,CAA8BnZ,IAA9B;aACO,KAAP;;WAEK,IAAP;GANW,CAAb;;SASOub,GAAP;;;AAGF,SAASd,YAAT,CAAsBc,GAAtB,EAA2B;MACrB0E,UAAU1E,IAAIsB,MAAJ,CAAWoD,OAAzB;;MAEG,CAACA,OAAJ,EAAa,OAAO1E,GAAP;;;MAGTxM,IAAJ,CAASgO,CAAT,GAAaxB,IAAIxM,IAAJ,CAASgO,CAAT,CAAWrR,MAAX,CAAkB,UAAS1L,IAAT,EAAe;;QAEzCigB,QAAQC,QAAR,CAAiBlgB,KAAKnB,IAAtB,CAAH,EAAgC;UAC1Bge,MAAJ,CAAWf,KAAX,CAAiB3C,YAAjB,CAA8BnZ,IAA9B;aACO,KAAP;;WAEK,IAAP;GANW,CAAb;;SASOub,GAAP;;;;;AAMF,SAASb,SAAT,CAAmBa,GAAnB,EAAwB;OAClB,IAAIphB,IAAIohB,IAAIsB,MAAJ,CAAWF,OAAvB,EAAgCxiB,KAAKohB,IAAIsB,MAAJ,CAAWD,OAAhD,EAAyDziB,GAAzD,EAA8D;QACxDiR,QAAQjR,MAAMwE,MAAMyO,YAAZ,GAA2B,MAA3B,GAAoC,MAAhD;QACIqQ,SAAS9e,MAAM2O,WAAN,IAAqBnT,IAAIohB,IAAIsB,MAAJ,CAAW3P,UAAf,GAA4B,CAAjD,CAAb;QACIiT,MAAJ,CAAWrY,OAAX,CAAmB,EAACsW,OAAO,QAAR,EAAkB/B,GAAG,CAArB,EAAwBgC,GAAG,CAA3B,EAA8BC,GAAGb,MAAjC,EAAyC2C,QAAQhV,KAAjD,EAAwDiV,MAAM,kBAA9D,EAAkFC,MAAM,CAAxF,EAA2FzhB,MAAM,MAAjG,EAAyGme,MAAM7iB,CAA/G,EAAnB;;SAEKohB,GAAP;;;AAGF,SAASZ,eAAT,CAAyBY,GAAzB,EAA8B;MACxBgF,SAAS,EAAb;;MAEIJ,MAAJ,CAAWzU,MAAX,CAAkBqE,GAAG,MAAH,EAAW,MAAX,CAAlB,EAAsCyC,OAAtC,CAA8C,UAAS4L,KAAT,EAAgB;QACxDiC,OAAOjC,MAAMpB,IAAN,KAAere,MAAMyO,YAArB,GAAoC,MAApC,GAA6C,MAAxD;QACI0F,QAAQ,EAACsL,OAAO,MAAR,EAAgB5iB,KAAK4iB,MAAMpB,IAA3B,EAAiCX,GAAG,CAAC,EAArC,EAAyCgC,GAAG,CAACD,MAAME,CAAP,GAAW,CAAvD,EAA0D+B,MAAMA,IAAhE,EAAsEG,MAAM,cAA5E,EAAZ;WACOlmB,IAAP,CAAYwY,KAAZ;GAHF;;MAMIqN,MAAJ,GAAa5E,IAAI4E,MAAJ,CAAWrH,MAAX,CAAkByH,MAAlB,CAAb;SACOhF,GAAP;;;AAGF,SAASX,UAAT,CAAoBW,GAApB,EAAyB;MACnBkF,OAAO,EAAG,kBAAkB,uBAArB;eACc,yBADd;gBAEe,0BAFf;YAGW,wBAHX;WAIU;GAJrB;;MAOI1R,IAAJ,CAASmO,CAAT,CAAW1K,OAAX,CAAmB,UAASiB,IAAT,EAAe;QAC7B,CAAC9U,MAAMoO,SAAP,IAAoB,EAAE0G,KAAK3F,IAAL,CAAUkP,IAAV,KAAmBre,MAAMyO,YAAzB,IAAyCqG,KAAKzF,GAAL,CAASgP,IAAT,KAAkBre,MAAMyO,YAAnE,CAAvB;aACSzS,SAAP;;QAEEyQ,QAAQqV,KAAKhN,KAAKX,KAAV,CAAZ;QACIA,QAAQW,KAAKX,KAAL,IAAc,KAA1B;QACItJ,KAAQiK,KAAKzF,GAAL,CAASD,GAAT,GAAe,GAAf,GAAqB0F,KAAK3F,IAAL,CAAUC,GAA3C;;;;;;;;;QASIuS,OAAO,EAAClC,OAAO,MAAR,EAAgBrQ,KAAKvE,EAArB,EAAyBkX,IAAIjN,KAAKzF,GAAL,CAASqO,CAAtC,EAAyCsE,IAAIlN,KAAKzF,GAAL,CAASqQ,CAAtD,EAAyDuC,IAAInN,KAAK3F,IAAL,CAAUuO,CAAvE,EAA0EwE,IAAIpN,KAAK3F,IAAL,CAAUuQ,CAAxF,EAA2F+B,QAAQhV,KAAnG,EAA0GvM,MAAM,MAAhH,EAAwHiU,OAAOA,KAA/H,EAAX;QACIqN,MAAJ,CAAW7lB,IAAX,CAAgBgmB,IAAhB;GAhBF;SAkBO/E,GAAP;;;AAGF,SAASV,UAAT,CAAoBU,GAApB,EAAyB;MACnB4E,MAAJ,GAAa5E,IAAI4E,MAAJ,CAAWrH,MAAX,CAAkBlK,KAAlB,CAAwB2M,IAAI4E,MAA5B,EAAoC5E,IAAIxM,IAAJ,CAASgO,CAAT,CAAW9S,GAAX,CAAe,UAASjK,IAAT,EAAe;;QAE1E,CAACrB,MAAMoO,SAAV,EAAqB;UACf+T,QAAQ,CAAC9gB,KAAKgO,GAAL,CAAS8K,MAAT,CAAgB9Y,KAAK8N,IAArB,EACK7D,GADL,CACS;eAAK,CAACzL,EAAEwP,GAAF,CAAMgP,IAAP,EAAaxe,EAAEsP,IAAF,CAAOkP,IAApB,CAAL;OADT,EAEKpP,MAFL,CAEY,UAACC,GAAD,EAAMpP,CAAN;eAAYoP,IAAIiL,MAAJ,CAAWra,CAAX,CAAZ;OAFZ,EAEuC,EAFvC,EAGKiN,MAHL,CAGY;eAAK2S,MAAM1f,MAAMyO,YAAjB;OAHZ,EAG2C/S,MAHxD;UAIGymB,KAAH,EACE,OAAO,EAAP;;;;;;;;;;;;;QAaEL,OAAO,EAAEM,SAAS;;QAETC,QAAQ,wBAFV;aAGS,yBAHT;WAIO;KAJlB;;QAOI5V,QAAQqV,KAAKzgB,KAAKnB,IAAV,CAAZ;;QAEEuf,QAAQ,EAAEA,OAAO,QAAT;WACOpe,KAAK+N,GADZ;SAEK/N,KAAKqc,CAFV;SAGKrc,KAAKqe,CAHV;SAIKre,KAAKse,CAJV;YAKQte,KAAKU,IALb;YAMQ0K;KANpB;;QASG,CAACpL,KAAK8W,SAAT,EACE,OAAOsH,KAAP;;QAEEtH,eAAY,EAAEsH,OAAO,QAAT;WACOpe,KAAK+N,GADZ;SAEK/N,KAAKqc,CAFV;SAGKrc,KAAKqe,CAHV;SAIKre,KAAKse,CAAL,GAAS,CAJd;YAKQ,IALR;YAMQ;KANxB;;WASO,CAACxH,YAAD,EAAYsH,KAAZ,CAAP;GAnD+C,CAApC,CAAb;SAqDO7C,GAAP;;;AAGF,SAAST,eAAT,CAAyBS,GAAzB,EAA8B;MACxBgF,SAAS,EAAb;;MAEIJ,MAAJ,CAAW3N,OAAX,CAAmB,UAAS4L,KAAT,EAAgB;QAC9B,CAACA,MAAM1d,IAAV,EAAgB,OAAO/F,SAAP;QACZa,MAAM4U,SAASgO,MAAM1d,IAAf,EAAqB,EAArB,CAAV;QACIoS,QAAQ,EAACsL,OAAO,MAAR,EAAgB5iB,KAAKA,GAArB,EAA0B6gB,GAAG+B,MAAM/B,CAAN,GAAU,EAAvC,EAA2CgC,GAAGD,MAAMC,CAAN,GAAU,CAAxD,EAAZ;WACO/jB,IAAP,CAAYwY,KAAZ;GAJF;;MAOIqN,MAAJ,GAAa5E,IAAI4E,MAAJ,CAAWrH,MAAX,CAAkByH,MAAlB,CAAb;SACOhF,GAAP;;;AAGF,SAASR,eAAT,CAAyBQ,GAAzB,EAA8B;MACzB,CAAC5c,MAAMwO,WAAV,EACE,OAAOoO,GAAP;;MAEEgF,SAAS,EAAb;;MAEIJ,MAAJ,CAAW3N,OAAX,CAAmB,UAAS4L,KAAT,EAAgB;QAC9BA,MAAMvf,IAAN,KAAe,MAAlB,EAA0B,OAAOlE,SAAP;QACtBmY,QAAQ,EAACsL,OAAO,YAAR,EAAsBsC,IAAItC,MAAMsC,EAAhC,EAAoCC,IAAIvC,MAAMuC,EAA9C,EAAkDC,IAAIxC,MAAMwC,EAA5D,EAAgEC,IAAIzC,MAAMyC,EAA1E,EAA8ER,MAAMjC,MAAMgC,MAA1F,EAAkG5kB,KAAK4iB,MAAMtL,KAA7G,EAAZ;WACOxY,IAAP,CAAYwY,KAAZ;GAHF;;MAMIqN,MAAJ,GAAa5E,IAAI4E,MAAJ,CAAWrH,MAAX,CAAkByH,MAAlB,CAAb;SACOhF,GAAP;;;;;;AAMF,SAASP,YAAT,CAAsBO,GAAtB,EAA2B;MACrB0F,GAAJ,CAAQzF,IAAR;MACIyF,GAAJ,CAAQvF,IAAR;SACOH,GAAP;;;AAGF,SAASN,WAAT,CAAqBM,GAArB,EAA0B;;MAEpBxZ,QAAQ,EAAZ;MACI2Q,QAAQ,EAAZ;;MAEIyN,MAAJ,CAAW3N,OAAX,CAAmB,UAASxS,IAAT,EAAe;QAC5BihB,GAAJ,CAAQxF,IAAR,IAAgByF,WAAWlhB,IAAX,CAAhB;GADF;;;WAKS8V,cAAT,CAAwB,iBAAxB,EAA2C9U,SAA3C,GAAuDua,IAAI0F,GAAJ,CAAQzF,IAAR,GAAeD,IAAI0F,GAAJ,CAAQxF,IAAvB,GAA8BF,IAAI0F,GAAJ,CAAQvF,IAA7F;;;WAGSyF,cAAT,CAAwB3iB,CAAxB,EAA2B;QACrBgL,KAAKhL,EAAEE,MAAF,CAAS8K,EAAlB;QACImN,MAAMnN,GAAGrO,KAAH,CAAS,GAAT,CAAV;QACG,CAACwb,IAAI,CAAJ,CAAJ,EAAY,OAAOhc,SAAP;;QAERkW,MAAM,SAANA,GAAM,CAASjS,CAAT,EAAY;aAAQ,CAAC+X,IAAI7L,OAAJ,CAAYlM,EAAEmP,GAAd,CAAR;KAAvB;aACA,CAAc8C,GAAd;;;MAGEuQ,aAAaD,cAAjB;MACIE,aAAaF,cAAjB;;MAEIG,aAAa5O,MAAMhH,MAAN,CAAa;WAAM,IAAN;GAAb,CAAjB;aACWzB,GAAX,CAAe;WAAMlH,EAAA,CAAOyG,EAAP,EAAWnI,gBAAX,CAA4B,OAA5B,EAAqC+f,UAArC,CAAN;GAAf;aACWnX,GAAX,CAAe;WAAMlH,EAAA,CAAOyG,EAAP,EAAWnI,gBAAX,CAA4B,WAA5B,EAAyCggB,UAAzC,CAAN;GAAf;;WAGSE,cAAT,CAAwB/iB,CAAxB,EAA2B;QACrBgL,KAAKhL,EAAEE,MAAF,CAAS8K,EAAlB;QACG,CAACA,EAAJ,EAAQ,OAAO7O,SAAP;;QAEJgc,MAAMvI,EAAExP,CAAF,CAAI4K,EAAJ,EAAQwS,IAAR,GAAeA,IAAf,GAAsBvG,GAAtB,GAA4BxL,GAA5B,CAAgC;aAAKoS,EAAEtO,GAAP;KAAhC,EAA4CrC,MAA5C,CAAmDwE,MAAnD,CAAV;QACIW,MAAM,SAANA,GAAM,CAASjS,CAAT,EAAY;aAAQ,CAAC+X,IAAI7L,OAAJ,CAAYlM,EAAEmP,GAAd,CAAR;KAAvB;aACA,CAAc8C,GAAd;;;MAGE2Q,aAAaD,cAAjB;MACIE,aAAaF,cAAjB;;MAEIG,aAAa3f,MAAM2J,MAAN,CAAa;WAAM,IAAN;GAAb,CAAjB;aACWzB,GAAX,CAAe;WAAMlH,EAAA,CAAOyG,EAAP,EAAWnI,gBAAX,CAA4B,OAA5B,EAAqCmgB,UAArC,CAAN;GAAf;aACWvX,GAAX,CAAe;WAAMlH,EAAA,CAAOyG,EAAP,EAAWnI,gBAAX,CAA4B,WAA5B,EAAyCogB,UAAzC,CAAN;GAAf;;;;;SAMOlG,GAAP,CAlDwB;;;WAuDf2F,UAAT,CAAoBlhB,IAApB,EAA0B;QACpB+d,KAAK,GAAT;QACIE,KAAK,GAAT;;QAEGje,KAAKoe,KAAL,KAAe,QAAlB,EACE,OAAOuD,YAAY3hB,IAAZ,EAAkB+d,KAAK/d,KAAKqc,CAA5B,EAA+B4B,KAAKje,KAAKqe,CAAzC,EAA4Cre,KAAKse,CAAjD,EAAoDte,KAAKogB,MAAzD,EAAiEpgB,KAAKqgB,IAAtE,EAA4ErgB,KAAKsgB,IAAjF,CAAP;;QAECtgB,KAAKoe,KAAL,KAAe,MAAlB,EACE,OAAOwD,UAAU5hB,IAAV,EAAgB+d,KAAK/d,KAAK0gB,EAA1B,EAA8BzC,KAAKje,KAAK2gB,EAAxC,EACgB5C,KAAK/d,KAAK4gB,EAD1B,EAC8B3C,KAAKje,KAAK6gB,EADxC,EAC4C7gB,KAAKogB,MADjD,EACyDpgB,KAAKsgB,IAD9D,CAAP;;QAGCtgB,KAAKoe,KAAL,KAAe,MAAlB,EACE,OAAOyD,UAAU7hB,IAAV,EAAgB+d,KAAK/d,KAAKqc,CAA1B,EAA6B4B,KAAKje,KAAKqe,CAAvC,EAA0Cre,KAAKxE,GAA/C,EAAoDwE,KAAKwgB,IAAzD,EAA+DxgB,KAAKqgB,IAApE,CAAP;;QAECrgB,KAAKoe,KAAL,KAAe,YAAlB,EACE,OAAO0D,gBAAiB9hB,IAAjB,EAAuB+d,KAAK/d,KAAK0gB,EAAjC,EAAqCzC,KAAKje,KAAK2gB,EAA/C,EACuB5C,KAAK/d,KAAK4gB,EADjC,EACqC3C,KAAKje,KAAK6gB,EAD/C,EAEuB7gB,KAAKxE,GAF5B,EAEiCwE,KAAKwgB,IAFtC,EAE4CxgB,KAAKqgB,IAFjD,CAAP;;;WAMKsB,WAAT,CAAqB3hB,IAArB,EAA2Bqc,CAA3B,EAA8BgC,CAA9B,EAAiCZ,MAAjC,EAAyCsE,YAAzC,EAAuDC,UAAvD,EAAmEC,UAAnE,EAA+E;QAC1E,CAAC5F,CAAD,IAAM,CAACgC,CAAP,IAAY,CAACZ,MAAhB,EAAwB,OAAO9iB,SAAP;;iBAEXqnB,cAAc,SAA3B;iBACaC,cAAc,CAA3B;mBACeF,gBAAgB,MAA/B;;QAEIG,YAAUliB,KAAK+N,GAAnB;UACMzT,IAAN,CAAW4nB,IAAX;;4BAEsBA,IAAtB,kBAAsCliB,KAAKnB,IAAL,IAAa,MAAnD,eAAkEwd,CAAlE,cAA4EgC,CAA5E,aAAqFZ,MAArF,gBAAsGuE,UAAtG,wBAAmIC,UAAnI,kBAA0JF,YAA1J;;;WAGOH,SAAT,CAAmB5hB,IAAnB,EAAyBmiB,KAAzB,EAAgCC,KAAhC,EAAuCC,GAAvC,EAA4CC,GAA5C,EAAiDP,YAAjD,EAA+DE,UAA/D,EAA2E;mBAC1DF,gBAAgB,MAA/B;iBACaE,cAAc,GAA3B;;QAEGE,QAAQC,KAAR,GAAgBC,GAAhB,GAAsBC,GAAtB,GAA4B,CAA5B,KAAkC,CAArC,EACE,OAAO,EAAP;;QAEEJ,YAAUliB,KAAK+N,GAAnB;UACMzT,IAAN,CAAW4nB,IAAX;;;mDAKoBliB,KAAKnB,IAFzB,cAEsCsjB,KAFtC,cAEoDC,KAFpD,cAEkEC,GAFlE,cAE8EC,GAF9E,mCAE+GP,YAF/G,+BAGgBG,IAHhB,kBAGiCliB,KAAKnB,IAHtC,cAGmDsjB,KAHnD,cAGiEC,KAHjE,cAG+EC,GAH/E,cAG2FC,GAH3F;;;WAOOT,SAAT,CAAmB7hB,IAAnB,EAAyBqc,CAAzB,EAA4BgC,CAA5B,EAA+B7iB,GAA/B,EAAoCglB,IAApC,EAA0CwB,UAA1C,EAAsDO,SAAtD,EAAiE;iBAClD,MAAb;WACO,gBAAP;gBACY,MAAZ;QACGC,MAAMnG,CAAN,CAAH,EAAa,OAAO,EAAP;QACTA,KAAK,CAAT;QACIgC,KAAK,CAAT;QACI/U,OAAO9N,GAAP,CAAJ,EAAiB;2BACI6gB,CAAnB,aAA4BgC,CAA5B,uBAA+CmC,IAA/C,sDAAoG+B,SAApG,UAAkH/mB,GAAlH;;yBAEiB6gB,CAAnB,aAA4BgC,CAA5B,uBAA+CmC,IAA/C,gBAA8DwB,UAA9D,0CAA6GO,SAA7G,UAA2H/mB,GAA3H;;;WAGOsmB,eAAT,CAAyB9hB,IAAzB,EAA+B0gB,EAA/B,EAAmCC,EAAnC,EAAuCC,EAAvC,EAA2CC,EAA3C,EAA+CrlB,GAA/C,EAAoDglB,IAApD,EAA0DwB,UAA1D,EAAsE;WAC7D,EAAP;;;;QAIIS,SAAJ,GAAgBT,cAAc,KAA9B;QACIxB,IAAJ,GAAWA,QAAQ,iBAAnB;;;;QAIIkC,UAAU,CAAd;QACIvD,KAAKyB,KAAKF,EAAd;QACIrB,KAAKwB,KAAKF,EAAd;QACI/b,MAAM+d,KAAKrD,IAAL,CAAUH,KAAGA,EAAH,GAAME,KAAGA,EAAnB,CAAV;QACIuD,QAAQhe,MAAM,IAAE8d,OAApB;QACIG,MAAM,IAAE,CAAZ;QACIxG,IAAIqE,EAAR;QACIrC,IAAIsC,EAAR;;QAEImC,aAAatnB,GAAjB;QACI+f,IAAIwH,WAAJ,IAAmB1J,IAAI0J,WAAJ,CAAgBD,UAAhB,EAA4BE,KAA5B,GAAoCJ,KAA3D,EAAiE;aACxDE,cAAczJ,IAAI0J,WAAJ,CAAgBD,aAAW,GAA3B,EAAgCE,KAAhC,GAAwCJ,KAA7D;qBAAiFE,WAAWpS,KAAX,CAAiB,CAAjB,EAAoB,CAAC,CAArB,CAAb;OACpEoS,cAAc,GAAd;;;;QAIEG,QAAQN,KAAKO,KAAL,CAAW7D,EAAX,EAAeF,EAAf,CAAZ;QACI8D,QAAQ,CAACN,KAAKQ,EAAN,GAAS,CAAjB,IAAsBF,QAAQN,KAAKQ,EAAL,GAAQ,CAA1C,EAA4C;UACtCvC,EAAJ;UACIC,EAAJ;YACM,CAAC,CAAP;YACM,CAAC,CAAP;eACS8B,KAAKQ,EAAd;;;QAGEC,IAAJ;QACIC,SAAJ,GAAgB,QAAhB;QACIC,SAAJ,CAAcjH,IAAE8C,KAAG0D,GAAnB,EAAwBxE,IAAEgB,KAAGwD,GAA7B;QACIU,MAAJ,CAAWN,KAAX;QACIO,QAAJ,CAAaV,UAAb,EAAyB,CAAzB,EAA4B,CAAC,CAA7B;QACIW,OAAJ;;;;AAMJ,AAOA,AAOA,SAASvI,aAAT,CAAuBK,GAAvB,EAA4B;;;SAGnBA,GAAP;;;AAIF,AAmBA,AAUA,AASA,AASA,AAyCA;;AAEA,SAASJ,WAAT,CAAqBI,GAArB,EAA0B;MACpBmI,UAAUtV,EAAExP,CAAF,CAAI,EAAC+S,KAAK,QAAN,EAAJ,EAAqB8D,GAArB,EAAd,CADwB;MAEpBoH,MAAJ,CAAW6G,OAAX,GAAqBA,OAArB;SACOnI,GAAP;;;AAGF,SAASH,cAAT,CAAwBG,GAAxB,EAA6B;MACvBsB,MAAJ,CAAW6G,OAAX,GAAqBnI,IAAIsB,MAAJ,CAAW6G,OAAX,CAAmBzZ,GAAnB,CAAuB,UAASmH,MAAT,EAAiB;WACpD4L,IAAP,GAAc,IAAIzH,IAAJ,CAASnE,OAAOkE,IAAP,GAAY,SAArB,EAAgC2H,WAAhC,EAAd;WACO7L,MAAP;GAFmB,CAArB;;MAKG,CAACzS,MAAM0O,gBAAV,EAA4B,OAAOkO,GAAP;;MAExBsB,MAAJ,CAAW6G,OAAX,GAAqBnI,IAAIsB,MAAJ,CAAW6G,OAAX,CAAmBhY,MAAnB,CAA0B,UAAS0F,MAAT,EAAiB;WACvDA,OAAO4L,IAAP,KAAgBre,MAAMyO,YAA7B;GADmB,CAArB;;SAIOmO,GAAP;;;AAIF,SAASF,cAAT,CAAwBE,GAAxB,EAA6B;MACvB1G,YAAY0G,IAAIsB,MAAJ,CAAW6G,OAAX,CAAmBzZ,GAAnB,CAAuB0Z,SAAvB,EAAkCjY,MAAlC,CAAyCmL,OAAzC,CAAhB;MACIgG,MAAJ,CAAWhI,SAAX,GAAuBA,SAAvB;SACO0G,GAAP;;;AAGF,SAASoI,SAAT,CAAmBvS,MAAnB,EAA2B;MACrB7R,OAAO,EAAX;MACImT,QAAQtB,OAAOtD,IAAP,CAAYgL,MAAZ,CAAmB1H,OAAOpD,GAA1B,CAAZ;MACG,CAAC0E,MAAM,CAAN,CAAJ,EAAc,OAAO,KAAP;MACXA,MAAM,CAAN,EAASI,KAAT,KAAmB,KAAtB,EACEJ,QAAQ,CAACA,MAAM,CAAN,CAAD,EAAWA,MAAM,CAAN,CAAX,CAAR;WACOkR,KAAT,CAAepa,EAAf,EAAmBiK,IAAnB,EAAyB;WAASA,KAAKzF,GAAL,CAASD,GAAT,KAAiBvE,EAAjB,GAAsBiK,KAAK3F,IAA3B,GAAkC2F,KAAKzF,GAA9C;;OACtB1T,IAAL,CAAUspB,MAAMxS,OAAOrD,GAAb,EAAkB2E,MAAM,CAAN,CAAlB,CAAV,EAAuCA,MAAM,CAAN,CAAvC,EAAiDtB,MAAjD,EAAyDsB,MAAM,CAAN,CAAzD,EAAmEkR,MAAMxS,OAAOrD,GAAb,EAAkB2E,MAAM,CAAN,CAAlB,CAAnE;OACKsK,IAAL,GAAY5L,OAAO4L,IAAnB;SACOzd,IAAP;;;AAGF,SAAS+b,eAAT,CAAyBC,GAAzB,EAA8B;QAC5B,CAAW,WAAX,EAAwB,EAAxB;MACIsI,UAAU,CAAd;;MAEIhH,MAAJ,CAAWhI,SAAX,CAAqB2J,IAArB,CAA0B,UAASva,CAAT,EAAYkF,CAAZ,EAAe;WAChClF,EAAE+Y,IAAF,GAAS7T,EAAE6T,IAAlB;GADF;;MAIIH,MAAJ,CAAWhI,SAAX,CAAqBrC,OAArB,CAA6B,UAASjT,IAAT,EAAe;QACtCqV,WAAW,EAAf;QACIkP,aAAa,EAAjB;QACIC,kBAAkB,CAAtB;;QAEGxkB,KAAKyd,IAAL,KAAc6G,OAAjB,EAA0B;iBACb,SAAStkB,KAAKyd,IAAd,GAAqB,OAAhC;gBACUzd,KAAKyd,IAAf;;;SAGGxK,OAAL,CAAa,UAASrB,KAAT,EAAgB;UACvBpC,IAAJ;UACIsG,OAAOlE,MAAMzQ,IAAN,IAAcyQ,MAAM2B,KAA/B;UACInB,MAAMR,MAAMQ,GAAhB;UACI9S,OAAO8S,MAAMR,MAAMtS,IAAZ,GAAmB,MAA9B;;UAEImlB,UAAU,CAACnlB,IAAD,CAAd;UACG8S,GAAH,EAAQ;gBACErX,IAAR,CAAaqX,GAAb;gBACQrX,IAAR,CAAa,UAAU6W,MAAMpD,GAA7B;OAFF,MAIK;gBACKzT,IAAR,CAAa,UAAW6W,MAAMnD,GAAN,CAAUD,GAArB,GAA2B,GAA3B,GAAiCoD,MAAMrD,IAAN,CAAWC,GAAzD;;;UAGCoD,MAAM2F,SAAT,EACEiN;;UAECllB,SAAS,MAAZ,EACEkQ,OAAO,EAACvF,IAAI2H,MAAMpD,GAAN,IAAW,EAAhB,EAAP,CADF,KAGEgB,OAAO,EAAC4J,KAAKxH,MAAMnD,GAAN,CAAUD,GAAhB,EAAqB6K,KAAKzH,MAAMrD,IAAN,CAAWC,GAArC,EAAP;;UAEC,CAACpP,MAAMqO,UAAV,EACE8W,cAAcG,SAASD,OAAT,EAAkBjV,IAAlB,EAAwBsG,IAAxB,CAAd,CADF,KAGEyO,cAAcI,eAAe/S,KAAf,EAAsBtS,IAAtB,EAA4B8S,GAA5B,EAAiC0D,IAAjC,CAAd;KA1BJ;;QA6BI8O,mBAAmB,UAAvB;wBACoBJ,oBAAoB,CAApB,GAAwB,YAAxB,GAAuC,EAA3D;gBACY,eAAeI,gBAAf,GAAkC,IAAlC,GAAyCL,UAAzC,GAAsD,OAAlE;;aAEA,CAAc,WAAd,EAA2BlP,QAA3B;GA3CF;;WA8CSqP,QAAT,CAAkBD,OAAlB,EAA2BjV,IAA3B,EAAiCqV,IAAjC,EAAuC;YAC7Btc,OAAR,CAAgB,MAAhB;QACIuc,YAAYL,QAAQM,IAAR,CAAa,GAAb,CAAhB;;QAEIC,WAAW7W,OAAOC,IAAP,CAAYoB,IAAZ,EAAkB9E,GAAlB,CAAsB,UAASrQ,GAAT,EAAc;aAAQ,UAAUA,GAAV,GAAgB,IAAhB,GAAuBmV,KAAKnV,GAAL,CAAvB,GAAmC,GAA1C;KAArC,EAAqF0qB,IAArF,CAA0F,GAA1F,CAAf;;WAEO,mBAAmBD,SAAnB,GAA+B,GAA/B,GACAE,QADA,GAEA,0BAFA,GAGAH,IAHA,GAGO,SAHd;;;WAMOF,cAAT,CAAwB/S,KAAxB,EAA+BtS,IAA/B,EAAqC8S,GAArC,EAA0CyS,IAA1C,EAAgD;QAC1CI,SAAS,EAAb;QACIC,QAAQ,EAAZ;;QAEG9S,QAAQ,QAAX,EAAqB;eACV,qCAAmCR,MAAMpD,GAAzC,GAA6C,sCAAtD;KADF,MAGK,IAAGlP,SAAS,MAAZ,EAAoB;cACf,OAAOA,IAAP,GAAc,GAAtB;eACS,qCAAmCsS,MAAMpD,GAAzC,GAA6C,6DAAtD;;;WAGK,MAAMqW,IAAN,GAAaK,KAAb,GAAqBD,MAA5B;;;SAGKjJ,GAAP;;;;;AAQF,SAASmJ,SAAT,CAAmB5I,KAAnB,EAA0BzH,YAA1B,EAAwC;;;;;sBAKlBA,YAApB;;;AAGF,SAASsQ,WAAT,CAAqBhT,GAArB,EAA0BiT,CAA1B,EAA6B;MACvBC,cAAc,IAAIC,MAAJ,CAAWF,CAAX,EAAc,GAAd,CAAlB;MACIG,aAAa,IAAID,MAAJ,CAAW,MAAMF,CAAjB,EAAoB,GAApB,CAAjB;MACI7iB,QAAQqM,EAAE+O,QAAF,CAAWzR,MAAX,CAAkB,UAAS1L,IAAT,EAAe;WAAQA,KAAK2R,GAAL,KAAaA,GAApB;GAAlC,EAA4D1H,GAA5D,CAAgExO,KAAK,MAAL,CAAhE,EACLiQ,MADK,CACE,UAAShL,IAAT,EAAe;WAAQmkB,YAAYG,IAAZ,CAAiBtkB,IAAjB,CAAP;GADlB,CAAZ;;QAGM8d,IAAN,CAAW,UAASva,CAAT,EAAYkF,CAAZ,EAAe;WACjB4b,WAAWC,IAAX,CAAgB7b,CAAhB,IAAqB4b,WAAWC,IAAX,CAAgB/gB,CAAhB,CAArB,IAA2CA,EAAEghB,UAAF,KAAiB9b,EAAE8b,UAAF,EAAnE;GADF;;SAIOljB,KAAP;;;AAGF,SAASmjB,mBAAT,CAA6B7Q,YAA7B,EAA2C;MACrC8Q,mBAAmB,EAACC,MAAM,IAAP,EAAatO,WAAW,IAAxB,EAA8BuO,WAAW,CAAzC,EAAvB;WACSC,gBAAT,CAA0B3T,GAA1B,EAA+B;WAAQ,EAACjR,MAAM,QAAP,EAAiB6kB,QAAQ,gBAASX,CAAT,EAAY3c,EAAZ,EAAgB;WAAI0c,YAAYhT,GAAZ,EAAiBiT,CAAjB,CAAH;OAA1C,EAAP;;;MAE5BY,SAAS,EAAb;MACIC,UAAU,EAAd;MACIC,gBAAgB,iEAApB;;;MAGI9Q,WAAWP,aAAaE,OAA5B;;WAESI,MAAT,CAAgBnC,OAAhB,CAAwB,UAAS2C,IAAT,EAAehb,CAAf,EAAkB;eAC7BwrB,aAAaxQ,IAAb,EAAmBA,KAAKnW,KAAxB,EAA+B7E,CAA/B,IAAoC,GAA/C;GADF;;;MAKIgb,OAAOP,SAASJ,KAAT,CAAe,CAAf,CAAX;MACIoR,QAAQ,EAAZ;MACGzQ,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;YACf8mB,aAAaxQ,IAAb,EAAmB0Q,gBAAgB1Q,KAAKxD,GAArB,EAA0BwD,KAAKvb,GAA/B,CAAnB,CAAR;GADF,MAGK,IAAGub,KAAKtW,IAAL,KAAc,SAAjB,EAA4B;YACvB8mB,aAAaxQ,IAAb,EAAmB2Q,gBAAgB3Q,KAAKxD,GAArB,EAA0BwD,KAAKvb,GAA/B,CAAnB,CAAR;GADG,MAGA,IAAGub,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;YACpB8mB,aAAaxQ,IAAb,EAAmB4Q,gBAAgB5Q,KAAKvb,GAArB,CAAnB,CAAR;;;aAGSgsB,KAAX;;;QAIA,CAAW,kBAAX,EAA+BH,UAAUD,MAAV,GAAmBE,aAAlD;;;MAGIM,WAAWtY,OAAOC,IAAP,CAAYuD,IAAZ,CAAf;WACSsB,OAAT,CAAiB,UAASb,GAAT,EAAc;MAC3B,MAAIA,GAAJ,GAAQ,QAAV,EAAoBsU,SAApB,CAA8Bd,gBAA9B,EAAgDG,iBAAiB3T,GAAjB,CAAhD;GADF;;MAIGiD,SAASD,MAAT,CAAgBta,MAAnB,EACE6rB,EAAE,MAAM/Q,KAAKvb,GAAb,EAAkBoE,KAAlB;;SAEK,KAAP;;;;WAIS6nB,eAAT,CAAyBlU,GAAzB,EAA8B/X,GAA9B,EAAmC;QAC7BwqB,OAAO,EAAX;;QAEGzS,QAAQ,OAAX,EACE,OAAO,6BAA4BA,GAA5B,GAAiC,oCAAjC,GAAuEwU,OAAOxU,GAAP,CAAvE,GAAoF,GAApF,GAAyFA,GAAzF,GAA8F,QAA9F,GAAwG/X,GAAxG,GAA6G,IAApH;QACC+X,QAAQ,QAAX,EAAqB;cACX,gCAAR;UACI/W,UAAU,CAAC,gBAAD,EAAmB,MAAnB,EAA2B,MAA3B,EAAmC,UAAnC,EAA+C,SAA/C,EAA0D,QAA1D,CAAd;;cAEQ4X,OAAR,CAAgB,UAAS4T,MAAT,EAAiB;gBACvB,aAAaA,MAAb,GAAsB,WAA9B;OADF;cAGQ,WAAR;aACOhC,IAAP;;;;WAIK0B,eAAT,CAAyBnU,GAAzB,EAA8B/X,GAA9B,EAAmC;;QAE7B4B,MAAM,iBAAe5B,GAAf,GAAmB,IAA7B;WACO,wCAAP;WACO,kCAAP;WACO,sCAAP;WACO,0CAAP;WACO,WAAP;WACO4B,GAAP;;;WAGOuqB,eAAT,CAAyBnsB,GAAzB,EAA8B;QACxB4B,MAAM,gBAAe5B,GAAf,GAAoB,sBAApB,GAA4CA,GAA5C,GAAiD,yBAA3D;WACO4B,GAAP;;;WAGOmqB,YAAT,CAAsBxQ,IAAtB,EAA4BnW,KAA5B,EAAmC2e,KAAnC,EAA0C;;QACpCyG,OAAO,EAAX;;QAEGjP,KAAKvb,GAAL,KAAa,SAAhB,EAA2B;UACtBub,KAAKnW,KAAR,EAAe;gBACL,WAAWmW,KAAKnW,KAAhB,GAAwB,UAAhC;OADF,MAEO;gBACG,gDAAR;gBACQA,QAAQ,GAAhB;;KALJ,MAQK,IAAGmW,KAAKvb,GAAL,KAAa,MAAhB,EAAwB;cACnB,OAAR;cACQoF,KAAR;cACQ,OAAR;KAHG,MAKA,IAAGmW,KAAKvb,GAAL,KAAa,QAAhB,EAA0B;cACrBoF,QAAQ,GAAhB;KADG,MAGA,IAAGmW,KAAKtW,IAAL,KAAc,SAAjB,EAA4B;UAC5B8e,UAAU,CAAb,EAAgB;gBACN,OAAR;gBACQwI,OAAOnnB,KAAP,IAAgB,GAAxB;gBACQA,QAAQ,GAAhB;YACGmW,KAAKnW,KAAR,EACEolB,QAAQjP,KAAKnW,KAAL,KAAe,QAAf,GAA0B,MAA1B,GAAmC,QAA3C;OALJ,MAMO;gBACG,KAAR;gBACQmnB,OAAOnnB,KAAP,IAAgB,GAAxB;gBACQA,QAAQ,IAAhB;;KAVC,MAaA,IAAGmW,KAAKtW,IAAL,KAAc,MAAjB,EAAyB;cACpB,SAAR;cACQG,QAAQ,GAAhB;KAFG,MAIA;aACI,MAAMA,KAAN,GAAc,GAArB;;;WAGKolB,IAAP;;;;AAIJ,SAAS+B,MAAT,CAAgBlW,GAAhB,EAAqB;qBACD+U,IAAX,CAAgB/U,GAAhB,IAAuB,GAAvB,GAA6B;;;;AAItC,SAASoW,SAAT,CAAmBC,EAAnB,EAAuB9G,EAAvB,EAA2B;SAClB8G,GAAG5a,MAAH,CAAU,UAAS2Q,CAAT,EAAY;WACpBmD,GAAG1U,OAAH,CAAWuR,CAAX,MAAkB,CAAC,CAA1B;GADK,CAAP;;;AAiBF,SAASkK,QAAT,GAAoB;;;MAGdC,aAAa,CAAC,oBAAD,EAAuB,SAAvB,CAAjB;MACIC,SAAS9nB,MAAM8N,IAAN,CAAWxC,GAAX,CAAe,UAASiN,GAAT,EAAc;WAASsP,WAAW,CAAX,IAAgBtP,GAAhB,GAAsBsP,WAAW,CAAX,CAA7B;GAA/B,EAA6ElC,IAA7E,CAAkF,IAAlF,CAAb;QACA,CAAW,UAAX,EAAuBmC,MAAvB;;;MAGIC,SAASL,UAAU3Y,OAAOC,IAAP,CAAYhP,MAAMgO,OAAlB,CAAV,EAAsChO,MAAM8N,IAA5C,EAAkD+R,IAAlD,EAAb;MACImI,YAAY,aAAaD,OAAOpC,IAAP,CAAY,mBAAZ,CAAb,GAAgD,WAAhE;QACA,CAAW,WAAX,EAAwBqC,SAAxB;;;AAIF,SAASna,UAAT,GAAsB;;sBAEA6H,KAApB;;;;AC3oCF;;AAEA,AACA,AACA,AACA,AAEA,AAAO,IAAIjG,IAAI0L,OAAOgC,KAAP,EAAR;AACP,AAGA,SAAS8K,MAAT,CAAgB1P,GAAhB,EAAqB;QACbzK,IAAN,CAAWnS,IAAX,CAAgB4c,GAAhB;MACI4C,OAAOgC,KAAP,EAAJ;gBACcnd,MAAM+N,KAApB;;;;AAIF,SAASma,SAAT,CAAmB3P,GAAnB,EAAwB;MAClByG,QAAQhf,MAAM8N,IAAN,CAAW3B,OAAX,CAAmBoM,GAAnB,CAAZ;MACGyG,UAAU,CAAC,CAAd,EACE,OAAOhjB,SAAP;;QAEI8R,IAAN,CAAW1G,MAAX,CAAkB4X,KAAlB,EAAyB,CAAzB;MACI7D,OAAOgC,KAAP,EAAJ;gBACcnd,MAAM+N,KAApB;;;;;;;;AAQF,SAASoa,QAAT,CAAkB7e,EAAlB,EAAsB;wBACE,UAASyE,KAAT,EAAgB;QACjClS,MAAMyZ,OAAN,CAAcvH,KAAd,CAAH,EACEzE,GAAG8e,cAAcC,cAActa,KAAd,CAAd,CAAH,EADF,KAGEzE,GAAGyE,KAAH,EAJkC;GAAtC;;;AAQF,SAASsa,aAAT,CAAuBta,KAAvB,EAA8B;QACtBA,KAAN,GAAcA,KAAd;SACOA,KAAP;;;AAGF,SAASqa,aAAT,CAAuBra,KAAvB,EAA8B;;;;;;;;;;;;;;MAgBxBua,OAAOC,aAAaC,aAAaza,KAAb,CAAb,CAAX;QACMC,OAAN,GAAgBya,YAAY1a,KAAZ,CAAhB;;OAEK3K,KAAL,CAAWqU,GAAX,CAAe5D,OAAf,CAAuB,UAASxS,IAAT,EAAe;QAChC6Q,MAAM8K,OAAO,SAAS3b,KAAK2R,GAArB,CAAV,CADoC;QAEjC,CAACd,GAAJ,EAAS,OAAOlW,SAAP;QACLqF,KAAKnB,IAAT,EAAemB,IAAf;GAHF;;OAMK0S,KAAL,CAAW0D,GAAX,CAAe5D,OAAf,CAAuB,UAASiB,IAAT,EAAe;;aAC3BA,KAAK5U,IAAd,EAAoB4U,KAAK3F,IAAzB,EAA+B2F,KAAKzF,GAApC,EAAyCyF,IAAzC;GADF;;OAIK1R,KAAL,CAAWslB,IAAX,CAAgB7U,OAAhB,CAAwB,UAASxS,IAAT,EAAe;;;GAAvC;;;AAMF,SAASonB,WAAT,CAAqB1a,KAArB,EAA4B;MACtBiB,OAAO,EAAX;QACM6E,OAAN,CAAc,UAASvE,IAAT,EAAe;KAC1B,CAACA,KAAKxB,IAAL,IAAW,EAAZ,EAAgB+F,OAAhB,CAAwB,UAAS0E,GAAT,EAAc;UAClCA,GAAH,EACEvJ,KAAKuJ,GAAL,IAAY,IAAZ;KAFH,CAAD;GADF;SAMOvJ,IAAP;;;AAGF,SAASwZ,YAAT,CAAsBza,KAAtB,EAA6B;UACnBA,MAAMhB,MAAN,CAAa,UAASuC,IAAT,EAAe;WAC3B,CAAC,CAACqZ,cAAcrZ,KAAKxB,IAAnB,EAAyB9N,MAAM8N,IAA/B,EAAqCpS,MAA9C,CADkC;GAA5B,CAAR;;SAIOqS,KAAP;;;AAGF,SAASwa,YAAT,CAAsBxa,KAAtB,EAA6B;MACvBua,OAAO,EAACllB,OAAO,EAACqU,KAAK,EAAN,EAAUiR,MAAM,EAAhB,EAAoB5e,QAAQ,EAA5B,EAAR,EAAyCiK,OAAO,EAAC0D,KAAK,EAAN,EAAUiR,MAAM,EAAhB,EAAoB5e,QAAQ,EAA5B,EAAhD,EAAX;QACM+J,OAAN,CAAc,UAASvE,IAAT,EAAe;;;;;QAKvB1O,OAAO0nB,KAAKhZ,KAAKpP,IAAL,GAAU,GAAf,EAAoBoP,KAAKmD,MAAzB,KAAoC,EAA/C,CAL2B;;;QAQvB3D,OAAOQ,KAAKc,IAAhB,CAR2B;SAStBwY,GAAL,GAAWtZ,KAAKsZ,GAAhB;SACKC,IAAL,GAAYvZ,KAAKuZ,IAAjB;SACK/a,IAAL,GAAYwB,KAAKxB,IAAjB;SACKnS,IAAL,CAAUmT,IAAV;GAZF;SAcOwZ,IAAP;;;AAGF,SAASK,aAAT,CAAuBhB,EAAvB,EAA2B9G,EAA3B,EAA+B;SACtB8G,GAAG5a,MAAH,CAAU,UAAS2Q,CAAT,EAAY;WACpBmD,GAAG1U,OAAH,CAAWuR,CAAX,MAAkB,CAAC,CAA1B;GADK,CAAP;;;AC3GK,SAAS/P,WAAT,GAAuB;;IAE5B,CAAO,OAAP,EAAgBjL,gBAAhB,CAAiC,QAAjC,EAA2C0B,KAA3C;;IAEA,CAAO,QAAP,EAAiB1B,gBAAjB,CAAkC,QAAlC,EAA4C0B,aAA5C;;IAEA,CAAO,kBAAP,EAA2B1B,gBAA3B,CAA4C,QAA5C,EAAsD0B,YAAtD;;IAEA,CAAO,WAAP,EAAoB1B,gBAApB,CAAqC,WAArC,EAAkD0B,oBAAlD;IACA,CAAO,WAAP,EAAoB1B,gBAApB,CAAqC,UAArC,EAAiD0B,sBAAjD;IACA,CAAO,WAAP,EAAoB1B,gBAApB,CAAqC,OAArC,EAA8C0B,eAA9C;IACA,CAAO,WAAP,EAAoB1B,gBAApB,CAAqC,OAArC,EAA8C0B,eAA9C;;IAEA,CAAO,UAAP,EAAmB1B,gBAAnB,CAAoC,OAApC,EAA6C0B,cAA7C;IACA,CAAO,UAAP,EAAmB1B,gBAAnB,CAAoC,WAApC,EAAiD0B,kBAAjD;IACA,CAAO,UAAP,EAAmB1B,gBAAnB,CAAoC,UAApC,EAAgD0B,iBAAhD;;WAES1B,gBAAT,CAA0B,SAA1B,EAAqC0B,cAArC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DF,SAAS0W,MAAT,GAAgB;;;MAGXkC,OAAO8L,QAAP,CAAgBC,IAAhB,CAAqBhX,KAArB,CAA2B,CAA3B,EAA8B,CAA9B,MAAqC,WAAxC,EAAqD;QAChDiL,OAAO8L,QAAP,CAAgBE,IAAnB,EACEhpB,MAAMkO,SAAN,GAAkB8O,OAAO8L,QAAP,CAAgBE,IAAhB,CAAqBjX,KAArB,CAA2B,CAA3B,CAAlB,CADF,KAGE/R,MAAMkO,SAAN,GAAkB,IAAlB;;;MAGD8O,OAAO8L,QAAP,CAAgBG,MAAnB,EAA2B;UACnBhb,KAAN,GAAc+O,OAAO8L,QAAP,CAAgBG,MAAhB,CAAuBtX,MAAvB,CAA8B,CAA9B,EAAiCnV,KAAjC,CAAuC,GAAvC,EAA4CyS,MAA5C,CAAmD,UAASC,GAAT,EAAcga,IAAd,EAAoB;UAC/EntB,IAAImtB,KAAK1sB,KAAL,CAAW,GAAX,CAAR;UACIT,EAAE,CAAF,CAAJ,IAAYA,EAAE,CAAF,CAAZ;aACOmT,GAAP;KAHY,EAIX,EAJW,CAAd;QAKGlP,MAAMiO,KAAN,CAAYsK,GAAf,EACEvY,MAAM8N,IAAN,GAAa,CAAC9N,MAAMiO,KAAN,CAAYsK,GAAb,CAAb,CADF,KAEK,IAAGvY,MAAMiO,KAAN,CAAYH,IAAf,EACH9N,MAAM8N,IAAN,GAAa9N,MAAMiO,KAAN,CAAYH,IAAZ,CAAiBtR,KAAjB,CAAuB,GAAvB,CAAb;;;;;;SAMG2Q,SAAP,GAAmBU,UAAnB;;;;WAISvE,EAAT,GAAc;;UAEN6E,OAAN,GAAgB,KAAhB,CAFY;;;WAKL7E,EAAT;;aAEW,YAAW;;GAAtB,EAEG,GAFH;;;;;AC9HF;;;;;;AAMA,AACA,AACA,AACA,AAGAwR;;AAEA,SAASA,OAAT,GAAgB;;SAEPnN,WAAP,GAAqBA,WAArB;SACOwb,aAAP,GAAuBA,UAAvB;SACO,EAAC,OAAD,OAAP,EAAoB1lB,SAAS0T,cAAT,CAAwB,SAAxB,CAApB;"}