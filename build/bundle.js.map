{"version":3,"file":"bundle.js","sources":["../node_modules/preact/src/vnode.js","../node_modules/preact/src/options.js","../node_modules/preact/src/h.js","../node_modules/preact/src/util.js","../node_modules/preact/src/constants.js","../node_modules/preact/src/linked-state.js","../node_modules/preact/src/render-queue.js","../node_modules/preact/src/vdom/functional-component.js","../node_modules/preact/src/vdom/index.js","../node_modules/preact/src/dom/index.js","../node_modules/preact/src/dom/recycler.js","../node_modules/preact/src/vdom/diff.js","../node_modules/preact/src/vdom/component-recycler.js","../node_modules/preact/src/vdom/component.js","../node_modules/preact/src/component.js","../node_modules/preact/src/render.js","../src/utils.js","../src/Sidebar/tabBar/tab/tab.js","../src/Sidebar/tabBar/tabBar.js","../src/UiKit/Header/index.js","../src/UiKit/Button/index.js","../src/Sidebar/views/home/index.js","../src/Sidebar/views/about/index.js","../src/app/state.js","../src/app/net.js","../src/app/fun.js","../src/app/model.js","../src/app/graph.js","../src/app/convo.js","../src/app/dom.js","../src/app/highlight.js","../src/app/render.js","../src/Sidebar/views/yourSelection/index.js","../src/Sidebar/views/current/index.js","../src/UiKit/LegendItem/index.js","../src/Sidebar/views/filters/index.js","../src/Sidebar/views/story/index.js","../src/Sidebar/Sidebar.js","../src/app/main.js","../src/main.js"],"sourcesContent":["/** Virtual DOM Node */\nexport function VNode(nodeName, attributes, children) {\n\t/** @type {string|function} */\n\tthis.nodeName = nodeName;\n\n\t/** @type {object<string>|undefined} */\n\tthis.attributes = attributes;\n\n\t/** @type {array<VNode>|undefined} */\n\tthis.children = children;\n\n\t/** Reference to the given key. */\n\tthis.key = attributes && attributes.key;\n}\n","/** Global options\n *\t@public\n *\t@namespace options {Object}\n */\nexport default {\n\n\t/** If `true`, `prop` changes trigger synchronous component updates.\n\t *\t@name syncComponentUpdates\n\t *\t@type Boolean\n\t *\t@default true\n\t */\n\t//syncComponentUpdates: true,\n\n\t/** Processes all created VNodes.\n\t *\t@param {VNode} vnode\tA newly-created VNode to normalize/process\n\t */\n\t//vnode(vnode) { }\n\n\t/** Hook invoked after a component is mounted. */\n\t// afterMount(component) { }\n\n\t/** Hook invoked after the DOM is updated with a component's latest render. */\n\t// afterUpdate(component) { }\n\n\t/** Hook invoked immediately before a component is unmounted. */\n\t// beforeUnmount(component) { }\n};\n","import { VNode } from './vnode';\nimport options from './options';\n\n\nconst stack = [];\n\nconst EMPTY_CHILDREN = [];\n\n/** JSX/hyperscript reviver\n*\tBenchmarks: https://esbench.com/bench/57ee8f8e330ab09900a1a1a0\n *\t@see http://jasonformat.com/wtf-is-jsx\n *\t@public\n *  @example\n *  /** @jsx h *\\/\n *  import { render, h } from 'preact';\n *  render(<span>foo</span>, document.body);\n */\nexport function h(nodeName, attributes) {\n\tlet children, lastSimple, child, simple, i;\n\tfor (i=arguments.length; i-- > 2; ) {\n\t\tstack.push(arguments[i]);\n\t}\n\tif (attributes && attributes.children) {\n\t\tif (!stack.length) stack.push(attributes.children);\n\t\tdelete attributes.children;\n\t}\n\twhile (stack.length) {\n\t\tif ((child = stack.pop()) instanceof Array) {\n\t\t\tfor (i=child.length; i--; ) stack.push(child[i]);\n\t\t}\n\t\telse if (child!=null && child!==true && child!==false) {\n\t\t\tif (typeof child=='number') child = String(child);\n\t\t\tsimple = typeof child=='string';\n\t\t\tif (simple && lastSimple) {\n\t\t\t\tchildren[children.length-1] += child;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t(children || (children = [])).push(child);\n\t\t\t\tlastSimple = simple;\n\t\t\t}\n\t\t}\n\t}\n\n\tlet p = new VNode(nodeName, attributes || undefined, children || EMPTY_CHILDREN);\n\n\t// if a \"vnode hook\" is defined, pass every created VNode to it\n\tif (options.vnode) options.vnode(p);\n\n\treturn p;\n}\n","/** Copy own-properties from `props` onto `obj`.\n *\t@returns obj\n *\t@private\n */\nexport function extend(obj, props) {\n\tif (props) {\n\t\tfor (let i in props) obj[i] = props[i];\n\t}\n\treturn obj;\n}\n\n\n/** Fast clone. Note: does not filter out non-own properties.\n *\t@see https://esbench.com/bench/56baa34f45df6895002e03b6\n */\nexport function clone(obj) {\n\treturn extend({}, obj);\n}\n\n\n/** Get a deep property value from the given object, expressed in dot-notation.\n *\t@private\n */\nexport function delve(obj, key) {\n\tfor (let p=key.split('.'), i=0; i<p.length && obj; i++) {\n\t\tobj = obj[p[i]];\n\t}\n\treturn obj;\n}\n\n\n/** @private is the given object a Function? */\nexport function isFunction(obj) {\n\treturn 'function'===typeof obj;\n}\n\n\n/** @private is the given object a String? */\nexport function isString(obj) {\n\treturn 'string'===typeof obj;\n}\n\n\n/** Convert a hashmap of CSS classes to a space-delimited className string\n *\t@private\n */\nexport function hashToClassName(c) {\n\tlet str = '';\n\tfor (let prop in c) {\n\t\tif (c[prop]) {\n\t\t\tif (str) str += ' ';\n\t\t\tstr += prop;\n\t\t}\n\t}\n\treturn str;\n}\n\n\n/** Just a memoized String#toLowerCase */\nlet lcCache = {};\nexport const toLowerCase = s => lcCache[s] || (lcCache[s] = s.toLowerCase());\n\n\n/** Call a function asynchronously, as soon as possible.\n *\t@param {Function} callback\n */\nlet resolved = typeof Promise!=='undefined' && Promise.resolve();\nexport const defer = resolved ? (f => { resolved.then(f); }) : setTimeout;\n","// render modes\n\nexport const NO_RENDER = 0;\nexport const SYNC_RENDER = 1;\nexport const FORCE_RENDER = 2;\nexport const ASYNC_RENDER = 3;\n\nexport const EMPTY = {};\n\nexport const ATTR_KEY = typeof Symbol!=='undefined' ? Symbol.for('preactattr') : '__preactattr_';\n\n// DOM properties that should NOT have \"px\" added when numeric\nexport const NON_DIMENSION_PROPS = {\n\tboxFlex:1, boxFlexGroup:1, columnCount:1, fillOpacity:1, flex:1, flexGrow:1,\n\tflexPositive:1, flexShrink:1, flexNegative:1, fontWeight:1, lineClamp:1, lineHeight:1,\n\topacity:1, order:1, orphans:1, strokeOpacity:1, widows:1, zIndex:1, zoom:1\n};\n\n// DOM event types that do not bubble and should be attached via useCapture\nexport const NON_BUBBLING_EVENTS = { blur:1, error:1, focus:1, load:1, resize:1, scroll:1 };\n","import { isString, delve } from './util';\n\n/** Create an Event handler function that sets a given state property.\n *\t@param {Component} component\tThe component whose state should be updated\n *\t@param {string} key\t\t\t\tA dot-notated key path to update in the component's state\n *\t@param {string} eventPath\t\tA dot-notated key path to the value that should be retrieved from the Event or component\n *\t@returns {function} linkedStateHandler\n *\t@private\n */\nexport function createLinkedState(component, key, eventPath) {\n\tlet path = key.split('.');\n\treturn function(e) {\n\t\tlet t = e && e.target || this,\n\t\t\tstate = {},\n\t\t\tobj = state,\n\t\t\tv = isString(eventPath) ? delve(e, eventPath) : t.nodeName ? (t.type.match(/^che|rad/) ? t.checked : t.value) : e,\n\t\t\ti = 0;\n\t\tfor ( ; i<path.length-1; i++) {\n\t\t\tobj = obj[path[i]] || (obj[path[i]] = !i && component.state[path[i]] || {});\n\t\t}\n\t\tobj[path[i]] = v;\n\t\tcomponent.setState(state);\n\t};\n}\n","import options from './options';\nimport { defer } from './util';\nimport { renderComponent } from './vdom/component';\n\n/** Managed queue of dirty components to be re-rendered */\n\n// items/itemsOffline swap on each rerender() call (just a simple pool technique)\nlet items = [];\n\nexport function enqueueRender(component) {\n\tif (!component._dirty && (component._dirty = true) && items.push(component)==1) {\n\t\t(options.debounceRendering || defer)(rerender);\n\t}\n}\n\n\nexport function rerender() {\n\tlet p, list = items;\n\titems = [];\n\twhile ( (p = list.pop()) ) {\n\t\tif (p._dirty) renderComponent(p);\n\t}\n}\n","import { EMPTY } from '../constants';\nimport { getNodeProps } from './index';\nimport { isFunction } from '../util';\n\n\n/** Check if a VNode is a reference to a stateless functional component.\n *\tA function component is represented as a VNode whose `nodeName` property is a reference to a function.\n *\tIf that function is not a Component (ie, has no `.render()` method on a prototype), it is considered a stateless functional component.\n *\t@param {VNode} vnode\tA VNode\n *\t@private\n */\nexport function isFunctionalComponent(vnode) {\n\tlet nodeName = vnode && vnode.nodeName;\n\treturn nodeName && isFunction(nodeName) && !(nodeName.prototype && nodeName.prototype.render);\n}\n\n\n\n/** Construct a resultant VNode from a VNode referencing a stateless functional component.\n *\t@param {VNode} vnode\tA VNode with a `nodeName` property that is a reference to a function.\n *\t@private\n */\nexport function buildFunctionalComponent(vnode, context) {\n\treturn vnode.nodeName(getNodeProps(vnode), context || EMPTY);\n}\n","import { clone, isString, isFunction, toLowerCase } from '../util';\nimport { isFunctionalComponent } from './functional-component';\n\n\n/** Check if two nodes are equivalent.\n *\t@param {Element} node\n *\t@param {VNode} vnode\n *\t@private\n */\nexport function isSameNodeType(node, vnode) {\n\tif (isString(vnode)) {\n\t\treturn node instanceof Text;\n\t}\n\tif (isString(vnode.nodeName)) {\n\t\treturn !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n\t}\n\tif (isFunction(vnode.nodeName)) {\n\t\treturn (node._componentConstructor ? node._componentConstructor===vnode.nodeName : true) || isFunctionalComponent(vnode);\n\t}\n}\n\n\nexport function isNamedNode(node, nodeName) {\n\treturn node.normalizedNodeName===nodeName || toLowerCase(node.nodeName)===toLowerCase(nodeName);\n}\n\n\n/**\n * Reconstruct Component-style `props` from a VNode.\n * Ensures default/fallback values from `defaultProps`:\n * Own-properties of `defaultProps` not present in `vnode.attributes` are added.\n * @param {VNode} vnode\n * @returns {Object} props\n */\nexport function getNodeProps(vnode) {\n\tlet props = clone(vnode.attributes);\n\tprops.children = vnode.children;\n\n\tlet defaultProps = vnode.nodeName.defaultProps;\n\tif (defaultProps) {\n\t\tfor (let i in defaultProps) {\n\t\t\tif (props[i]===undefined) {\n\t\t\t\tprops[i] = defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn props;\n}\n","import { NON_DIMENSION_PROPS, NON_BUBBLING_EVENTS } from '../constants';\nimport options from '../options';\nimport { toLowerCase, isString, isFunction, hashToClassName } from '../util';\n\n\n\n\n/** Removes a given DOM Node from its parent. */\nexport function removeNode(node) {\n\tlet p = node.parentNode;\n\tif (p) p.removeChild(node);\n}\n\n\n/** Set a named attribute on the given Node, with special behavior for some names and event handlers.\n *\tIf `value` is `null`, the attribute/handler will be removed.\n *\t@param {Element} node\tAn element to mutate\n *\t@param {string} name\tThe name/key to set, such as an event or attribute name\n *\t@param {any} old\tThe last value that was set for this name/node pair\n *\t@param {any} value\tAn attribute value, such as a function to be used as an event handler\n *\t@param {Boolean} isSvg\tAre we currently diffing inside an svg?\n *\t@private\n */\nexport function setAccessor(node, name, old, value, isSvg) {\n\n\tif (name==='className') name = 'class';\n\n\tif (name==='class' && value && typeof value==='object') {\n\t\tvalue = hashToClassName(value);\n\t}\n\n\tif (name==='key') {\n\t\t// ignore\n\t}\n\telse if (name==='class' && !isSvg) {\n\t\tnode.className = value || '';\n\t}\n\telse if (name==='style') {\n\t\tif (!value || isString(value) || isString(old)) {\n\t\t\tnode.style.cssText = value || '';\n\t\t}\n\t\tif (value && typeof value==='object') {\n\t\t\tif (!isString(old)) {\n\t\t\t\tfor (let i in old) if (!(i in value)) node.style[i] = '';\n\t\t\t}\n\t\t\tfor (let i in value) {\n\t\t\t\tnode.style[i] = typeof value[i]==='number' && !NON_DIMENSION_PROPS[i] ? (value[i]+'px') : value[i];\n\t\t\t}\n\t\t}\n\t}\n\telse if (name==='dangerouslySetInnerHTML') {\n\t\tif (value) node.innerHTML = value.__html || '';\n\t}\n\telse if (name[0]=='o' && name[1]=='n') {\n\t\tlet l = node._listeners || (node._listeners = {});\n\t\tname = toLowerCase(name.substring(2));\n\t\t// @TODO: this might be worth it later, un-breaks focus/blur bubbling in IE9:\n\t\t// if (node.attachEvent) name = name=='focus'?'focusin':name=='blur'?'focusout':name;\n\t\tif (value) {\n\t\t\tif (!l[name]) node.addEventListener(name, eventProxy, !!NON_BUBBLING_EVENTS[name]);\n\t\t}\n\t\telse if (l[name]) {\n\t\t\tnode.removeEventListener(name, eventProxy, !!NON_BUBBLING_EVENTS[name]);\n\t\t}\n\t\tl[name] = value;\n\t}\n\telse if (name!=='list' && name!=='type' && !isSvg && name in node) {\n\t\tsetProperty(node, name, value==null ? '' : value);\n\t\tif (value==null || value===false) node.removeAttribute(name);\n\t}\n\telse {\n\t\tlet ns = isSvg && name.match(/^xlink\\:?(.+)/);\n\t\tif (value==null || value===false) {\n\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', toLowerCase(ns[1]));\n\t\t\telse node.removeAttribute(name);\n\t\t}\n\t\telse if (typeof value!=='object' && !isFunction(value)) {\n\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', toLowerCase(ns[1]), value);\n\t\t\telse node.setAttribute(name, value);\n\t\t}\n\t}\n}\n\n\n/** Attempt to set a DOM property to the given value.\n *\tIE & FF throw for certain property-value combinations.\n */\nfunction setProperty(node, name, value) {\n\ttry {\n\t\tnode[name] = value;\n\t} catch (e) { }\n}\n\n\n/** Proxy an event to hooked event handlers\n *\t@private\n */\nfunction eventProxy(e) {\n\treturn this._listeners[e.type](options.event && options.event(e) || e);\n}\n","import { toLowerCase } from '../util';\nimport { removeNode } from './index';\n\n/** DOM node pool, keyed on nodeName. */\n\nconst nodes = {};\n\nexport function collectNode(node) {\n\tremoveNode(node);\n\n\tif (node instanceof Element) {\n\t\tnode._component = node._componentConstructor = null;\n\n\t\tlet name = node.normalizedNodeName || toLowerCase(node.nodeName);\n\t\t(nodes[name] || (nodes[name] = [])).push(node);\n\t}\n}\n\n\nexport function createNode(nodeName, isSvg) {\n\tlet name = toLowerCase(nodeName),\n\t\tnode = nodes[name] && nodes[name].pop() || (isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName));\n\tnode.normalizedNodeName = name;\n\treturn node;\n}\n","import { ATTR_KEY } from '../constants';\nimport { isString, isFunction } from '../util';\nimport { isSameNodeType, isNamedNode } from './index';\nimport { isFunctionalComponent, buildFunctionalComponent } from './functional-component';\nimport { buildComponentFromVNode } from './component';\nimport { setAccessor, removeNode } from '../dom/index';\nimport { createNode, collectNode } from '../dom/recycler';\nimport { unmountComponent } from './component';\nimport options from '../options';\n\n\n/** Queue of components that have been mounted and are awaiting componentDidMount */\nexport const mounts = [];\n\n/** Diff recursion count, used to track the end of the diff cycle. */\nexport let diffLevel = 0;\n\n/** Global flag indicating if the diff is currently within an SVG */\nlet isSvgMode = false;\n\n/** Global flag indicating if the diff is performing hydration */\nlet hydrating = false;\n\n/** Invoke queued componentDidMount lifecycle methods */\nexport function flushMounts() {\n\tlet c;\n\twhile ((c=mounts.pop())) {\n\t\tif (options.afterMount) options.afterMount(c);\n\t\tif (c.componentDidMount) c.componentDidMount();\n\t}\n}\n\n\n/** Apply differences in a given vnode (and it's deep children) to a real DOM Node.\n *\t@param {Element} [dom=null]\t\tA DOM node to mutate into the shape of the `vnode`\n *\t@param {VNode} vnode\t\t\tA VNode (with descendants forming a tree) representing the desired DOM structure\n *\t@returns {Element} dom\t\t\tThe created/mutated element\n *\t@private\n */\nexport function diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\t// diffLevel having been 0 here indicates initial entry into the diff (not a subdiff)\n\tif (!diffLevel++) {\n\t\t// when first starting the diff, check if we're diffing an SVG or within an SVG\n\t\tisSvgMode = parent && typeof parent.ownerSVGElement!=='undefined';\n\n\t\t// hydration is inidicated by the existing element to be diffed not having a prop cache\n\t\thydrating = dom && !(ATTR_KEY in dom);\n\t}\n\n\tlet ret = idiff(dom, vnode, context, mountAll);\n\n\t// append the element if its a new parent\n\tif (parent && ret.parentNode!==parent) parent.appendChild(ret);\n\n\t// diffLevel being reduced to 0 means we're exiting the diff\n\tif (!--diffLevel) {\n\t\thydrating = false;\n\t\t// invoke queued componentDidMount lifecycle methods\n\t\tif (!componentRoot) flushMounts();\n\t}\n\n\treturn ret;\n}\n\n\nfunction idiff(dom, vnode, context, mountAll) {\n\tlet ref = vnode && vnode.attributes && vnode.attributes.ref;\n\n\n\t// Resolve ephemeral Pure Functional Components\n\twhile (isFunctionalComponent(vnode)) {\n\t\tvnode = buildFunctionalComponent(vnode, context);\n\t}\n\n\n\t// empty values (null & undefined) render as empty Text nodes\n\tif (vnode==null) vnode = '';\n\n\n\t// Fast case: Strings create/update Text nodes.\n\tif (isString(vnode)) {\n\t\t// update if it's already a Text node\n\t\tif (dom && dom instanceof Text && dom.parentNode) {\n\t\t\tif (dom.nodeValue!=vnode) {\n\t\t\t\tdom.nodeValue = vnode;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// it wasn't a Text node: replace it with one and recycle the old Element\n\t\t\tif (dom) recollectNodeTree(dom);\n\t\t\tdom = document.createTextNode(vnode);\n\t\t}\n\n\t\treturn dom;\n\t}\n\n\n\t// If the VNode represents a Component, perform a component diff.\n\tif (isFunction(vnode.nodeName)) {\n\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t}\n\n\n\tlet out = dom,\n\t\tnodeName = String(vnode.nodeName),\t// @TODO this masks undefined component errors as `<undefined>`\n\t\tprevSvgMode = isSvgMode,\n\t\tvchildren = vnode.children;\n\n\n\t// SVGs have special namespace stuff.\n\t// This tracks entering and exiting that namespace when descending through the tree.\n\tisSvgMode = nodeName==='svg' ? true : nodeName==='foreignObject' ? false : isSvgMode;\n\n\n\tif (!dom) {\n\t\t// case: we had no element to begin with\n\t\t// - create an element with the nodeName from VNode\n\t\tout = createNode(nodeName, isSvgMode);\n\t}\n\telse if (!isNamedNode(dom, nodeName)) {\n\t\t// case: Element and VNode had different nodeNames\n\t\t// - need to create the correct Element to match VNode\n\t\t// - then migrate children from old to new\n\n\t\tout = createNode(nodeName, isSvgMode);\n\n\t\t// move children into the replacement node\n\t\twhile (dom.firstChild) out.appendChild(dom.firstChild);\n\n\t\t// if the previous Element was mounted into the DOM, replace it inline\n\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t// recycle the old element (skips non-Element node types)\n\t\trecollectNodeTree(dom);\n\t}\n\n\n\tlet fc = out.firstChild,\n\t\tprops = out[ATTR_KEY];\n\n\t// Attribute Hydration: if there is no prop cache on the element,\n\t// ...create it and populate it with the element's attributes.\n\tif (!props) {\n\t\tout[ATTR_KEY] = props = {};\n\t\tfor (let a=out.attributes, i=a.length; i--; ) props[a[i].name] = a[i].value;\n\t}\n\n\t// Optimization: fast-path for elements containing a single TextNode:\n\tif (!hydrating && vchildren && vchildren.length===1 && typeof vchildren[0]==='string' && fc && fc instanceof Text && !fc.nextSibling) {\n\t\tif (fc.nodeValue!=vchildren[0]) {\n\t\t\tfc.nodeValue = vchildren[0];\n\t\t}\n\t}\n\t// otherwise, if there are existing or new children, diff them:\n\telse if (vchildren && vchildren.length || fc) {\n\t\tinnerDiffNode(out, vchildren, context, mountAll, !!props.dangerouslySetInnerHTML);\n\t}\n\n\n\t// Apply attributes/props from VNode to the DOM Element:\n\tdiffAttributes(out, vnode.attributes, props);\n\n\n\t// invoke original ref (from before resolving Pure Functional Components):\n\tif (ref) {\n\t\t(props.ref = ref)(out);\n\t}\n\n\tisSvgMode = prevSvgMode;\n\n\treturn out;\n}\n\n\n/** Apply child and attribute changes between a VNode and a DOM Node to the DOM.\n *\t@param {Element} dom\t\tElement whose children should be compared & mutated\n *\t@param {Array} vchildren\tArray of VNodes to compare to `dom.childNodes`\n *\t@param {Object} context\t\tImplicitly descendant context object (from most recent `getChildContext()`)\n *\t@param {Boolean} mountAll\n *\t@param {Boolean} absorb\t\tIf `true`, consumes externally created elements similar to hydration\n */\nfunction innerDiffNode(dom, vchildren, context, mountAll, absorb) {\n\tlet originalChildren = dom.childNodes,\n\t\tchildren = [],\n\t\tkeyed = {},\n\t\tkeyedLen = 0,\n\t\tmin = 0,\n\t\tlen = originalChildren.length,\n\t\tchildrenLen = 0,\n\t\tvlen = vchildren && vchildren.length,\n\t\tj, c, vchild, child;\n\n\tif (len) {\n\t\tfor (let i=0; i<len; i++) {\n\t\t\tlet child = originalChildren[i],\n\t\t\t\tprops = child[ATTR_KEY],\n\t\t\t\tkey = vlen ? ((c = child._component) ? c.__key : props ? props.key : null) : null;\n\t\t\tif (key!=null) {\n\t\t\t\tkeyedLen++;\n\t\t\t\tkeyed[key] = child;\n\t\t\t}\n\t\t\telse if (hydrating || absorb || props || child instanceof Text) {\n\t\t\t\tchildren[childrenLen++] = child;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (vlen) {\n\t\tfor (let i=0; i<vlen; i++) {\n\t\t\tvchild = vchildren[i];\n\t\t\tchild = null;\n\n\t\t\t// if (isFunctionalComponent(vchild)) {\n\t\t\t// \tvchild = buildFunctionalComponent(vchild);\n\t\t\t// }\n\n\t\t\t// attempt to find a node based on key matching\n\t\t\tlet key = vchild.key;\n\t\t\tif (key!=null) {\n\t\t\t\tif (keyedLen && key in keyed) {\n\t\t\t\t\tchild = keyed[key];\n\t\t\t\t\tkeyed[key] = undefined;\n\t\t\t\t\tkeyedLen--;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// attempt to pluck a node of the same type from the existing children\n\t\t\telse if (!child && min<childrenLen) {\n\t\t\t\tfor (j=min; j<childrenLen; j++) {\n\t\t\t\t\tc = children[j];\n\t\t\t\t\tif (c && isSameNodeType(c, vchild)) {\n\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\tif (j===childrenLen-1) childrenLen--;\n\t\t\t\t\t\tif (j===min) min++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// morph the matched/found/created DOM child to match vchild (deep)\n\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\tif (child && child!==dom) {\n\t\t\t\tif (i>=len) {\n\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t}\n\t\t\t\telse if (child!==originalChildren[i]) {\n\t\t\t\t\tif (child===originalChildren[i+1]) {\n\t\t\t\t\t\tremoveNode(originalChildren[i]);\n\t\t\t\t\t}\n\t\t\t\t\tdom.insertBefore(child, originalChildren[i] || null);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\tif (keyedLen) {\n\t\tfor (let i in keyed) if (keyed[i]) recollectNodeTree(keyed[i]);\n\t}\n\n\t// remove orphaned children\n\twhile (min<=childrenLen) {\n\t\tchild = children[childrenLen--];\n\t\tif (child) recollectNodeTree(child);\n\t}\n}\n\n\n\n/** Recursively recycle (or just unmount) a node an its descendants.\n *\t@param {Node} node\t\t\t\t\t\tDOM node to start unmount/removal from\n *\t@param {Boolean} [unmountOnly=false]\tIf `true`, only triggers unmount lifecycle, skips removal\n */\nexport function recollectNodeTree(node, unmountOnly) {\n\tlet component = node._component;\n\tif (component) {\n\t\t// if node is owned by a Component, unmount that component (ends up recursing back here)\n\t\tunmountComponent(component, !unmountOnly);\n\t}\n\telse {\n\t\t// If the node's VNode had a ref function, invoke it with null here.\n\t\t// (this is part of the React spec, and smart for unsetting references)\n\t\tif (node[ATTR_KEY] && node[ATTR_KEY].ref) node[ATTR_KEY].ref(null);\n\n\t\tif (!unmountOnly) {\n\t\t\tcollectNode(node);\n\t\t}\n\n\t\t// Recollect/unmount all children.\n\t\t// - we use .lastChild here because it causes less reflow than .firstChild\n\t\t// - it's also cheaper than accessing the .childNodes Live NodeList\n\t\tlet c;\n\t\twhile ((c=node.lastChild)) recollectNodeTree(c, unmountOnly);\n\t}\n}\n\n\n\n/** Apply differences in attributes from a VNode to the given DOM Element.\n *\t@param {Element} dom\t\tElement with attributes to diff `attrs` against\n *\t@param {Object} attrs\t\tThe desired end-state key-value attribute pairs\n *\t@param {Object} old\t\t\tCurrent/previous attributes (from previous VNode or element's prop cache)\n */\nfunction diffAttributes(dom, attrs, old) {\n\t// remove attributes no longer present on the vnode by setting them to undefined\n\tlet name;\n\tfor (name in old) {\n\t\tif (!(attrs && name in attrs) && old[name]!=null) {\n\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t}\n\t}\n\n\t// add new & update changed attributes\n\tif (attrs) {\n\t\tfor (name in attrs) {\n\t\t\tif (name!=='children' && name!=='innerHTML' && (!(name in old) || attrs[name]!==(name==='value' || name==='checked' ? dom[name] : old[name]))) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Component } from '../component';\n\n/** Retains a pool of Components for re-use, keyed on component name.\n *\tNote: since component names are not unique or even necessarily available, these are primarily a form of sharding.\n *\t@private\n */\nconst components = {};\n\n\nexport function collectComponent(component) {\n\tlet name = component.constructor.name,\n\t\tlist = components[name];\n\tif (list) list.push(component);\n\telse components[name] = [component];\n}\n\n\nexport function createComponent(Ctor, props, context) {\n\tlet inst = new Ctor(props, context),\n\t\tlist = components[Ctor.name];\n\tComponent.call(inst, props, context);\n\tif (list) {\n\t\tfor (let i=list.length; i--; ) {\n\t\t\tif (list[i].constructor===Ctor) {\n\t\t\t\tinst.nextBase = list[i].nextBase;\n\t\t\t\tlist.splice(i, 1);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn inst;\n}\n","import { SYNC_RENDER, NO_RENDER, FORCE_RENDER, ASYNC_RENDER, ATTR_KEY } from '../constants';\nimport options from '../options';\nimport { isFunction, clone, extend } from '../util';\nimport { enqueueRender } from '../render-queue';\nimport { getNodeProps } from './index';\nimport { diff, mounts, diffLevel, flushMounts, recollectNodeTree } from './diff';\nimport { isFunctionalComponent, buildFunctionalComponent } from './functional-component';\nimport { createComponent, collectComponent } from './component-recycler';\nimport { removeNode } from '../dom/index';\n\n\n\n/** Set a component's `props` (generally derived from JSX attributes).\n *\t@param {Object} props\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.renderSync=false]\tIf `true` and {@link options.syncComponentUpdates} is `true`, triggers synchronous rendering.\n *\t@param {boolean} [opts.render=true]\t\t\tIf `false`, no render will be triggered.\n */\nexport function setComponentProps(component, props, opts, context, mountAll) {\n\tif (component._disable) return;\n\tcomponent._disable = true;\n\n\tif ((component.__ref = props.ref)) delete props.ref;\n\tif ((component.__key = props.key)) delete props.key;\n\n\tif (!component.base || mountAll) {\n\t\tif (component.componentWillMount) component.componentWillMount();\n\t}\n\telse if (component.componentWillReceiveProps) {\n\t\tcomponent.componentWillReceiveProps(props, context);\n\t}\n\n\tif (context && context!==component.context) {\n\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\tcomponent.context = context;\n\t}\n\n\tif (!component.prevProps) component.prevProps = component.props;\n\tcomponent.props = props;\n\n\tcomponent._disable = false;\n\n\tif (opts!==NO_RENDER) {\n\t\tif (opts===SYNC_RENDER || options.syncComponentUpdates!==false || !component.base) {\n\t\t\trenderComponent(component, SYNC_RENDER, mountAll);\n\t\t}\n\t\telse {\n\t\t\tenqueueRender(component);\n\t\t}\n\t}\n\n\tif (component.__ref) component.__ref(component);\n}\n\n\n\n/** Render a Component, triggering necessary lifecycle events and taking High-Order Components into account.\n *\t@param {Component} component\n *\t@param {Object} [opts]\n *\t@param {boolean} [opts.build=false]\t\tIf `true`, component will build and store a DOM node if not already associated with one.\n *\t@private\n */\nexport function renderComponent(component, opts, mountAll, isChild) {\n\tif (component._disable) return;\n\n\tlet skip, rendered,\n\t\tprops = component.props,\n\t\tstate = component.state,\n\t\tcontext = component.context,\n\t\tpreviousProps = component.prevProps || props,\n\t\tpreviousState = component.prevState || state,\n\t\tpreviousContext = component.prevContext || context,\n\t\tisUpdate = component.base,\n\t\tnextBase = component.nextBase,\n\t\tinitialBase = isUpdate || nextBase,\n\t\tinitialChildComponent = component._component,\n\t\tinst, cbase;\n\n\t// if updating\n\tif (isUpdate) {\n\t\tcomponent.props = previousProps;\n\t\tcomponent.state = previousState;\n\t\tcomponent.context = previousContext;\n\t\tif (opts!==FORCE_RENDER\n\t\t\t&& component.shouldComponentUpdate\n\t\t\t&& component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\tskip = true;\n\t\t}\n\t\telse if (component.componentWillUpdate) {\n\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t}\n\t\tcomponent.props = props;\n\t\tcomponent.state = state;\n\t\tcomponent.context = context;\n\t}\n\n\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\tcomponent._dirty = false;\n\n\tif (!skip) {\n\t\tif (component.render) rendered = component.render(props, state, context);\n\n\t\t// context to pass to the child, can be updated via (grand-)parent component\n\t\tif (component.getChildContext) {\n\t\t\tcontext = extend(clone(context), component.getChildContext());\n\t\t}\n\n\t\twhile (isFunctionalComponent(rendered)) {\n\t\t\trendered = buildFunctionalComponent(rendered, context);\n\t\t}\n\n\t\tlet childComponent = rendered && rendered.nodeName,\n\t\t\ttoUnmount, base;\n\n\t\tif (isFunction(childComponent)) {\n\t\t\t// set up high order component link\n\n\t\t\tlet childProps = getNodeProps(rendered);\n\t\t\tinst = initialChildComponent;\n\n\t\t\tif (inst && inst.constructor===childComponent && childProps.key==inst.__key) {\n\t\t\t\tsetComponentProps(inst, childProps, SYNC_RENDER, context);\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttoUnmount = inst;\n\n\t\t\t\tinst = createComponent(childComponent, childProps, context);\n\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\tinst._parentComponent = component;\n\t\t\t\tcomponent._component = inst;\n\t\t\t\tsetComponentProps(inst, childProps, NO_RENDER, context);\n\t\t\t\trenderComponent(inst, SYNC_RENDER, mountAll, true);\n\t\t\t}\n\n\t\t\tbase = inst.base;\n\t\t}\n\t\telse {\n\t\t\tcbase = initialBase;\n\n\t\t\t// destroy high order component link\n\t\t\ttoUnmount = initialChildComponent;\n\t\t\tif (toUnmount) {\n\t\t\t\tcbase = component._component = null;\n\t\t\t}\n\n\t\t\tif (initialBase || opts===SYNC_RENDER) {\n\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t}\n\t\t}\n\n\t\tif (initialBase && base!==initialBase && inst!==initialChildComponent) {\n\t\t\tlet baseParent = initialBase.parentNode;\n\t\t\tif (baseParent && base!==baseParent) {\n\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\tif (!toUnmount) {\n\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\trecollectNodeTree(initialBase);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (toUnmount) {\n\t\t\tunmountComponent(toUnmount, base!==initialBase);\n\t\t}\n\n\t\tcomponent.base = base;\n\t\tif (base && !isChild) {\n\t\t\tlet componentRef = component,\n\t\t\t\tt = component;\n\t\t\twhile ((t=t._parentComponent)) {\n\t\t\t\t(componentRef = t).base = base;\n\t\t\t}\n\t\t\tbase._component = componentRef;\n\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t}\n\t}\n\n\tif (!isUpdate || mountAll) {\n\t\tmounts.unshift(component);\n\t}\n\telse if (!skip) {\n\t\tif (component.componentDidUpdate) {\n\t\t\tcomponent.componentDidUpdate(previousProps, previousState, previousContext);\n\t\t}\n\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t}\n\n\tlet cb = component._renderCallbacks, fn;\n\tif (cb) while ( (fn = cb.pop()) ) fn.call(component);\n\n\tif (!diffLevel && !isChild) flushMounts();\n}\n\n\n\n/** Apply the Component referenced by a VNode to the DOM.\n *\t@param {Element} dom\tThe DOM node to mutate\n *\t@param {VNode} vnode\tA Component-referencing VNode\n *\t@returns {Element} dom\tThe created/mutated element\n *\t@private\n */\nexport function buildComponentFromVNode(dom, vnode, context, mountAll) {\n\tlet c = dom && dom._component,\n\t\toriginalComponent = c,\n\t\toldDom = dom,\n\t\tisDirectOwner = c && dom._componentConstructor===vnode.nodeName,\n\t\tisOwner = isDirectOwner,\n\t\tprops = getNodeProps(vnode);\n\twhile (c && !isOwner && (c=c._parentComponent)) {\n\t\tisOwner = c.constructor===vnode.nodeName;\n\t}\n\n\tif (c && isOwner && (!mountAll || c._component)) {\n\t\tsetComponentProps(c, props, ASYNC_RENDER, context, mountAll);\n\t\tdom = c.base;\n\t}\n\telse {\n\t\tif (originalComponent && !isDirectOwner) {\n\t\t\tunmountComponent(originalComponent, true);\n\t\t\tdom = oldDom = null;\n\t\t}\n\n\t\tc = createComponent(vnode.nodeName, props, context);\n\t\tif (dom && !c.nextBase) {\n\t\t\tc.nextBase = dom;\n\t\t\t// passing dom/oldDom as nextBase will recycle it if unused, so bypass recycling on L241:\n\t\t\toldDom = null;\n\t\t}\n\t\tsetComponentProps(c, props, SYNC_RENDER, context, mountAll);\n\t\tdom = c.base;\n\n\t\tif (oldDom && dom!==oldDom) {\n\t\t\toldDom._component = null;\n\t\t\trecollectNodeTree(oldDom);\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n\n\n/** Remove a component from the DOM and recycle it.\n *\t@param {Element} dom\t\t\tA DOM node from which to unmount the given Component\n *\t@param {Component} component\tThe Component instance to unmount\n *\t@private\n */\nexport function unmountComponent(component, remove) {\n\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\t// console.log(`${remove?'Removing':'Unmounting'} component: ${component.constructor.name}`);\n\tlet base = component.base;\n\n\tcomponent._disable = true;\n\n\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\tcomponent.base = null;\n\n\t// recursively tear down & recollect high-order component children:\n\tlet inner = component._component;\n\tif (inner) {\n\t\tunmountComponent(inner, remove);\n\t}\n\telse if (base) {\n\t\tif (base[ATTR_KEY] && base[ATTR_KEY].ref) base[ATTR_KEY].ref(null);\n\n\t\tcomponent.nextBase = base;\n\n\t\tif (remove) {\n\t\t\tremoveNode(base);\n\t\t\tcollectComponent(component);\n\t\t}\n\t\tlet c;\n\t\twhile ((c=base.lastChild)) recollectNodeTree(c, !remove);\n\t\t// removeOrphanedChildren(base.childNodes, true);\n\t}\n\n\tif (component.__ref) component.__ref(null);\n\tif (component.componentDidUnmount) component.componentDidUnmount();\n}\n","import { FORCE_RENDER } from './constants';\nimport { extend, clone, isFunction } from './util';\nimport { createLinkedState } from './linked-state';\nimport { renderComponent } from './vdom/component';\nimport { enqueueRender } from './render-queue';\n\n/** Base Component class, for the ES6 Class method of creating Components\n *\t@public\n *\n *\t@example\n *\tclass MyFoo extends Component {\n *\t\trender(props, state) {\n *\t\t\treturn <div />;\n *\t\t}\n *\t}\n */\nexport function Component(props, context) {\n\t/** @private */\n\tthis._dirty = true;\n\t// /** @public */\n\t// this._disableRendering = false;\n\t// /** @public */\n\t// this.prevState = this.prevProps = this.prevContext = this.base = this.nextBase = this._parentComponent = this._component = this.__ref = this.__key = this._linkedStates = this._renderCallbacks = null;\n\t/** @public */\n\tthis.context = context;\n\t/** @type {object} */\n\tthis.props = props;\n\t/** @type {object} */\n\tif (!this.state) this.state = {};\n}\n\n\nextend(Component.prototype, {\n\n\t/** Returns a `boolean` value indicating if the component should re-render when receiving the given `props` and `state`.\n\t *\t@param {object} nextProps\n\t *\t@param {object} nextState\n\t *\t@param {object} nextContext\n\t *\t@returns {Boolean} should the component re-render\n\t *\t@name shouldComponentUpdate\n\t *\t@function\n\t */\n\t// shouldComponentUpdate() {\n\t// \treturn true;\n\t// },\n\n\n\t/** Returns a function that sets a state property when called.\n\t *\tCalling linkState() repeatedly with the same arguments returns a cached link function.\n\t *\n\t *\tProvides some built-in special cases:\n\t *\t\t- Checkboxes and radio buttons link their boolean `checked` value\n\t *\t\t- Inputs automatically link their `value` property\n\t *\t\t- Event paths fall back to any associated Component if not found on an element\n\t *\t\t- If linked value is a function, will invoke it and use the result\n\t *\n\t *\t@param {string} key\t\tThe path to set - can be a dot-notated deep key\n\t *\t@param {string} [eventPath]\tIf set, attempts to find the new state value at a given dot-notated path within the object passed to the linkedState setter.\n\t *\t@returns {function} linkStateSetter(e)\n\t *\n\t *\t@example Update a \"text\" state value when an input changes:\n\t *\t\t<input onChange={ this.linkState('text') } />\n\t *\n\t *\t@example Set a deep state value on click\n\t *\t\t<button onClick={ this.linkState('touch.coords', 'touches.0') }>Tap</button\n\t */\n\tlinkState(key, eventPath) {\n\t\tlet c = this._linkedStates || (this._linkedStates = {});\n\t\treturn c[key+eventPath] || (c[key+eventPath] = createLinkedState(this, key, eventPath));\n\t},\n\n\n\t/** Update component state by copying properties from `state` to `this.state`.\n\t *\t@param {object} state\t\tA hash of state properties to update with new values\n\t */\n\tsetState(state, callback) {\n\t\tlet s = this.state;\n\t\tif (!this.prevState) this.prevState = clone(s);\n\t\textend(s, isFunction(state) ? state(s, this.props) : state);\n\t\tif (callback) (this._renderCallbacks = (this._renderCallbacks || [])).push(callback);\n\t\tenqueueRender(this);\n\t},\n\n\n\t/** Immediately perform a synchronous re-render of the component.\n\t *\t@private\n\t */\n\tforceUpdate() {\n\t\trenderComponent(this, FORCE_RENDER);\n\t},\n\n\n\t/** Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n\t *\tVirtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n\t *\t@param {object} props\t\tProps (eg: JSX attributes) received from parent element/component\n\t *\t@param {object} state\t\tThe component's current state\n\t *\t@param {object} context\t\tContext object (if a parent component has provided context)\n\t *\t@returns VNode\n\t */\n\trender() {}\n\n});\n","import { diff } from './vdom/diff';\n\n/** Render JSX into a `parent` Element.\n *\t@param {VNode} vnode\t\tA (JSX) VNode to render\n *\t@param {Element} parent\t\tDOM element to render into\n *\t@param {Element} [merge]\tAttempt to re-use an existing DOM tree rooted at `merge`\n *\t@public\n *\n *\t@example\n *\t// render a div into <body>:\n *\trender(<div id=\"hello\">hello!</div>, document.body);\n *\n *\t@example\n *\t// render a \"Thing\" component into #foo:\n *\tconst Thing = ({ name }) => <span>{ name }</span>;\n *\trender(<Thing name=\"one\" />, document.querySelector('#foo'));\n */\nexport function render(vnode, parent, merge) {\n\treturn diff(merge, vnode, {}, false, parent);\n}\n","// for making conditional class making easier in react\nexport const classMaker = (a, b, class_1, class_2) => a === b ? class_1: class_2\n","import { h, render, Component } from 'preact';\nimport './Tab.css'\nimport {classMaker} from '../../../utils';\n\nconst Tab = ({id, name, currentView, icon, changeView}) => {\n\n  const tabClasses = classMaker(currentView, id, 'Tab selected', 'Tab')\n  const iconClasses = classMaker(currentView, id, `${icon} tab-icon selected`, `${icon} tab-icon`)\n\n  return (\n    <button class={tabClasses} onClick={() => changeView(id)}>\n      <icon class={iconClasses} />\n      {name}\n    </button>\n  );\n};\n\nexport default Tab;","import { h, render, Component } from 'preact';\nimport './tabBar.css'\nimport Tab from './tab/tab';\n\n/**\n * List to iterate over and generate tab commponents with.\n */\nconst tabs = [\n  {name: \"Home\", id: \"home\", icon: \"fa fa-home\"},\n  {name: \"Add A Story\", id: \"story\", icon: \"fa fa-commenting-o\"},\n  {name: \"Filters\", id: \"filters\", icon: \"fa fa-map-marker\"},\n  {name: \"Read Stories\", id: \"read_stories\", icon: \"fa fa-eye\"},\n  {name: \"Selected Stories\", id: \"selected_stories\", icon: \"fa fa-commenting\"},\n  {name: \"About\", id:\"about\", icon: \"fa fa-clone\"},\n] \n\n\n/**\n * Constructs the menu tabs that are clickable. \n */\nconst TabBar = props => {\n  const renderTabs = () => {\n    return tabs.map(tab => {\n      return <Tab {...tab} currentView={props.currentView} changeView={props.changeView} />\n    })\n  }\n\n  return (\n    <div class=\"Tabbar\">\n      {renderTabs()}\n      <div class=\"Tabbar__fillspace\"></div>\n    </div>\n\n  );\n};\n\nexport default TabBar;\n","import { h, render } from 'preact';\nimport './styles.css'\n\nconst Header = props => {\n  const genClassName = () => {\n    switch(props.type){\n      case 'large':\n        return 'Header large'\n      default: \n        return 'Header'\n    }\n  }\n\n\n  return (\n    <div class={genClassName()} style={props.style}>\n     {props.children} \n    </div>\n  );\n};\n\nexport default Header;","import { h, render } from 'preact';\nimport './styles.css'\n\nconst Button = props => {\n  const genClassName = () => {\n    switch(props.buttonStyle){\n      case 'large':\n        return 'Button large'\n      case 'next':\n        return 'Button next'\n      default:\n        return 'Button'\n    }\n  }\n\n\n  return (\n    <button\n      type={props.type}\n      onClick={props.onClick}\n      class={genClassName()}\n      style={props.style}>\n     {props.children}\n    </button>\n  );\n};\n\nexport default Button;\n","import { h, render } from 'preact';\nimport './styles.css'\nimport Header from 'UiKit/Header/index';\nimport Button from 'UiKit/Button/index';\n\nconst Home = ({changeView}) => {\n  return (\n    <div>\n\n      {/* General Welcome Message  */}\n      <section class=\"Home__welcome\">\n\n      </section>\n\n      {/* Add a story CTA */}\n      <section class=\"Home__cta-addstory\">\n\n      <p>An annual celebration of the open Internet movement, where passionate technologists, educators, and makers come together to explore the future of the open Web and advocate for a healthy internet. This ripple map illustrates the many connections and outcomes that MozFest has fostered</p>\n\n      <p class=\"Home__cta_text\">We'd love to hear your stories!</p>\n\n        <Button onClick={() => changeView('story')}>\n          Add a story\n          <i class=\"fa fa-chevron-right pl_1\" aria-hidden=\"true\"></i>\n        </Button>\n\n        <a href=\"mailto:una@andalsotoo.net?subject=Someone added me to the Ripple Map without my consent&body=Please remove me, my name is:\">\n          <button >Someone put me in without my consent</button>\n        </a>\n\n      </section>\n\n    </div>\n  );\n};\n\nexport default Home;\n","import { h, render } from 'preact';\nimport Header from 'UiKit/Header/index';\n\nconst About = () => {\n  return (\n    <div>\n      <Header>What it is</Header>\n\n      <p>The Ripple Mapping Tool is an interactive data visualization platform for social movements and community organizers. It allows community members to tell stories about how events and programs impacted their lives, and generates “ripple maps” that show the long term outcomes of interconnected organizing efforts.</p>\n\n      <Header>Origins and inspiration</Header>\n\n      <p>The tool began as a static infographic poster design that demonstrated the many outcomes from the Difference Engine Initiative, a women-in-games program in Toronto. As the poster evolved into this app, we drew inspiration from philosopher and activist Grace Lee Boggs, who wrote, “We never know how our small activities will affect others through the invisible fabric of our connectedness. In this exquisitely connected world, it’s never a question of ‘critical mass.’ It’s always about critical connections.” The Ripple Map demonstrates that it is strong relationships that move progress forward.</p>\n\n      <Header>Nuts & Bolts</Header>\n\n      <p>The Ripple Mapping Tool is a web-based platform, with most of the logic happening in the browser aided by a tiny NodeJS server for persistence. It uses an in-memory graph database for the semantic graph (individual words are vertices, connections are edges), a configurable rendering pipeline for the story visualization (previously canvas-based, now svg), a similar pipeline for textual rendering (stories are rendered into sentences from the raw graph data), and has a custom layout algorithm for building the story visualization. The UI wrapper is Preact, a minimalistic version of React.</p>\n\n      <Header>Credits</Header>\n\n      <p>Lead designer: Una Lee</p>\n      <p>Lead developer: Dann Toliver</p>\n      <p>Interactive designer: Lupe Pérez</p>\n      <p>Front end developer: Tyler Sloane</p>\n    </div>\n  );\n};\n\nexport default About;\n","const state = {}\nexport default state\n\nstate.org = 2 // this changes per branch...\n\nstate.tags = [] // THINK: default to ['plain']?\nstate.facts = []\nstate.tagkeys = {}\nstate.query = {}\n\nstate.safe_mode = false\n\nstate.all_edges        = true  // awkward... :(\nstate.admin_mode       = false // yep another hack w00t\nstate.my_maxyear       = 2017  // total hackery...\nstate.my_minyear       = 2010  // hack hack hack\nstate.show_labels      = false // yup\nstate.current_year     = 2017  // more hacks\nstate.filter_sentences = false // awkward... :(\nstate.ring_radius      = 30    // lalala\n","import {G} from 'graph'\nimport state from 'state'\n\nexport {add_to_server_facts, persist, get_facts_from_server}\n\n\nlet loaded = false\n\nfunction add_to_server_facts(type, live_item) {\n  if(!loaded)\n    return undefined // can't save facts until you have all the facts\n\n  /*\n\n   data model:\n   user: id\n   action: add/remove/edit\n   type: node/edge\n   tags: [...]\n   [maybe other stats can live here?]\n   data:\n     node: {id, name, type, cat...}\n     edge: {_in, _out, type, label}\n\n   */\n\n  // var item = JSON.parse(JSON.stringify(live_item))\n  var item = Object.keys(live_item).reduce(function(acc, key) {\n        if(['_in', '_out'].indexOf(key) !== -1) return acc\n        acc[key] = live_item[key]\n        return acc\n      }, {})\n\n  if(type === 'edge') {\n    item._out = live_item._out._id\n    item._in  = live_item._in._id\n  }\n\n  // FIXME: present splash page of some kind\n\n  var fact = { email: state.email\n             , action: 'add'\n             , type: type\n             , tags: state.tags\n             , data: item\n             }\n\n  send_data_to_server(fact)\n}\n\nfunction persist() {\n  // THINK: do we still need localstorage caching?\n  Dagoba.persist(G, 'rripplemap')\n}\n\npersist = debounce(persist, 1000)\n\nfunction debounce(func, wait, immediate) {\n  // via underscore, needs cleaning\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n\n  var timeout\n  return function() {\n    var context = this, args = arguments\n    var later = function() {\n          timeout = null\n          if (!immediate) func.apply(context, args)\n        }\n    var callNow = immediate && !timeout\n    clearTimeout(timeout)\n    timeout = setTimeout(later, wait)\n    if (callNow) func.apply(context, args)\n  }\n}\n\nfunction send_data_to_server(data, cb) {\n  var url = 'http://ripplemap.io:8888'\n\n  if(state.safe_mode === 'daring') {\n    url = 'http://localhost:8888'\n  }\n  else if(state.safe_mode) {\n    return console.log(G)\n  }\n\n  fetch(url, { method: 'post'\n             , body: JSON.stringify(data)\n             })\n  .then(response => response.json())\n  .then(result   => cb ? cb(result) : null)\n}\n\nfunction get_facts_from_server(cb) {\n  var url = 'http://ripplemap.io:8888'\n  var org = state.org || 1\n\n  // local shunt for airplane mode\n\n  if(state.safe_mode === 'local')\n    return cb(JSON.parse(localStorage['DAGOBA::ripmapdata']))\n\n  if(state.safe_mode === 'daring')\n    url = 'http://localhost:8888'\n\n  url += '?org=' + org\n\n  fetch(url, { method: 'get'})\n  .then(response => response.json())\n  .then(data => cb(data))\n  .then(data => {loaded = true; return data})\n  .catch(err => console.log('lalalal', err))\n}\n","// Some fun functions that help or something\n\nexport {noop, not, eq, unique, strip, comp, prop, cp_prop, clone, truncate, push_it, pipe, error}\n\n\nfunction noop() {}\n\nfunction not(fun) {return function() {return !fun.apply(null, arguments)}}\n\nfunction eq(attr, val) {return function(obj) {return obj[attr] === val}}\n\nfunction unique(v, k, list) {return list.indexOf(v) === k}\n\nfunction strip(attr) {return function(obj) { delete obj[attr]; return obj }}\n\nfunction comp(f, g) {return function() { var args = [].slice.call(arguments); return f(g.apply(null, args)) }}\n\nfunction prop (attr) {return function(obj) {return obj[attr]}}\n\nfunction cp_prop(from_attr, to_attr) {return function(obj) {obj[to_attr] = obj[from_attr]; return obj}}\n\nfunction clone(obj) {return JSON.parse(JSON.stringify(obj))}\n\nfunction truncate(str, to) {\n  if(!to || str.length <= to) return str\n  return str.substr(0, to-2) + '...'\n}\n\nfunction push_it(list, key, val) {\n  if(!list[key])\n    return list[key] = [val]\n\n  list[key].push(val)\n  return list[key]\n}\n\nfunction pipe() {\n  var all_funs = [].slice.call(arguments)\n\n  function magic_pipe(data) {\n    var funs = all_funs.slice()\n    var fun\n\n    function inner() {\n      while(fun = funs.shift()) {\n        if(fun.async) {              // fun is async\n          return fun.async(data, cb)\n        } else {                     // fun is a function\n          data = fun(data)\n        }\n      }\n    }\n\n    function cb(new_data) {\n      data = new_data\n      inner()\n    }\n\n    // TODO: this should return a promise for data\n    inner()\n    return data\n  }\n\n  return magic_pipe\n}\n\nfunction error(mess) {\n  console.log(arguments, mess)\n}\n","import {G} from 'graph'\nimport {error, clone} from 'fun'\nimport {add_to_server_facts} from 'net'\n\nexport const cats = {} // ripplemap categories\nexport const adders = {thing: add_thing, action: add_action, edge: add_edge}\nexport {add_thing, add_action, add_edge}\n\n\n/* INTERFACES FOR RIPPLE MODEL\n *\n * There are four categories: Thing, Action, Effect, and Happening\n *\n * Each category has multiple types associated with it. Each node has a category and type.\n *\n * Each node also tracks its cron, the adding user, and some type of 'confidence interval' (later)\n *\n * Each edge has a type, which is its label. Nodes expect edges of certain types.\n *\n */\n\ncats.thing = {}\ncats.action = {}\ncats.effect = {}\ncats.happening = {}\n\nfunction get_node(catstr, typestr, props) {\n  var node = convert_props(props)\n\n  var cat = cats[catstr]\n  if(!cat)\n    return error('that is not a valid cat', catstr)\n\n  var type = cat[typestr]\n  if(!type)\n    return error('that is not a valid ' + catstr + ' type', typestr)\n\n  // TODO: check props again the cattype's property list\n\n  node.cat  = catstr\n  node.type = typestr\n  node.name = props.name || typestr // TODO: remove (or something...)\n\n  return node\n}\n\nfunction add_alias(catstr, typestr, alias) {\n  // TODO: check alias\n\n  // add an alias to anything\n  var cat = cats[catstr]\n  if(!cat)\n    return error('Invalid cat', catstr)\n\n  var type = cat[typestr]\n  if(!type)\n    return error('That is not a valid thing type', typestr)\n\n  // add alias\n  type.aliases.push(alias)\n\n  // add type to list\n  cat[alias] = type\n\n  // THINK: alias rules?\n}\n\n\nfunction add_thing(type, props, persist) {\n  var node = get_node('thing', type, props)\n  if(!node) return false\n\n  node.priority = 1 // bbq???\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n\n  return node\n}\n\nfunction add_action(type, props, persist) {\n  var node = get_node('action', type, props)\n  if(!node) return false\n\n  node.priority = 1 // bbq???\n\n  // TODO: check props against type (what does this mean?)\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n\n  return node\n}\n\nfunction add_effect(type, props, persist) {\n  var node = get_node('effect', type, props)\n  if(!node) return undefined\n\n  node.priority = 0.5 // bbq???\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n}\n\nfunction add_happening(type, props, persist) {\n  var node = get_node('happening', type, props)\n  if(!node) return undefined\n\n  node.priority = 0.4\n\n  add_to_graph('node', node)\n  if(persist)\n    add_to_server_facts('node', node)\n}\n\n\n\nfunction new_thing_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.thing[type]\n  if(cattype)\n    return error('That thing type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // add properties.cc\n  // NOTE: cc means 'can connect', it's used to limit illogical causality\n  cattype.cc = properties.cc || {}\n\n  // add default props for all things\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.props.name = {}\n  cattype.props.start = {} // THINK: these have both fuzziness and confidence issues (how sure is the user of the time, how sure are we of the user)\n  cattype.props.end = {}\n\n  // TODO: add questions\n\n  // put in place\n  cats.thing[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('thing', type, alias)\n    })\n  }\n}\n\nfunction new_action_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.action[type]\n  if(cattype)\n    return error('That action type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.did = {dir: 'in',  plural: 0, label: 'did', types: ['person'], aliases: []}\n  cattype.edges.to  = {dir: 'in',  plural: 0, label: 'to',  types: ['effect'], aliases: []}\n  cattype.edges.the = {dir: 'out', plural: 0, label: 'the', types: ['thing'],  aliases: []}\n\n  // add default props for all actions\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.action[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('action', type, alias)\n    })\n  }\n}\n\nfunction new_effect_type(type, properties) {\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.effect[type]\n  if(cattype)\n    return error('That effect type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.to     = {dir: 'out', plural: 0, label: 'to',     types: ['action'],    aliases: []}\n  cattype.edges.by     = {dir: 'in',  plural: 1, label: 'by',     types: ['thing'],     aliases: []}\n  cattype.edges.was    = {dir: 'in',  plural: 1, label: 'was',    types: ['person'],    aliases: []}\n  cattype.edges.during = {dir: 'out', plural: 0, label: 'during', types: ['happening'], aliases: []}\n\n  // add default props for all effects\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.effect[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('effect', type, alias)\n    })\n  }\n}\n\nfunction new_happening_type(type, properties) {\n  // what properties do happenings have?\n  // an edge type can have an alias for storytelling purposes\n\n  // TODO: valid type?\n\n  // does this type exist already?\n  var cattype = cats.happening[type]\n  if(cattype)\n    return error('That happening type already exists', type)\n\n  // manually create\n  // THINK: should we copy properties here?\n  cattype = {type: type}\n\n  // add properties.edges and default edges\n  cattype.edges = properties.edges || {}\n  cattype.edges.at     = {dir: 'out', plural: 0, label: 'at',     types: ['place',   'event'], aliases: []}\n  cattype.edges.the    = {dir: 'out', plural: 1, label: 'the',    types: ['outcome', 'event'], aliases: []}\n  cattype.edges.did    = {dir: 'in',  plural: 1, label: 'did',    types: ['person'],           aliases: []}\n  cattype.edges.during = {dir: 'in',  plural: 0, label: 'during', types: ['effect'],           aliases: []}\n\n  // add default props for all happenings\n  cattype.props = {} // THINK: get props from properties.props?\n  cattype.aliases = [] // THINK: but if you do don't override properties.aliases\n\n  // TODO: add questions\n\n  // put in place\n  cats.happening[type] = cattype\n\n  // add properties.aliases\n  if(properties.aliases) {\n    properties.aliases.forEach(function(alias) {\n      add_alias('happening', type, alias)\n    })\n  }\n}\n\n\nfunction new_edge_type(type, properties) {\n  // what properties do edges have?\n}\n\nfunction add_edge(type, from, to, props, persist) {\n  var edge = {}\n\n  // check from and to\n  // check type against from and to interfaces\n  // publish in dagoba + persist\n\n  edge = convert_props(props)\n  edge._in = to\n  edge._out = from\n  edge.type = type\n  edge.label = type\n\n  // THINK: if Dagoba supported proper subgraphs, we could have RM.facts and RM.G and keep them fully in sync, instead of limiting RM.G to just the \"viewable\" facts. we'll need a new RM.GG or something for the currently viewable subgraph. this would also help with all the duplicate node warning messages, cut down on allocations, and allow a pipeline based around building new graphs (or extending/syncing the main graph from the factbase). so facts_to_graph would take a graph and some facts and put them together, or something. or as you add new facts they're automatically ramified into the graph. or fizzlemorts.\n\n  add_to_graph('edge', edge)\n  if(persist)\n    add_to_server_facts('edge', edge)\n}\n\nfunction import_graph(V, E) {\n  // add V things\n  // add V happenings\n  // add edges\n}\n\nfunction extract_story(V, E) {\n  // given a subgraph, extract a \"story\"\n}\n\nfunction story_to_text(story) {\n  // what is a story?\n  // how do we turn it into text?\n}\n\nfunction subgraph_of(thing1, thing2) {\n  // find all the paths between them, and their attached bits\n}\n\n\n// SET UP CATEGORIES AND EDGES\n\nnew_thing_type('person',  {})\nnew_thing_type('program', {})\nnew_thing_type('job',     {aliases: ['contract']})\nnew_thing_type('org',     {cc: ['org']})\nnew_thing_type('place',   {cc: ['place', 'event']})\nnew_thing_type('event',   {cc: ['event', 'outcome'], timerange: true}) // already has start and end, so... ?\nnew_thing_type('outcome', {cc: ['outcome'], aliases: ['artwork', 'session']}) // local vs ubiquitous outcomes -- they're structurally different\n\nnew_action_type('pass',      {aliases: []})\nnew_action_type('join',      {aliases: []})\nnew_action_type('leave',     {aliases: []})\nnew_action_type('create',    {aliases: ['make', 'write', 'created']})\nnew_action_type('attend',    {aliases: ['attended', 'participate in', 'participated in']})\nnew_action_type('manage',    {aliases: ['run', 'lead', 'facilitate', 'coordinate', 'organize', 'organized']})\nnew_action_type('assist',    {aliases: ['help', 'host', 'contribute', 'wrangled at']})\nnew_action_type('present',   {aliases: ['presented', 'presented at']})\nnew_action_type('represent', {aliases: []})\nnew_action_type('fund',      {aliases: ['funded']})\nnew_action_type('inspire',   {aliases: ['inspired']})\nnew_action_type('invite',    {aliases: ['invited']})\nnew_action_type('meet',      {aliases: ['met']})\n\n\nvar options = ['attended', 'participated in', 'funded', 'organized', 'inspired', 'invited', 'met', 'created', 'presented']\n\n\nnew_effect_type('inspire',   {aliases: ['influenced']})\nnew_effect_type('convince',  {aliases: ['ask']})\nnew_effect_type('introduce', {aliases: ['meet']})\n\nnew_happening_type('conversation', {aliases: []})\nnew_happening_type('experience',   {aliases: ['see', 'hear', 'watch', 'attend']})\n\n\n\n// MODEL HELPERS\n\n\nfunction add_to_graph(type, item) {\n  if(type === 'node') {\n    // TODO: this is kind of a hack, but also kind of not\n    if(!item._id)\n      item._id = get_new_id()\n    G.addVertex(item)\n  }\n\n  if(type === 'edge') {\n    G.addEdge(item)\n  }\n}\n\nfunction get_new_id() {\n  // TODO: swap this out for maybe a mongo_id implementation\n  return (\"\" + Math.random()).slice(2)\n}\n\nfunction convert_props(props) {\n  if(typeof props !== 'object')\n    return {}\n\n  if(Array.isArray(props))\n    return {}\n\n  return clone(props)\n}\n","/*global Dagoba */\n\nimport state from 'state'\nimport {get_facts_from_server} from 'net'\nimport {adders, add_edge} from 'model'\nimport {force_rerender} from 'render'\n\nexport let G = Dagoba.graph()\nexport {addtag, removetag, add_data}\n\n\nfunction addtag(tag) {\n  state.tags.push(tag)\n  G = Dagoba.graph() // THINK: can we thread this through instead?\n  fact_to_graph(state.facts)\n  force_rerender()\n}\n\nfunction removetag(tag) {\n  var index = state.tags.indexOf(tag)\n  if(index === -1)\n    return undefined\n\n  state.tags.splice(index, 1)\n  G = Dagoba.graph() // THINK: can we thread this through instead?\n  fact_to_graph(state.facts)\n  force_rerender()\n}\n\n// function reset_graph() {\n//   G = Dagoba.graph()\n// }\n\nfunction add_data(cb) {\n  get_facts_from_server(function(facts) {\n    if(Array.isArray(facts))\n      cb(fact_to_graph(capture_facts(facts)))\n    else\n      cb(facts) // already a graph, from localStorage\n  })\n}\n\nfunction capture_facts(facts) {\n  state.facts = facts\n  return facts\n}\n\nfunction fact_to_graph(facts) {\n  /*\n\n   data model:\n   user: id\n   action: add/remove/edit\n   type: node/edge\n   tags: [...]\n   org: id\n   [maybe other stats can live here?]\n   data:\n   node: {id, name, type, cat...}\n   edge: {_in, _out, type, label}\n\n   */\n\n  var tree = factor_facts(filter_facts(facts))\n  state.tagkeys = get_tagkeys(facts)\n\n  tree.nodes.add.forEach(function(node) {\n    // var fun = window['add_' + node.cat] // FIXME: ugh erk yuck poo\n    var fun = adders[node.cat]\n    if(!fun) return undefined\n    fun(node.type, node)\n  })\n\n  tree.edges.add.forEach(function(edge) { // we need to delay these so the nodes are all in place (sometimes the facts get added in weird orders)\n    add_edge(edge.type, edge._out, edge._in, edge)\n  })\n\n  tree.nodes.edit.forEach(function(node) {\n    // FIXME: what on earth is this??? should it be G.edit?\n    // RM.graph.edit(node) //////\n  })\n}\n\nfunction get_tagkeys(facts) {\n  var keys = {}\n  facts.forEach(function(fact) {\n    if(fact.action !== 'add') return undefined\n\n    ~(fact.tags||[]).forEach(function(tag) {\n      if(tag)\n        keys[tag] = true\n    })\n  })\n  return keys\n}\n\nfunction filter_facts(facts) {\n  facts = facts.filter(function(fact) {\n    return !!set_intersect(fact.tags, state.tags).length // THINK: this implies no empty tag arrays (so 'plain' as default?)\n  })\n\n  return facts\n}\n\nfunction factor_facts(facts) {\n  var tree = {nodes: {add: [], edit: [], remove: []}, edges: {add: [], edit: [], remove: []}}\n  facts.forEach(function(fact) {\n    // var branch = tree[fact.type+'s']\n    // var list = branch[fact.action] || []\n    // if(!branch[fact.action])\n    //   branch[fact.action] = list\n    var list = tree[fact.type+'s'][fact.action] || [] // TODO: error handling\n\n    // var item = clone(fact.data)\n    var item = fact.data // THINK: is mutating here okay?\n    item.org = fact.org\n    item.user = fact.user\n    item.tags = fact.tags\n    list.push(item)\n  })\n  return tree\n}\n\nfunction set_intersect(xs, ys) {\n  return xs.filter(function(x) {\n    return ys.indexOf(x) !== -1\n  })\n}\n","import {add_thing, add_action, add_edge} from 'model'\n// import * as dom from 'dom'\nimport {G} from 'graph'\nimport {force_rerender} from 'render'\nimport {error} from 'fun'\n\n\nexport let convo = new_conversation()\nexport {update_conversation, restart_sentence}\n\nfunction restart_sentence() {\n  convo.current = new_sentence()\n  force_rerender()\n}\n\nfunction update_conversation(values, conversation) {\n  var conversation = conversation || convo\n\n  var wants = conversation.current.slots[0].key\n  var value = values && values[wants] || false\n  // var value = dom.el(wants).value\n\n  convo = fulfill_desire(conversation, value)\n\n  return convo\n}\n\nfunction new_sentence() {\n  var slots = [ {key: 'subject', type: 'word', cat: 'thing'}\n              , {key: 'verb', type: 'word', cat: 'action'}\n              , {key: 'object', type: 'word', cat: 'thing'}\n              , {key: 'date', type: 'date'}\n              ]\n  return {slots: slots, filled: []}\n}\n\nfunction new_conversation() {\n  var sentence = new_sentence()\n  return {sentences: [], current: sentence}\n}\n\nfunction fulfill_desire(conversation, value) {\n  var conversation = conversation || convo\n\n  var sentence = give_word(conversation.current, value)\n\n  // TODO: allow multi-sentence conversations\n\n\n  if(!sentence.slots.length) {\n    var subject, verb, object, date\n    sentence.filled.forEach(function(slot) {\n      if(slot.type === 'gettype') {\n        var thing = add_thing(slot.value, {name: slot.name}, true)\n        if(slot.oldkey === 'subject') subject = thing\n        if(slot.oldkey === 'object' ) object  = thing\n      }\n      else if(slot.type === 'date') {\n        date = slot.value\n      }\n      else if(slot.key === 'subject') {\n        subject = slot.word\n      }\n      else if(slot.key === 'object') {\n        object = slot.word\n      }\n      else if(slot.key === 'verb') {\n        verb = (slot.word||{}).type || slot.value\n      }\n    })\n\n    if(subject && verb && object) {\n      verb = add_action(verb, {time: new Date(date).getTime() }, true)\n      add_edge('the', verb._id, object._id, 0, true)\n      add_edge('did', subject._id, verb._id, 0, true)\n    }\n\n    // start over\n    // TODO: show the sentence\n    // conversation = new_conversation()\n    conversation.sentences.push(sentence)\n    restart_sentence()\n    // conversation.current = new_sentence()\n\n    // force_rerender()\n  }\n\n  return conversation\n}\n\nfunction give_word(sentence, value) {\n  var slot = sentence.slots.shift()\n  if(!slot)\n    return error('This sentence is finished')\n\n  // TODO: check this logic modularly\n  if(slot.type === 'word') {\n    var word = G.v({name: value, cat: slot.cat}).run()[0]\n    if(word) {\n      slot.word = word\n    }\n  }\n\n  if(slot.cat === 'thing') {\n    if(slot.type === 'word') {\n      if(!slot.word) {\n        sentence.slots.unshift({key: 'type', type: 'gettype', name: value, cat: slot.cat, oldkey: slot.key})\n      }\n    }\n    else if(slot.type === 'gettype') {\n      // var nameslot = sentence.filled[sentence.filled.length-1]\n    }\n  }\n\n  // fix it in post\n  slot.value = value\n  sentence.filled.push(slot)\n\n  return sentence\n}\n","// this does some dom things\n\nimport state from 'state'\nimport {G, addtag, removetag} from 'graph'\nimport {update_conversation} from 'convo'\nimport {error, noop} from 'fun'\nimport {persist} from 'net'\nimport {force_rerender, showtags, whatsnext} from 'render'\n\n\nexport {set_el, append_el}\n\nexport const el = function() {\n  const els = {}\n  const default_el = {addEventListener: noop, removeEventListener: noop}\n\n  return function(el_id) {\n    // NOTE: removing caching for now to deal with vdom\n    // if(els[el_id])\n    //   return els[el_id]\n    els[el_id] = document.getElementById(el_id) || default_el\n    return els[el_id]\n  }\n}()\n\nfunction set_el(el_id, val) {\n  el(el_id).innerHTML = val\n}\n\nfunction append_el(el_id, val) {\n  el(el_id).innerHTML += val\n}\n\n\n\n// LOGIN/ORG/TAG STUFF\n\nexport function login(e) {\n  e.preventDefault()\n  state.email = el('email').value\n\n  const name = el('name').value\n  const verb = el('mz_involved').value\n  let values = { subject: name\n               , type: 'person'\n               , verb: verb\n               , object: 'MozFest 2017'\n               , date: '2017-10-26'\n               }\n  update_conversation(values)\n  update_conversation(values)\n  update_conversation(values)\n  update_conversation(values)\n  update_conversation(values)\n\n  force_rerender()\n\n  // el('login').classList.add('hide')\n  // el('storytime').classList.remove('hide')\n}\n\n\n\n\n// INTERACTIONS & DOM BINDINGS\n\nexport function click_tagnames(ev) {\n  ev.preventDefault()\n  var target = ev.target\n  var tag = target.innerText\n  if(!tag) return undefined\n  removetag(tag)\n\n  force_rerender()\n  showtags()\n}\n\nexport function global_keydown(ev) {\n  // TODO: clean this up (prevent span hijacking)\n  if( ev.target.tagName === 'SPAN'\n   || ev.target.tagName === 'INPUT'\n   || ev.target.tagName === 'SELECT'\n   || ev.target.tagName === 'TEXTAREA'\n    )\n    return true\n\n  var key = ev.keyCode || ev.which\n\n  // var key_a = 97\n  var key_e = 69\n  var key_f = 70\n  var key_l = 76\n  var key_n = 78\n  var key_p = 80\n  // var key_s = 115\n  var tilde = 126\n  var larro = 37\n  var uarro = 38\n  var rarro = 39\n  var darro = 40\n  // var langl = 60\n  // var rangl = 62\n\n  if(key === larro || key === darro || key === key_p) {\n    ev.preventDefault()\n    if(state.current_year <= state.my_minyear) return false\n    state.current_year--\n    force_rerender()\n  }\n\n  if(key === rarro || key === uarro || key === key_n) {\n    ev.preventDefault()\n    if(state.current_year >= state.my_maxyear) return false\n    state.current_year++\n    force_rerender()\n  }\n\n  if(key === key_f) {\n    state.filter_sentences = !state.filter_sentences\n    force_rerender()\n  }\n\n  if(key === key_e) {\n    state.all_edges = !state.all_edges\n    force_rerender()\n  }\n\n  if(key === key_l) {\n    state.show_labels = !state.show_labels\n    force_rerender()\n  }\n\n  if(key === tilde) {\n    state.admin_mode = !state.admin_mode\n    force_rerender()\n  }\n}\n\nexport function submit_addtag(ev) {\n  ev.preventDefault()\n  addtag(el('othertags').value)\n\n  force_rerender()\n  showtags()\n}\n\nexport function keyup_sentences(ev) {\n  // var key = ev.keyCode || ev.which\n  var span = ev.target\n  var type = span.classList.contains('edge') ? 'edge' : 'cat'\n  var val = span.textContent\n  var id = span.getAttribute('data-id')\n\n  // TODO: trap return for special effects\n  // TODO: maybe trap tab also\n\n  // ev.preventDefault()\n\n  // handle the node case\n  if(type === 'cat' && id && val) {\n    var node = G.vertexIndex[id]\n    if(node && node.name !== val) {\n      // update the name/label in the real graph\n      node.name = val\n      pub(id)\n    }\n  }\n\n  // handle the edge case\n  if(type === 'edge') {\n    var id1 = span.getAttribute('data-id1')\n    var id2 = span.getAttribute('data-id2')\n\n    var node1 = G.vertexIndex[id1]\n    var edges = node1._in.concat(node1._out)\n    var edge = edges.filter\n      (function(edge)\n        {return ( edge._in._id === id1 && edge._out._id === id2 )\n             || ( edge._in._id === id2 && edge._out._id === id1 ) })[0]\n\n    if(!edge) return undefined\n\n    edge.label = val\n    edge.type = val\n\n    // pub(id1 + '-' + id2)\n    // Dagoba.persist(G, 'rripplemap')\n    persist()\n  }\n\n  function pub(id) {\n    // publish the change\n    // Dagoba.persist(G, 'rripplemap')\n    persist()\n\n    // update all other sentences\n    var spans = document.querySelectorAll('span.node-' + id)\n    for(var i = 0; i < spans.length; i++) {\n      if(spans[i] !== span)\n        spans[i].textContent = val\n    }\n\n    // rerender the graph\n    force_rerender(0)\n  }\n\n}\n\nexport function click_sentences(ev) {\n  var target = ev.target\n  if(target.nodeName !== 'BUTTON')\n    return true\n\n  var id = target.getAttribute('data-id')\n  var node = G.vertexIndex[id]\n\n  if(!node)\n    return error('That node does not exist')\n\n  if(node.cat === 'action') { // remove \"sentence\"\n    G.removeVertex(node)\n  }\n  else {\n    G.removeVertex(node) // THINK: is this really reasonable?\n  }\n\n  persist()\n  force_rerender()\n}\n\nexport function submit_convo(ev) {\n  ev.preventDefault()\n\n  // submit event to field key-value list:\n  let fields = [...ev.currentTarget.elements]\n  let values = fields.reduce((acc, el) => {acc[el.id] = el.value; return acc}, {})\n\n  if(!Object.keys(values).reduce((acc, k) => acc + values[k], '')) // no values? don't submit\n    return false\n\n  update_conversation(values)\n\n  // whatsnext(G, update_conversation())\n\n  force_rerender()\n}\n","import {G} from 'graph'\nimport * as dom from 'dom'\nimport {unique} from 'fun'\nimport {force_rerender} from 'render'\n\nexport {activate, deactivate, highlightz, unhighlight, add_svg_listeners}\n\n\nfunction do_for_edge(f, e) {\n\n}\n\n\nfunction activate(vertex) {\n  vertex.active = true\n}\n\nfunction deactivate(vertex) {\n  delete vertex.active\n}\n\nfunction highlight(vertex) {\n  vertex.highlight = true\n}\n\nfunction unhighlight(vertex) {\n  delete vertex.highlight\n}\n\n\n\n\n\n\nfunction add_svg_listeners(edges, nodes) {\n\n  // add listeners\n  function highlight_edge(e) {\n    let id = e.target.id\n    let ids = id.split('-')\n    if(!ids[0]) return undefined\n\n    // var fun = function(v) {return ~ids.indexOf(v._id)}\n    // highlightyo(fun)\n    highlightyo(ids)\n  }\n\n  let edge_click = highlight_edge\n  let edge_hover = highlight_edge\n\n  let good_edges = edges.filter(id => true)\n  good_edges.map(id => dom.el(id).addEventListener('click', edge_click))\n  good_edges.map(id => dom.el(id).addEventListener('mouseover', edge_hover))\n\n\n  function highlight_node(e) {\n    let id = e.target.id\n    if(!id) return undefined\n\n    let ids = G.v(id).both().both().run().map(x => x._id).filter(unique)\n    // var fun = function(v) {return ~ids.indexOf(v._id)}\n\n    setTimeout(x => highlightyo(ids), 300) // TODO: this is so weird\n  }\n\n  function activate_node(e) {\n    let id = e.target.id\n    if(!id) return undefined\n\n    let ids = G.v(id).both().both().run().map(x => x._id).filter(unique)\n    // var fun = function(v) {return ~ids.indexOf(v._id)}\n    highlightyo(ids, 'activate')\n  }\n\n  let node_click = activate_node\n  let node_hover = highlight_node\n\n  let good_nodes = nodes.filter(id => +id)\n  good_nodes.map(id => dom.el(id).addEventListener('click', node_click))\n  good_nodes.map(id => dom.el(id).addEventListener('mouseover', node_hover))\n}\n\n\n\n\nlet highlight_target = ''\nlet highlight_fun = ''\n\nexport function activate_highlighter() {\n  highlight_fun = dom.el('sentences').addEventListener('mousemove', highlight_event)\n}\n\nexport function deactivate_highlighter() {\n  dom.el('sentences').removeEventListener('mousemove', highlight_fun)\n}\n\nfunction highlight_event(e) {\n  for(var t=e.target; t && t.matches; t = t.parentNode) {\n    if(t.matches('.sentence')) {\n      if(highlight_target === t)\n        return undefined\n\n      highlight_target = t\n      var ids = [].slice.call(t.children).map(node => node.dataset.id).filter(Boolean)\n      // var fun = function(v) {return ~ids.indexOf(v._id)}\n      // ids.forEach(id => G.v(id).run()[0].highlight = true)\n      // render()\n      highlightyo(ids)\n      return undefined\n    }\n  }\n}\n\nfunction highlightyo(o_or_f, action='highlight') {\n  var current = action === 'activate' ? G.v({active:    true}).run()\n                                      : G.v({highlight: true}).run()\n\n\n  current.forEach(function(node) {\n    if(action === 'activate')\n      deactivate(node)\n    else\n      unhighlight(node)\n  })\n\n  if(!o_or_f || !o_or_f.length) {\n    force_rerender()\n    return undefined\n  }\n\n  if(typeof o_or_f === 'function') {\n    current = G.v().filter(o_or_f).run()\n  } else {\n    current = G.v(o_or_f).run()\n  }\n\n  current.forEach(function(node) {\n    if(action === 'activate')\n      activate(node)\n    else\n      highlight(node)\n  })\n\n  force_rerender()\n}\n\n\nexport function mouseover_tagnames(ev) {\n  var target = ev.target\n  var tag = target.innerText\n\n  if(!tag)\n    return undefined\n\n  if(highlight_target === tag)\n    return undefined\n\n  highlight_target = tag\n  highlightyo(function(v) { return ~v.tags.indexOf(tag) })\n}\n\nexport function mouseout_tagnames(ev) {\n  if(!highlight_target)\n    return undefined\n\n  highlight_target = false\n  highlightyo()\n}\n\n\n\n\n// HIGHLIGHT MODULE\n\n/*\n  So there's at least two kinds of highlighting:\n  - click on a node in the viz (or cmd-click a story node?) to 'activate' it\n  - mouseover a node/edge in the viz or stories to 'highlight' it\n\n  highlighting is temporary, and makes a visual difference in all copies of the impacted nodes/edges\n\n  activation lasts until deactivation (another subgraph is activated, or everything is deactivated)\n\n  in either case, we should be adding that knowledge to the graph so it can be rendered correctly everywhere\n\n\n  functions:\n  activate(node_or_edge)\n  highlight(node_or_edge)\n\n  do_for_edge(f, e)\n  do_for_connected_nodes(f, e) // this is based on the current rendering... :[\n\n  need to add listeners to things... where should those live? in preact?\n*/\n","import {G} from 'graph'\nimport {eq, prop, clone, truncate, push_it, pipe} from 'fun'\nimport * as dom from 'dom'\nimport * as highlight from 'highlight'\nimport {convo} from 'convo'\nimport {cats} from 'model'\nimport state from 'state'\n\nexport {init, force_rerender, add_renderer, get_sentence_html, get_viz_html, get_convo_html, get_tag_html, showtags, whatsnext, get_active_sentence_html}\n\nconst renderers = []\nfunction add_renderer(f) {\n  renderers.push(f)\n}\n\nlet render_requested = false\n\nfunction force_rerender() {\n  if(render_requested) return undefined\n  render_requested = true\n\n  window.requestAnimationFrame(() => {\n    render_requested = false\n    renderers.forEach(f => f(state))\n  })\n}\n\n\n\n// function render_all() {\n//   render()\n//   render_conversation(conversation)\n//   showtags()\n// }\n\n\n// TODO: break this up more, make canvas and svg renderers into imported modules (w/ dom ctx as input to canvas one)\n\nconst ctx = dom.el('ripples').getContext('2d')\n\nvar viz_pipe, word_pipe, wyrd_pipe\n\n\n// RENDER PIPELINE\n\nfunction init() {\n  // TODO: consider a workflow for managing this tripartite pipeline, so we can auto-cache etc\n  viz_pipe = pipe( mod('data', sg_compact)\n                 , mod('data', likenamed)\n                 , mod('data', cluster)\n                 , mod('data', Dagoba.cloneflat)\n                   // layout:\n                 , set_year\n                 , data_to_graph\n                 , add_fakes\n                 , set_coords\n                 , set_score\n                 , minimize_edge_length\n                 , remove_fakes\n                 , unique_y_pos\n                 , filter_by_year\n                 , filter_nodes\n                   // shapes:\n                 , add_rings\n                 , add_ring_labels\n                 , copy_edges\n                 , copy_nodes\n                 , add_node_labels\n                 , add_edge_labels\n                   // rendering:\n                 , clear_it_svg\n                 , draw_it_svg\n                 , draw_metadata\n                 )\n\n  word_pipe = pipe( get_actions\n                  , filter_actions\n                  , make_sentences\n                  , write_sentences\n                  )\n\n  wyrd_pipe = pipe( get_actions\n                  , filter_actions\n                  , make_sentences\n                  , filter_active\n                  , write_sentences\n                  )\n}\n\nfunction render_pipe(pipe) {\n  // TODO: cloning is inefficient: make lazy subgraphs\n  var env = { data: Dagoba.clone(G)\n            , svg: {head: '', body: '', tail: ''}\n            , params: { my_maxyear: state.my_maxyear\n                      , my_minyear: state.my_minyear\n                      , filters: window.filter_poo\n                      }\n            , shapes: []\n            , ctx: ctx\n            }\n\n  return pipe(env)\n\n  // viz_pipe(env)\n  // word_pipe(env)\n\n  // if(n === undefined)\n  //   state.pipelines.forEach(function(pipeline) { pipeline(env) })\n  // else\n  //   state.pipelines[n](env)\n}\n\nfunction get_sentence_html() {\n  let env = render_pipe(word_pipe)\n  return env.output_html\n}\n\nfunction get_active_sentence_html() {\n  let env = render_pipe(wyrd_pipe)\n  return env.output_html\n}\n\nfunction get_viz_html() {\n  // THINK: viz_pipe should be initialized with a dom context or something...\n  let env = render_pipe(viz_pipe)\n  return env.output_html\n}\n\nfunction get_convo_html() {\n  return render_conversation(convo)\n}\n\n\n// COMPACTIONS\n\nfunction sg_compact(g) {\n  // so... this is pretty silly i guess or something. use subgraphs instead.\n  var newg = Dagoba.graph()\n  var edges = []\n\n  g.v().run().forEach(function(node) {\n    if(node.time)\n      return undefined\n\n    var others = g.v(node._id).both().run()\n    others.forEach(function(other) {\n      if(other.time)\n        node.time = Math.min(node.time||Infinity, other.time)\n\n      var oo = g.v(other._id).both().run()\n      if(oo.length < 2)\n        return undefined\n\n      var edge = {_in: oo[0]._id, _out: oo[1]._id, label: other.name || \"\"}\n\n      if(!edges.some(x => x._in === edge._in && x._out === edge._out))\n        edges.push(edge)\n\n      newg.addVertex(node)\n    })\n  })\n\n  edges.forEach(function(edge) {\n    newg.addEdge(edge)\n  })\n\n  return newg\n}\n\nfunction likenamed(g) {\n  var namemap = {}\n\n  g.v().run().forEach(function(node) {\n    if(!node.name)\n      return undefined\n\n    if(!namemap[node.name]) {\n      namemap[node.name] = [node]\n    }\n    else {\n      namemap[node.name].push(node)\n    }\n  })\n\n  Object.keys(namemap).forEach(function(name) {\n    if(namemap[name].length > 1)\n      g.mergeVertices(namemap[name])\n  })\n\n  return g\n}\n\n\n/// modularize this:\n\nlet clusters = [ ['AMC', 'amc', 'Allied Media Conference', 'allied media conference', 'Allied media Conference']\n              , ['AMP', 'amp', 'Allied Media Projects', 'allied media projects']\n              , ['AMC2016 Coordinators Weekend', 'AMC 2016 Coordinators Meeting']\n              , ['jayy dodd', 'jayy']\n              ]\n\nfunction cluster(g) {\n  clusters.map(function(names) {\n    return names.reduce(function(acc, name) {\n      return acc.concat(g.v({name: name}).run())\n    }, [])\n  }).forEach(g.mergeVertices.bind(g))\n\n  return g\n}\n\n// LAYOUT\n\nfunction mod(prop, fun) {\n  return function(env) {\n    env[prop] = fun(env[prop])\n    return env\n  }\n}\n\nfunction set_year(env) {\n  var minyear = Infinity\n  var maxyear = 0\n  var list = env.params.years = {}\n\n  env.data.V = env.data.V.map(function(node) {\n\n    if(node.time < 1199161600000) return node // HACK: remove me!!!\n\n    var year = (new Date(node.time+100000000)).getFullYear()\n    if(year < minyear) minyear = year // effectful :(\n    if(year > maxyear) maxyear = year // effectful :(\n\n    node.year = year // mutation :(\n    push_it(list, node.year, node) //, G.vertexIndex[node._id])\n\n    return node\n  })\n\n  // env.params.minyear = minyear\n  // env.params.maxyear = maxyear\n  env.params.minyear = state.my_minyear\n  env.params.maxyear = state.my_maxyear\n\n  return env\n}\n\nfunction data_to_graph(env) {\n  // THINK: this is kind of weird... we could probably get more leverage by just using G itself\n  env.params.graph = Dagoba.graph(env.data.V, env.data.E)\n  env.data.V = env.params.graph.vertices\n  env.data.E = env.params.graph.edges\n  return env\n}\n\nfunction add_fakes(env) {\n  var years = env.params.years\n\n  Object.keys(years).forEach(function(yearstr) {\n    var year = years[yearstr]\n    var fake = {type: 'fake', year: yearstr, name: 'fake', _in: [], _out: []}\n    // var copies = 3 + Math.ceil(year.length / 5)\n    var copies = 10 - year.length < 0 ? 2 : 10 - year.length\n    // var fakes = [clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake), clone(fake)]\n    var fakes = []\n    for(var i = 0; i < copies; i++) {\n      fakes.push(clone(fake))\n    }\n\n    Array.prototype.push.apply(year, fakes)\n    Array.prototype.push.apply(env.data.V, fakes)\n  })\n\n  return env\n}\n\nfunction set_coords(env) {\n  var years = env.params.years\n\n  env.data.V.forEach(function(node) {\n    if(node.x) return node\n\n    var offset = node.year - env.params.my_minyear + 1\n    var radius = offset * state.ring_radius // HACK: remove this!\n\n    var nabes = years[node.year]\n    // var gnode = G.vertexIndex[node._id]\n\n    if(!nabes) return false\n\n    var index = nabes.indexOf(node)\n    var arc = 2 * Math.PI / nabes.length\n\n    var deg = offset + index * arc\n    var cx  = radius * Math.cos(deg)\n    var cy  = radius * Math.sin(deg)\n    var edge_count = node._in.length + node._out.length\n\n    node.shape = 'circle'\n    node.x = cx\n    node.y = cy\n    node.r = 4 + 2*Math.min(5, edge_count / 2) //Math.floor(node.name.charCodeAt(0)/20)\n\n    return node\n  })\n\n  return env\n}\n\nfunction set_score(env) {\n  env.data.V = env.data.V.map(function(node) { node.score = score(node); return node })\n  return env\n}\n\nfunction minimize_edge_length(env) {\n  var years = env.params.years\n\n  Object.keys(years).sort().forEach(function(key) {\n    var peers = years[key]\n    peers.sort(score_sort)\n    peers.forEach(function(node) {\n      peers.forEach(function(peer) {\n        swap(node, peer)\n        var new_node_score = score(node)\n        var new_peer_score = score(peer)\n        if(node.score + peer.score < new_node_score + new_peer_score) {\n          swap(node, peer)\n        } else {\n          node.score = new_node_score\n          peer.score = new_peer_score\n        }\n      })\n    })\n  })\n\n  return env\n\n  function swap(n1, n2) {\n    var x = n1.x, y = n1.y\n    n1.x = n2.x; n1.y = n2.y\n    n2.x = x;    n2.y = y\n  }\n\n  function score_sort(n1, n2) {\n    return n1.score - n2.score\n  }\n}\n\nfunction score(node) {\n  return [].concat(node._in||[], node._out||[]).reduce(function(acc, edge) {return acc + score_edge(edge, node)}, 0)\n\n  function score_edge(edge, self) {\n    //// TODO: if other end is \"older\" than this end, don't count it...\n    if(edge._in  === node && edge._out.year > node.year) return 0\n    if(edge._out === node && edge._in. year > node.year) return 0\n\n    // return edge._in.x + edge._out.x\n\n    var dx = Math.abs(edge._in.x - edge._out.x)\n    var dy = Math.abs(edge._in.y - edge._out.y)\n\n    return Math.sqrt(dx*dx + dy*dy)\n  }\n}\n\nfunction remove_fakes(env) {\n  env.data.V = env.data.V.filter(function(node) {\n    return node.type !== 'fake'\n  })\n  return env\n}\n\nfunction unique_y_pos(env) {\n  var threshold = 6\n  // var node_radius = 5\n  var arc = Math.PI / 100\n  var years = env.params.years\n  var ys = []\n\n  Object.keys(years).sort().forEach(function(key) {\n    var peers = years[key]\n    peers.forEach(function(node) {\n      var coords, closest\n\n      if(node.type === 'fake') // le sigh\n        return\n\n      // A) do a binary search on an array of midpoints to find the closest one\n      // B) if it's within threshold walk around the circle in both directions until you find an opening\n      // C) if you reach the antipode give up\n\n      for(var da = arc; da < Math.PI; da = -1*(da + arc*(da/Math.abs(da)))) {\n        coords = modify_coords(node, da)\n        closest = find_closest(coords.y, ys)\n        if(!closest || Math.abs(closest - coords.y) > threshold)\n          break\n      }\n\n      // console.log(da, closest, coords.y, Math.abs(closest - coords.y))\n\n      node.x = coords.x\n      node.y = coords.y\n      ys.push(coords.y)\n\n      ys.sort(function(a, b) {return a - b}) // OPT: just insert coords.y in place\n    })\n  })\n\n  return env\n\n  function modify_coords(node, da) {\n    return { x: node.x * Math.cos(da) - node.y * Math.sin(da)\n           , y: node.x * Math.sin(da) + node.y * Math.cos(da)\n           }\n  }\n\n  function find_closest(n, ns) { // binary search\n    var closest\n    var index = Math.floor(ns.length / 2)\n    var item = ns[index]\n\n    if(ns.length < 5) {\n      for(var i = 0; i < ns.length; i++) {\n        if(closest === undefined || Math.abs(ns[i] - n) < Math.abs(closest - n))\n          closest = ns[i]\n      }\n      return closest\n    }\n\n    if(item === n)\n      return item\n\n    if(item > n)\n      return find_closest(n, ns.slice(0, index))\n\n    return find_closest(n, ns.slice(index + 1))\n  }\n}\n\nfunction filter_by_year(env) {\n  var max = env.params.my_maxyear\n  var min = env.params.my_minyear\n\n  // hack hack hack\n  if(state.current_year < max)\n    max = state.current_year\n\n  // TODO: do this in Dagoba so we can erase edges automatically\n  env.data.V = env.data.V.filter(function(node) {\n    // yuckyuckyuck\n    if(node.year > max || node.year < min) {\n      env.params.graph.removeVertex(node)\n      return false\n    }\n    return true\n  })\n\n  return env\n}\n\nfunction filter_nodes(env) {\n  let filters = env.params.filters\n\n  if(!filters) return env\n\n  // TODO: do this in Dagoba so we can erase edges automatically\n  env.data.V = env.data.V.filter(function(node) {\n    // yuckyuckyuck\n    if(filters.includes(node.type)) {\n      env.params.graph.removeVertex(node)\n      return false\n    }\n    return true\n  })\n\n  return env\n}\n\n\n// SHAPES\n\nfunction add_rings(env) {\n  for(var i = env.params.minyear; i <= env.params.maxyear; i++) {\n    var color = i === state.current_year ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.3)'\n    var radius = state.ring_radius * (i - env.params.my_minyear + 1)\n    env.shapes.unshift({shape: 'circle', x: 0, y: 0, r: radius, stroke: color, fill: 'rgba(0, 0, 0, 0)', line: 1, type: 'ring', year: i})\n  }\n  return env\n}\n\nfunction add_ring_labels(env) {\n  var labels = []\n\n  env.shapes.filter(eq('type', 'ring')).forEach(function(shape) {\n    var fill = shape.year == state.current_year ? '#ccc' : '#999'\n    var label = {shape: 'text', str: shape.year, x: -15, y: -shape.r - 5, fill: fill} //, font: \"18px Raleway\" }\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\nfunction copy_edges(env) {\n  var hues = { \"participate in\": \"rgba(52, 73, 94, 0.7)\"\n             , \"inspire\": \"rgba(241, 196, 15, 0.7)\"\n             , \"organize\": \"rgba(141, 196, 215, 0.7)\"\n             , \"lead\": \"rgba(231, 76, 60, 0.7)\"\n             , \"met\": \"rgba(102, 39, 239, 0.7)\"\n             }\n\n  env.data.E.forEach(function(edge) {\n    if(!state.all_edges && !(edge._out.year === state.current_year || edge._in.year === state.current_year)) // HACK: remove this\n      return undefined\n\n    var color = hues[edge.label]\n    var label = edge.label || \"#777\"\n    var id    = edge._in._id + '-' + edge._out._id\n\n    // TODO: is this needed with hard baked colours?\n    /* var color = str_to_color(label)*/\n    /* function str_to_color(str) { return 'hsl' + (state.show_labels?'a':'') + '(' + str_to_num(str) + ',100%,40%' + (state.show_labels?',0.3':'') + ')';}*/\n    /* function str_to_color(str) { return 'hsla' + '(' + str_to_num(str) + ',30%,40%,0.' + (state.show_labels?'3':'7') + ')' }*/\n    /* function str_to_num(str) { return char_to_num(str, 0) + char_to_num(str, 1) + char_to_num(str, 2) }*/\n    /* function char_to_num(char, index) { return (char.charCodeAt(index) % 20) * 20 }*/\n\n    var line = {shape: 'line', _id: id, x1: edge._in.x, y1: edge._in.y, x2: edge._out.x, y2: edge._out.y, stroke: color, type: 'edge', label: label}\n    env.shapes.push(line)\n  })\n  return env\n}\n\nfunction copy_nodes(env) {\n  env.shapes = env.shapes.concat.apply(env.shapes, env.data.V.map(function(node) {\n    // HACK: move this elsewhere\n    if(!state.all_edges) {\n      var ghost = !node._in.concat(node._out)\n                           .map(e => [e._in.year, e._out.year])\n                           .reduce((acc, t) => acc.concat(t), [])\n                           .filter(y => y === state.current_year).length\n      if(ghost)\n        return []\n    }\n\n    // var this_year = state.all_edges || node.year === state.current_year\n    // var color =  'hsla(0,0%,20%,0.' + (this_year ? '99' : '3') + ')'\n\n    var hues = { outcome: \"#ffd600\"    // yellow\n               , person:  \"#009edb\"    // blue (aka, Individual)\n               , event:   \"#f32938\"    // red\n               , org:     \"#00af4c\"    // green (aka, \"Group\")\n               }\n\n    var color = hues[node.type]\n\n    var shape = { shape: 'circle'\n                , _id: node._id\n                , x: node.x\n                , y: node.y\n                , r: node.r * 0.8     // node is 20% smaller\n                , name: node.name\n                , fill: color\n                }\n\n    if(!node.highlight && !node.active)\n      return shape\n\n    let colour = node.active ? 'rgba(255, 214, 0, 0.98)'\n                             : 'rgba(255, 214, 0, 0.8)'\n\n    var highlight = { shape: 'circle'\n                    , _id: node._id + '-highlight'\n                    , x: node.x\n                    , y: node.y\n                    , r: node.r + 10\n                    , line: 0.01\n                    , fill: colour\n                    , type: 'highlight'\n                    }\n\n    return [highlight, shape]\n  }))\n  return env\n}\n\nfunction add_node_labels(env) {\n  var labels = []\n\n  env.shapes.forEach(function(shape) {\n    if(!shape.name) return undefined\n    var str = truncate(shape.name, 50)\n    var label = {shape: 'text', str: str, x: shape.x + 15, y: shape.y + 5}\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\nfunction add_edge_labels(env) {\n  if(!state.show_labels)\n    return env\n\n  var labels = []\n\n  env.shapes.forEach(function(shape) {\n    if(shape.type !== 'edge') return undefined\n    var label = {shape: 'angle_text', x1: shape.x1, y1: shape.y1, x2: shape.x2, y2: shape.y2, fill: shape.stroke, str: shape.label}\n    labels.push(label)\n  })\n\n  env.shapes = env.shapes.concat(labels)\n  return env\n}\n\n// RENDERING\n\n// experimental svg mode functions...\nfunction clear_it_svg(env) {\n  env.svg.head = `<svg viewBox=\"0 0 900 900\" style=\"height:900px\" xmlns=\"http://www.w3.org/2000/svg\">`\n  env.svg.tail = `</svg>`\n  return env\n}\n\nfunction draw_it_svg(env) {\n  // tees: create an array of element id's to loop over and add mouse over events too.\n  let nodes = []\n  let edges = []\n\n  env.shapes.forEach(function(node) {\n    env.svg.body += draw_shape(node)\n  })\n\n  // inject the svg node\n  document.getElementById('ripplemap-mount').innerHTML = env.svg.head + env.svg.body + env.svg.tail\n\n  highlight.add_svg_listeners(edges, nodes)\n\n  return env // <----- hey look, the function ends here!\n\n\n\n\n  function draw_shape(node) {\n    var cx = 450\n    var cy = 450\n\n    if(node.shape === 'circle')\n      return draw_circle(node, cx + node.x, cy + node.y, node.r, node.stroke, node.fill, node.line)\n\n    if(node.shape === 'line')\n      return draw_line(node, cx + node.x1, cy + node.y1\n                           , cx + node.x2, cy + node.y2, node.stroke, node.line)\n\n    if(node.shape === 'text')\n      return draw_text(node, cx + node.x, cy + node.y, node.str, node.font, node.fill)\n\n    if(node.shape === 'angle_text')\n      return draw_angle_text( node, cx + node.x1, cy + node.y1\n                                  , cx + node.x2, cy + node.y2\n                                  , node.str, node.font, node.fill\n                            )\n  }\n\n  function draw_circle(node, x, y, radius, stroke_color, fill_color, line_width) {\n    if(!x || !y || !radius) return undefined\n\n    // console.log(stroke_color)\n    fill_color = fill_color || '#444444'\n    line_width = line_width || 2\n    stroke_color = stroke_color || '#eef'\n\n    let u_id = `${node._id}`\n    nodes.push(u_id)\n\n    return `<circle id=\"${u_id}\" class=\"${node.type || 'node'}\" cx=\"${x}\" cy=\"${y}\" r=\"${radius}\" fill=\"${fill_color}\" stroke-width=\"${line_width}\" stroke=\"${stroke_color}\"/>`\n  }\n\n  function draw_line(node, fromx, fromy, tox, toy, stroke_color, line_width) {\n    /* stroke_color = stroke_color || '#eef' // override until highlighting is figured out*/\n    stroke_color = 'rgba(255, 255, 255, 0.4)'\n    // console.log(stroke_color)\n    line_width = line_width || 0.5\n\n\n    if(fromx * fromy * tox * toy * 0 !== 0)\n      return ''\n\n    let u_id = `${node._id}`\n    edges.push(u_id)\n\n    // TODO: highlight edge\n    return `\n      <g>\n        <line class= \"${node.type}\" x1=\"${fromx}\" y1=\"${fromy}\" x2=\"${tox}\" y2=\"${toy}\" stroke-width=\"2\" stroke=\"${stroke_color}\"/>\n        <line id=\"${u_id}\" class= \"${node.type}\" x1=\"${fromx}\" y1=\"${fromy}\" x2=\"${tox}\" y2=\"${toy}\" stroke-width=\"15\" stroke=\"rgba(0, 0, 0, 0)\"/>\n      </g>`\n  }\n\n  function draw_text(node, x, y, str, font, fill_color, font_size) {\n    fill_color = fill_color || '#fff'\n    font_size  =  font_size || '14.5px'\n    font       =       font || \"Archivo  Narrow\"\n\n    if(isNaN(x)) return ''\n\n    x = x || 0\n    y = y || 0\n\n    return `<text x=\"${x}\" y=\"${y}\" font-family=\"${font}\" fill=\"${fill_color}\" letter-spacing=\"1px\" font-size=\"${font_size}\">${str}</text>`\n  }\n\n  function draw_angle_text(node, x1, y1, x2, y2, str, font, fill_color) {\n    return ''\n\n    // TODO: write this function\n\n    ctx.fillstyle = fill_color || '337'\n    ctx.font = font || \"14px sans-serif\"\n\n    // modified from http://phrogz.net/tmp/canvas_rotated_text.html\n\n    var padding = 5\n    var dx = x2 - x1\n    var dy = y2 - y1\n    var len = math.sqrt(dx*dx+dy*dy)\n    var avail = len - 2*padding\n    var pad = 1/2\n    var x = x1\n    var y = y1\n\n    var texttodraw = str\n    if (env.measuretext && ctx.measuretext(texttodraw).width > avail){\n      while (texttodraw && ctx.measuretext(texttodraw+\"…\").width > avail) texttodraw = texttodraw.slice(0, -1)\n      texttodraw += \"…\"\n    }\n\n    // keep text upright\n    var angle = math.atan2(dy, dx)\n    if (angle < -math.pi/2 || angle > math.pi/2){\n      x = x2\n      y = y2\n      dx *= -1\n      dy *= -1\n      angle -= math.pi\n    }\n\n    ctx.save()\n    ctx.textalign = 'center'\n    ctx.translate(x+dx*pad, y+dy*pad)\n    ctx.rotate(angle)\n    ctx.filltext(texttodraw, 0, -3)\n    ctx.restore()\n  }\n\n}\n\n\n/////////////////////////////////\n\nfunction clear_it(env) {\n  env.ctx.clearRect(0, 0, 1000, 1000)\n  return env\n}\n\nfunction draw_it(env) {\n  env.shapes.forEach(function(node) {\n    draw_shape(env.ctx, node)\n  })\n  return env\n}\n\nfunction draw_metadata(env) {\n  // el('minyear').textContent = 1900 + env.params.minyear\n  // el('maxyear').textContent = 1900 + state.current_year\n  return env\n}\n\n\n// CANVAS FUNCTIONS\n\nfunction draw_shape(ctx, node) {\n  var cx = 450\n  var cy = 450\n\n  if(node.shape === 'circle')\n    draw_circle(ctx, cx + node.x, cy + node.y, node.r, node.stroke, node.fill, node.line)\n\n  if(node.shape === 'line')\n    draw_line(ctx, cx + node.x1, cy + node.y1, cx + node.x2, cy + node.y2, node.stroke, node.line)\n\n  if(node.shape === 'text')\n    draw_text(ctx, cx + node.x, cy + node.y, node.str, node.font, node.fill)\n\n  if(node.shape === 'angle_text')\n    draw_angle_text(ctx, cx + node.x1, cy + node.y1, cx + node.x2, cy + node.y2, node.str, node.font, node.fill)\n}\n\nfunction draw_circle(ctx, x, y, radius, stroke_color, fill_color, line_width) {\n  ctx.beginpath()\n  ctx.arc(x, y, radius, 0, math.pi*2, false)\n  ctx.fillstyle = fill_color || '#444444'\n  ctx.fill()\n  ctx.linewidth = line_width || 2\n  ctx.strokestyle = stroke_color || '#eef'\n  ctx.stroke()\n}\n\nfunction draw_line(ctx, fromx, fromy, tox, toy, stroke_color, line_width) {\n  var path=new path2d()\n  path.moveto(fromx, fromy)\n  path.lineto(tox, toy)\n  ctx.strokestyle = stroke_color || '#eef'\n  ctx.linewidth = line_width || 0.5\n  ctx.stroke(path)\n}\n\nfunction draw_text(ctx, x, y, str, font, fill_color) {\n  ctx.fillstyle = fill_color || '#000'\n  ctx.font = font || \"14px raleway\"\n  if(isNaN(x)) return undefined\n  x = x || 0\n  y = y || 0\n  ctx.filltext(str, x, y)\n}\n\nfunction draw_angle_text(ctx, x1, y1, x2, y2, str, font, fill_color) {\n  ctx.fillstyle = fill_color || '337'\n  ctx.font = font || \"14px sans-serif\"\n\n  // modified from http://phrogz.net/tmp/canvas_rotated_text.html\n\n  var padding = 5\n  var dx = x2 - x1\n  var dy = y2 - y1\n  var len = math.sqrt(dx*dx+dy*dy)\n  var avail = len - 2*padding\n  var pad = 1/2\n  var x = x1\n  var y = y1\n\n  var texttodraw = str\n  if (ctx.measuretext && ctx.measuretext(texttodraw).width > avail){\n    while (texttodraw && ctx.measuretext(texttodraw+\"…\").width > avail) texttodraw = texttodraw.slice(0, -1)\n    texttodraw += \"…\"\n  }\n\n  // keep text upright\n  var angle = math.atan2(dy, dx)\n  if (angle < -math.pi/2 || angle > math.pi/2){\n    x = x2\n    y = y2\n    dx *= -1\n    dy *= -1\n    angle -= math.pi\n  }\n\n  ctx.save()\n  ctx.textalign = 'center'\n  ctx.translate(x+dx*pad, y+dy*pad)\n  ctx.rotate(angle)\n  ctx.filltext(texttodraw, 0, -3)\n  ctx.restore()\n}\n\n\n\n// SENTENCE STRUCTURES\n\nfunction get_actions(env) {\n  var actions = G.v({cat: 'action'}).run() // FIXME: use env.data, not G\n  env.params.actions = actions\n  return env\n}\n\nfunction filter_actions(env) {\n  env.params.actions = env.params.actions.map(function(action) {\n    action.year = new Date(action.time+100000000).getFullYear()\n    return action\n  })\n\n  if(!state.filter_sentences) return env\n\n  env.params.actions = env.params.actions.filter(function(action) {\n    return action.year === state.current_year\n  })\n\n  return env\n}\n\nfunction make_sentences(env) {\n  var sentences = env.params.actions.map(construct).filter(Boolean)\n  env.params.sentences = sentences\n  return env\n}\n\nfunction construct(action) {\n  var list = []\n  var edges = action._out.concat(action._in)\n  if(!edges[1]) return false\n  if(edges[0].label === 'the')\n    edges = [edges[1], edges[0]]\n  function notme(id, edge) { return edge._in._id === id ? edge._out : edge._in }\n  // list.push(notme(action._id, edges[0]), edges[0], action, edges[1], notme(action._id, edges[1]))\n  list.push(notme(action._id, edges[0]), action, notme(action._id, edges[1])) // TODO: change this for did/the\n  list.year = action.year\n  return list\n}\n\nfunction filter_active(env) {\n  env.params.sentences = env.params.sentences.filter(list => {\n    // return list[0].active && list[4].active\n    return list[0].active && list[2].active\n  })\n\n  return env\n}\n\nfunction write_sentences(env) {\n  // dom.set_el('sentences', '')\n  let str = ''\n\n  var oldyear = 1\n\n  env.params.sentences.sort(function(a, b) {\n    return a.year - b.year\n  })\n\n  env.params.sentences.forEach(function(list) {\n    var sentence = ''\n    var innerwords = ''\n    var highlight_count = 0\n\n    if(list.year !== oldyear) {\n      sentence = '<h2>' + list.year + '</h2>'\n      oldyear = list.year\n    }\n\n    list.forEach(function(thing) {\n      var data\n      var word = thing.name || thing.label\n      var cat = thing.cat\n      var type = cat ? thing.type : 'edge'\n\n      var classes = [type]\n      if(cat) {\n        classes.push(cat)\n        classes.push('node-' + thing._id)\n      }\n      else {\n        classes.push('node-' +  thing._in._id + '-' + thing._out._id)\n      }\n\n      // TODO: change this vis-a-vis new highlighting -- it currently only highlights a sentence if *all* of the elements are lit, but we could instead highlight individual elements.\n      // THINK: this fix probably makes more sense as part of lifting the html renderer into preact, through keeping the active/highlight info in the new intermediate data structure\n      if(thing.highlight || thing.active)\n        highlight_count++\n\n      if(type !== 'edge')\n        data = {id: thing._id||''}\n      else\n        data = {id1: thing._in._id, id2: thing._out._id}\n\n      if(!state.admin_mode)\n        innerwords += template(classes, data, word)\n      else\n        innerwords += admin_template(thing, type, cat, word)\n    })\n\n    var sentence_classes = 'sentence'\n    sentence_classes += highlight_count >= 2 ? ' highlight' : ''\n    sentence += '<p class=\"' + sentence_classes + '\">' + innerwords + '.</p>'\n\n    // dom.append_el('sentences', sentence)\n    str += sentence\n  })\n\n  env.output_html = str\n\n  return env\n\n  // helpers:\n\n  function template(classes, data, text) {\n    classes.unshift('word')\n    var classtext = classes.join(' ')\n\n    var datatext = Object.keys(data).map(function(key) {return 'data-' + key + '=\"' + data[key] + '\"'}).join(' ')\n\n    return ' <span class=\"' + classtext + '\"'\n         + datatext\n         + ' contentEditable=\"true\">'\n         + text + '</span>'\n  }\n\n  function admin_template(thing, type, cat, text) {\n    var button = ''\n    var notes = ''\n\n    if(cat === 'action') {\n      button = '<button class=\"delete\" data-id=\"'+thing._id+'\">delete just this sentence</button>'\n    }\n    else if(type !== 'edge') {\n      notes = ' (' + type + ')'\n      button = '<button class=\"delete\" data-id=\"'+thing._id+'\">delete this thing and all its sentences entirely</button>'\n    }\n\n    return ' ' + text + notes + button\n  }\n}\n\n\n\n\n// FORM BUILDER & FRIENDS\n\nfunction whatsnext(graph = G, conversation = convo) {\n  // this function decides what to ask the user next, based on their conversation and the world\n  // call it for rendering so it can decide what to do\n\n\n  // TODO: incorporate graph knowledge (graph is the whole world, or the relevant subgraph)\n  // THINK: what is a conversation?\n  // are we currently in a sentence? then find the highest weighted unfilled 'port'\n\n  return render_conversation(conversation)\n\n  // force_rerender()\n}\n\nfunction get_cat_dat(cat, q) {\n  var substrRegex = new RegExp(q, 'i')\n  var frontRegex = new RegExp('^' + q, 'i')\n  var nodes = G.vertices.filter(function(node) {return node.cat === cat}).map(prop('name'))\n        .filter(function(name) {return substrRegex.test(name)})\n\n  nodes.sort(function(a, b) {\n    return frontRegex.test(b) - frontRegex.test(a) || a.charCodeAt() - b.charCodeAt()\n  })\n\n  return nodes\n}\n\nfunction render_conversation(conversation) {\n  let str = ''\n\n  // var typeahead_params = {hint: true, highlight: true, minLength: 1}\n  // function typeahead_source(cat) {return {name: 'states', source: function(q, cb) {cb(get_cat_dat(cat, q))}}}\n  function make_datalist(cat) {\n    let nodes = G.vertices.filter(function(node) {return node.cat === cat}).map(prop('name'))\n    let options = nodes.reduce((acc, v) => acc + `<option value=\"${v}\">`, '')\n    return `<datalist id=\"${cat}-list\">${options}</datalist>`\n  }\n\n  var inputs = ''\n  var prelude = ''\n  // var submit_button = '<input type=\"submit\" style=\"position: absolute; left: -9999px\">'\n\n  // account for existing sentences\n  if(conversation.sentences.length) {\n    conversation.sentences.forEach(\n      s => {\n        prelude += '<p>'\n        s.filled.forEach((slot, i) => prelude += inject_value(slot, slot.value, i) + ' ')\n        prelude += '</p>'\n      })\n  }\n\n  // special case the first step\n  var sentence = conversation.current\n\n  sentence.filled.forEach(function(slot, i) {\n    prelude += inject_value(slot, slot.value, i) + ' '\n  })\n\n  if(!prelude) {\n    prelude = `<p>Okay, let’s fill in the blanks.</p>`\n  } else {\n    // prelude += `<p>Thanks for adding your story, it's on the map!</p><p>Tell us some other stories about your involvement in MozFest</p>`\n  }\n\n  // display the unfilled slot\n  var slot = sentence.slots[0]\n  var input = ''\n  if(slot.type === 'word') {\n    input = inject_value(slot, make_word_input(slot.cat, slot.key))\n  }\n  else if(slot.type === 'gettype') {\n    input = inject_value(slot, make_type_input(slot.cat, slot.key))\n  }\n  else if(slot.type === 'date') {\n    input = inject_value(slot, make_date_input(slot.key))\n  }\n\n  prelude += input\n\n\n  // do the DOM\n  // dom.set_el('the-conversation', prelude + inputs + submit_button)\n  str = prelude + inputs // + submit_button\n\n  // wiring... /sigh\n  var catnames = Object.keys(cats)\n  catnames.forEach(function(cat) {\n    // $('.'+cat+'-input').typeahead(typeahead_params, typeahead_source(cat))\n  })\n\n  // if(sentence.filled.length)\n  //   dom.el(slot.key).focus()    // TODO: this probably doesn't work\n\n  // TODO: use the autofocus attr directly on the input\n\n  return str\n\n  // helper functions\n\n  function make_word_input(cat, key) {\n    // var text = ''\n\n    let datalist = make_datalist(cat, key)\n\n    if(cat === 'thing') {\n      return `<input autofocus list=\"${cat}-list\" id=\"${key}\" type=\"text\" size=\"50\"\n                     placeholder=\"name of a person or thing\">` + datalist\n                     // placeholder=\"A${mayben(cat)} ${cat}\">` + datalist\n    }\n\n    if(cat === 'action') {\n      // var options = ['participate in', 'fund', 'organize', 'inspire', 'invite', 'meet', 'create', 'present']\n      var options = ['attended', 'inspired', 'invited', 'met', 'created', 'wrangled at', 'presented at']\n      return make_select_list('verb', options)\n\n      // text += '<select id=\"verb\" name=\"verb\">'\n      // // var options = ['facilitate', 'coordinate', 'contribute', 'create', 'attend', 'manage', 'assist', 'present', 'join', 'leave']\n      // options.forEach(function(option) {\n      //   text += '<option>' + option + '</option>'\n      // })\n      // text += '</select>'\n      // return text\n    }\n  }\n\n  function make_type_input(cat, key) {\n    // TODO: this assumes cat is always 'thing'\n    var options = ['person', 'org', 'event', 'outcome', 'program', 'job']\n    return make_select_list(key, options)\n  }\n\n  function make_select_box(id, xs) {  // takes a list of strings\n    let options = xs.reduce((acc, x) => acc + `<option value=\"${x}\">${x}</option>`, '')\n    return `<select id=\"${id}\" name=\"${id}\"> ${options} </select>`\n  }\n\n  function make_select_list(id, xs) { // a newfangled select box\n    /// TODO: this is sooooooper stooooopid\n    ///       just return a data structure, bind it into the state as part of the convo,\n    ///       and have preact render it. no sense mucking with dom weirdness here, just handle the logic\n    return xs.reduce((acc, x) => acc + `<p class=\"choice ${x}\" onclick=\"f__r(yuck({${id}:'${x}'}))\">${x}</p>`, '')\n  }\n\n\n  function make_date_input(key) {\n    var str = '<input id=\"' +key+ '\" type=\"date\" name=\"' +key+ '\" value=\"2017-10-26\" />'\n    return str\n  }\n\n  function inject_value(slot, value, index) { // HACK: index is a huge hack, remove it.\n    var text = ''\n\n    if(slot.key === 'subject') {\n      if(slot.value && Number.isInteger(index)) {\n        // text += '<p><b>' + slot.value + '</b></p>'\n        text += '<b>' + slot.value + '</b>'\n      } else {\n        text += value + ' '\n      }\n    }\n    else if(slot.key === 'verb') {\n      // text += ' did '\n      text += value\n      // text += ' the '\n    }\n    else if(slot.key === 'object') {\n      text += value + ' '\n    }\n    else if(slot.type === 'gettype') {\n      if(!Number.isInteger(index)) {\n        // hack hack hack\n        text += 'is a'\n        text += value\n      }\n      // else if(index === 1) {\n      //   text += ' is a'\n      //   text += mayben(value) + ' '\n      //   text += value + ' '\n      //   if(slot.value)\n      //     text += slot.value === 'person' ? 'who ' : 'which '\n      // } else {\n      //   text += ' (a'\n      //   text += mayben(value) + ' '\n      //   text += value + ') '\n      // }\n    }\n    else if(slot.type === 'date') {\n      text += ' on around '\n      text += value + ' '\n    }\n    else {\n      text = ' ' + value + ' '\n    }\n\n    return text\n  }\n}\n\nfunction mayben(val) {\n  return /^[aeiou]/.test(val) ? 'n' : ''\n}\n\n\nfunction set_minus(xs, ys) {\n  return xs.filter(function(x) {\n    return ys.indexOf(x) === -1\n  })\n}\n\n\n\n\n// function get_tag_html() {\nfunction showtags() {\n  // generate current tags\n  // hoverable span for highlight, plus clickable for remove\n  var tagstr = state.tags.map(function(tag) {\n    return (\n      `<span class=\"tag\">\n        <i class=\"tag_icon fa fa-times-circle pr_1\" aria-hidden=\"true\"></i>${tag}\n      </span>`\n    )\n  }).join('');\n\n  dom.set_el('tagnames', tagstr)\n\n  // generate select box\n  var unused = set_minus(Object.keys(state.tagkeys), state.tags).sort()\n  var optionstr = '<option>' + unused.join('</option><option>') + '</option>'\n  dom.set_el('othertags', optionstr)\n\n  // return {tagnames: tagstr, othertags: optionstr}\n}\n","import { h, render } from 'preact';\nimport Header from 'UiKit/Header/index';\nimport Button from 'UiKit/Button/index';\n\nimport {get_active_sentence_html} from 'render'\n\nconst YourSelection = ({changeView}) => {\n  return (\n    <div>\n      <Header>Your Selection</Header>\n\n      {/* Add a story CTA */}\n      <section class=\"YourSelection__cta-addstory\">\n        <p>Ready to add your own story?</p>\n        <Button onClick={() => changeView('story')}>Add a story ▶</Button>\n      </section>\n\n      <h3>Click any story to edit</h3>\n      <div id=\"sentences\" dangerouslySetInnerHTML={{__html: get_active_sentence_html()}}> </div>\n\n    </div>\n  );\n};\n\nexport default YourSelection;\n","import { h, render } from 'preact';\nimport Header from 'UiKit/Header/index';\n\nimport {get_sentence_html} from 'render'\nimport * as dom from 'dom'\nimport {activate_highlighter, deactivate_highlighter} from 'highlight'\n\n\nconst Current = () => {\n  return (\n    <div>\n      <Header>Currently Showing</Header>\n      <h3>Click any story to edit</h3>\n      <div id=\"sentences\"\n           onMouseover={activate_highlighter}\n           onMouseout={deactivate_highlighter}\n           onKeyup={dom.keyup_sentences}\n           onClick={dom.click_sentences}\n           dangerouslySetInnerHTML={{__html: get_sentence_html()}}>\n      </div>\n    </div>\n  );\n};\n\nexport default Current;\n","import { h, render } from 'preact';\nimport './styles.css'\n\nconst LegendItem = (props) => {\n  let filter_is_on = props.currentFilters.indexOf(props.filter_key)\n\n  const containerStyles = {\n    display: 'flex',\n    alignItems: 'center',\n    margin: '1rem 0',\n    cursor: 'pointer',\n  }\n\n  const circleStyles = { \n    display: 'inline-block',\n    width: props.size || '0px',\n    height: props.size ||'0px',\n    background: filter_is_on !== -1 ? props.selected : props.color,\n    borderRadius: '50%',\n    marginRight: '1rem',\n    borderBottom: filter_is_on !== -1 ? '1px solid black' : '0',\n  }\n\n  const textStyles = {\n    borderBottom: filter_is_on !== -1 ? '1px solid black' : '0',\n  }\n\n  return (\n    <div style={containerStyles}>\n      <div style={circleStyles}/>\n      <span onClick={() => props.toggleFilter(props.filter_key)} style={textStyles}>{props.children}</span>\n    </div>\n  );\n}\n\nexport default LegendItem;","import { h, render, Component } from 'preact';\nimport Header from 'UiKit/Header'\nimport './styles.css'\nimport LegendItem from 'UiKit/LegendItem';\nimport Button from 'UiKit/Button'\n\nimport {force_rerender} from 'render'\n\n// TODO: find out if EDGES need to be filterable (like NODES are clickable to toggle)\nconst LegendNodes = [{\n        name: 'Event',\n        color: '#f32938',\n        selected: 'grey',\n        filter_key: 'event',\n    },\n    {\n        name: 'Individual',\n        color: '#009edb',\n        selected: 'grey',\n        filter_key: 'person',\n    },\n    {\n        name: 'Group',\n        color: '#00af4c',\n        selected: 'grey',\n        filter_key: 'org',\n    },\n    {\n        name: 'Outcome',\n        color: '#ffd600',\n        selected: 'grey',\n        filter_key: 'outcome',\n    },\n    {\n        name: 'Program',\n        color: '#af00d6',\n        selected: 'grey',\n        filter_key: 'program',\n    },\n    {\n        name: 'Job/contract',\n        color: '#d6af00',\n        selected: 'grey',\n        filter_key: 'job',\n    },\n]\n\nconst LegendEdges = [{\n        name: 'Participated',\n        filter_key: 'participated',\n        color: 'rgba(52, 73, 94, 0.7)'\n    },\n    {\n        name: 'Lead',\n        filter_key: 'lead',\n        color: 'rgba(231, 76, 60, 0.7)'\n    },\n    {\n        name: 'Inspired',\n        filter_key: 'inspired',\n        color: 'rgba(241, 196, 15, 0.7)'\n    },\n    {\n        name: 'Organized',\n        filter_key: 'organized',\n        color: \"rgba(141, 196, 215, 0.7)\"\n    },\n    {\n        name: 'Met',\n        filter_key: 'met',\n        color: 'rgba(102, 39, 239, 0.7)'\n    },\n]\n\n\n/* ----- Preact Jams ----- */\n\nclass Legend extends Component {\n  state = {\n    currentFilters: [],\n  }\n\n\n  toggleFilter = (filter) => {\n    let cur_filters = this.state.currentFilters\n    let filter_exists = cur_filters.indexOf(filter)\n\n    // if filter already exists, remove it\n    if (filter_exists !== -1) {\n      cur_filters.splice(filter_exists, 1)\n      this.setState({currentFilters: cur_filters})\n    }\n    else {\n      this.setState({\n        ...this.state,\n        currentFilters: [...this.state.currentFilters, filter]\n      })\n    }\n\n    // FIXME: this is leaking into the global space\n    window.filter_poo = this.state.currentFilters\n\n    // window.rm_render()\n    force_rerender()\n  }\n\n  renderNodes = () => {\n    return LegendNodes.map(node => (\n      <LegendItem\n        {...node}\n        size=\"15px\"\n        toggleFilter={this.toggleFilter}\n        currentFilters = {this.state.currentFilters}\n      >\n        {node.name}\n      </LegendItem>)\n  )}\n\n  renderActions = () => {\n    return LegendEdges.map(node => (\n      <LegendItem\n        {...node}\n        size=\"15px\"\n        currentFilters = {this.state.currentFilters}\n        toggleFilter={this.toggleFilter}\n      >\n        {node.name}\n      </LegendItem>\n    ))\n  }\n\n  render() {\n    return (\n      <div class=\"Legend\">\n\n        {/* Render the \"Nodes\" column (with colored legend items */}\n        <section class=\"Legend__columns\" >\n          <section class=\"Legend__column\" style={{paddingRight: '10px'}}>\n           <Header>People & things</Header>\n            {this.renderNodes()}\n          </section>\n\n        {/* Render the \"Actions\" column (and \"Hide all\"\" button) */}\n          <section class=\"Legend__column\" style={{paddingLeft: '10px'}}>\n            <Header>Actions</Header>\n            {this.renderActions()}\n            {/* <Button><icon class=\"fa fa-eye-slash\" style={{paddingRight: '1rem'}} />Hide all </Button> */}\n          </section>\n        </section>\n\n        {/* Years Section */}\n        <section class=\"Legend__years\">\n          <Header> Years </Header>\n          {/* TODO: year slider */}\n        </section>\n\n        {/* Keys Section */}\n        <section class=\"Legend__keys\">\n          <Header> Keys </Header>\n          <p>'←' for previous year</p>\n          <p>'→' for next year</p>\n          <p>'e' toggles recent connections</p>\n          <p>'f' toggles filter stories by year</p>\n          <p>'l' for legend edges</p>\n        </section>\n\n      </div>\n    );\n  }\n}\n\nexport default Legend;\n","import { h, render, Component } from 'preact'\nimport Header from 'UiKit/Header/index'\n\nimport {get_convo_html} from 'render'\nimport state from 'state'\nimport * as dom from 'dom'\nimport {convo, restart_sentence} from 'convo'\n\nimport Button from 'UiKit/Button/'\nimport './styles.css'\n\n  // <p>We'd love to hear your stories! Let's start with your contact info:</p>\nconst consent_disclaimer =  <div>\n  <p>To add your story, we need the consent of everyone in it. To obtain someone’s informed consent, they need to know:</p>\n  <p>- That they’re consenting to being named in a story on the MozFest Ripple Map, and that MozFest attendees and organizers will be able to read that story</p>\n  <p>- That there are risks we will do our best to protect them from: unintentional data usage, monitoring, surveillance</p>\n  <p>- That at any time, they can change or remove their story.</p>\n  <p>For transparency and accountability, they will be able to see that you have added them.</p>\n</div>\n\nconst thanks = <div>\n  <p>Thanks for adding your story, it's on the map!</p>\n  <p>Tell us some other stories about your involvement in MozFest</p>\n</div>\n\n\nconst Story = () => {\n  return (\n    <div class=\"Story\">\n      <Header>Add a story</Header>\n\n      <div id=\"signup\" class={state.email ? 'hide' : ''}>\n        <form id=\"login\" onSubmit={dom.login} class=\"Story__form\">\n          <h3>Want to add something to the map?</h3>\n\n          <p>We'd love to hear your stories! Let's start with your contact info:</p>\n          <input name=\"email\" id=\"email\" type=\"text\" placeholder=\"email\" class=\"typeahead Story__input\" />\n\n          <p>Your name</p>\n          <input name=\"name\" id=\"name\" type=\"text\" placeholder=\"name\" class=\"typeahead Story__input\" />\n\n          <p>How are you involved in Mozfest 2017?</p>\n          <select name=\"mz_involved\" id=\"mz_involved\" class=\"Story__input\">\n            <option value=\"attended\">attendee</option>\n            <option value=\"wrangled at\">wrangler</option>\n            <option value=\"presented at\">presenter</option>\n          </select>\n\n          <p>It’s really important to us that we have your informed consent to add your story to the map. Here’s what you need to know.</p>\n\n          <p>Who will see this map: everyone at MozFest 2017</p>\n\n          <p>At any time, you can change or remove your story. You will also be able to see if someone has added you to a story. Does this all sound okay to you?</p>\n\n\n          <Button type=\"submit\" buttonStyle=\"next\">Next\n            <i class=\"fa fa-chevron-right pl_1\" aria-hidden=\"true\"></i>\n          </Button>\n        </form>\n      </div>\n\n      <div id=\"storytime\" class={state.email ? '' : 'hide'}>\n\n    {!convo.current.filled.length && thanks}\n\n        <form id=\"the-conversation\" onSubmit={dom.submit_convo}>\n          <div dangerouslySetInnerHTML={{__html: get_convo_html()}}></div>\n\n    {convo.current.slots.length === 1 && consent_disclaimer}\n\n          <Button type=\"submit\" buttonStyle=\"next\">\n            <p onClick={restart_sentence} style={{textAlign: 'left', flex: 'inherit'}}>\n              <i class=\"fa fa-chevron-left pl_1\" aria-hidden=\"true\"></i>\n              Go back\n            </p>\n            Next\n            <i class=\"fa fa-chevron-right pl_1\" aria-hidden=\"true\"></i>\n          </Button>\n\n        </form>\n\n      </div>\n    </div>\n  )\n}\n\nexport default Story\n","import { h, render, Component } from 'preact';\nimport './sidebar.css'\nimport TabBar from './tabBar/tabBar';\nimport Home from './views/home/index';\nimport About from './views/about/index';\nimport YourSelection from './views/yourSelection/index';\nimport Current from './views/current/index';\nimport Filters from './views/filters/index';\nimport Story from './views/story/index';\n\n/**\n * Sidebar layout and state\n */\nclass Sidebar extends Component {\n  state = {\n    currentView: 'home'\n  }\n\n  componentDidMount() {\n    // window.do_the_glue()\n\n    // FIXME: this is a huge horrid hacky hack\n    window.changeView = this.changeView.bind(this)\n\n  }\n\n  componentDidUpdate() {\n    // window.render_all()\n    // window.do_the_glue()\n  }\n\n  changeView = (view_id) => {\n    this.setState({\n      currentView: view_id\n    })\n    // on transitioning to different component sub views... run glue?\n    // window.do_the_glue()\n  }\n\n  renderSelectedView = () => {\n    switch(this.state.currentView){\n\n      case 'home':\n        return (<Home changeView={this.changeView} />)\n\n      case 'story':\n        return <Story />\n\n      case 'filters':\n        return <Filters />\n\n      case 'read_stories':\n        return (<Current />)\n\n      case 'selected_stories':\n        return (<YourSelection changeView={this.changeView}/>)\n\n      case 'about':\n        return <About />\n\n      default:\n        return <Home />\n    }\n  }\n\n  render() {\n    return (\n      <aside class=\"Sidebar\">\n\n        {/* Render different views based on which section is selected*/}\n        <section class=\"Sidebar__container\">\n          <h3 class=\"Sidebar__header\">MozFest: Ripple Effect</h3>\n        <div class=\"Sidebar__subheading\"> The world's leading festival for the open Internet movement. </div>\n          {this.renderSelectedView()}\n        </section>\n\n        <TabBar currentView={this.state.currentView} changeView={this.changeView} />\n\n      </aside>\n    );\n  }\n}\n\nexport default Sidebar;\n","import {add_data} from './graph'\nimport {init as render_init, add_renderer as on_render, force_rerender, showtags, get_viz_html} from 'render'\nimport * as dom from 'dom' // just for effects\nimport state from 'state'\nimport {mouseover_tagnames, mouseout_tagnames, activate_highlighter, deactivate_highlighter} from 'highlight'\n\n\nexport {init, state, on_render}\n\n\n\n\n\n// TODO: partition incoming bleep bloops by action\n// TODO: build edit functions\n// TODO: build remove functions\n// TODO: ask user for email address\n// TODO: show current tags\n// TODO: allow changing of tags\n// TODO: allow multitag views\n// TODO: add all tags on server\n// TODO: try to get an additional compaction in\n\n// TODO: consolidate like-named nodes\n// TODO: consolidate email addresses on server\n// TODO: copy tags into url\n\n\n\n\n\n// INIT\n\n\nfunction init() {\n\n  // TODO: break this up a little so the logic is clearer\n\n  if(window.location.host.slice(0, 9) === \"127.0.0.1\") {\n    if(window.location.hash)\n      state.safe_mode = window.location.hash.slice(1)\n    else\n      state.safe_mode = true\n  }\n\n  if(window.location.search) {\n    state.query = window.location.search.substr(1).split('&').reduce(function(acc, pair) {\n      var p = pair.split('=')\n      acc[p[0]] = p[1]\n      return acc\n    }, {})\n    if(state.query.tag)\n      state.tags = [state.query.tag]\n    else if(state.query.tags)\n      state.tags = state.query.tags.split('|')\n  }\n\n  // G = Dagoba.graph()\n\n  render_init()\n\n  function cb() {\n    force_rerender()\n    showtags()\n    tagglue()\n  }\n\n  add_data(cb)\n\n  // setTimeout(function() {\n  //   // render()\n  // }, 111)\n\n  on_render(get_viz_html)       // oh poo\n}\n\nfunction tagglue() {\n  // barf yuck\n  dom.el('tagnames').addEventListener('click', dom.click_tagnames)\n  dom.el('tagnames').addEventListener('mouseover', mouseover_tagnames)\n  dom.el('tagnames').addEventListener('mouseout', mouseout_tagnames)\n  dom.el('addtag').addEventListener('submit', dom.submit_addtag)\n\n  // not quite as barfy\n  document.addEventListener('keydown', dom.global_keydown)\n}\n\n\n///////////////////////// DOM GLUE ///////////////////////////////\n\n\n\nexport function do_the_glue2() {\n  // NOTE: this never gets called\n\n  dom.el('login').addEventListener('submit', dom.login)\n\n  dom.el('addtag').addEventListener('submit', dom.submit_addtag)\n\n  dom.el('the-conversation').addEventListener('submit', dom.submit_convo)\n\n  dom.el('sentences').addEventListener('mouseover', activate_highlighter)\n  dom.el('sentences').addEventListener('mouseout', deactivate_highlighter)\n  dom.el('sentences').addEventListener('keyup', dom.keyup_sentences)\n  dom.el('sentences').addEventListener('click', dom.click_sentences)\n\n  // dom.el('tagnames').addEventListener('click', dom.click_tagnames)\n  // dom.el('tagnames').addEventListener('mouseover', dom.mouseover_tagnames)\n  // dom.el('tagnames').addEventListener('mouseout', dom.mouseout_tagnames)\n\n  // document.addEventListener('keydown', dom.global_keydown)\n\n\n\n  // render_all()\n}\n\n\n///////////////////// END DOM GLUE ///////////////////////////////\n","/**\n *\n * The entry point to the Ripple Map app (RM)\n * Binds the RM app to the Preact renderer\n *\n */\n\nimport './styles/main.css'\n\n// TODO: do we need h, Component below?\n\nimport {render, h} from 'preact'\nimport Sidebar from './Sidebar/Sidebar'\n\nimport {init, on_render} from 'app/main'\n\nimport {update_conversation as yuck} from 'convo'\nimport {force_rerender as f__r} from 'render'\nwindow.yuck = yuck\nwindow.f__r = f__r\n\n\ninit() // engage the application\n\nlet root\nlet renderer = () => root = render(h(Sidebar, null), document.getElementById('sidebar'), root)\n\non_render(renderer) // connect the preact renderer\n"],"names":["VNode","nodeName","attributes","children","key","stack","EMPTY_CHILDREN","h","lastSimple","child","simple","i","arguments","length","push","pop","Array","String","p","undefined","options","vnode","extend","obj","props","clone","delve","split","isFunction","isString","hashToClassName","c","str","prop","lcCache","toLowerCase","s","resolved","Promise","resolve","defer","then","f","setTimeout","NO_RENDER","SYNC_RENDER","FORCE_RENDER","ASYNC_RENDER","EMPTY","ATTR_KEY","Symbol","for","NON_DIMENSION_PROPS","boxFlexGroup","columnCount","fillOpacity","flex","flexGrow","flexShrink","flexNegative","fontWeight","lineClamp","lineHeight","order","orphans","strokeOpacity","widows","zIndex","zoom","NON_BUBBLING_EVENTS","blur","error","focus","load","resize","scroll","createLinkedState","component","eventPath","path","e","t","target","state","v","type","match","checked","value","setState","items","enqueueRender","_dirty","debounceRendering","rerender","list","renderComponent","isFunctionalComponent","prototype","render","buildFunctionalComponent","context","getNodeProps","isSameNodeType","node","Text","_componentConstructor","isNamedNode","normalizedNodeName","defaultProps","removeNode","parentNode","removeChild","setAccessor","name","old","isSvg","className","style","cssText","innerHTML","__html","l","_listeners","substring","addEventListener","eventProxy","removeEventListener","removeAttribute","ns","removeAttributeNS","setAttributeNS","setAttribute","setProperty","event","nodes","collectNode","Element","_component","createNode","document","createElementNS","createElement","mounts","diffLevel","isSvgMode","hydrating","flushMounts","afterMount","componentDidMount","diff","dom","mountAll","parent","componentRoot","ownerSVGElement","ret","idiff","appendChild","ref","nodeValue","recollectNodeTree","createTextNode","buildComponentFromVNode","out","vchildren","firstChild","replaceChild","fc","a","nextSibling","dangerouslySetInnerHTML","prevSvgMode","innerDiffNode","absorb","originalChildren","childNodes","keyed","keyedLen","min","len","childrenLen","vlen","j","vchild","__key","insertBefore","unmountOnly","lastChild","diffAttributes","attrs","components","collectComponent","constructor","createComponent","Ctor","inst","call","nextBase","splice","setComponentProps","opts","_disable","__ref","base","componentWillMount","componentWillReceiveProps","prevContext","prevProps","syncComponentUpdates","isChild","skip","rendered","previousProps","previousState","prevState","previousContext","isUpdate","initialBase","initialChildComponent","cbase","shouldComponentUpdate","componentWillUpdate","getChildContext","childComponent","toUnmount","childProps","_parentComponent","baseParent","componentRef","unshift","componentDidUpdate","afterUpdate","cb","_renderCallbacks","fn","originalComponent","oldDom","isDirectOwner","isOwner","unmountComponent","remove","beforeUnmount","componentWillUnmount","inner","componentDidUnmount","Component","_linkedStates","callback","merge","classMaker","b","class_1","class_2","Tab","id","currentView","icon","changeView","tabClasses","iconClasses","tabs","TabBar","renderTabs","map","tab","Header","genClassName","Button","buttonStyle","onClick","Home","About","org","tags","facts","tagkeys","query","safe_mode","all_edges","admin_mode","my_maxyear","my_minyear","show_labels","current_year","filter_sentences","ring_radius","loaded","add_to_server_facts","live_item","item","Object","keys","reduce","acc","indexOf","_out","_id","_in","fact","email","persist","G","debounce","func","wait","immediate","timeout","args","later","apply","callNow","send_data_to_server","data","url","console","log","method","JSON","stringify","response","json","result","get_facts_from_server","parse","localStorage","catch","err","noop","eq","attr","val","unique","k","truncate","to","substr","push_it","pipe","all_funs","slice","magic_pipe","funs","fun","shift","async","new_data","mess","cats","adders","thing","add_thing","action","add_action","edge","add_edge","effect","happening","get_node","catstr","typestr","convert_props","cat","add_alias","alias","aliases","priority","new_thing_type","properties","cattype","cc","start","end","forEach","new_action_type","edges","did","dir","plural","label","types","the","new_effect_type","by","was","during","new_happening_type","at","from","timerange","add_to_graph","get_new_id","addVertex","addEdge","Math","random","isArray","Dagoba","graph","addtag","tag","removetag","index","add_data","fact_to_graph","capture_facts","tree","factor_facts","filter_facts","get_tagkeys","add","edit","filter","set_intersect","user","xs","ys","x","convo","new_conversation","restart_sentence","current","new_sentence","update_conversation","values","conversation","wants","slots","fulfill_desire","filled","sentence","sentences","give_word","subject","verb","object","date","slot","oldkey","word","time","Date","getTime","run","el","els","default_el","el_id","getElementById","set_el","login","preventDefault","click_tagnames","ev","innerText","global_keydown","tagName","keyCode","which","key_e","key_f","key_l","key_n","key_p","tilde","larro","uarro","rarro","darro","submit_addtag","keyup_sentences","span","classList","contains","textContent","getAttribute","vertexIndex","id1","id2","node1","concat","pub","spans","querySelectorAll","click_sentences","removeVertex","submit_convo","fields","currentTarget","elements","activate","vertex","active","deactivate","highlight","unhighlight","add_svg_listeners","highlight_edge","ids","edge_click","edge_hover","good_edges","highlight_node","both","highlightyo","activate_node","node_click","node_hover","good_nodes","highlight_target","highlight_fun","activate_highlighter","highlight_event","deactivate_highlighter","matches","dataset","Boolean","o_or_f","mouseover_tagnames","mouseout_tagnames","renderers","add_renderer","render_requested","force_rerender","requestAnimationFrame","ctx","getContext","viz_pipe","word_pipe","wyrd_pipe","init","mod","sg_compact","likenamed","cluster","cloneflat","set_year","data_to_graph","add_fakes","set_coords","set_score","minimize_edge_length","remove_fakes","unique_y_pos","filter_by_year","filter_nodes","add_rings","add_ring_labels","copy_edges","copy_nodes","add_node_labels","add_edge_labels","clear_it_svg","draw_it_svg","draw_metadata","get_actions","filter_actions","make_sentences","write_sentences","filter_active","render_pipe","env","head","body","tail","window","filter_poo","get_sentence_html","output_html","get_active_sentence_html","get_viz_html","get_convo_html","render_conversation","g","newg","others","other","Infinity","oo","some","namemap","mergeVertices","clusters","names","bind","minyear","maxyear","params","years","V","year","getFullYear","E","vertices","yearstr","fake","copies","fakes","offset","radius","nabes","arc","PI","deg","cx","cos","cy","sin","edge_count","shape","y","r","score","sort","peers","score_sort","peer","new_node_score","new_peer_score","swap","n1","n2","score_edge","self","dx","abs","dy","sqrt","threshold","coords","closest","da","modify_coords","find_closest","n","floor","max","filters","includes","color","shapes","stroke","fill","line","labels","hues","x1","y1","x2","y2","ghost","outcome","person","colour","svg","draw_shape","draw_circle","draw_line","draw_text","font","draw_angle_text","stroke_color","fill_color","line_width","u_id","fromx","fromy","tox","toy","font_size","isNaN","fillstyle","padding","math","avail","pad","texttodraw","measuretext","width","angle","atan2","pi","save","textalign","translate","rotate","filltext","restore","actions","construct","notme","oldyear","innerwords","highlight_count","classes","template","admin_template","sentence_classes","text","classtext","join","datatext","button","notes","make_datalist","inputs","prelude","inject_value","input","make_word_input","make_type_input","make_date_input","catnames","datalist","make_select_list","Number","isInteger","set_minus","showtags","tagstr","unused","optionstr","YourSelection","Current","LegendItem","filter_is_on","currentFilters","filter_key","containerStyles","circleStyles","size","selected","textStyles","toggleFilter","LegendNodes","LegendEdges","Legend","cur_filters","filter_exists","renderNodes","renderActions","paddingRight","paddingLeft","consent_disclaimer","thanks","Story","textAlign","Sidebar","view_id","renderSelectedView","Filters","location","host","hash","search","pair","tagglue","yuck","f__r","root","renderer","on_render"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA,AAAO,SAASA,KAAT,CAAeC,QAAf,EAAyBC,UAAzB,EAAqCC,QAArC,EAA+C;;MAEhDF,QAAL,GAAgBA,QAAhB;;;MAGKC,UAAL,GAAkBA,UAAlB;;;MAGKC,QAAL,GAAgBA,QAAhB;;;MAGKC,GAAL,GAAWF,cAAcA,WAAWE,GAApC;;;ACZD;;;;AAIA,cAAe;;;;;;;;;;;;;;;;;;;;;;CAAf;;ACAA,IAAMC,QAAQ,EAAd;;AAEA,IAAMC,iBAAiB,EAAvB;;;;;;;;;;;AAWA,AAAO,SAASC,CAAT,CAAWN,QAAX,EAAqBC,UAArB,EAAiC;KACnCC,iBAAJ;KAAcK,mBAAd;KAA0BC,cAA1B;KAAiCC,eAAjC;KAAyCC,UAAzC;MACKA,IAAEC,UAAUC,MAAjB,EAAyBF,MAAM,CAA/B,GAAoC;QAC7BG,IAAN,CAAWF,UAAUD,CAAV,CAAX;;KAEGT,cAAcA,WAAWC,QAA7B,EAAuC;MAClC,CAACE,MAAMQ,MAAX,EAAmBR,MAAMS,IAAN,CAAWZ,WAAWC,QAAtB;SACZD,WAAWC,QAAlB;;QAEME,MAAMQ,MAAb,EAAqB;MAChB,CAACJ,QAAQJ,MAAMU,GAAN,EAAT,aAAiCC,KAArC,EAA4C;QACtCL,IAAEF,MAAMI,MAAb,EAAqBF,GAArB;UAAkCG,IAAN,CAAWL,MAAME,CAAN,CAAX;;GAD7B,MAGK,IAAIF,SAAO,IAAP,IAAeA,UAAQ,IAAvB,IAA+BA,UAAQ,KAA3C,EAAkD;OAClD,OAAOA,KAAP,IAAc,QAAlB,EAA4BA,QAAQQ,OAAOR,KAAP,CAAR;YACnB,OAAOA,KAAP,IAAc,QAAvB;OACIC,UAAUF,UAAd,EAA0B;aAChBL,SAASU,MAAT,GAAgB,CAAzB,KAA+BJ,KAA/B;IADD,MAGK;KACHN,aAAaA,WAAW,EAAxB,CAAD,EAA8BW,IAA9B,CAAmCL,KAAnC;iBACaC,MAAb;;;;;KAKCQ,IAAI,IAAIlB,KAAJ,CAAUC,QAAV,EAAoBC,cAAciB,SAAlC,EAA6ChB,YAAYG,cAAzD,CAAR;;;KAGIc,QAAQC,KAAZ,EAAmBD,QAAQC,KAAR,CAAcH,CAAd;;QAEZA,CAAP;;;AChDD;;;;AAIA,AAAO,SAASI,MAAT,CAAgBC,GAAhB,EAAqBC,KAArB,EAA4B;KAC9BA,KAAJ,EAAW;OACL,IAAIb,CAAT,IAAca,KAAd;OAAyBb,CAAJ,IAASa,MAAMb,CAAN,CAAT;;;QAEfY,GAAP;;;;;;AAOD,AAAO,SAASE,KAAT,CAAeF,GAAf,EAAoB;QACnBD,OAAO,EAAP,EAAWC,GAAX,CAAP;;;;;;AAOD,AAAO,SAASG,KAAT,CAAeH,GAAf,EAAoBnB,GAApB,EAAyB;MAC1B,IAAIc,IAAEd,IAAIuB,KAAJ,CAAU,GAAV,CAAN,EAAsBhB,IAAE,CAA7B,EAAgCA,IAAEO,EAAEL,MAAJ,IAAcU,GAA9C,EAAmDZ,GAAnD,EAAwD;QACjDY,IAAIL,EAAEP,CAAF,CAAJ,CAAN;;QAEMY,GAAP;;;;AAKD,AAAO,SAASK,UAAT,CAAoBL,GAApB,EAAyB;QACxB,eAAa,OAAOA,GAA3B;;;;AAKD,AAAO,SAASM,QAAT,CAAkBN,GAAlB,EAAuB;QACtB,aAAW,OAAOA,GAAzB;;;;;;AAOD,AAAO,SAASO,eAAT,CAAyBC,CAAzB,EAA4B;KAC9BC,MAAM,EAAV;MACK,IAAIC,IAAT,IAAiBF,CAAjB,EAAoB;MACfA,EAAEE,IAAF,CAAJ,EAAa;OACRD,GAAJ,EAASA,OAAO,GAAP;UACFC,IAAP;;;QAGKD,GAAP;;;;AAKD,IAAIE,UAAU,EAAd;AACA,AAAO,IAAMC,cAAc,SAAdA,WAAc;QAAKD,QAAQE,CAAR,MAAeF,QAAQE,CAAR,IAAaA,EAAED,WAAF,EAA5B,CAAL;CAApB;;;;;AAMP,IAAIE,WAAW,OAAOC,OAAP,KAAiB,WAAjB,IAAgCA,QAAQC,OAAR,EAA/C;AACA,AAAO,IAAMC,QAAQH,WAAY,aAAK;UAAWI,IAAT,CAAcC,CAAd;CAAnB,GAA0CC,UAAxD;;ACnEP;;AAEA,AAAO,IAAMC,YAAY,CAAlB;AACP,AAAO,IAAMC,cAAc,CAApB;AACP,AAAO,IAAMC,eAAe,CAArB;AACP,AAAO,IAAMC,eAAe,CAArB;;AAEP,AAAO,IAAMC,QAAQ,EAAd;;AAEP,AAAO,IAAMC,WAAW,OAAOC,MAAP,KAAgB,WAAhB,GAA8BA,OAAOC,GAAP,CAAW,YAAX,CAA9B,GAAyD,eAA1E;;;AAGP,AAAO,IAAMC,sBAAsB;UAC1B,CAD0B,EACvBC,cAAa,CADU,EACPC,aAAY,CADL,EACQC,aAAY,CADpB,EACuBC,MAAK,CAD5B,EAC+BC,UAAS,CADxC;eAErB,CAFqB,EAElBC,YAAW,CAFO,EAEJC,cAAa,CAFT,EAEYC,YAAW,CAFvB,EAE0BC,WAAU,CAFpC,EAEuCC,YAAW,CAFlD;UAG1B,CAH0B,EAGvBC,OAAM,CAHiB,EAGdC,SAAQ,CAHM,EAGHC,eAAc,CAHX,EAGcC,QAAO,CAHrB,EAGwBC,QAAO,CAH/B,EAGkCC,MAAK;CAHnE;;;AAOP,AAAO,IAAMC,sBAAsB,EAAEC,MAAK,CAAP,EAAUC,OAAM,CAAhB,EAAmBC,OAAM,CAAzB,EAA4BC,MAAK,CAAjC,EAAoCC,QAAO,CAA3C,EAA8CC,QAAO,CAArD,EAA5B;;ACVA,SAASC,iBAAT,CAA2BC,SAA3B,EAAsCzE,GAAtC,EAA2C0E,SAA3C,EAAsD;KACxDC,OAAO3E,IAAIuB,KAAJ,CAAU,GAAV,CAAX;QACO,UAASqD,CAAT,EAAY;MACdC,IAAID,KAAKA,EAAEE,MAAP,IAAiB,IAAzB;MACCC,QAAQ,EADT;MAEC5D,MAAM4D,KAFP;MAGCC,IAAIvD,SAASiD,SAAT,IAAsBpD,MAAMsD,CAAN,EAASF,SAAT,CAAtB,GAA4CG,EAAEhF,QAAF,GAAcgF,EAAEI,IAAF,CAAOC,KAAP,CAAa,UAAb,IAA2BL,EAAEM,OAA7B,GAAuCN,EAAEO,KAAvD,GAAgER,CAHjH;MAICrE,IAAI,CAJL;SAKQA,IAAEoE,KAAKlE,MAAL,GAAY,CAAtB,EAAyBF,GAAzB,EAA8B;SACvBY,IAAIwD,KAAKpE,CAAL,CAAJ,MAAiBY,IAAIwD,KAAKpE,CAAL,CAAJ,IAAe,CAACA,CAAD,IAAMkE,UAAUM,KAAV,CAAgBJ,KAAKpE,CAAL,CAAhB,CAAN,IAAkC,EAAlE,CAAN;;MAEGoE,KAAKpE,CAAL,CAAJ,IAAeyE,CAAf;YACUK,QAAV,CAAmBN,KAAnB;EAVD;;;ACJD,IAAIO,QAAQ,EAAZ;;AAEA,AAAO,SAASC,aAAT,CAAuBd,SAAvB,EAAkC;KACpC,CAACA,UAAUe,MAAX,KAAsBf,UAAUe,MAAV,GAAmB,IAAzC,KAAkDF,MAAM5E,IAAN,CAAW+D,SAAX,KAAuB,CAA7E,EAAgF;GAC9EzD,QAAQyE,iBAAR,IAA6BrD,KAA9B,EAAqCsD,QAArC;;;;AAKF,AAAO,SAASA,QAAT,GAAoB;KACtB5E,UAAJ;KAAO6E,OAAOL,KAAd;SACQ,EAAR;QACSxE,IAAI6E,KAAKhF,GAAL,EAAb,EAA2B;MACtBG,EAAE0E,MAAN,EAAcI,gBAAgB9E,CAAhB;;;;ACTT,SAAS+E,qBAAT,CAA+B5E,KAA/B,EAAsC;MACxCpB,WAAWoB,SAASA,MAAMpB,QAA9B;SACOA,YAAY2B,WAAW3B,QAAX,CAAZ,IAAoC,EAAEA,SAASiG,SAAT,IAAsBjG,SAASiG,SAAT,CAAmBC,MAA3C,CAA3C;;;;;;;AASD,AAAO,SAASC,wBAAT,CAAkC/E,KAAlC,EAAyCgF,OAAzC,EAAkD;SACjDhF,MAAMpB,QAAN,CAAeqG,aAAajF,KAAb,CAAf,EAAoCgF,WAAWrD,KAA/C,CAAP;;;ACdM,SAASuD,cAAT,CAAwBC,IAAxB,EAA8BnF,KAA9B,EAAqC;KACvCQ,SAASR,KAAT,CAAJ,EAAqB;SACbmF,gBAAgBC,IAAvB;;KAEG5E,SAASR,MAAMpB,QAAf,CAAJ,EAA8B;SACtB,CAACuG,KAAKE,qBAAN,IAA+BC,YAAYH,IAAZ,EAAkBnF,MAAMpB,QAAxB,CAAtC;;KAEG2B,WAAWP,MAAMpB,QAAjB,CAAJ,EAAgC;SACxB,CAACuG,KAAKE,qBAAL,GAA6BF,KAAKE,qBAAL,KAA6BrF,MAAMpB,QAAhE,GAA2E,IAA5E,KAAqFgG,sBAAsB5E,KAAtB,CAA5F;;;;AAKF,AAAO,SAASsF,WAAT,CAAqBH,IAArB,EAA2BvG,QAA3B,EAAqC;QACpCuG,KAAKI,kBAAL,KAA0B3G,QAA1B,IAAsCkC,YAAYqE,KAAKvG,QAAjB,MAA6BkC,YAAYlC,QAAZ,CAA1E;;;;;;;;;;AAWD,AAAO,SAASqG,YAAT,CAAsBjF,KAAtB,EAA6B;KAC/BG,QAAQC,MAAMJ,MAAMnB,UAAZ,CAAZ;OACMC,QAAN,GAAiBkB,MAAMlB,QAAvB;;KAEI0G,eAAexF,MAAMpB,QAAN,CAAe4G,YAAlC;KACIA,YAAJ,EAAkB;OACZ,IAAIlG,CAAT,IAAckG,YAAd,EAA4B;OACvBrF,MAAMb,CAAN,MAAWQ,SAAf,EAA0B;UACnBR,CAAN,IAAWkG,aAAalG,CAAb,CAAX;;;;;QAKIa,KAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvCM,SAASsF,UAAT,CAAoBN,IAApB,EAA0B;KAC5BtF,IAAIsF,KAAKO,UAAb;KACI7F,CAAJ,EAAOA,EAAE8F,WAAF,CAAcR,IAAd;;;;;;;;;;;;AAaR,AAAO,SAASS,WAAT,CAAqBT,IAArB,EAA2BU,IAA3B,EAAiCC,GAAjC,EAAsC3B,KAAtC,EAA6C4B,KAA7C,EAAoD;;KAEtDF,SAAO,WAAX,EAAwBA,OAAO,OAAP;;KAEpBA,SAAO,OAAP,IAAkB1B,KAAlB,IAA2B,QAAOA,KAAP,yCAAOA,KAAP,OAAe,QAA9C,EAAwD;UAC/C1D,gBAAgB0D,KAAhB,CAAR;;;KAGG0B,SAAO,KAAX,EAAkB;;EAAlB,MAGK,IAAIA,SAAO,OAAP,IAAkB,CAACE,KAAvB,EAA8B;OAC7BC,SAAL,GAAiB7B,SAAS,EAA1B;EADI,MAGA,IAAI0B,SAAO,OAAX,EAAoB;MACpB,CAAC1B,KAAD,IAAU3D,SAAS2D,KAAT,CAAV,IAA6B3D,SAASsF,GAAT,CAAjC,EAAgD;QAC1CG,KAAL,CAAWC,OAAX,GAAqB/B,SAAS,EAA9B;;MAEGA,SAAS,QAAOA,KAAP,yCAAOA,KAAP,OAAe,QAA5B,EAAsC;OACjC,CAAC3D,SAASsF,GAAT,CAAL,EAAoB;SACd,IAAIxG,CAAT,IAAcwG,GAAd;SAAuB,EAAExG,KAAK6E,KAAP,CAAJ,EAAmBgB,KAAKc,KAAL,CAAW3G,CAAX,IAAgB,EAAhB;;;QAElC,IAAIA,EAAT,IAAc6E,KAAd,EAAqB;SACf8B,KAAL,CAAW3G,EAAX,IAAgB,OAAO6E,MAAM7E,EAAN,CAAP,KAAkB,QAAlB,IAA8B,CAACyC,oBAAoBzC,EAApB,CAA/B,GAAyD6E,MAAM7E,EAAN,IAAS,IAAlE,GAA0E6E,MAAM7E,EAAN,CAA1F;;;EATE,MAaA,IAAIuG,SAAO,yBAAX,EAAsC;MACtC1B,KAAJ,EAAWgB,KAAKgB,SAAL,GAAiBhC,MAAMiC,MAAN,IAAgB,EAAjC;EADP,MAGA,IAAIP,KAAK,CAAL,KAAS,GAAT,IAAgBA,KAAK,CAAL,KAAS,GAA7B,EAAkC;MAClCQ,IAAIlB,KAAKmB,UAAL,KAAoBnB,KAAKmB,UAAL,GAAkB,EAAtC,CAAR;SACOxF,YAAY+E,KAAKU,SAAL,CAAe,CAAf,CAAZ,CAAP;;;MAGIpC,KAAJ,EAAW;OACN,CAACkC,EAAER,IAAF,CAAL,EAAcV,KAAKqB,gBAAL,CAAsBX,IAAtB,EAA4BY,UAA5B,EAAwC,CAAC,CAACzD,oBAAoB6C,IAApB,CAA1C;GADf,MAGK,IAAIQ,EAAER,IAAF,CAAJ,EAAa;QACZa,mBAAL,CAAyBb,IAAzB,EAA+BY,UAA/B,EAA2C,CAAC,CAACzD,oBAAoB6C,IAApB,CAA7C;;IAECA,IAAF,IAAU1B,KAAV;EAXI,MAaA,IAAI0B,SAAO,MAAP,IAAiBA,SAAO,MAAxB,IAAkC,CAACE,KAAnC,IAA4CF,QAAQV,IAAxD,EAA8D;cACtDA,IAAZ,EAAkBU,IAAlB,EAAwB1B,SAAO,IAAP,GAAc,EAAd,GAAmBA,KAA3C;MACIA,SAAO,IAAP,IAAeA,UAAQ,KAA3B,EAAkCgB,KAAKwB,eAAL,CAAqBd,IAArB;EAF9B,MAIA;MACAe,KAAKb,SAASF,KAAK5B,KAAL,CAAW,eAAX,CAAlB;MACIE,SAAO,IAAP,IAAeA,UAAQ,KAA3B,EAAkC;OAC7ByC,EAAJ,EAAQzB,KAAK0B,iBAAL,CAAuB,8BAAvB,EAAuD/F,YAAY8F,GAAG,CAAH,CAAZ,CAAvD,EAAR,KACKzB,KAAKwB,eAAL,CAAqBd,IAArB;GAFN,MAIK,IAAI,QAAO1B,KAAP,yCAAOA,KAAP,OAAe,QAAf,IAA2B,CAAC5D,WAAW4D,KAAX,CAAhC,EAAmD;OACnDyC,EAAJ,EAAQzB,KAAK2B,cAAL,CAAoB,8BAApB,EAAoDhG,YAAY8F,GAAG,CAAH,CAAZ,CAApD,EAAwEzC,KAAxE,EAAR,KACKgB,KAAK4B,YAAL,CAAkBlB,IAAlB,EAAwB1B,KAAxB;;;;;;;;AASR,SAAS6C,WAAT,CAAqB7B,IAArB,EAA2BU,IAA3B,EAAiC1B,KAAjC,EAAwC;KACnC;OACE0B,IAAL,IAAa1B,KAAb;EADD,CAEE,OAAOR,CAAP,EAAU;;;;;;AAOb,SAAS8C,UAAT,CAAoB9C,CAApB,EAAuB;QACf,KAAK2C,UAAL,CAAgB3C,EAAEK,IAAlB,EAAwBjE,QAAQkH,KAAR,IAAiBlH,QAAQkH,KAAR,CAActD,CAAd,CAAjB,IAAqCA,CAA7D,CAAP;;;AC7FD,IAAMuD,QAAQ,EAAd;;AAEA,AAAO,SAASC,WAAT,CAAqBhC,IAArB,EAA2B;YACtBA,IAAX;;KAEIA,gBAAgBiC,OAApB,EAA6B;OACvBC,UAAL,GAAkBlC,KAAKE,qBAAL,GAA6B,IAA/C;;MAEIQ,OAAOV,KAAKI,kBAAL,IAA2BzE,YAAYqE,KAAKvG,QAAjB,CAAtC;GACCsI,MAAMrB,IAAN,MAAgBqB,MAAMrB,IAAN,IAAc,EAA9B,CAAD,EAAoCpG,IAApC,CAAyC0F,IAAzC;;;;AAKF,AAAO,SAASmC,UAAT,CAAoB1I,QAApB,EAA8BmH,KAA9B,EAAqC;KACvCF,OAAO/E,YAAYlC,QAAZ,CAAX;KACCuG,OAAO+B,MAAMrB,IAAN,KAAeqB,MAAMrB,IAAN,EAAYnG,GAAZ,EAAf,KAAqCqG,QAAQwB,SAASC,eAAT,CAAyB,4BAAzB,EAAuD5I,QAAvD,CAAR,GAA2E2I,SAASE,aAAT,CAAuB7I,QAAvB,CAAhH,CADR;MAEK2G,kBAAL,GAA0BM,IAA1B;QACOV,IAAP;;;ACXM,IAAMuC,SAAS,EAAf;;;AAGP,AAAO,IAAIC,YAAY,CAAhB;;;AAGP,IAAIC,YAAY,KAAhB;;;AAGA,IAAIC,YAAY,KAAhB;;;AAGA,AAAO,SAASC,WAAT,GAAuB;KACzBpH,UAAJ;QACQA,IAAEgH,OAAOhI,GAAP,EAAV,EAAyB;MACpBK,QAAQgI,UAAZ,EAAwBhI,QAAQgI,UAAR,CAAmBrH,CAAnB;MACpBA,EAAEsH,iBAAN,EAAyBtH,EAAEsH,iBAAF;;;;;;;;;;AAW3B,AAAO,SAASC,IAAT,CAAcC,GAAd,EAAmBlI,KAAnB,EAA0BgF,OAA1B,EAAmCmD,QAAnC,EAA6CC,MAA7C,EAAqDC,aAArD,EAAoE;;KAEtE,CAACV,WAAL,EAAkB;;cAELS,UAAU,OAAOA,OAAOE,eAAd,KAAgC,WAAtD;;;cAGYJ,OAAO,EAAEtG,YAAYsG,GAAd,CAAnB;;;KAGGK,MAAMC,MAAMN,GAAN,EAAWlI,KAAX,EAAkBgF,OAAlB,EAA2BmD,QAA3B,CAAV;;;KAGIC,UAAUG,IAAI7C,UAAJ,KAAiB0C,MAA/B,EAAuCA,OAAOK,WAAP,CAAmBF,GAAnB;;;KAGnC,IAAGZ,SAAP,EAAkB;cACL,KAAZ;;MAEI,CAACU,aAAL,EAAoBP;;;QAGdS,GAAP;;;AAID,SAASC,KAAT,CAAeN,GAAf,EAAoBlI,KAApB,EAA2BgF,OAA3B,EAAoCmD,QAApC,EAA8C;KACzCO,MAAM1I,SAASA,MAAMnB,UAAf,IAA6BmB,MAAMnB,UAAN,CAAiB6J,GAAxD;;;QAIO9D,sBAAsB5E,KAAtB,CAAP,EAAqC;UAC5B+E,yBAAyB/E,KAAzB,EAAgCgF,OAAhC,CAAR;;;;KAKGhF,SAAO,IAAX,EAAiBA,QAAQ,EAAR;;;KAIbQ,SAASR,KAAT,CAAJ,EAAqB;;MAEhBkI,OAAOA,eAAe9C,IAAtB,IAA8B8C,IAAIxC,UAAtC,EAAkD;OAC7CwC,IAAIS,SAAJ,IAAe3I,KAAnB,EAA0B;QACrB2I,SAAJ,GAAgB3I,KAAhB;;GAFF,MAKK;;OAEAkI,GAAJ,EAASU,kBAAkBV,GAAlB;SACHX,SAASsB,cAAT,CAAwB7I,KAAxB,CAAN;;;SAGMkI,GAAP;;;;KAKG3H,WAAWP,MAAMpB,QAAjB,CAAJ,EAAgC;SACxBkK,wBAAwBZ,GAAxB,EAA6BlI,KAA7B,EAAoCgF,OAApC,EAA6CmD,QAA7C,CAAP;;;KAIGY,MAAMb,GAAV;KACCtJ,WAAWgB,OAAOI,MAAMpB,QAAb,CADZ;;eAEegJ,SAFf;KAGCoB,YAAYhJ,MAAMlB,QAHnB;;;;aAQYF,aAAW,KAAX,GAAmB,IAAnB,GAA0BA,aAAW,eAAX,GAA6B,KAA7B,GAAqCgJ,SAA3E;;KAGI,CAACM,GAAL,EAAU;;;QAGHZ,WAAW1I,QAAX,EAAqBgJ,SAArB,CAAN;EAHD,MAKK,IAAI,CAACtC,YAAY4C,GAAZ,EAAiBtJ,QAAjB,CAAL,EAAiC;;;;;QAK/B0I,WAAW1I,QAAX,EAAqBgJ,SAArB,CAAN;;;SAGOM,IAAIe,UAAX;OAA2BR,WAAJ,CAAgBP,IAAIe,UAApB;GARc;MAWjCf,IAAIxC,UAAR,EAAoBwC,IAAIxC,UAAJ,CAAewD,YAAf,CAA4BH,GAA5B,EAAiCb,GAAjC;;;oBAGFA,GAAlB;;;KAIGiB,KAAKJ,IAAIE,UAAb;KACC9I,QAAQ4I,IAAInH,QAAJ,CADT;;;;KAKI,CAACzB,KAAL,EAAY;MACPyB,QAAJ,IAAgBzB,QAAQ,EAAxB;OACK,IAAIiJ,IAAEL,IAAIlK,UAAV,EAAsBS,IAAE8J,EAAE5J,MAA/B,EAAuCF,GAAvC;SAAoD8J,EAAE9J,CAAF,EAAKuG,IAAX,IAAmBuD,EAAE9J,CAAF,EAAK6E,KAAxB;;;;;KAI3C,CAAC0D,SAAD,IAAcmB,SAAd,IAA2BA,UAAUxJ,MAAV,KAAmB,CAA9C,IAAmD,OAAOwJ,UAAU,CAAV,CAAP,KAAsB,QAAzE,IAAqFG,EAArF,IAA2FA,cAAc/D,IAAzG,IAAiH,CAAC+D,GAAGE,WAAzH,EAAsI;MACjIF,GAAGR,SAAH,IAAcK,UAAU,CAAV,CAAlB,EAAgC;MAC5BL,SAAH,GAAeK,UAAU,CAAV,CAAf;;;;MAIG,IAAIA,aAAaA,UAAUxJ,MAAvB,IAAiC2J,EAArC,EAAyC;iBAC/BJ,GAAd,EAAmBC,SAAnB,EAA8BhE,OAA9B,EAAuCmD,QAAvC,EAAiD,CAAC,CAAChI,MAAMmJ,uBAAzD;;;;gBAKcP,GAAf,EAAoB/I,MAAMnB,UAA1B,EAAsCsB,KAAtC;;;KAIIuI,GAAJ,EAAS;GACPvI,MAAMuI,GAAN,GAAYA,GAAb,EAAkBK,GAAlB;;;aAGWQ,WAAZ;;QAEOR,GAAP;;;;;;;;;;AAWD,SAASS,aAAT,CAAuBtB,GAAvB,EAA4Bc,SAA5B,EAAuChE,OAAvC,EAAgDmD,QAAhD,EAA0DsB,MAA1D,EAAkE;KAC7DC,mBAAmBxB,IAAIyB,UAA3B;KACC7K,WAAW,EADZ;KAEC8K,QAAQ,EAFT;KAGCC,WAAW,CAHZ;KAICC,MAAM,CAJP;KAKCC,MAAML,iBAAiBlK,MALxB;KAMCwK,cAAc,CANf;KAOCC,OAAOjB,aAAaA,UAAUxJ,MAP/B;KAQC0K,UARD;KAQIxJ,UARJ;KAQOyJ,eARP;KAQe/K,cARf;;KAUI2K,GAAJ,EAAS;OACH,IAAIzK,IAAE,CAAX,EAAcA,IAAEyK,GAAhB,EAAqBzK,GAArB,EAA0B;OACrBF,SAAQsK,iBAAiBpK,CAAjB,CAAZ;OACCa,QAAQf,OAAMwC,QAAN,CADT;OAEC7C,MAAMkL,OAAQ,CAACvJ,IAAItB,OAAMiI,UAAX,IAAyB3G,EAAE0J,KAA3B,GAAmCjK,QAAQA,MAAMpB,GAAd,GAAoB,IAA/D,GAAuE,IAF9E;OAGIA,OAAK,IAAT,EAAe;;UAERA,GAAN,IAAaK,MAAb;IAFD,MAIK,IAAIyI,aAAa4B,MAAb,IAAuBtJ,KAAvB,IAAgCf,kBAAiBgG,IAArD,EAA2D;aACtD4E,aAAT,IAA0B5K,MAA1B;;;;;KAKC6K,IAAJ,EAAU;OACJ,IAAI3K,KAAE,CAAX,EAAcA,KAAE2K,IAAhB,EAAsB3K,IAAtB,EAA2B;YACjB0J,UAAU1J,EAAV,CAAT;WACQ,IAAR;;;;;;;OAOIP,OAAMoL,OAAOpL,GAAjB;OACIA,QAAK,IAAT,EAAe;QACV8K,YAAY9K,QAAO6K,KAAvB,EAA8B;aACrBA,MAAM7K,IAAN,CAAR;WACMA,IAAN,IAAae,SAAb;;;;;QAKG,IAAI,CAACV,KAAD,IAAU0K,MAAIE,WAAlB,EAA+B;UAC9BE,IAAEJ,GAAP,EAAYI,IAAEF,WAAd,EAA2BE,GAA3B,EAAgC;UAC3BpL,SAASoL,CAAT,CAAJ;UACIxJ,KAAKwE,eAAexE,CAAf,EAAkByJ,MAAlB,CAAT,EAAoC;eAC3BzJ,CAAR;gBACSwJ,CAAT,IAAcpK,SAAd;WACIoK,MAAIF,cAAY,CAApB,EAAuBA;WACnBE,MAAIJ,GAAR,EAAaA;;;;;;;WAORtB,MAAMpJ,KAAN,EAAa+K,MAAb,EAAqBnF,OAArB,EAA8BmD,QAA9B,CAAR;;OAEI/I,SAASA,UAAQ8I,GAArB,EAA0B;QACrB5I,MAAGyK,GAAP,EAAY;SACPtB,WAAJ,CAAgBrJ,KAAhB;KADD,MAGK,IAAIA,UAAQsK,iBAAiBpK,EAAjB,CAAZ,EAAiC;SACjCF,UAAQsK,iBAAiBpK,KAAE,CAAnB,CAAZ,EAAmC;iBACvBoK,iBAAiBpK,EAAjB,CAAX;;SAEG+K,YAAJ,CAAiBjL,KAAjB,EAAwBsK,iBAAiBpK,EAAjB,KAAuB,IAA/C;;;;;;KAOAuK,QAAJ,EAAc;OACR,IAAIvK,GAAT,IAAcsK,KAAd;OAAyBA,MAAMtK,GAAN,CAAJ,EAAcsJ,kBAAkBgB,MAAMtK,GAAN,CAAlB;;;;;QAI7BwK,OAAKE,WAAZ,EAAyB;UAChBlL,SAASkL,aAAT,CAAR;MACI5K,KAAJ,EAAWwJ,kBAAkBxJ,KAAlB;;;;;;;;AAUb,AAAO,SAASwJ,iBAAT,CAA2BzD,IAA3B,EAAiCmF,WAAjC,EAA8C;KAChD9G,YAAY2B,KAAKkC,UAArB;KACI7D,SAAJ,EAAe;;mBAEGA,SAAjB,EAA4B,CAAC8G,WAA7B;EAFD,MAIK;;;MAGAnF,KAAKvD,QAAL,KAAkBuD,KAAKvD,QAAL,EAAe8G,GAArC,EAA0CvD,KAAKvD,QAAL,EAAe8G,GAAf,CAAmB,IAAnB;;MAEtC,CAAC4B,WAAL,EAAkB;eACLnF,IAAZ;;;;;;MAMGzE,UAAJ;SACQA,IAAEyE,KAAKoF,SAAf;qBAA6C7J,CAAlB,EAAqB4J,WAArB;;;;;;;;;;AAW7B,SAASE,cAAT,CAAwBtC,GAAxB,EAA6BuC,KAA7B,EAAoC3E,GAApC,EAAyC;;KAEpCD,aAAJ;MACKA,IAAL,IAAaC,GAAb,EAAkB;MACb,EAAE2E,SAAS5E,QAAQ4E,KAAnB,KAA6B3E,IAAID,IAAJ,KAAW,IAA5C,EAAkD;eACrCqC,GAAZ,EAAiBrC,IAAjB,EAAuBC,IAAID,IAAJ,CAAvB,EAAkCC,IAAID,IAAJ,IAAY/F,SAA9C,EAAyD8H,SAAzD;;;;;KAKE6C,KAAJ,EAAW;OACL5E,IAAL,IAAa4E,KAAb,EAAoB;OACf5E,SAAO,UAAP,IAAqBA,SAAO,WAA5B,KAA4C,EAAEA,QAAQC,GAAV,KAAkB2E,MAAM5E,IAAN,OAAeA,SAAO,OAAP,IAAkBA,SAAO,SAAzB,GAAqCqC,IAAIrC,IAAJ,CAArC,GAAiDC,IAAID,IAAJ,CAAhE,CAA9D,CAAJ,EAA+I;gBAClIqC,GAAZ,EAAiBrC,IAAjB,EAAuBC,IAAID,IAAJ,CAAvB,EAAkCC,IAAID,IAAJ,IAAY4E,MAAM5E,IAAN,CAA9C,EAA2D+B,SAA3D;;;;;;ACvTJ,IAAM8C,aAAa,EAAnB;;AAGA,AAAO,SAASC,gBAAT,CAA0BnH,SAA1B,EAAqC;KACvCqC,OAAOrC,UAAUoH,WAAV,CAAsB/E,IAAjC;KACCnB,OAAOgG,WAAW7E,IAAX,CADR;KAEInB,IAAJ,EAAUA,KAAKjF,IAAL,CAAU+D,SAAV,EAAV,KACKkH,WAAW7E,IAAX,IAAmB,CAACrC,SAAD,CAAnB;;;AAIN,AAAO,SAASqH,eAAT,CAAyBC,IAAzB,EAA+B3K,KAA/B,EAAsC6E,OAAtC,EAA+C;KACjD+F,OAAO,IAAID,IAAJ,CAAS3K,KAAT,EAAgB6E,OAAhB,CAAX;KACCN,OAAOgG,WAAWI,KAAKjF,IAAhB,CADR;WAEUmF,IAAV,CAAeD,IAAf,EAAqB5K,KAArB,EAA4B6E,OAA5B;KACIN,IAAJ,EAAU;OACJ,IAAIpF,IAAEoF,KAAKlF,MAAhB,EAAwBF,GAAxB,GAA+B;OAC1BoF,KAAKpF,CAAL,EAAQsL,WAAR,KAAsBE,IAA1B,EAAgC;SAC1BG,QAAL,GAAgBvG,KAAKpF,CAAL,EAAQ2L,QAAxB;SACKC,MAAL,CAAY5L,CAAZ,EAAe,CAAf;;;;;QAKIyL,IAAP;;;ACZM,SAASI,iBAAT,CAA2B3H,SAA3B,EAAsCrD,KAAtC,EAA6CiL,IAA7C,EAAmDpG,OAAnD,EAA4DmD,QAA5D,EAAsE;KACxE3E,UAAU6H,QAAd,EAAwB;WACdA,QAAV,GAAqB,IAArB;;KAEK7H,UAAU8H,KAAV,GAAkBnL,MAAMuI,GAA7B,EAAmC,OAAOvI,MAAMuI,GAAb;KAC9BlF,UAAU4G,KAAV,GAAkBjK,MAAMpB,GAA7B,EAAmC,OAAOoB,MAAMpB,GAAb;;KAE/B,CAACyE,UAAU+H,IAAX,IAAmBpD,QAAvB,EAAiC;MAC5B3E,UAAUgI,kBAAd,EAAkChI,UAAUgI,kBAAV;EADnC,MAGK,IAAIhI,UAAUiI,yBAAd,EAAyC;YACnCA,yBAAV,CAAoCtL,KAApC,EAA2C6E,OAA3C;;;KAGGA,WAAWA,YAAUxB,UAAUwB,OAAnC,EAA4C;MACvC,CAACxB,UAAUkI,WAAf,EAA4BlI,UAAUkI,WAAV,GAAwBlI,UAAUwB,OAAlC;YAClBA,OAAV,GAAoBA,OAApB;;;KAGG,CAACxB,UAAUmI,SAAf,EAA0BnI,UAAUmI,SAAV,GAAsBnI,UAAUrD,KAAhC;WAChBA,KAAV,GAAkBA,KAAlB;;WAEUkL,QAAV,GAAqB,KAArB;;KAEID,SAAO7J,SAAX,EAAsB;MACjB6J,SAAO5J,WAAP,IAAsBzB,QAAQ6L,oBAAR,KAA+B,KAArD,IAA8D,CAACpI,UAAU+H,IAA7E,EAAmF;mBAClE/H,SAAhB,EAA2BhC,WAA3B,EAAwC2G,QAAxC;GADD,MAGK;iBACU3E,SAAd;;;;KAIEA,UAAU8H,KAAd,EAAqB9H,UAAU8H,KAAV,CAAgB9H,SAAhB;;;;;;;;;AAWtB,AAAO,SAASmB,eAAT,CAAyBnB,SAAzB,EAAoC4H,IAApC,EAA0CjD,QAA1C,EAAoD0D,OAApD,EAA6D;KAC/DrI,UAAU6H,QAAd,EAAwB;;KAEpBS,aAAJ;KAAUC,iBAAV;KACC5L,QAAQqD,UAAUrD,KADnB;KAEC2D,QAAQN,UAAUM,KAFnB;KAGCkB,UAAUxB,UAAUwB,OAHrB;KAICgH,gBAAgBxI,UAAUmI,SAAV,IAAuBxL,KAJxC;KAKC8L,gBAAgBzI,UAAU0I,SAAV,IAAuBpI,KALxC;KAMCqI,kBAAkB3I,UAAUkI,WAAV,IAAyB1G,OAN5C;KAOCoH,WAAW5I,UAAU+H,IAPtB;KAQCN,WAAWzH,UAAUyH,QARtB;KASCoB,cAAcD,YAAYnB,QAT3B;KAUCqB,wBAAwB9I,UAAU6D,UAVnC;KAWC0D,aAXD;KAWOwB,cAXP;;;KAcIH,QAAJ,EAAc;YACHjM,KAAV,GAAkB6L,aAAlB;YACUlI,KAAV,GAAkBmI,aAAlB;YACUjH,OAAV,GAAoBmH,eAApB;MACIf,SAAO3J,YAAP,IACA+B,UAAUgJ,qBADV,IAEAhJ,UAAUgJ,qBAAV,CAAgCrM,KAAhC,EAAuC2D,KAAvC,EAA8CkB,OAA9C,MAA2D,KAF/D,EAEsE;UAC9D,IAAP;GAHD,MAKK,IAAIxB,UAAUiJ,mBAAd,EAAmC;aAC7BA,mBAAV,CAA8BtM,KAA9B,EAAqC2D,KAArC,EAA4CkB,OAA5C;;YAES7E,KAAV,GAAkBA,KAAlB;YACU2D,KAAV,GAAkBA,KAAlB;YACUkB,OAAV,GAAoBA,OAApB;;;WAGS2G,SAAV,GAAsBnI,UAAU0I,SAAV,GAAsB1I,UAAUkI,WAAV,GAAwBlI,UAAUyH,QAAV,GAAqB,IAAzF;WACU1G,MAAV,GAAmB,KAAnB;;KAEI,CAACuH,IAAL,EAAW;MACNtI,UAAUsB,MAAd,EAAsBiH,WAAWvI,UAAUsB,MAAV,CAAiB3E,KAAjB,EAAwB2D,KAAxB,EAA+BkB,OAA/B,CAAX;;;MAGlBxB,UAAUkJ,eAAd,EAA+B;aACpBzM,OAAOG,MAAM4E,OAAN,CAAP,EAAuBxB,UAAUkJ,eAAV,EAAvB,CAAV;;;SAGM9H,sBAAsBmH,QAAtB,CAAP,EAAwC;cAC5BhH,yBAAyBgH,QAAzB,EAAmC/G,OAAnC,CAAX;;;MAGG2H,iBAAiBZ,YAAYA,SAASnN,QAA1C;MACCgO,kBADD;MACYrB,aADZ;;MAGIhL,WAAWoM,cAAX,CAAJ,EAAgC;;;OAG3BE,aAAa5H,aAAa8G,QAAb,CAAjB;UACOO,qBAAP;;OAEIvB,QAAQA,KAAKH,WAAL,KAAmB+B,cAA3B,IAA6CE,WAAW9N,GAAX,IAAgBgM,KAAKX,KAAtE,EAA6E;sBAC1DW,IAAlB,EAAwB8B,UAAxB,EAAoCrL,WAApC,EAAiDwD,OAAjD;IADD,MAGK;gBACQ+F,IAAZ;;WAEOF,gBAAgB8B,cAAhB,EAAgCE,UAAhC,EAA4C7H,OAA5C,CAAP;SACKiG,QAAL,GAAgBF,KAAKE,QAAL,IAAiBA,QAAjC;SACK6B,gBAAL,GAAwBtJ,SAAxB;cACU6D,UAAV,GAAuB0D,IAAvB;sBACkBA,IAAlB,EAAwB8B,UAAxB,EAAoCtL,SAApC,EAA+CyD,OAA/C;oBACgB+F,IAAhB,EAAsBvJ,WAAtB,EAAmC2G,QAAnC,EAA6C,IAA7C;;;UAGM4C,KAAKQ,IAAZ;GApBD,MAsBK;WACIc,WAAR;;;eAGYC,qBAAZ;OACIM,SAAJ,EAAe;YACNpJ,UAAU6D,UAAV,GAAuB,IAA/B;;;OAGGgF,eAAejB,SAAO5J,WAA1B,EAAuC;QAClC+K,KAAJ,EAAWA,MAAMlF,UAAN,GAAmB,IAAnB;WACJY,KAAKsE,KAAL,EAAYR,QAAZ,EAAsB/G,OAAtB,EAA+BmD,YAAY,CAACiE,QAA5C,EAAsDC,eAAeA,YAAY3G,UAAjF,EAA6F,IAA7F,CAAP;;;;MAIE2G,eAAed,SAAOc,WAAtB,IAAqCtB,SAAOuB,qBAAhD,EAAuE;OAClES,aAAaV,YAAY3G,UAA7B;OACIqH,cAAcxB,SAAOwB,UAAzB,EAAqC;eACzB7D,YAAX,CAAwBqC,IAAxB,EAA8Bc,WAA9B;;QAEI,CAACO,SAAL,EAAgB;iBACHvF,UAAZ,GAAyB,IAAzB;uBACkBgF,WAAlB;;;;;MAKCO,SAAJ,EAAe;oBACGA,SAAjB,EAA4BrB,SAAOc,WAAnC;;;YAGSd,IAAV,GAAiBA,IAAjB;MACIA,QAAQ,CAACM,OAAb,EAAsB;OACjBmB,eAAexJ,SAAnB;OACCI,IAAIJ,SADL;UAEQI,IAAEA,EAAEkJ,gBAAZ,EAA+B;KAC7BE,eAAepJ,CAAhB,EAAmB2H,IAAnB,GAA0BA,IAA1B;;QAEIlE,UAAL,GAAkB2F,YAAlB;QACK3H,qBAAL,GAA6B2H,aAAapC,WAA1C;;;;KAIE,CAACwB,QAAD,IAAajE,QAAjB,EAA2B;SACnB8E,OAAP,CAAezJ,SAAf;EADD,MAGK,IAAI,CAACsI,IAAL,EAAW;MACXtI,UAAU0J,kBAAd,EAAkC;aACvBA,kBAAV,CAA6BlB,aAA7B,EAA4CC,aAA5C,EAA2DE,eAA3D;;MAEGpM,QAAQoN,WAAZ,EAAyBpN,QAAQoN,WAAR,CAAoB3J,SAApB;;;KAGtB4J,KAAK5J,UAAU6J,gBAAnB;KAAqCC,WAArC;KACIF,EAAJ,EAAQ,OAASE,KAAKF,GAAG1N,GAAH,EAAd;KAA6BsL,IAAH,CAAQxH,SAAR;EAElC,IAAI,CAACmE,SAAD,IAAc,CAACkE,OAAnB,EAA4B/D;;;;;;;;;AAW7B,AAAO,SAASgB,uBAAT,CAAiCZ,GAAjC,EAAsClI,KAAtC,EAA6CgF,OAA7C,EAAsDmD,QAAtD,EAAgE;KAClEzH,IAAIwH,OAAOA,IAAIb,UAAnB;KACCkG,oBAAoB7M,CADrB;KAEC8M,SAAStF,GAFV;KAGCuF,gBAAgB/M,KAAKwH,IAAI7C,qBAAJ,KAA4BrF,MAAMpB,QAHxD;KAIC8O,UAAUD,aAJX;KAKCtN,QAAQ8E,aAAajF,KAAb,CALT;QAMOU,KAAK,CAACgN,OAAN,KAAkBhN,IAAEA,EAAEoM,gBAAtB,CAAP,EAAgD;YACrCpM,EAAEkK,WAAF,KAAgB5K,MAAMpB,QAAhC;;;KAGG8B,KAAKgN,OAAL,KAAiB,CAACvF,QAAD,IAAazH,EAAE2G,UAAhC,CAAJ,EAAiD;oBAC9B3G,CAAlB,EAAqBP,KAArB,EAA4BuB,YAA5B,EAA0CsD,OAA1C,EAAmDmD,QAAnD;QACMzH,EAAE6K,IAAR;EAFD,MAIK;MACAgC,qBAAqB,CAACE,aAA1B,EAAyC;oBACvBF,iBAAjB,EAAoC,IAApC;SACMC,SAAS,IAAf;;;MAGG3C,gBAAgB7K,MAAMpB,QAAtB,EAAgCuB,KAAhC,EAAuC6E,OAAvC,CAAJ;MACIkD,OAAO,CAACxH,EAAEuK,QAAd,EAAwB;KACrBA,QAAF,GAAa/C,GAAb;;YAES,IAAT;;oBAEiBxH,CAAlB,EAAqBP,KAArB,EAA4BqB,WAA5B,EAAyCwD,OAAzC,EAAkDmD,QAAlD;QACMzH,EAAE6K,IAAR;;MAEIiC,UAAUtF,QAAMsF,MAApB,EAA4B;UACpBnG,UAAP,GAAoB,IAApB;qBACkBmG,MAAlB;;;;QAIKtF,GAAP;;;;;;;;AAUD,AAAO,SAASyF,gBAAT,CAA0BnK,SAA1B,EAAqCoK,MAArC,EAA6C;KAC/C7N,QAAQ8N,aAAZ,EAA2B9N,QAAQ8N,aAAR,CAAsBrK,SAAtB;;;KAGvB+H,OAAO/H,UAAU+H,IAArB;;WAEUF,QAAV,GAAqB,IAArB;;KAEI7H,UAAUsK,oBAAd,EAAoCtK,UAAUsK,oBAAV;;WAE1BvC,IAAV,GAAiB,IAAjB;;;KAGIwC,QAAQvK,UAAU6D,UAAtB;KACI0G,KAAJ,EAAW;mBACOA,KAAjB,EAAwBH,MAAxB;EADD,MAGK,IAAIrC,IAAJ,EAAU;MACVA,KAAK3J,QAAL,KAAkB2J,KAAK3J,QAAL,EAAe8G,GAArC,EAA0C6C,KAAK3J,QAAL,EAAe8G,GAAf,CAAmB,IAAnB;;YAEhCuC,QAAV,GAAqBM,IAArB;;MAEIqC,MAAJ,EAAY;cACArC,IAAX;oBACiB/H,SAAjB;;MAEG9C,UAAJ;SACQA,IAAE6K,KAAKhB,SAAf;qBAA6C7J,CAAlB,EAAqB,CAACkN,MAAtB;GAVb;;;KAcXpK,UAAU8H,KAAd,EAAqB9H,UAAU8H,KAAV,CAAgB,IAAhB;KACjB9H,UAAUwK,mBAAd,EAAmCxK,UAAUwK,mBAAV;;;ACzQ7B,SAASC,SAAT,CAAmB9N,KAAnB,EAA0B6E,OAA1B,EAAmC;;MAEpCT,MAAL,GAAc,IAAd;;;;;;MAMKS,OAAL,GAAeA,OAAf;;MAEK7E,KAAL,GAAaA,KAAb;;KAEI,CAAC,KAAK2D,KAAV,EAAiB,KAAKA,KAAL,GAAa,EAAb;;;AAIlB7D,OAAOgO,UAAUpJ,SAAjB,EAA4B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAAA,qBAkCjB9F,GAlCiB,EAkCZ0E,SAlCY,EAkCD;MACrB/C,IAAI,KAAKwN,aAAL,KAAuB,KAAKA,aAAL,GAAqB,EAA5C,CAAR;SACOxN,EAAE3B,MAAI0E,SAAN,MAAqB/C,EAAE3B,MAAI0E,SAAN,IAAmBF,kBAAkB,IAAlB,EAAwBxE,GAAxB,EAA6B0E,SAA7B,CAAxC,CAAP;EApC0B;;;;;;SAAA,oBA2ClBK,KA3CkB,EA2CXqK,QA3CW,EA2CD;MACrBpN,IAAI,KAAK+C,KAAb;MACI,CAAC,KAAKoI,SAAV,EAAqB,KAAKA,SAAL,GAAiB9L,MAAMW,CAAN,CAAjB;SACdA,CAAP,EAAUR,WAAWuD,KAAX,IAAoBA,MAAM/C,CAAN,EAAS,KAAKZ,KAAd,CAApB,GAA2C2D,KAArD;MACIqK,QAAJ,EAAc,CAAC,KAAKd,gBAAL,GAAyB,KAAKA,gBAAL,IAAyB,EAAnD,EAAwD5N,IAAxD,CAA6D0O,QAA7D;gBACA,IAAd;EAhD0B;;;;;;YAAA,yBAuDb;kBACG,IAAhB,EAAsB1M,YAAtB;EAxD0B;;;;;;;;;;OAAA,oBAmElB;CAnEV;;ACfO,SAASqD,MAAT,CAAgB9E,KAAhB,EAAuBoI,MAAvB,EAA+BgG,KAA/B,EAAsC;SACrCnG,KAAKmG,KAAL,EAAYpO,KAAZ,EAAmB,EAAnB,EAAuB,KAAvB,EAA8BoI,MAA9B,CAAP;;;;;;;;;AClBD;AACA,AAAO,IAAMiG,aAAa,SAAbA,UAAa,CAACjF,CAAD,EAAIkF,CAAJ,EAAOC,OAAP,EAAgBC,OAAhB;SAA4BpF,MAAMkF,CAAN,GAAUC,OAAV,GAAmBC,OAA/C;CAAnB;;ACGP,IAAMC,MAAM,SAANA,GAAM,OAA+C;MAA7CC,EAA6C,QAA7CA,EAA6C;MAAzC7I,IAAyC,QAAzCA,IAAyC;MAAnC8I,WAAmC,QAAnCA,WAAmC;MAAtBC,IAAsB,QAAtBA,IAAsB;MAAhBC,UAAgB,QAAhBA,UAAgB;;;MAEnDC,aAAaT,WAAWM,WAAX,EAAwBD,EAAxB,EAA4B,cAA5B,EAA4C,KAA5C,CAAnB;MACMK,cAAcV,WAAWM,WAAX,EAAwBD,EAAxB,EAA+BE,IAA/B,yBAA4DA,IAA5D,eAApB;;SAGE;;MAAQ,SAAOE,UAAf,EAA2B,SAAS;eAAMD,WAAWH,EAAX,CAAN;OAApC;gBACQ,SAAOK,WAAb,GADF;;GADF;CALF,CAaA;;ACVA,IAAMC,OAAO,CACX,EAACnJ,MAAM,MAAP,EAAe6I,IAAI,MAAnB,EAA2BE,MAAM,YAAjC,EADW,EAEX,EAAC/I,MAAM,aAAP,EAAsB6I,IAAI,OAA1B,EAAmCE,MAAM,oBAAzC,EAFW,EAGX,EAAC/I,MAAM,SAAP,EAAkB6I,IAAI,SAAtB,EAAiCE,MAAM,kBAAvC,EAHW,EAIX,EAAC/I,MAAM,cAAP,EAAuB6I,IAAI,cAA3B,EAA2CE,MAAM,WAAjD,EAJW,EAKX,EAAC/I,MAAM,kBAAP,EAA2B6I,IAAI,kBAA/B,EAAmDE,MAAM,kBAAzD,EALW,EAMX,EAAC/I,MAAM,OAAP,EAAgB6I,IAAG,OAAnB,EAA4BE,MAAM,aAAlC,EANW,CAAb;;;;;AAaA,IAAMK,SAAS,SAATA,MAAS,QAAS;MAChBC,aAAa,SAAbA,UAAa,GAAM;WAChBF,KAAKG,GAAL,CAAS,eAAO;aACd,EAAC,GAAD,eAASC,GAAT,IAAc,aAAajP,MAAMwO,WAAjC,EAA8C,YAAYxO,MAAM0O,UAAhE,IAAP;KADK,CAAP;GADF;;SAOE;;MAAK,SAAM,QAAX;gBAAA;eAEO,SAAM,mBAAX;GAHJ;CAPF,CAgBA;;;;;;ACjCA,IAAMQ,SAAS,SAATA,MAAS,QAAS;MAChBC,eAAe,SAAfA,YAAe,GAAM;YAClBnP,MAAM6D,IAAb;WACO,OAAL;eACS,cAAP;;eAEO,QAAP;;GALN;;SAWE;;MAAK,SAAOsL,cAAZ,EAA4B,OAAOnP,MAAM8F,KAAzC;UACQnH;GAFV;CAXF,CAkBA;;;;AClBA,IAAMyQ,SAAS,SAATA,MAAS,QAAS;MAChBD,eAAe,SAAfA,YAAe,GAAM;YAClBnP,MAAMqP,WAAb;WACO,OAAL;eACS,cAAP;WACG,MAAL;eACS,aAAP;;eAEO,QAAP;;GAPN;;SAaE;;;YACQrP,MAAM6D,IADd;eAEW7D,MAAMsP,OAFjB;eAGSH,cAHT;aAISnP,MAAM8F,KAJf;UAKQnH;GANV;CAbF,CAwBA;;ACtBA,IAAM4Q,OAAO,SAAPA,IAAO,OAAkB;MAAhBb,UAAgB,QAAhBA,UAAgB;;SAE3B;;;mBAGW,SAAM,eAAf,GAHF;;;QAQW,SAAM,oBAAf;;;;;OAAA;;;UAIG,SAAM,gBAAT;;OAJA;;cAME;UAAQ,SAAS;mBAAMA,WAAW,OAAX,CAAN;WAAjB;;iBAEK,SAAM,0BAAT,EAAoC,eAAY,MAAhD;OARJ;;;UAWK,MAAK,4HAAR;;;;;;;;GApBN;CADF,CA+BA;;ACjCA,IAAMc,QAAQ,SAARA,KAAQ,GAAM;SAEhB;;;;YACE;;;KADF;;;;;KAAA;;YAKE;;;KALF;;;;;KAAA;;YASE;;;KATF;;;;;KAAA;;YAaE;;;KAbF;;;;;KAAA;;;;;KAAA;;;;;KAAA;;;;;;GADF;CADF,CAyBA;;AC5BA,IAAM7L,QAAQ,EAAd;AACA,AAEAA,MAAM8L,GAAN,GAAY,CAAZ;;AAEA9L,MAAM+L,IAAN,GAAa,EAAb;AACA/L,MAAMgM,KAAN,GAAc,EAAd;AACAhM,MAAMiM,OAAN,GAAgB,EAAhB;AACAjM,MAAMkM,KAAN,GAAc,EAAd;;AAEAlM,MAAMmM,SAAN,GAAkB,KAAlB;;AAEAnM,MAAMoM,SAAN,GAAyB,IAAzB;AACApM,MAAMqM,UAAN,GAAyB,KAAzB;AACArM,MAAMsM,UAAN,GAAyB,IAAzB;AACAtM,MAAMuM,UAAN,GAAyB,IAAzB;AACAvM,MAAMwM,WAAN,GAAyB,KAAzB;AACAxM,MAAMyM,YAAN,GAAyB,IAAzB;AACAzM,MAAM0M,gBAAN,GAAyB,KAAzB;AACA1M,MAAM2M,WAAN,GAAyB,EAAzB;;ACbA,IAAIC,SAAS,KAAb;;AAEA,SAASC,mBAAT,CAA6B3M,IAA7B,EAAmC4M,SAAnC,EAA8C;MACzC,CAACF,MAAJ,EACE,OAAO5Q,SAAP,CAF0C;;;;;;;;;;;;;;;MAmBxC+Q,OAAOC,OAAOC,IAAP,CAAYH,SAAZ,EAAuBI,MAAvB,CAA8B,UAASC,GAAT,EAAclS,GAAd,EAAmB;QACnD,CAAC,KAAD,EAAQ,MAAR,EAAgBmS,OAAhB,CAAwBnS,GAAxB,MAAiC,CAAC,CAArC,EAAwC,OAAOkS,GAAP;QACpClS,GAAJ,IAAW6R,UAAU7R,GAAV,CAAX;WACOkS,GAAP;GAHK,EAIJ,EAJI,CAAX;;MAMGjN,SAAS,MAAZ,EAAoB;SACbmN,IAAL,GAAYP,UAAUO,IAAV,CAAeC,GAA3B;SACKC,GAAL,GAAYT,UAAUS,GAAV,CAAcD,GAA1B;;;;;MAKEE,OAAO,EAAEC,OAAOzN,MAAMyN,KAAf;YACU,KADV;UAEQvN,IAFR;UAGQF,MAAM+L,IAHd;UAIQgB;GAJnB;;sBAOoBS,IAApB;;;AAGF,SAASE,OAAT,GAAmB;;SAEVA,OAAP,CAAeC,CAAf,EAAkB,YAAlB;;;AAGFD,UAAUE,SAASF,OAAT,EAAkB,IAAlB,CAAV;;AAEA,SAASE,QAAT,CAAkBC,IAAlB,EAAwBC,IAAxB,EAA8BC,SAA9B,EAAyC;;;;;;;MAOnCC,OAAJ;SACO,YAAW;QACZ9M,UAAU,IAAd;QAAoB+M,OAAOxS,SAA3B;QACIyS,QAAQ,SAARA,KAAQ,GAAW;gBACP,IAAV;UACI,CAACH,SAAL,EAAgBF,KAAKM,KAAL,CAAWjN,OAAX,EAAoB+M,IAApB;KAFtB;QAIIG,UAAUL,aAAa,CAACC,OAA5B;iBACaA,OAAb;cACUxQ,WAAW0Q,KAAX,EAAkBJ,IAAlB,CAAV;QACIM,OAAJ,EAAaP,KAAKM,KAAL,CAAWjN,OAAX,EAAoB+M,IAApB;GATf;;;AAaF,SAASI,mBAAT,CAA6BC,IAA7B,EAAmChF,EAAnC,EAAuC;MACjCiF,MAAM,0BAAV;;MAEGvO,MAAMmM,SAAN,KAAoB,QAAvB,EAAiC;UACzB,uBAAN;GADF,MAGK,IAAGnM,MAAMmM,SAAT,EAAoB;WAChBqC,QAAQC,GAAR,CAAYd,CAAZ,CAAP;;;QAGIY,GAAN,EAAW,EAAEG,QAAQ,MAAV;UACQC,KAAKC,SAAL,CAAeN,IAAf;GADnB,EAGChR,IAHD,CAGM;WAAYuR,SAASC,IAAT,EAAZ;GAHN,EAICxR,IAJD,CAIM;WAAYgM,KAAKA,GAAGyF,MAAH,CAAL,GAAkB,IAA9B;GAJN;;;AAOF,SAASC,qBAAT,CAA+B1F,EAA/B,EAAmC;MAC7BiF,MAAM,0BAAV;MACIzC,MAAM9L,MAAM8L,GAAN,IAAa,CAAvB;;;;MAIG9L,MAAMmM,SAAN,KAAoB,OAAvB,EACE,OAAO7C,GAAGqF,KAAKM,KAAL,CAAWC,aAAa,oBAAb,CAAX,CAAH,CAAP;;MAEClP,MAAMmM,SAAN,KAAoB,QAAvB,EACEoC,MAAM,uBAAN;;SAEK,UAAUzC,GAAjB;;QAEMyC,GAAN,EAAW,EAAEG,QAAQ,KAAV,EAAX,EACCpR,IADD,CACM;WAAYuR,SAASC,IAAT,EAAZ;GADN,EAECxR,IAFD,CAEM;WAAQgM,GAAGgF,IAAH,CAAR;GAFN,EAGChR,IAHD,CAGM,gBAAQ;aAAU,IAAT,CAAe,OAAOgR,IAAP;GAH9B,EAICa,KAJD,CAIO;WAAOX,QAAQC,GAAR,CAAY,SAAZ,EAAuBW,GAAvB,CAAP;GAJP;;;AC7GF;;AAEA,AAGA,SAASC,IAAT,GAAgB;;AAEhB,AAEA,SAASC,EAAT,CAAYC,IAAZ,EAAkBC,GAAlB,EAAuB;SAAQ,UAASpT,GAAT,EAAc;WAAQA,IAAImT,IAAJ,MAAcC,GAArB;GAAtB;;;AAExB,SAASC,MAAT,CAAgBxP,CAAhB,EAAmByP,CAAnB,EAAsB9O,IAAtB,EAA4B;SAAQA,KAAKwM,OAAL,CAAanN,CAAb,MAAoByP,CAA3B;;;AAE7B,AAEA,AAEA,SAAS5S,IAAT,CAAeyS,IAAf,EAAqB;SAAQ,UAASnT,GAAT,EAAc;WAAQA,IAAImT,IAAJ,CAAP;GAAtB;;;AAEtB,AAEA,SAASjT,OAAT,CAAeF,GAAf,EAAoB;SAAQuS,KAAKM,KAAL,CAAWN,KAAKC,SAAL,CAAexS,GAAf,CAAX,CAAP;;;AAErB,SAASuT,QAAT,CAAkB9S,GAAlB,EAAuB+S,EAAvB,EAA2B;MACtB,CAACA,EAAD,IAAO/S,IAAInB,MAAJ,IAAckU,EAAxB,EAA4B,OAAO/S,GAAP;SACrBA,IAAIgT,MAAJ,CAAW,CAAX,EAAcD,KAAG,CAAjB,IAAsB,KAA7B;;;AAGF,SAASE,OAAT,CAAiBlP,IAAjB,EAAuB3F,GAAvB,EAA4BuU,GAA5B,EAAiC;MAC5B,CAAC5O,KAAK3F,GAAL,CAAJ,EACE,OAAO2F,KAAK3F,GAAL,IAAY,CAACuU,GAAD,CAAnB;;OAEGvU,GAAL,EAAUU,IAAV,CAAe6T,GAAf;SACO5O,KAAK3F,GAAL,CAAP;;;AAGF,SAAS8U,IAAT,GAAgB;MACVC,WAAW,GAAGC,KAAH,CAAS/I,IAAT,CAAczL,SAAd,CAAf;;WAESyU,UAAT,CAAoB5B,IAApB,EAA0B;QACpB6B,OAAOH,SAASC,KAAT,EAAX;QACIG,GAAJ;;aAESnG,KAAT,GAAiB;aACTmG,MAAMD,KAAKE,KAAL,EAAZ,EAA0B;YACrBD,IAAIE,KAAP,EAAc;;iBACLF,IAAIE,KAAJ,CAAUhC,IAAV,EAAgBhF,EAAhB,CAAP;SADF,MAEO;;iBACE8G,IAAI9B,IAAJ,CAAP;;;;;aAKGhF,EAAT,CAAYiH,QAAZ,EAAsB;aACbA,QAAP;;;;;;WAMKjC,IAAP;;;SAGK4B,UAAP;;;AAGF,SAAS9Q,OAAT,CAAeoR,IAAf,EAAqB;UACX/B,GAAR,CAAYhT,SAAZ,EAAuB+U,IAAvB;;;AC/DK,IAAMC,OAAO,EAAb;AACP,AAAO,IAAMC,SAAS,EAACC,OAAOC,SAAR,EAAmBC,QAAQC,UAA3B,EAAuCC,MAAMC,QAA7C,EAAf;AACP,AAeAP,KAAKE,KAAL,GAAa,EAAb;AACAF,KAAKI,MAAL,GAAc,EAAd;AACAJ,KAAKQ,MAAL,GAAc,EAAd;AACAR,KAAKS,SAAL,GAAiB,EAAjB;;AAEA,SAASC,QAAT,CAAkBC,MAAlB,EAA0BC,OAA1B,EAAmChV,KAAnC,EAA0C;MACpCgF,OAAOiQ,cAAcjV,KAAd,CAAX;;MAEIkV,MAAMd,KAAKW,MAAL,CAAV;MACG,CAACG,GAAJ,EACE,OAAOnS,QAAM,yBAAN,EAAiCgS,MAAjC,CAAP;;MAEElR,OAAOqR,IAAIF,OAAJ,CAAX;MACG,CAACnR,IAAJ,EACE,OAAOd,QAAM,yBAAyBgS,MAAzB,GAAkC,OAAxC,EAAiDC,OAAjD,CAAP;;;;OAIGE,GAAL,GAAYH,MAAZ;OACKlR,IAAL,GAAYmR,OAAZ;OACKtP,IAAL,GAAY1F,MAAM0F,IAAN,IAAcsP,OAA1B,CAfwC;;SAiBjChQ,IAAP;;;AAGF,SAASmQ,SAAT,CAAmBJ,MAAnB,EAA2BC,OAA3B,EAAoCI,KAApC,EAA2C;;;;MAIrCF,MAAMd,KAAKW,MAAL,CAAV;MACG,CAACG,GAAJ,EACE,OAAOnS,QAAM,aAAN,EAAqBgS,MAArB,CAAP;;MAEElR,OAAOqR,IAAIF,OAAJ,CAAX;MACG,CAACnR,IAAJ,EACE,OAAOd,QAAM,gCAAN,EAAwCiS,OAAxC,CAAP;;;OAGGK,OAAL,CAAa/V,IAAb,CAAkB8V,KAAlB;;;MAGIA,KAAJ,IAAavR,IAAb;;;;;AAMF,SAAS0Q,SAAT,CAAmB1Q,IAAnB,EAAyB7D,KAAzB,EAAgCqR,UAAhC,EAAyC;MACnCrM,OAAO8P,SAAS,OAAT,EAAkBjR,IAAlB,EAAwB7D,KAAxB,CAAX;MACG,CAACgF,IAAJ,EAAU,OAAO,KAAP;;OAELsQ,QAAL,GAAgB,CAAhB,CAJuC;;eAM1B,MAAb,EAAqBtQ,IAArB;MACGqM,UAAH,EACEb,oBAAoB,MAApB,EAA4BxL,IAA5B;;SAEKA,IAAP;;;AAGF,SAASyP,UAAT,CAAoB5Q,IAApB,EAA0B7D,KAA1B,EAAiCqR,UAAjC,EAA0C;MACpCrM,OAAO8P,SAAS,QAAT,EAAmBjR,IAAnB,EAAyB7D,KAAzB,CAAX;MACG,CAACgF,IAAJ,EAAU,OAAO,KAAP;;OAELsQ,QAAL,GAAgB,CAAhB,CAJwC;;;;eAQ3B,MAAb,EAAqBtQ,IAArB;MACGqM,UAAH,EACEb,oBAAoB,MAApB,EAA4BxL,IAA5B;;SAEKA,IAAP;;;AAGF,AAWA,AAaA,SAASuQ,cAAT,CAAwB1R,IAAxB,EAA8B2R,UAA9B,EAA0C;;;;MAIpCC,UAAUrB,KAAKE,KAAL,CAAWzQ,IAAX,CAAd;MACG4R,OAAH,EACE,OAAO1S,QAAM,gCAAN,EAAwCc,IAAxC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;UACQwR,OAAR,GAAkB,EAAlB,CAXwC;;;;UAehCK,EAAR,GAAaF,WAAWE,EAAX,IAAiB,EAA9B;;;UAGQ1V,KAAR,GAAgB,EAAhB,CAlBwC;UAmBhCA,KAAR,CAAc0F,IAAd,GAAqB,EAArB;UACQ1F,KAAR,CAAc2V,KAAd,GAAsB,EAAtB,CApBwC;UAqBhC3V,KAAR,CAAc4V,GAAd,GAAoB,EAApB;;;;;OAKKtB,KAAL,CAAWzQ,IAAX,IAAmB4R,OAAnB;;;MAGGD,WAAWH,OAAd,EAAuB;eACVA,OAAX,CAAmBQ,OAAnB,CAA2B,UAAST,KAAT,EAAgB;gBAC/B,OAAV,EAAmBvR,IAAnB,EAAyBuR,KAAzB;KADF;;;;AAMJ,SAASU,eAAT,CAAyBjS,IAAzB,EAA+B2R,UAA/B,EAA2C;;;;MAIrCC,UAAUrB,KAAKI,MAAL,CAAY3Q,IAAZ,CAAd;MACG4R,OAAH,EACE,OAAO1S,QAAM,iCAAN,EAAyCc,IAAzC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQkS,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcC,GAAd,GAAoB,EAACC,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAsCC,OAAO,CAAC,QAAD,CAA7C,EAAyDf,SAAS,EAAlE,EAApB;UACQU,KAAR,CAAcxC,EAAd,GAAoB,EAAC0C,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAsCC,OAAO,CAAC,QAAD,CAA7C,EAAyDf,SAAS,EAAlE,EAApB;UACQU,KAAR,CAAcM,GAAd,GAAoB,EAACJ,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAsCC,OAAO,CAAC,OAAD,CAA7C,EAAyDf,SAAS,EAAlE,EAApB;;;UAGQrV,KAAR,GAAgB,EAAhB,CAnByC;UAoBjCqV,OAAR,GAAkB,EAAlB,CApByC;;;;;OAyBpCb,MAAL,CAAY3Q,IAAZ,IAAoB4R,OAApB;;;MAGGD,WAAWH,OAAd,EAAuB;eACVA,OAAX,CAAmBQ,OAAnB,CAA2B,UAAST,KAAT,EAAgB;gBAC/B,QAAV,EAAoBvR,IAApB,EAA0BuR,KAA1B;KADF;;;;AAMJ,SAASkB,eAAT,CAAyBzS,IAAzB,EAA+B2R,UAA/B,EAA2C;;;;MAIrCC,UAAUrB,KAAKQ,MAAL,CAAY/Q,IAAZ,CAAd;MACG4R,OAAH,EACE,OAAO1S,QAAM,iCAAN,EAAyCc,IAAzC,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQkS,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcxC,EAAd,GAAuB,EAAC0C,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAA+Df,SAAS,EAAxE,EAAvB;UACQU,KAAR,CAAcQ,EAAd,GAAuB,EAACN,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,OAAD,CAAhD,EAA+Df,SAAS,EAAxE,EAAvB;UACQU,KAAR,CAAcS,GAAd,GAAuB,EAACP,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAA+Df,SAAS,EAAxE,EAAvB;UACQU,KAAR,CAAcU,MAAd,GAAuB,EAACR,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,QAA/B,EAAyCC,OAAO,CAAC,WAAD,CAAhD,EAA+Df,SAAS,EAAxE,EAAvB;;;UAGQrV,KAAR,GAAgB,EAAhB,CApByC;UAqBjCqV,OAAR,GAAkB,EAAlB,CArByC;;;;;OA0BpCT,MAAL,CAAY/Q,IAAZ,IAAoB4R,OAApB;;;MAGGD,WAAWH,OAAd,EAAuB;eACVA,OAAX,CAAmBQ,OAAnB,CAA2B,UAAST,KAAT,EAAgB;gBAC/B,QAAV,EAAoBvR,IAApB,EAA0BuR,KAA1B;KADF;;;;AAMJ,SAASsB,kBAAT,CAA4B7S,IAA5B,EAAkC2R,UAAlC,EAA8C;;;;;;;MAOxCC,UAAUrB,KAAKS,SAAL,CAAehR,IAAf,CAAd;MACG4R,OAAH,EACE,OAAO1S,QAAM,oCAAN,EAA4Cc,IAA5C,CAAP;;;;YAIQ,EAACA,MAAMA,IAAP,EAAV;;;UAGQkS,KAAR,GAAgBP,WAAWO,KAAX,IAAoB,EAApC;UACQA,KAAR,CAAcY,EAAd,GAAuB,EAACV,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,IAA/B,EAAyCC,OAAO,CAAC,OAAD,EAAY,OAAZ,CAAhD,EAAsEf,SAAS,EAA/E,EAAvB;UACQU,KAAR,CAAcM,GAAd,GAAuB,EAACJ,KAAK,KAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,SAAD,EAAY,OAAZ,CAAhD,EAAsEf,SAAS,EAA/E,EAAvB;UACQU,KAAR,CAAcC,GAAd,GAAuB,EAACC,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,KAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAAsEf,SAAS,EAA/E,EAAvB;UACQU,KAAR,CAAcU,MAAd,GAAuB,EAACR,KAAK,IAAN,EAAaC,QAAQ,CAArB,EAAwBC,OAAO,QAA/B,EAAyCC,OAAO,CAAC,QAAD,CAAhD,EAAsEf,SAAS,EAA/E,EAAvB;;;UAGQrV,KAAR,GAAgB,EAAhB,CAvB4C;UAwBpCqV,OAAR,GAAkB,EAAlB,CAxB4C;;;;;OA6BvCR,SAAL,CAAehR,IAAf,IAAuB4R,OAAvB;;;MAGGD,WAAWH,OAAd,EAAuB;eACVA,OAAX,CAAmBQ,OAAnB,CAA2B,UAAST,KAAT,EAAgB;gBAC/B,WAAV,EAAuBvR,IAAvB,EAA6BuR,KAA7B;KADF;;;;AAOJ,AAIA,SAAST,QAAT,CAAkB9Q,IAAlB,EAAwB+S,IAAxB,EAA8BrD,EAA9B,EAAkCvT,KAAlC,EAAyCqR,UAAzC,EAAkD;MAC5CqD,OAAO,EAAX;;;;;;SAMOO,cAAcjV,KAAd,CAAP;OACKkR,GAAL,GAAWqC,EAAX;OACKvC,IAAL,GAAY4F,IAAZ;OACK/S,IAAL,GAAYA,IAAZ;OACKsS,KAAL,GAAatS,IAAb;;;;eAIa,MAAb,EAAqB6Q,IAArB;MACGrD,UAAH,EACEb,oBAAoB,MAApB,EAA4BkE,IAA5B;;;AAGJ,AAMA,AAIA,AAKA,AAOAa,eAAe,QAAf,EAA0B,EAA1B;AACAA,eAAe,SAAf,EAA0B,EAA1B;AACAA,eAAe,KAAf,EAA0B,EAACF,SAAS,CAAC,UAAD,CAAV,EAA1B;AACAE,eAAe,KAAf,EAA0B,EAACG,IAAI,CAAC,KAAD,CAAL,EAA1B;AACAH,eAAe,OAAf,EAA0B,EAACG,IAAI,CAAC,OAAD,EAAU,OAAV,CAAL,EAA1B;AACAH,eAAe,OAAf,EAA0B,EAACG,IAAI,CAAC,OAAD,EAAU,SAAV,CAAL,EAA2BmB,WAAW,IAAtC,EAA1B;AACAtB,eAAe,SAAf,EAA0B,EAACG,IAAI,CAAC,SAAD,CAAL,EAAkBL,SAAS,CAAC,SAAD,EAAY,SAAZ,CAA3B,EAA1B;;AAEAS,gBAAgB,MAAhB,EAA6B,EAACT,SAAS,EAAV,EAA7B;AACAS,gBAAgB,MAAhB,EAA6B,EAACT,SAAS,EAAV,EAA7B;AACAS,gBAAgB,OAAhB,EAA6B,EAACT,SAAS,EAAV,EAA7B;AACAS,gBAAgB,QAAhB,EAA6B,EAACT,SAAS,CAAC,MAAD,EAAS,OAAT,EAAkB,SAAlB,CAAV,EAA7B;AACAS,gBAAgB,QAAhB,EAA6B,EAACT,SAAS,CAAC,UAAD,EAAa,gBAAb,EAA+B,iBAA/B,CAAV,EAA7B;AACAS,gBAAgB,QAAhB,EAA6B,EAACT,SAAS,CAAC,KAAD,EAAQ,MAAR,EAAgB,YAAhB,EAA8B,YAA9B,EAA4C,UAA5C,EAAwD,WAAxD,CAAV,EAA7B;AACAS,gBAAgB,QAAhB,EAA6B,EAACT,SAAS,CAAC,MAAD,EAAS,MAAT,EAAiB,YAAjB,EAA+B,aAA/B,CAAV,EAA7B;AACAS,gBAAgB,SAAhB,EAA6B,EAACT,SAAS,CAAC,WAAD,EAAc,cAAd,CAAV,EAA7B;AACAS,gBAAgB,WAAhB,EAA6B,EAACT,SAAS,EAAV,EAA7B;AACAS,gBAAgB,MAAhB,EAA6B,EAACT,SAAS,CAAC,QAAD,CAAV,EAA7B;AACAS,gBAAgB,SAAhB,EAA6B,EAACT,SAAS,CAAC,UAAD,CAAV,EAA7B;AACAS,gBAAgB,QAAhB,EAA6B,EAACT,SAAS,CAAC,SAAD,CAAV,EAA7B;AACAS,gBAAgB,MAAhB,EAA6B,EAACT,SAAS,CAAC,KAAD,CAAV,EAA7B;;AAGA,AAAIzV,AAGJ0W,gBAAgB,SAAhB,EAA6B,EAACjB,SAAS,CAAC,YAAD,CAAV,EAA7B;AACAiB,gBAAgB,UAAhB,EAA6B,EAACjB,SAAS,CAAC,KAAD,CAAV,EAA7B;AACAiB,gBAAgB,WAAhB,EAA6B,EAACjB,SAAS,CAAC,MAAD,CAAV,EAA7B;;AAEAqB,mBAAmB,cAAnB,EAAmC,EAACrB,SAAS,EAAV,EAAnC;AACAqB,mBAAmB,YAAnB,EAAmC,EAACrB,SAAS,CAAC,KAAD,EAAQ,MAAR,EAAgB,OAAhB,EAAyB,QAAzB,CAAV,EAAnC;;;;;AAOA,SAASyB,YAAT,CAAsBjT,IAAtB,EAA4B6M,IAA5B,EAAkC;MAC7B7M,SAAS,MAAZ,EAAoB;;QAEf,CAAC6M,KAAKO,GAAT,EACEP,KAAKO,GAAL,GAAW8F,YAAX;MACAC,SAAF,CAAYtG,IAAZ;;;MAGC7M,SAAS,MAAZ,EAAoB;MAChBoT,OAAF,CAAUvG,IAAV;;;;AAIJ,SAASqG,UAAT,GAAsB;;SAEb,CAAC,KAAKG,KAAKC,MAAL,EAAN,EAAqBvD,KAArB,CAA2B,CAA3B,CAAP;;;AAGF,SAASqB,aAAT,CAAuBjV,KAAvB,EAA8B;MACzB,QAAOA,KAAP,yCAAOA,KAAP,OAAiB,QAApB,EACE,OAAO,EAAP;;MAECR,MAAM4X,OAAN,CAAcpX,KAAd,CAAH,EACE,OAAO,EAAP;;SAEKC,QAAMD,KAAN,CAAP;;;ACxXF;;AAEA,AACA,AACA,AACA,AAEA,AAAO,IAAIsR,IAAI+F,OAAOC,KAAP,EAAR;AACP,AAGA,SAASC,MAAT,CAAgBC,GAAhB,EAAqB;QACb9H,IAAN,CAAWpQ,IAAX,CAAgBkY,GAAhB;MACIH,OAAOC,KAAP,EAAJ,CAFmB;gBAGL3T,MAAMgM,KAApB;;;;AAIF,SAAS8H,SAAT,CAAmBD,GAAnB,EAAwB;MAClBE,QAAQ/T,MAAM+L,IAAN,CAAWqB,OAAX,CAAmByG,GAAnB,CAAZ;MACGE,UAAU,CAAC,CAAd,EACE,OAAO/X,SAAP;;QAEI+P,IAAN,CAAW3E,MAAX,CAAkB2M,KAAlB,EAAyB,CAAzB;MACIL,OAAOC,KAAP,EAAJ,CANsB;gBAOR3T,MAAMgM,KAApB;;;;;;;;AAQF,SAASgI,QAAT,CAAkB1K,EAAlB,EAAsB;wBACE,UAAS0C,KAAT,EAAgB;QACjCnQ,MAAM4X,OAAN,CAAczH,KAAd,CAAH,EACE1C,GAAG2K,cAAcC,cAAclI,KAAd,CAAd,CAAH,EADF,KAGE1C,GAAG0C,KAAH,EAJkC;GAAtC;;;AAQF,SAASkI,aAAT,CAAuBlI,KAAvB,EAA8B;QACtBA,KAAN,GAAcA,KAAd;SACOA,KAAP;;;AAGF,SAASiI,aAAT,CAAuBjI,KAAvB,EAA8B;;;;;;;;;;;;;;MAgBxBmI,OAAOC,aAAaC,aAAarI,KAAb,CAAb,CAAX;QACMC,OAAN,GAAgBqI,YAAYtI,KAAZ,CAAhB;;OAEK5I,KAAL,CAAWmR,GAAX,CAAerC,OAAf,CAAuB,UAAS7Q,IAAT,EAAe;;QAEhC+O,MAAMM,OAAOrP,KAAKkQ,GAAZ,CAAV;QACG,CAACnB,GAAJ,EAAS,OAAOpU,SAAP;QACLqF,KAAKnB,IAAT,EAAemB,IAAf;GAJF;;OAOK+Q,KAAL,CAAWmC,GAAX,CAAerC,OAAf,CAAuB,UAASnB,IAAT,EAAe;;aAC3BA,KAAK7Q,IAAd,EAAoB6Q,KAAK1D,IAAzB,EAA+B0D,KAAKxD,GAApC,EAAyCwD,IAAzC;GADF;;OAIK3N,KAAL,CAAWoR,IAAX,CAAgBtC,OAAhB,CAAwB,UAAS7Q,IAAT,EAAe;;;GAAvC;;;AAMF,SAASiT,WAAT,CAAqBtI,KAArB,EAA4B;MACtBiB,OAAO,EAAX;QACMiF,OAAN,CAAc,UAAS1E,IAAT,EAAe;QACxBA,KAAKqD,MAAL,KAAgB,KAAnB,EAA0B,OAAO7U,SAAP;;KAEzB,CAACwR,KAAKzB,IAAL,IAAW,EAAZ,EAAgBmG,OAAhB,CAAwB,UAAS2B,GAAT,EAAc;UAClCA,GAAH,EACE5G,KAAK4G,GAAL,IAAY,IAAZ;KAFH,CAAD;GAHF;SAQO5G,IAAP;;;AAGF,SAASoH,YAAT,CAAsBrI,KAAtB,EAA6B;UACnBA,MAAMyI,MAAN,CAAa,UAASjH,IAAT,EAAe;WAC3B,CAAC,CAACkH,cAAclH,KAAKzB,IAAnB,EAAyB/L,MAAM+L,IAA/B,EAAqCrQ,MAA9C,CADkC;GAA5B,CAAR;;SAIOsQ,KAAP;;;AAGF,SAASoI,YAAT,CAAsBpI,KAAtB,EAA6B;MACvBmI,OAAO,EAAC/Q,OAAO,EAACmR,KAAK,EAAN,EAAUC,MAAM,EAAhB,EAAoB1K,QAAQ,EAA5B,EAAR,EAAyCsI,OAAO,EAACmC,KAAK,EAAN,EAAUC,MAAM,EAAhB,EAAoB1K,QAAQ,EAA5B,EAAhD,EAAX;QACMoI,OAAN,CAAc,UAAS1E,IAAT,EAAe;;;;;QAKvB5M,OAAOuT,KAAK3G,KAAKtN,IAAL,GAAU,GAAf,EAAoBsN,KAAKqD,MAAzB,KAAoC,EAA/C,CAL2B;;;QAQvB9D,OAAOS,KAAKc,IAAhB,CAR2B;SAStBxC,GAAL,GAAW0B,KAAK1B,GAAhB;SACK6I,IAAL,GAAYnH,KAAKmH,IAAjB;SACK5I,IAAL,GAAYyB,KAAKzB,IAAjB;SACKpQ,IAAL,CAAUoR,IAAV;GAZF;SAcOoH,IAAP;;;AAGF,SAASO,aAAT,CAAuBE,EAAvB,EAA2BC,EAA3B,EAA+B;SACtBD,GAAGH,MAAH,CAAU,UAASK,CAAT,EAAY;WACpBD,GAAGzH,OAAH,CAAW0H,CAAX,MAAkB,CAAC,CAA1B;GADK,CAAP;;;ACrHK,IAAIC,QAAQC,kBAAZ;AACP,AAEA,SAASC,gBAAT,GAA4B;QACpBC,OAAN,GAAgBC,cAAhB;;;;AAIF,SAASC,mBAAT,CAA6BC,MAA7B,EAAqCC,YAArC,EAAmD;MAC7CA,eAAeA,gBAAgBP,KAAnC;;MAEIQ,QAAQD,aAAaJ,OAAb,CAAqBM,KAArB,CAA2B,CAA3B,EAA8Bva,GAA1C;MACIoF,QAAQgV,UAAUA,OAAOE,KAAP,CAAV,IAA2B,KAAvC;;;UAGQE,eAAeH,YAAf,EAA6BjV,KAA7B,CAAR;;SAEO0U,KAAP;;;AAGF,SAASI,YAAT,GAAwB;MAClBK,QAAQ,CAAE,EAACva,KAAK,SAAN,EAAiBiF,MAAM,MAAvB,EAA+BqR,KAAK,OAApC,EAAF,EACE,EAACtW,KAAK,MAAN,EAAciF,MAAM,MAApB,EAA4BqR,KAAK,QAAjC,EADF,EAEE,EAACtW,KAAK,QAAN,EAAgBiF,MAAM,MAAtB,EAA8BqR,KAAK,OAAnC,EAFF,EAGE,EAACtW,KAAK,MAAN,EAAciF,MAAM,MAApB,EAHF,CAAZ;SAKO,EAACsV,OAAOA,KAAR,EAAeE,QAAQ,EAAvB,EAAP;;;AAGF,SAASV,gBAAT,GAA4B;MACtBW,WAAWR,cAAf;SACO,EAACS,WAAW,EAAZ,EAAgBV,SAASS,QAAzB,EAAP;;;AAGF,SAASF,cAAT,CAAwBH,YAAxB,EAAsCjV,KAAtC,EAA6C;MACvCiV,eAAeA,gBAAgBP,KAAnC;;MAEIY,WAAWE,UAAUP,aAAaJ,OAAvB,EAAgC7U,KAAhC,CAAf;;;;;MAKG,CAACsV,SAASH,KAAT,CAAe9Z,MAAnB,EAA2B;QACrBoa,OAAJ,EAAaC,IAAb,EAAmBC,MAAnB,EAA2BC,IAA3B;aACSP,MAAT,CAAgBxD,OAAhB,CAAwB,UAASgE,IAAT,EAAe;UAClCA,KAAKhW,IAAL,KAAc,SAAjB,EAA4B;YACtByQ,QAAQC,UAAUsF,KAAK7V,KAAf,EAAsB,EAAC0B,MAAMmU,KAAKnU,IAAZ,EAAtB,EAAyC,IAAzC,CAAZ;YACGmU,KAAKC,MAAL,KAAgB,SAAnB,EAA8BL,UAAUnF,KAAV;YAC3BuF,KAAKC,MAAL,KAAgB,QAAnB,EAA8BH,SAAUrF,KAAV;OAHhC,MAKK,IAAGuF,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;eACrBgW,KAAK7V,KAAZ;OADG,MAGA,IAAG6V,KAAKjb,GAAL,KAAa,SAAhB,EAA2B;kBACpBib,KAAKE,IAAf;OADG,MAGA,IAAGF,KAAKjb,GAAL,KAAa,QAAhB,EAA0B;iBACpBib,KAAKE,IAAd;OADG,MAGA,IAAGF,KAAKjb,GAAL,KAAa,MAAhB,EAAwB;eACpB,CAACib,KAAKE,IAAL,IAAW,EAAZ,EAAgBlW,IAAhB,IAAwBgW,KAAK7V,KAApC;;KAhBJ;;QAoBGyV,WAAWC,IAAX,IAAmBC,MAAtB,EAA8B;aACrBlF,WAAWiF,IAAX,EAAiB,EAACM,MAAM,IAAIC,IAAJ,CAASL,IAAT,EAAeM,OAAf,EAAP,EAAjB,EAAoD,IAApD,CAAP;eACS,KAAT,EAAgBR,KAAKzI,GAArB,EAA0B0I,OAAO1I,GAAjC,EAAsC,CAAtC,EAAyC,IAAzC;eACS,KAAT,EAAgBwI,QAAQxI,GAAxB,EAA6ByI,KAAKzI,GAAlC,EAAuC,CAAvC,EAA0C,IAA1C;;;;;;iBAMWsI,SAAb,CAAuBja,IAAvB,CAA4Bga,QAA5B;;;;;;;SAOKL,YAAP;;;AAGF,SAASO,SAAT,CAAmBF,QAAnB,EAA6BtV,KAA7B,EAAoC;MAC9B6V,OAAOP,SAASH,KAAT,CAAenF,KAAf,EAAX;MACG,CAAC6F,IAAJ,EACE,OAAO9W,QAAM,2BAAN,CAAP;;;MAGC8W,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;QACnBkW,OAAOzI,EAAE1N,CAAF,CAAI,EAAC8B,MAAM1B,KAAP,EAAckR,KAAK2E,KAAK3E,GAAxB,EAAJ,EAAkCiF,GAAlC,GAAwC,CAAxC,CAAX;QACGJ,IAAH,EAAS;WACFA,IAAL,GAAYA,IAAZ;;;;MAIDF,KAAK3E,GAAL,KAAa,OAAhB,EAAyB;QACpB2E,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;UACpB,CAACgW,KAAKE,IAAT,EAAe;iBACJZ,KAAT,CAAerM,OAAf,CAAuB,EAAClO,KAAK,MAAN,EAAciF,MAAM,SAApB,EAA+B6B,MAAM1B,KAArC,EAA4CkR,KAAK2E,KAAK3E,GAAtD,EAA2D4E,QAAQD,KAAKjb,GAAxE,EAAvB;;KAFJ,MAKK,IAAGib,KAAKhW,IAAL,KAAc,SAAjB,EAA4B;;;;;;OAM9BG,KAAL,GAAaA,KAAb;WACSqV,MAAT,CAAgB/Z,IAAhB,CAAqBua,IAArB;;SAEOP,QAAP;;;ACtHF;;AAEA,AACA,AACA,AACA,AACA,AACA,AAGA,AAEA,AAAO,IAAMc,KAAK,YAAW;MACrBC,MAAM,EAAZ;MACMC,aAAa,EAACjU,kBAAkB2M,IAAnB,EAAyBzM,qBAAqByM,IAA9C,EAAnB;;SAEO,UAASuH,KAAT,EAAgB;;;;QAIjBA,KAAJ,IAAanT,SAASoT,cAAT,CAAwBD,KAAxB,KAAkCD,UAA/C;WACOD,IAAIE,KAAJ,CAAP;GALF;CAJgB,EAAX;;AAaP,SAASE,MAAT,CAAgBF,KAAhB,EAAuBpH,GAAvB,EAA4B;KACvBoH,KAAH,EAAUvU,SAAV,GAAsBmN,GAAtB;;;AAGF,AAQA,AAAO,SAASuH,KAAT,CAAelX,CAAf,EAAkB;IACrBmX,cAAF;QACMvJ,KAAN,GAAcgJ,GAAG,OAAH,EAAYpW,KAA1B;;MAEM0B,OAAO0U,GAAG,MAAH,EAAWpW,KAAxB;MACM0V,OAAOU,GAAG,aAAH,EAAkBpW,KAA/B;MACIgV,SAAS,EAAES,SAAS/T,IAAX;UACQ,QADR;UAEQgU,IAFR;YAGU,cAHV;UAIQ;GAJrB;sBAMoBV,MAApB;sBACoBA,MAApB;sBACoBA,MAApB;sBACoBA,MAApB;sBACoBA,MAApB;;;;;;;;;;AAaF,AAAO,SAAS4B,cAAT,CAAwBC,EAAxB,EAA4B;KAC9BF,cAAH;MACIjX,SAASmX,GAAGnX,MAAhB;MACI8T,MAAM9T,OAAOoX,SAAjB;MACG,CAACtD,GAAJ,EAAS,OAAO7X,SAAP;YACC6X,GAAV;;;;;;AAMF,AAAO,SAASuD,cAAT,CAAwBF,EAAxB,EAA4B;;MAE7BA,GAAGnX,MAAH,CAAUsX,OAAV,KAAsB,MAAtB,IACAH,GAAGnX,MAAH,CAAUsX,OAAV,KAAsB,OADtB,IAEAH,GAAGnX,MAAH,CAAUsX,OAAV,KAAsB,QAFtB,IAGAH,GAAGnX,MAAH,CAAUsX,OAAV,KAAsB,UAH1B,EAKE,OAAO,IAAP;;MAEEpc,MAAMic,GAAGI,OAAH,IAAcJ,GAAGK,KAA3B;;;MAGIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;;MAEIC,QAAQ,GAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;MACIC,QAAQ,EAAZ;;;;MAIGhd,QAAQ6c,KAAR,IAAiB7c,QAAQgd,KAAzB,IAAkChd,QAAQ2c,KAA7C,EAAoD;OAC/CZ,cAAH;QACGhX,MAAMyM,YAAN,IAAsBzM,MAAMuM,UAA/B,EAA2C,OAAO,KAAP;UACrCE,YAAN;;;;MAICxR,QAAQ+c,KAAR,IAAiB/c,QAAQ8c,KAAzB,IAAkC9c,QAAQ0c,KAA7C,EAAoD;OAC/CX,cAAH;QACGhX,MAAMyM,YAAN,IAAsBzM,MAAMsM,UAA/B,EAA2C,OAAO,KAAP;UACrCG,YAAN;;;;MAICxR,QAAQwc,KAAX,EAAkB;UACV/K,gBAAN,GAAyB,CAAC1M,MAAM0M,gBAAhC;;;;MAICzR,QAAQuc,KAAX,EAAkB;UACVpL,SAAN,GAAkB,CAACpM,MAAMoM,SAAzB;;;;MAICnR,QAAQyc,KAAX,EAAkB;UACVlL,WAAN,GAAoB,CAACxM,MAAMwM,WAA3B;;;;MAICvR,QAAQ4c,KAAX,EAAkB;UACVxL,UAAN,GAAmB,CAACrM,MAAMqM,UAA1B;;;;;AAKJ,AAAO,SAAS6L,aAAT,CAAuBhB,EAAvB,EAA2B;KAC7BF,cAAH;SACOP,GAAG,WAAH,EAAgBpW,KAAvB;;;;;;AAMF,AAAO,SAAS8X,eAAT,CAAyBjB,EAAzB,EAA6B;;MAE9BkB,OAAOlB,GAAGnX,MAAd;MACIG,OAAOkY,KAAKC,SAAL,CAAeC,QAAf,CAAwB,MAAxB,IAAkC,MAAlC,GAA2C,KAAtD;MACI9I,MAAM4I,KAAKG,WAAf;MACI3N,KAAKwN,KAAKI,YAAL,CAAkB,SAAlB,CAAT;;;;;;;;MAQGtY,SAAS,KAAT,IAAkB0K,EAAlB,IAAwB4E,GAA3B,EAAgC;QAC1BnO,OAAOsM,EAAE8K,WAAF,CAAc7N,EAAd,CAAX;QACGvJ,QAAQA,KAAKU,IAAL,KAAcyN,GAAzB,EAA8B;;WAEvBzN,IAAL,GAAYyN,GAAZ;UACI5E,EAAJ;;;;;MAKD1K,SAAS,MAAZ,EAAoB;QACdwY,MAAMN,KAAKI,YAAL,CAAkB,UAAlB,CAAV;QACIG,MAAMP,KAAKI,YAAL,CAAkB,UAAlB,CAAV;;QAEII,QAAQjL,EAAE8K,WAAF,CAAcC,GAAd,CAAZ;QACItG,QAAQwG,MAAMrL,GAAN,CAAUsL,MAAV,CAAiBD,MAAMvL,IAAvB,CAAZ;QACI0D,OAAOqB,MAAMqC,MAAN,CACR,UAAS1D,IAAT,EACC;aAAUA,KAAKxD,GAAL,CAASD,GAAT,KAAiBoL,GAAjB,IAAwB3H,KAAK1D,IAAL,CAAUC,GAAV,KAAkBqL,GAA5C,IACE5H,KAAKxD,GAAL,CAASD,GAAT,KAAiBqL,GAAjB,IAAwB5H,KAAK1D,IAAL,CAAUC,GAAV,KAAkBoL,GADnD;KAFM,EAGsD,CAHtD,CAAX;;QAKG,CAAC3H,IAAJ,EAAU,OAAO/U,SAAP;;SAELwW,KAAL,GAAahD,GAAb;SACKtP,IAAL,GAAYsP,GAAZ;;;;;;;WAOOsJ,GAAT,CAAalO,EAAb,EAAiB;;;;;;QAMXmO,QAAQtV,SAASuV,gBAAT,CAA0B,eAAepO,EAAzC,CAAZ;SACI,IAAIpP,IAAI,CAAZ,EAAeA,IAAIud,MAAMrd,MAAzB,EAAiCF,GAAjC,EAAsC;UACjCud,MAAMvd,CAAN,MAAa4c,IAAhB,EACEW,MAAMvd,CAAN,EAAS+c,WAAT,GAAuB/I,GAAvB;;;;mBAIW,CAAf;;;;AAKJ,AAAO,SAASyJ,eAAT,CAAyB/B,EAAzB,EAA6B;MAC9BnX,SAASmX,GAAGnX,MAAhB;MACGA,OAAOjF,QAAP,KAAoB,QAAvB,EACE,OAAO,IAAP;;MAEE8P,KAAK7K,OAAOyY,YAAP,CAAoB,SAApB,CAAT;MACInX,OAAOsM,EAAE8K,WAAF,CAAc7N,EAAd,CAAX;;MAEG,CAACvJ,IAAJ,EACE,OAAOjC,QAAM,0BAAN,CAAP;;MAECiC,KAAKkQ,GAAL,KAAa,QAAhB,EAA0B;;MACtB2H,YAAF,CAAe7X,IAAf;GADF,MAGK;MACD6X,YAAF,CAAe7X,IAAf,EADG;;;;;;;AAQP,AAAO,SAAS8X,YAAT,CAAsBjC,EAAtB,EAA0B;KAC5BF,cAAH;;;MAGIoC,qCAAalC,GAAGmC,aAAH,CAAiBC,QAA9B,EAAJ;MACIjE,SAAS+D,OAAOlM,MAAP,CAAc,UAACC,GAAD,EAAMsJ,EAAN,EAAa;QAAKA,GAAG7L,EAAP,IAAa6L,GAAGpW,KAAhB,CAAuB,OAAO8M,GAAP;GAAnD,EAAgE,EAAhE,CAAb;;MAEG,CAACH,OAAOC,IAAP,CAAYoI,MAAZ,EAAoBnI,MAApB,CAA2B,UAACC,GAAD,EAAMuC,CAAN;WAAYvC,MAAMkI,OAAO3F,CAAP,CAAlB;GAA3B,EAAwD,EAAxD,CAAJ;WACS,KAAP;;sBAEkB2F,MAApB;;;;;;;ACnOF,SAASkE,QAAT,CAAkBC,MAAlB,EAA0B;SACjBC,MAAP,GAAgB,IAAhB;;;AAGF,SAASC,UAAT,CAAoBF,MAApB,EAA4B;SACnBA,OAAOC,MAAd;;;AAGF,SAASE,SAAT,CAAmBH,MAAnB,EAA2B;SAClBG,SAAP,GAAmB,IAAnB;;;AAGF,SAASC,WAAT,CAAqBJ,MAArB,EAA6B;SACpBA,OAAOG,SAAd;;;AAQF,SAASE,iBAAT,CAA2BzH,KAA3B,EAAkChP,KAAlC,EAAyC;;;WAG9B0W,cAAT,CAAwBja,CAAxB,EAA2B;QACrB+K,KAAK/K,EAAEE,MAAF,CAAS6K,EAAlB;QACImP,MAAMnP,GAAGpO,KAAH,CAAS,GAAT,CAAV;QACG,CAACud,IAAI,CAAJ,CAAJ,EAAY,OAAO/d,SAAP;;;;gBAIA+d,GAAZ;;;MAGEC,aAAaF,cAAjB;MACIG,aAAaH,cAAjB;;MAEII,aAAa9H,MAAMqC,MAAN,CAAa;WAAM,IAAN;GAAb,CAAjB;aACWpJ,GAAX,CAAe;WAAMjH,EAAA,CAAOwG,EAAP,EAAWlI,gBAAX,CAA4B,OAA5B,EAAqCsX,UAArC,CAAN;GAAf;aACW3O,GAAX,CAAe;WAAMjH,EAAA,CAAOwG,EAAP,EAAWlI,gBAAX,CAA4B,WAA5B,EAAyCuX,UAAzC,CAAN;GAAf;;WAGSE,cAAT,CAAwBta,CAAxB,EAA2B;QACrB+K,KAAK/K,EAAEE,MAAF,CAAS6K,EAAlB;QACG,CAACA,EAAJ,EAAQ,OAAO5O,SAAP;;QAEJ+d,MAAMpM,EAAE1N,CAAF,CAAI2K,EAAJ,EAAQwP,IAAR,GAAeA,IAAf,GAAsB5D,GAAtB,GAA4BnL,GAA5B,CAAgC;aAAKyJ,EAAExH,GAAP;KAAhC,EAA4CmH,MAA5C,CAAmDhF,MAAnD,CAAV;;;eAGW;aAAK4K,YAAYN,GAAZ,CAAL;KAAX,EAAkC,GAAlC,EAPyB;;;WAUlBO,aAAT,CAAuBza,CAAvB,EAA0B;QACpB+K,KAAK/K,EAAEE,MAAF,CAAS6K,EAAlB;QACG,CAACA,EAAJ,EAAQ,OAAO5O,SAAP;;QAEJ+d,MAAMpM,EAAE1N,CAAF,CAAI2K,EAAJ,EAAQwP,IAAR,GAAeA,IAAf,GAAsB5D,GAAtB,GAA4BnL,GAA5B,CAAgC;aAAKyJ,EAAExH,GAAP;KAAhC,EAA4CmH,MAA5C,CAAmDhF,MAAnD,CAAV;;gBAEYsK,GAAZ,EAAiB,UAAjB;;;MAGEQ,aAAaD,aAAjB;MACIE,aAAaL,cAAjB;;MAEIM,aAAarX,MAAMqR,MAAN,CAAa;WAAM,CAAC7J,EAAP;GAAb,CAAjB;aACWS,GAAX,CAAe;WAAMjH,EAAA,CAAOwG,EAAP,EAAWlI,gBAAX,CAA4B,OAA5B,EAAqC6X,UAArC,CAAN;GAAf;aACWlP,GAAX,CAAe;WAAMjH,EAAA,CAAOwG,EAAP,EAAWlI,gBAAX,CAA4B,WAA5B,EAAyC8X,UAAzC,CAAN;GAAf;;;AAMF,IAAIE,mBAAmB,EAAvB;AACA,IAAIC,gBAAgB,EAApB;;AAEA,AAAO,SAASC,oBAAT,GAAgC;kBACrBxW,EAAA,CAAO,WAAP,EAAoB1B,gBAApB,CAAqC,WAArC,EAAkDmY,eAAlD,CAAhB;;;AAGF,AAAO,SAASC,sBAAT,GAAkC;IACvC,CAAO,WAAP,EAAoBlY,mBAApB,CAAwC,WAAxC,EAAqD+X,aAArD;;;AAGF,SAASE,eAAT,CAAyBhb,CAAzB,EAA4B;OACtB,IAAIC,IAAED,EAAEE,MAAZ,EAAoBD,KAAKA,EAAEib,OAA3B,EAAoCjb,IAAIA,EAAE8B,UAA1C,EAAsD;QACjD9B,EAAEib,OAAF,CAAU,WAAV,CAAH,EAA2B;UACtBL,qBAAqB5a,CAAxB,EACE,OAAO9D,SAAP;;yBAEiB8D,CAAnB;UACIia,MAAM,GAAG9J,KAAH,CAAS/I,IAAT,CAAcpH,EAAE9E,QAAhB,EAA0BqQ,GAA1B,CAA8B;eAAQhK,KAAK2Z,OAAL,CAAapQ,EAArB;OAA9B,EAAuD6J,MAAvD,CAA8DwG,OAA9D,CAAV;;;;kBAIYlB,GAAZ;aACO/d,SAAP;;;;;AAKN,SAASqe,WAAT,CAAqBa,MAArB,EAAiD;MAApBrK,MAAoB,uEAAb,WAAa;;MAC3CqE,UAAUrE,WAAW,UAAX,GAAwBlD,EAAE1N,CAAF,CAAI,EAACwZ,QAAW,IAAZ,EAAJ,EAAuBjD,GAAvB,EAAxB,GACwB7I,EAAE1N,CAAF,CAAI,EAAC0Z,WAAW,IAAZ,EAAJ,EAAuBnD,GAAvB,EADtC;;UAIQtE,OAAR,CAAgB,UAAS7Q,IAAT,EAAe;QAC1BwP,WAAW,UAAd,EACE6I,WAAWrY,IAAX,EADF,KAGEuY,YAAYvY,IAAZ;GAJJ;;MAOG,CAAC6Z,MAAD,IAAW,CAACA,OAAOxf,MAAtB,EAA8B;;WAErBM,SAAP;;;MAGC,OAAOkf,MAAP,KAAkB,UAArB,EAAiC;cACrBvN,EAAE1N,CAAF,GAAMwU,MAAN,CAAayG,MAAb,EAAqB1E,GAArB,EAAV;GADF,MAEO;cACK7I,EAAE1N,CAAF,CAAIib,MAAJ,EAAY1E,GAAZ,EAAV;;;UAGMtE,OAAR,CAAgB,UAAS7Q,IAAT,EAAe;QAC1BwP,WAAW,UAAd,EACE0I,SAASlY,IAAT,EADF,KAGEsY,UAAUtY,IAAV;GAJJ;;;;;AAWF,AAAO,SAAS8Z,kBAAT,CAA4BjE,EAA5B,EAAgC;MACjCnX,SAASmX,GAAGnX,MAAhB;MACI8T,MAAM9T,OAAOoX,SAAjB;;MAEG,CAACtD,GAAJ,EACE,OAAO7X,SAAP;;MAEC0e,qBAAqB7G,GAAxB,EACE,OAAO7X,SAAP;;qBAEiB6X,GAAnB;cACY,UAAS5T,CAAT,EAAY;WAAS,CAACA,EAAE8L,IAAF,CAAOqB,OAAP,CAAeyG,GAAf,CAAR;GAA1B;;;AAGF,AAAO,SAASuH,iBAAT,CAA2BlE,EAA3B,EAA+B;MACjC,CAACwD,gBAAJ,EACE,OAAO1e,SAAP;;qBAEiB,KAAnB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3JF,IAAMqf,YAAY,EAAlB;AACA,SAASC,YAAT,CAAsB/d,CAAtB,EAAyB;YACb5B,IAAV,CAAe4B,CAAf;;;AAGF,IAAIge,mBAAmB,KAAvB;;AAEA,SAASC,cAAT,GAA0B;MACrBD,gBAAH,EAAqB,OAAOvf,SAAP;qBACF,IAAnB;;SAEOyf,qBAAP,CAA6B,YAAM;uBACd,KAAnB;cACUvJ,OAAV,CAAkB;aAAK3U,EAAEyC,KAAF,CAAL;KAAlB;GAFF;;;;;;;;;;;;AAiBF,IAAM0b,MAAMtX,EAAA,CAAO,SAAP,EAAkBuX,UAAlB,CAA6B,IAA7B,CAAZ;;AAEA,IAAIC,QAAJ;IAAcC,SAAd;IAAyBC,SAAzB;;;;AAKA,SAASC,IAAT,GAAgB;;aAEHhM,KAAMiM,IAAI,MAAJ,EAAYC,UAAZ,CAAN,EACMD,IAAI,MAAJ,EAAYE,SAAZ,CADN,EAEMF,IAAI,MAAJ,EAAYG,OAAZ,CAFN,EAGMH,IAAI,MAAJ,EAAYtI,OAAO0I,SAAnB;;IAEAC,QALN,EAMMC,aANN,EAOMC,SAPN,EAQMC,UARN,EASMC,SATN,EAUMC,oBAVN,EAWMC,YAXN,EAYMC,YAZN,EAaMC,cAbN,EAcMC;;IAEAC,SAhBN,EAiBMC,eAjBN,EAkBMC,UAlBN,EAmBMC,UAnBN,EAoBMC,eApBN,EAqBMC;;IAEAC,YAvBN,EAwBMC,WAxBN,EAyBMC,aAzBN,CAAX;;cA4BYxN,KAAMyN,WAAN,EACMC,cADN,EAEMC,cAFN,EAGMC,eAHN,CAAZ;;cAMY5N,KAAMyN,WAAN,EACMC,cADN,EAEMC,cAFN,EAGME,aAHN,EAIMD,eAJN,CAAZ;;;AAQF,SAASE,WAAT,CAAqB9N,OAArB,EAA2B;;MAErB+N,MAAM,EAAExP,MAAMoF,OAAOpX,KAAP,CAAaqR,CAAb,CAAR;SACO,EAACoQ,MAAM,EAAP,EAAWC,MAAM,EAAjB,EAAqBC,MAAM,EAA3B,EADP;YAEU,EAAE3R,YAAYtM,MAAMsM,UAApB;kBACctM,MAAMuM,UADpB;eAEW2R,OAAOC;KAJ5B;YAMU,EANV;SAOOzC;GAPjB;;SAUO3L,QAAK+N,GAAL,CAAP;;;;;;;;;;;AAWF,SAASM,iBAAT,GAA6B;MACvBN,MAAMD,YAAYhC,SAAZ,CAAV;SACOiC,IAAIO,WAAX;;;AAGF,SAASC,wBAAT,GAAoC;MAC9BR,MAAMD,YAAY/B,SAAZ,CAAV;SACOgC,IAAIO,WAAX;;;AAGF,SAASE,YAAT,GAAwB;;MAElBT,MAAMD,YAAYjC,QAAZ,CAAV;SACOkC,IAAIO,WAAX;;;AAGF,SAASG,cAAT,GAA0B;SACjBC,oBAAoB1J,KAApB,CAAP;;;;;AAMF,SAASkH,UAAT,CAAoByC,CAApB,EAAuB;;MAEjBC,OAAOjL,OAAOC,KAAP,EAAX;MACIvB,QAAQ,EAAZ;;IAEEnS,CAAF,GAAMuW,GAAN,GAAYtE,OAAZ,CAAoB,UAAS7Q,IAAT,EAAe;QAC9BA,KAAKgV,IAAR,EACE,OAAOra,SAAP;;QAEE4iB,SAASF,EAAEze,CAAF,CAAIoB,KAAKiM,GAAT,EAAc8M,IAAd,GAAqB5D,GAArB,EAAb;WACOtE,OAAP,CAAe,UAAS2M,KAAT,EAAgB;UAC1BA,MAAMxI,IAAT,EACEhV,KAAKgV,IAAL,GAAY9C,KAAKvN,GAAL,CAAS3E,KAAKgV,IAAL,IAAWyI,QAApB,EAA8BD,MAAMxI,IAApC,CAAZ;;UAEE0I,KAAKL,EAAEze,CAAF,CAAI4e,MAAMvR,GAAV,EAAe8M,IAAf,GAAsB5D,GAAtB,EAAT;UACGuI,GAAGrjB,MAAH,GAAY,CAAf,EACE,OAAOM,SAAP;;UAEE+U,OAAO,EAACxD,KAAKwR,GAAG,CAAH,EAAMzR,GAAZ,EAAiBD,MAAM0R,GAAG,CAAH,EAAMzR,GAA7B,EAAkCkF,OAAOqM,MAAM9c,IAAN,IAAc,EAAvD,EAAX;;UAEG,CAACqQ,MAAM4M,IAAN,CAAW;eAAKlK,EAAEvH,GAAF,KAAUwD,KAAKxD,GAAf,IAAsBuH,EAAEzH,IAAF,KAAW0D,KAAK1D,IAA3C;OAAX,CAAJ,EACE+E,MAAMzW,IAAN,CAAWoV,IAAX;;WAEGsC,SAAL,CAAehS,IAAf;KAbF;GALF;;QAsBM6Q,OAAN,CAAc,UAASnB,IAAT,EAAe;SACtBuC,OAAL,CAAavC,IAAb;GADF;;SAIO4N,IAAP;;;AAGF,SAASzC,SAAT,CAAmBwC,CAAnB,EAAsB;MAChBO,UAAU,EAAd;;IAEEhf,CAAF,GAAMuW,GAAN,GAAYtE,OAAZ,CAAoB,UAAS7Q,IAAT,EAAe;QAC9B,CAACA,KAAKU,IAAT,EACE,OAAO/F,SAAP;;QAEC,CAACijB,QAAQ5d,KAAKU,IAAb,CAAJ,EAAwB;cACdV,KAAKU,IAAb,IAAqB,CAACV,IAAD,CAArB;KADF,MAGK;cACKA,KAAKU,IAAb,EAAmBpG,IAAnB,CAAwB0F,IAAxB;;GARJ;;SAYO4L,IAAP,CAAYgS,OAAZ,EAAqB/M,OAArB,CAA6B,UAASnQ,IAAT,EAAe;QACvCkd,QAAQld,IAAR,EAAcrG,MAAd,GAAuB,CAA1B,EACEgjB,EAAEQ,aAAF,CAAgBD,QAAQld,IAAR,CAAhB;GAFJ;;SAKO2c,CAAP;;;;;AAMF,IAAIS,WAAW,CAAE,CAAC,KAAD,EAAQ,KAAR,EAAe,yBAAf,EAA0C,yBAA1C,EAAqE,yBAArE,CAAF,EACC,CAAC,KAAD,EAAQ,KAAR,EAAe,uBAAf,EAAwC,uBAAxC,CADD,EAEC,CAAC,8BAAD,EAAiC,+BAAjC,CAFD,EAGC,CAAC,WAAD,EAAc,MAAd,CAHD,CAAf;;AAMA,SAAShD,OAAT,CAAiBuC,CAAjB,EAAoB;WACTrT,GAAT,CAAa,UAAS+T,KAAT,EAAgB;WACpBA,MAAMlS,MAAN,CAAa,UAASC,GAAT,EAAcpL,IAAd,EAAoB;aAC/BoL,IAAI0L,MAAJ,CAAW6F,EAAEze,CAAF,CAAI,EAAC8B,MAAMA,IAAP,EAAJ,EAAkByU,GAAlB,EAAX,CAAP;KADK,EAEJ,EAFI,CAAP;GADF,EAIGtE,OAJH,CAIWwM,EAAEQ,aAAF,CAAgBG,IAAhB,CAAqBX,CAArB,CAJX;;SAMOA,CAAP;;;;;AAKF,SAAS1C,GAAT,CAAalf,OAAb,EAAmBsT,GAAnB,EAAwB;SACf,UAAS0N,GAAT,EAAc;QACfhhB,OAAJ,IAAYsT,IAAI0N,IAAIhhB,OAAJ,CAAJ,CAAZ;WACOghB,GAAP;GAFF;;;AAMF,SAASzB,QAAT,CAAkByB,GAAlB,EAAuB;MACjBwB,UAAUR,QAAd;MACIS,UAAU,CAAd;MACI3e,OAAOkd,IAAI0B,MAAJ,CAAWC,KAAX,GAAmB,EAA9B;;MAEInR,IAAJ,CAASoR,CAAT,GAAa5B,IAAIxP,IAAJ,CAASoR,CAAT,CAAWrU,GAAX,CAAe,UAAShK,IAAT,EAAe;;QAEtCA,KAAKgV,IAAL,GAAY,aAAf,EAA8B,OAAOhV,IAAP,CAFW;;QAIrCse,OAAQ,IAAIrJ,IAAJ,CAASjV,KAAKgV,IAAL,GAAU,SAAnB,CAAD,CAAgCuJ,WAAhC,EAAX;QACGD,OAAOL,OAAV,EAAmBA,UAAUK,IAAV,CALsB;QAMtCA,OAAOJ,OAAV,EAAmBA,UAAUI,IAAV,CANsB;;SAQpCA,IAAL,GAAYA,IAAZ,CARyC;YASjC/e,IAAR,EAAcS,KAAKse,IAAnB,EAAyBte,IAAzB,EATyC;;WAWlCA,IAAP;GAXW,CAAb;;;;MAgBIme,MAAJ,CAAWF,OAAX,GAAqBtf,MAAMuM,UAA3B;MACIiT,MAAJ,CAAWD,OAAX,GAAqBvf,MAAMsM,UAA3B;;SAEOwR,GAAP;;;AAGF,SAASxB,aAAT,CAAuBwB,GAAvB,EAA4B;;MAEtB0B,MAAJ,CAAW7L,KAAX,GAAmBD,OAAOC,KAAP,CAAamK,IAAIxP,IAAJ,CAASoR,CAAtB,EAAyB5B,IAAIxP,IAAJ,CAASuR,CAAlC,CAAnB;MACIvR,IAAJ,CAASoR,CAAT,GAAa5B,IAAI0B,MAAJ,CAAW7L,KAAX,CAAiBmM,QAA9B;MACIxR,IAAJ,CAASuR,CAAT,GAAa/B,IAAI0B,MAAJ,CAAW7L,KAAX,CAAiBvB,KAA9B;SACO0L,GAAP;;;AAGF,SAASvB,SAAT,CAAmBuB,GAAnB,EAAwB;MAClB2B,QAAQ3B,IAAI0B,MAAJ,CAAWC,KAAvB;;SAEOxS,IAAP,CAAYwS,KAAZ,EAAmBvN,OAAnB,CAA2B,UAAS6N,OAAT,EAAkB;QACvCJ,OAAOF,MAAMM,OAAN,CAAX;QACIC,OAAO,EAAC9f,MAAM,MAAP,EAAeyf,MAAMI,OAArB,EAA8Bhe,MAAM,MAApC,EAA4CwL,KAAK,EAAjD,EAAqDF,MAAM,EAA3D,EAAX;;QAEI4S,SAAS,KAAKN,KAAKjkB,MAAV,GAAmB,CAAnB,GAAuB,CAAvB,GAA2B,KAAKikB,KAAKjkB,MAAlD;;QAEIwkB,QAAQ,EAAZ;SACI,IAAI1kB,IAAI,CAAZ,EAAeA,IAAIykB,MAAnB,EAA2BzkB,GAA3B,EAAgC;YACxBG,IAAN,CAAWW,QAAM0jB,IAAN,CAAX;;;UAGIjf,SAAN,CAAgBpF,IAAhB,CAAqBwS,KAArB,CAA2BwR,IAA3B,EAAiCO,KAAjC;UACMnf,SAAN,CAAgBpF,IAAhB,CAAqBwS,KAArB,CAA2B2P,IAAIxP,IAAJ,CAASoR,CAApC,EAAuCQ,KAAvC;GAZF;;SAeOpC,GAAP;;;AAGF,SAAStB,UAAT,CAAoBsB,GAApB,EAAyB;MACnB2B,QAAQ3B,IAAI0B,MAAJ,CAAWC,KAAvB;;MAEInR,IAAJ,CAASoR,CAAT,CAAWxN,OAAX,CAAmB,UAAS7Q,IAAT,EAAe;QAC7BA,KAAKyT,CAAR,EAAW,OAAOzT,IAAP;;QAEP8e,SAAS9e,KAAKse,IAAL,GAAY7B,IAAI0B,MAAJ,CAAWjT,UAAvB,GAAoC,CAAjD;QACI6T,SAASD,SAASngB,MAAM2M,WAA5B,CAJgC;;QAM5B0T,QAAQZ,MAAMpe,KAAKse,IAAX,CAAZ;;;QAGG,CAACU,KAAJ,EAAW,OAAO,KAAP;;QAEPtM,QAAQsM,MAAMjT,OAAN,CAAc/L,IAAd,CAAZ;QACIif,MAAM,IAAI/M,KAAKgN,EAAT,GAAcF,MAAM3kB,MAA9B;;QAEI8kB,MAAML,SAASpM,QAAQuM,GAA3B;QACIG,KAAML,SAAS7M,KAAKmN,GAAL,CAASF,GAAT,CAAnB;QACIG,KAAMP,SAAS7M,KAAKqN,GAAL,CAASJ,GAAT,CAAnB;QACIK,aAAaxf,KAAKkM,GAAL,CAAS7R,MAAT,GAAkB2F,KAAKgM,IAAL,CAAU3R,MAA7C;;SAEKolB,KAAL,GAAa,QAAb;SACKhM,CAAL,GAAS2L,EAAT;SACKM,CAAL,GAASJ,EAAT;SACKK,CAAL,GAAS,IAAI,IAAEzN,KAAKvN,GAAL,CAAS,CAAT,EAAY6a,aAAa,CAAzB,CAAf,CAtBgC;;WAwBzBxf,IAAP;GAxBF;;SA2BOyc,GAAP;;;AAGF,SAASrB,SAAT,CAAmBqB,GAAnB,EAAwB;MAClBxP,IAAJ,CAASoR,CAAT,GAAa5B,IAAIxP,IAAJ,CAASoR,CAAT,CAAWrU,GAAX,CAAe,UAAShK,IAAT,EAAe;SAAO4f,KAAL,GAAaA,MAAM5f,IAAN,CAAb,CAA0B,OAAOA,IAAP;GAA1D,CAAb;SACOyc,GAAP;;;AAGF,SAASpB,oBAAT,CAA8BoB,GAA9B,EAAmC;MAC7B2B,QAAQ3B,IAAI0B,MAAJ,CAAWC,KAAvB;;SAEOxS,IAAP,CAAYwS,KAAZ,EAAmByB,IAAnB,GAA0BhP,OAA1B,CAAkC,UAASjX,GAAT,EAAc;QAC1CkmB,QAAQ1B,MAAMxkB,GAAN,CAAZ;UACMimB,IAAN,CAAWE,UAAX;UACMlP,OAAN,CAAc,UAAS7Q,IAAT,EAAe;YACrB6Q,OAAN,CAAc,UAASmP,IAAT,EAAe;aACtBhgB,IAAL,EAAWggB,IAAX;YACIC,iBAAiBL,MAAM5f,IAAN,CAArB;YACIkgB,iBAAiBN,MAAMI,IAAN,CAArB;YACGhgB,KAAK4f,KAAL,GAAaI,KAAKJ,KAAlB,GAA0BK,iBAAiBC,cAA9C,EAA8D;eACvDlgB,IAAL,EAAWggB,IAAX;SADF,MAEO;eACAJ,KAAL,GAAaK,cAAb;eACKL,KAAL,GAAaM,cAAb;;OARJ;KADF;GAHF;;SAkBOzD,GAAP;;WAES0D,IAAT,CAAcC,EAAd,EAAkBC,EAAlB,EAAsB;QAChB5M,IAAI2M,GAAG3M,CAAX;QAAciM,IAAIU,GAAGV,CAArB;OACGjM,CAAH,GAAO4M,GAAG5M,CAAV,CAAa2M,GAAGV,CAAH,GAAOW,GAAGX,CAAV;OACVjM,CAAH,GAAOA,CAAP,CAAa4M,GAAGX,CAAH,GAAOA,CAAP;;;WAGNK,UAAT,CAAoBK,EAApB,EAAwBC,EAAxB,EAA4B;WACnBD,GAAGR,KAAH,GAAWS,GAAGT,KAArB;;;;AAIJ,SAASA,KAAT,CAAe5f,IAAf,EAAqB;SACZ,GAAGwX,MAAH,CAAUxX,KAAKkM,GAAL,IAAU,EAApB,EAAwBlM,KAAKgM,IAAL,IAAW,EAAnC,EAAuCH,MAAvC,CAA8C,UAASC,GAAT,EAAc4D,IAAd,EAAoB;WAAQ5D,MAAMwU,WAAW5Q,IAAX,EAAiB1P,IAAjB,CAAb;GAAnE,EAAyG,CAAzG,CAAP;;WAESsgB,UAAT,CAAoB5Q,IAApB,EAA0B6Q,IAA1B,EAAgC;;QAE3B7Q,KAAKxD,GAAL,KAAclM,IAAd,IAAsB0P,KAAK1D,IAAL,CAAUsS,IAAV,GAAiBte,KAAKse,IAA/C,EAAqD,OAAO,CAAP;QAClD5O,KAAK1D,IAAL,KAAchM,IAAd,IAAsB0P,KAAKxD,GAAL,CAAUoS,IAAV,GAAiBte,KAAKse,IAA/C,EAAqD,OAAO,CAAP;;;;QAIjDkC,KAAKtO,KAAKuO,GAAL,CAAS/Q,KAAKxD,GAAL,CAASuH,CAAT,GAAa/D,KAAK1D,IAAL,CAAUyH,CAAhC,CAAT;QACIiN,KAAKxO,KAAKuO,GAAL,CAAS/Q,KAAKxD,GAAL,CAASwT,CAAT,GAAahQ,KAAK1D,IAAL,CAAU0T,CAAhC,CAAT;;WAEOxN,KAAKyO,IAAL,CAAUH,KAAGA,EAAH,GAAQE,KAAGA,EAArB,CAAP;;;;AAIJ,SAASpF,YAAT,CAAsBmB,GAAtB,EAA2B;MACrBxP,IAAJ,CAASoR,CAAT,GAAa5B,IAAIxP,IAAJ,CAASoR,CAAT,CAAWjL,MAAX,CAAkB,UAASpT,IAAT,EAAe;WACrCA,KAAKnB,IAAL,KAAc,MAArB;GADW,CAAb;SAGO4d,GAAP;;;AAGF,SAASlB,YAAT,CAAsBkB,GAAtB,EAA2B;MACrBmE,YAAY,CAAhB;;MAEI3B,MAAM/M,KAAKgN,EAAL,GAAU,GAApB;MACId,QAAQ3B,IAAI0B,MAAJ,CAAWC,KAAvB;MACI5K,KAAK,EAAT;;SAEO5H,IAAP,CAAYwS,KAAZ,EAAmByB,IAAnB,GAA0BhP,OAA1B,CAAkC,UAASjX,GAAT,EAAc;QAC1CkmB,QAAQ1B,MAAMxkB,GAAN,CAAZ;UACMiX,OAAN,CAAc,UAAS7Q,IAAT,EAAe;UACvB6gB,MAAJ,EAAYC,OAAZ;;UAEG9gB,KAAKnB,IAAL,KAAc,MAAjB;;;;;;;WAOI,IAAIkiB,KAAK9B,GAAb,EAAkB8B,KAAK7O,KAAKgN,EAA5B,EAAgC6B,KAAK,CAAC,CAAD,IAAIA,KAAK9B,OAAK8B,KAAG7O,KAAKuO,GAAL,CAASM,EAAT,CAAR,CAAT,CAArC,EAAsE;iBAC3DC,cAAchhB,IAAd,EAAoB+gB,EAApB,CAAT;kBACUE,aAAaJ,OAAOnB,CAApB,EAAuBlM,EAAvB,CAAV;YACG,CAACsN,OAAD,IAAY5O,KAAKuO,GAAL,CAASK,UAAUD,OAAOnB,CAA1B,IAA+BkB,SAA9C,EACE;;;;;WAKCnN,CAAL,GAASoN,OAAOpN,CAAhB;WACKiM,CAAL,GAASmB,OAAOnB,CAAhB;SACGplB,IAAH,CAAQumB,OAAOnB,CAAf;;SAEGG,IAAH,CAAQ,UAAS5b,CAAT,EAAYkF,CAAZ,EAAe;eAAQlF,IAAIkF,CAAX;OAAxB,EAvB2B;KAA7B;GAFF;;SA6BOsT,GAAP;;WAESuE,aAAT,CAAuBhhB,IAAvB,EAA6B+gB,EAA7B,EAAiC;WACxB,EAAEtN,GAAGzT,KAAKyT,CAAL,GAASvB,KAAKmN,GAAL,CAAS0B,EAAT,CAAT,GAAwB/gB,KAAK0f,CAAL,GAASxN,KAAKqN,GAAL,CAASwB,EAAT,CAAtC;SACK/gB,KAAKyT,CAAL,GAASvB,KAAKqN,GAAL,CAASwB,EAAT,CAAT,GAAwB/gB,KAAK0f,CAAL,GAASxN,KAAKmN,GAAL,CAAS0B,EAAT;KAD7C;;;WAKOE,YAAT,CAAsBC,CAAtB,EAAyBzf,EAAzB,EAA6B;;QACvBqf,OAAJ;QACIpO,QAAQR,KAAKiP,KAAL,CAAW1f,GAAGpH,MAAH,GAAY,CAAvB,CAAZ;QACIqR,OAAOjK,GAAGiR,KAAH,CAAX;;QAEGjR,GAAGpH,MAAH,GAAY,CAAf,EAAkB;WACZ,IAAIF,IAAI,CAAZ,EAAeA,IAAIsH,GAAGpH,MAAtB,EAA8BF,GAA9B,EAAmC;YAC9B2mB,YAAYnmB,SAAZ,IAAyBuX,KAAKuO,GAAL,CAAShf,GAAGtH,CAAH,IAAQ+mB,CAAjB,IAAsBhP,KAAKuO,GAAL,CAASK,UAAUI,CAAnB,CAAlD,EACEJ,UAAUrf,GAAGtH,CAAH,CAAV;;aAEG2mB,OAAP;;;QAGCpV,SAASwV,CAAZ,EACE,OAAOxV,IAAP;;QAECA,OAAOwV,CAAV,EACE,OAAOD,aAAaC,CAAb,EAAgBzf,GAAGmN,KAAH,CAAS,CAAT,EAAY8D,KAAZ,CAAhB,CAAP;;WAEKuO,aAAaC,CAAb,EAAgBzf,GAAGmN,KAAH,CAAS8D,QAAQ,CAAjB,CAAhB,CAAP;;;;AAIJ,SAAS8I,cAAT,CAAwBiB,GAAxB,EAA6B;MACvB2E,MAAM3E,IAAI0B,MAAJ,CAAWlT,UAArB;MACItG,MAAM8X,IAAI0B,MAAJ,CAAWjT,UAArB;;;MAGGvM,MAAMyM,YAAN,GAAqBgW,GAAxB,EACEA,MAAMziB,MAAMyM,YAAZ;;;MAGE6B,IAAJ,CAASoR,CAAT,GAAa5B,IAAIxP,IAAJ,CAASoR,CAAT,CAAWjL,MAAX,CAAkB,UAASpT,IAAT,EAAe;;QAEzCA,KAAKse,IAAL,GAAY8C,GAAZ,IAAmBphB,KAAKse,IAAL,GAAY3Z,GAAlC,EAAuC;UACjCwZ,MAAJ,CAAW7L,KAAX,CAAiBuF,YAAjB,CAA8B7X,IAA9B;aACO,KAAP;;WAEK,IAAP;GANW,CAAb;;SASOyc,GAAP;;;AAGF,SAAShB,YAAT,CAAsBgB,GAAtB,EAA2B;MACrB4E,UAAU5E,IAAI0B,MAAJ,CAAWkD,OAAzB;;MAEG,CAACA,OAAJ,EAAa,OAAO5E,GAAP;;;MAGTxP,IAAJ,CAASoR,CAAT,GAAa5B,IAAIxP,IAAJ,CAASoR,CAAT,CAAWjL,MAAX,CAAkB,UAASpT,IAAT,EAAe;;QAEzCqhB,QAAQC,QAAR,CAAiBthB,KAAKnB,IAAtB,CAAH,EAAgC;UAC1Bsf,MAAJ,CAAW7L,KAAX,CAAiBuF,YAAjB,CAA8B7X,IAA9B;aACO,KAAP;;WAEK,IAAP;GANW,CAAb;;SASOyc,GAAP;;;;;AAMF,SAASf,SAAT,CAAmBe,GAAnB,EAAwB;OAClB,IAAItiB,IAAIsiB,IAAI0B,MAAJ,CAAWF,OAAvB,EAAgC9jB,KAAKsiB,IAAI0B,MAAJ,CAAWD,OAAhD,EAAyD/jB,GAAzD,EAA8D;QACxDonB,QAAQpnB,MAAMwE,MAAMyM,YAAZ,GAA2B,0BAA3B,GAAwD,oBAApE;QACI2T,SAASpgB,MAAM2M,WAAN,IAAqBnR,IAAIsiB,IAAI0B,MAAJ,CAAWjT,UAAf,GAA4B,CAAjD,CAAb;QACIsW,MAAJ,CAAW1Z,OAAX,CAAmB,EAAC2X,OAAO,QAAR,EAAkBhM,GAAG,CAArB,EAAwBiM,GAAG,CAA3B,EAA8BC,GAAGZ,MAAjC,EAAyC0C,QAAQF,KAAjD,EAAwDG,MAAM,kBAA9D,EAAkFC,MAAM,CAAxF,EAA2F9iB,MAAM,MAAjG,EAAyGyf,MAAMnkB,CAA/G,EAAnB;;SAEKsiB,GAAP;;;AAGF,SAASd,eAAT,CAAyBc,GAAzB,EAA8B;MACxBmF,SAAS,EAAb;;MAEIJ,MAAJ,CAAWpO,MAAX,CAAkBnF,GAAG,MAAH,EAAW,MAAX,CAAlB,EAAsC4C,OAAtC,CAA8C,UAAS4O,KAAT,EAAgB;QACxDiC,OAAOjC,MAAMnB,IAAN,IAAc3f,MAAMyM,YAApB,GAAmC,MAAnC,GAA4C,MAAvD;QACI+F,QAAQ,EAACsO,OAAO,MAAR,EAAgBjkB,KAAKikB,MAAMnB,IAA3B,EAAiC7K,GAAG,CAAC,EAArC,EAAyCiM,GAAG,CAACD,MAAME,CAAP,GAAW,CAAvD,EAA0D+B,MAAMA,IAAhE,EAAZ,CAF4D;WAGrDpnB,IAAP,CAAY6W,KAAZ;GAHF;;MAMIqQ,MAAJ,GAAa/E,IAAI+E,MAAJ,CAAWhK,MAAX,CAAkBoK,MAAlB,CAAb;SACOnF,GAAP;;;AAGF,SAASb,UAAT,CAAoBa,GAApB,EAAyB;MACnBoF,OAAO,EAAE,kBAAkB,uBAApB;eACa,yBADb;gBAEc,0BAFd;YAGU,wBAHV;WAIS;GAJpB;;MAOI5U,IAAJ,CAASuR,CAAT,CAAW3N,OAAX,CAAmB,UAASnB,IAAT,EAAe;QAC7B,CAAC/Q,MAAMoM,SAAP,IAAoB,EAAE2E,KAAK1D,IAAL,CAAUsS,IAAV,KAAmB3f,MAAMyM,YAAzB,IAAyCsE,KAAKxD,GAAL,CAASoS,IAAT,KAAkB3f,MAAMyM,YAAnE,CAAvB;aACSzQ,SAAP;;QAEE4mB,QAAQM,KAAKnS,KAAKyB,KAAV,CAAZ;QACIA,QAAQzB,KAAKyB,KAAL,IAAc,MAA1B;QACI5H,KAAQmG,KAAKxD,GAAL,CAASD,GAAT,GAAe,GAAf,GAAqByD,KAAK1D,IAAL,CAAUC,GAA3C;;;;;;;;;QASI0V,OAAO,EAAClC,OAAO,MAAR,EAAgBxT,KAAK1C,EAArB,EAAyBuY,IAAIpS,KAAKxD,GAAL,CAASuH,CAAtC,EAAyCsO,IAAIrS,KAAKxD,GAAL,CAASwT,CAAtD,EAAyDsC,IAAItS,KAAK1D,IAAL,CAAUyH,CAAvE,EAA0EwO,IAAIvS,KAAK1D,IAAL,CAAU0T,CAAxF,EAA2F+B,QAAQF,KAAnG,EAA0G1iB,MAAM,MAAhH,EAAwHsS,OAAOA,KAA/H,EAAX;QACIqQ,MAAJ,CAAWlnB,IAAX,CAAgBqnB,IAAhB;GAhBF;SAkBOlF,GAAP;;;AAGF,SAASZ,UAAT,CAAoBY,GAApB,EAAyB;MACnB+E,MAAJ,GAAa/E,IAAI+E,MAAJ,CAAWhK,MAAX,CAAkB1K,KAAlB,CAAwB2P,IAAI+E,MAA5B,EAAoC/E,IAAIxP,IAAJ,CAASoR,CAAT,CAAWrU,GAAX,CAAe,UAAShK,IAAT,EAAe;;QAE1E,CAACrB,MAAMoM,SAAV,EAAqB;UACfmX,QAAQ,CAACliB,KAAKkM,GAAL,CAASsL,MAAT,CAAgBxX,KAAKgM,IAArB,EACShC,GADT,CACa;eAAK,CAACxL,EAAE0N,GAAF,CAAMoS,IAAP,EAAa9f,EAAEwN,IAAF,CAAOsS,IAApB,CAAL;OADb,EAESzS,MAFT,CAEgB,UAACC,GAAD,EAAMrN,CAAN;eAAYqN,IAAI0L,MAAJ,CAAW/Y,CAAX,CAAZ;OAFhB,EAE2C,EAF3C,EAGS2U,MAHT,CAGgB;eAAKsM,MAAM/gB,MAAMyM,YAAjB;OAHhB,EAG+C/Q,MAH5D;UAIG6nB,KAAH,EACE,OAAO,EAAP;;;;;;QAMAL,OAAO,EAAEM,SAAS,SAAX;QACEC,QAAS,SADX;QAEEtgB,OAAS,SAFX;QAGE2I,KAAS,SAHX;KAAX;;QAMI8W,QAAQM,KAAK7hB,KAAKnB,IAAV,CAAZ;;QAEI4gB,QAAQ,EAAEA,OAAO,QAAT;WACOzf,KAAKiM,GADZ;SAEKjM,KAAKyT,CAFV;SAGKzT,KAAK0f,CAHV;SAIK1f,KAAK2f,CAAL,GAAS,GAJd;QAKEjf,MAAMV,KAAKU,IALb;YAMQ6gB;KANpB;;QASG,CAACvhB,KAAKsY,SAAN,IAAmB,CAACtY,KAAKoY,MAA5B,EACE,OAAOqH,KAAP;;QAEE4C,SAASriB,KAAKoY,MAAL,GAAc,yBAAd,GACc,wBAD3B;;QAGIE,YAAY,EAAEmH,OAAO,QAAT;WACOzf,KAAKiM,GAAL,GAAW,YADlB;SAEKjM,KAAKyT,CAFV;SAGKzT,KAAK0f,CAHV;SAIK1f,KAAK2f,CAAL,GAAS,EAJd;YAKQ,IALR;YAMQ0C,MANR;YAOQ;KAPxB;;WAUO,CAAC/J,SAAD,EAAYmH,KAAZ,CAAP;GA/C+C,CAApC,CAAb;SAiDOhD,GAAP;;;AAGF,SAASX,eAAT,CAAyBW,GAAzB,EAA8B;MACxBmF,SAAS,EAAb;;MAEIJ,MAAJ,CAAW3Q,OAAX,CAAmB,UAAS4O,KAAT,EAAgB;QAC9B,CAACA,MAAM/e,IAAV,EAAgB,OAAO/F,SAAP;QACZa,MAAM8S,SAASmR,MAAM/e,IAAf,EAAqB,EAArB,CAAV;QACIyQ,QAAQ,EAACsO,OAAO,MAAR,EAAgBjkB,KAAKA,GAArB,EAA0BiY,GAAGgM,MAAMhM,CAAN,GAAU,EAAvC,EAA2CiM,GAAGD,MAAMC,CAAN,GAAU,CAAxD,EAAZ;WACOplB,IAAP,CAAY6W,KAAZ;GAJF;;MAOIqQ,MAAJ,GAAa/E,IAAI+E,MAAJ,CAAWhK,MAAX,CAAkBoK,MAAlB,CAAb;SACOnF,GAAP;;;AAGF,SAASV,eAAT,CAAyBU,GAAzB,EAA8B;MACzB,CAAC9d,MAAMwM,WAAV,EACE,OAAOsR,GAAP;;MAEEmF,SAAS,EAAb;;MAEIJ,MAAJ,CAAW3Q,OAAX,CAAmB,UAAS4O,KAAT,EAAgB;QAC9BA,MAAM5gB,IAAN,KAAe,MAAlB,EAA0B,OAAOlE,SAAP;QACtBwW,QAAQ,EAACsO,OAAO,YAAR,EAAsBqC,IAAIrC,MAAMqC,EAAhC,EAAoCC,IAAItC,MAAMsC,EAA9C,EAAkDC,IAAIvC,MAAMuC,EAA5D,EAAgEC,IAAIxC,MAAMwC,EAA1E,EAA8EP,MAAMjC,MAAMgC,MAA1F,EAAkGjmB,KAAKikB,MAAMtO,KAA7G,EAAZ;WACO7W,IAAP,CAAY6W,KAAZ;GAHF;;MAMIqQ,MAAJ,GAAa/E,IAAI+E,MAAJ,CAAWhK,MAAX,CAAkBoK,MAAlB,CAAb;SACOnF,GAAP;;;;;;AAMF,SAAST,YAAT,CAAsBS,GAAtB,EAA2B;MACrB6F,GAAJ,CAAQ5F,IAAR;MACI4F,GAAJ,CAAQ1F,IAAR;SACOH,GAAP;;;AAGF,SAASR,WAAT,CAAqBQ,GAArB,EAA0B;;MAEpB1a,QAAQ,EAAZ;MACIgP,QAAQ,EAAZ;;MAEIyQ,MAAJ,CAAW3Q,OAAX,CAAmB,UAAS7Q,IAAT,EAAe;QAC5BsiB,GAAJ,CAAQ3F,IAAR,IAAgB4F,WAAWviB,IAAX,CAAhB;GADF;;;WAKSwV,cAAT,CAAwB,iBAAxB,EAA2CxU,SAA3C,GAAuDyb,IAAI6F,GAAJ,CAAQ5F,IAAR,GAAeD,IAAI6F,GAAJ,CAAQ3F,IAAvB,GAA8BF,IAAI6F,GAAJ,CAAQ1F,IAA7F;;mBAEA,CAA4B7L,KAA5B,EAAmChP,KAAnC;;SAEO0a,GAAP,CAdwB;;;WAmBf8F,UAAT,CAAoBviB,IAApB,EAA0B;QACpBof,KAAK,GAAT;QACIE,KAAK,GAAT;;QAEGtf,KAAKyf,KAAL,KAAe,QAAlB,EACE,OAAO+C,YAAYxiB,IAAZ,EAAkBof,KAAKpf,KAAKyT,CAA5B,EAA+B6L,KAAKtf,KAAK0f,CAAzC,EAA4C1f,KAAK2f,CAAjD,EAAoD3f,KAAKyhB,MAAzD,EAAiEzhB,KAAK0hB,IAAtE,EAA4E1hB,KAAK2hB,IAAjF,CAAP;;QAEC3hB,KAAKyf,KAAL,KAAe,MAAlB,EACE,OAAOgD,UAAUziB,IAAV,EAAgBof,KAAKpf,KAAK8hB,EAA1B,EAA8BxC,KAAKtf,KAAK+hB,EAAxC,EACgB3C,KAAKpf,KAAKgiB,EAD1B,EAC8B1C,KAAKtf,KAAKiiB,EADxC,EAC4CjiB,KAAKyhB,MADjD,EACyDzhB,KAAK2hB,IAD9D,CAAP;;QAGC3hB,KAAKyf,KAAL,KAAe,MAAlB,EACE,OAAOiD,UAAU1iB,IAAV,EAAgBof,KAAKpf,KAAKyT,CAA1B,EAA6B6L,KAAKtf,KAAK0f,CAAvC,EAA0C1f,KAAKxE,GAA/C,EAAoDwE,KAAK2iB,IAAzD,EAA+D3iB,KAAK0hB,IAApE,CAAP;;QAEC1hB,KAAKyf,KAAL,KAAe,YAAlB,EACE,OAAOmD,gBAAiB5iB,IAAjB,EAAuBof,KAAKpf,KAAK8hB,EAAjC,EAAqCxC,KAAKtf,KAAK+hB,EAA/C,EACuB3C,KAAKpf,KAAKgiB,EADjC,EACqC1C,KAAKtf,KAAKiiB,EAD/C,EAEuBjiB,KAAKxE,GAF5B,EAEiCwE,KAAK2iB,IAFtC,EAE4C3iB,KAAK0hB,IAFjD,CAAP;;;WAMKc,WAAT,CAAqBxiB,IAArB,EAA2ByT,CAA3B,EAA8BiM,CAA9B,EAAiCX,MAAjC,EAAyC8D,YAAzC,EAAuDC,UAAvD,EAAmEC,UAAnE,EAA+E;QAC1E,CAACtP,CAAD,IAAM,CAACiM,CAAP,IAAY,CAACX,MAAhB,EAAwB,OAAOpkB,SAAP;;;iBAGXmoB,cAAc,SAA3B;iBACaC,cAAc,CAA3B;mBACeF,gBAAgB,MAA/B;;QAEIG,YAAUhjB,KAAKiM,GAAnB;UACM3R,IAAN,CAAW0oB,IAAX;;4BAEsBA,IAAtB,kBAAsChjB,KAAKnB,IAAL,IAAa,MAAnD,eAAkE4U,CAAlE,cAA4EiM,CAA5E,aAAqFX,MAArF,gBAAsG+D,UAAtG,wBAAmIC,UAAnI,kBAA0JF,YAA1J;;;WAGOJ,SAAT,CAAmBziB,IAAnB,EAAyBijB,KAAzB,EAAgCC,KAAhC,EAAuCC,GAAvC,EAA4CC,GAA5C,EAAiDP,YAAjD,EAA+DE,UAA/D,EAA2E;;mBAE1D,0BAAf;;iBAEaA,cAAc,GAA3B;;QAGGE,QAAQC,KAAR,GAAgBC,GAAhB,GAAsBC,GAAtB,GAA4B,CAA5B,KAAkC,CAArC,EACE,OAAO,EAAP;;QAEEJ,YAAUhjB,KAAKiM,GAAnB;UACM3R,IAAN,CAAW0oB,IAAX;;;mDAKoBhjB,KAAKnB,IAFzB,cAEsCokB,KAFtC,cAEoDC,KAFpD,cAEkEC,GAFlE,cAE8EC,GAF9E,mCAE+GP,YAF/G,+BAGgBG,IAHhB,kBAGiChjB,KAAKnB,IAHtC,cAGmDokB,KAHnD,cAGiEC,KAHjE,cAG+EC,GAH/E,cAG2FC,GAH3F;;;WAOOV,SAAT,CAAmB1iB,IAAnB,EAAyByT,CAAzB,EAA4BiM,CAA5B,EAA+BlkB,GAA/B,EAAoCmnB,IAApC,EAA0CG,UAA1C,EAAsDO,SAAtD,EAAiE;iBAClDP,cAAc,MAA3B;gBACcO,aAAa,QAA3B;WACmBV,QAAQ,iBAA3B;;QAEGW,MAAM7P,CAAN,CAAH,EAAa,OAAO,EAAP;;QAETA,KAAK,CAAT;QACIiM,KAAK,CAAT;;yBAEmBjM,CAAnB,aAA4BiM,CAA5B,uBAA+CiD,IAA/C,gBAA8DG,UAA9D,0CAA6GO,SAA7G,UAA2H7nB,GAA3H;;;WAGOonB,eAAT,CAAyB5iB,IAAzB,EAA+B8hB,EAA/B,EAAmCC,EAAnC,EAAuCC,EAAvC,EAA2CC,EAA3C,EAA+CzmB,GAA/C,EAAoDmnB,IAApD,EAA0DG,UAA1D,EAAsE;WAC7D,EAAP;;;;QAIIS,SAAJ,GAAgBT,cAAc,KAA9B;QACIH,IAAJ,GAAWA,QAAQ,iBAAnB;;;;QAIIa,UAAU,CAAd;QACIhD,KAAKwB,KAAKF,EAAd;QACIpB,KAAKuB,KAAKF,EAAd;QACInd,MAAM6e,KAAK9C,IAAL,CAAUH,KAAGA,EAAH,GAAME,KAAGA,EAAnB,CAAV;QACIgD,QAAQ9e,MAAM,IAAE4e,OAApB;QACIG,MAAM,IAAE,CAAZ;QACIlQ,IAAIqO,EAAR;QACIpC,IAAIqC,EAAR;;QAEI6B,aAAapoB,GAAjB;QACIihB,IAAIoH,WAAJ,IAAmBxJ,IAAIwJ,WAAJ,CAAgBD,UAAhB,EAA4BE,KAA5B,GAAoCJ,KAA3D,EAAiE;aACxDE,cAAcvJ,IAAIwJ,WAAJ,CAAgBD,aAAW,GAA3B,EAAgCE,KAAhC,GAAwCJ,KAA7D;qBAAiFE,WAAWhV,KAAX,CAAiB,CAAjB,EAAoB,CAAC,CAArB,CAAb;OACpEgV,cAAc,GAAd;;;;QAIEG,QAAQN,KAAKO,KAAL,CAAWtD,EAAX,EAAeF,EAAf,CAAZ;QACIuD,QAAQ,CAACN,KAAKQ,EAAN,GAAS,CAAjB,IAAsBF,QAAQN,KAAKQ,EAAL,GAAQ,CAA1C,EAA4C;UACtCjC,EAAJ;UACIC,EAAJ;YACM,CAAC,CAAP;YACM,CAAC,CAAP;eACSwB,KAAKQ,EAAd;;;QAGEC,IAAJ;QACIC,SAAJ,GAAgB,QAAhB;QACIC,SAAJ,CAAc3Q,IAAE+M,KAAGmD,GAAnB,EAAwBjE,IAAEgB,KAAGiD,GAA7B;QACIU,MAAJ,CAAWN,KAAX;QACIO,QAAJ,CAAaV,UAAb,EAAyB,CAAzB,EAA4B,CAAC,CAA7B;QACIW,OAAJ;;;;;;AAQJ,AAKA,AAOA,SAASrI,aAAT,CAAuBO,GAAvB,EAA4B;;;SAGnBA,GAAP;;;;;AAMF,AAiBA,AAUA,AASA,AASA,AA2CA,SAASN,WAAT,CAAqBM,GAArB,EAA0B;MACpB+H,UAAUlY,EAAE1N,CAAF,CAAI,EAACsR,KAAK,QAAN,EAAJ,EAAqBiF,GAArB,EAAd,CADwB;MAEpBgJ,MAAJ,CAAWqG,OAAX,GAAqBA,OAArB;SACO/H,GAAP;;;AAGF,SAASL,cAAT,CAAwBK,GAAxB,EAA6B;MACvB0B,MAAJ,CAAWqG,OAAX,GAAqB/H,IAAI0B,MAAJ,CAAWqG,OAAX,CAAmBxa,GAAnB,CAAuB,UAASwF,MAAT,EAAiB;WACpD8O,IAAP,GAAc,IAAIrJ,IAAJ,CAASzF,OAAOwF,IAAP,GAAY,SAArB,EAAgCuJ,WAAhC,EAAd;WACO/O,MAAP;GAFmB,CAArB;;MAKG,CAAC7Q,MAAM0M,gBAAV,EAA4B,OAAOoR,GAAP;;MAExB0B,MAAJ,CAAWqG,OAAX,GAAqB/H,IAAI0B,MAAJ,CAAWqG,OAAX,CAAmBpR,MAAnB,CAA0B,UAAS5D,MAAT,EAAiB;WACvDA,OAAO8O,IAAP,KAAgB3f,MAAMyM,YAA7B;GADmB,CAArB;;SAIOqR,GAAP;;;AAGF,SAASJ,cAAT,CAAwBI,GAAxB,EAA6B;MACvBlI,YAAYkI,IAAI0B,MAAJ,CAAWqG,OAAX,CAAmBxa,GAAnB,CAAuBya,SAAvB,EAAkCrR,MAAlC,CAAyCwG,OAAzC,CAAhB;MACIuE,MAAJ,CAAW5J,SAAX,GAAuBA,SAAvB;SACOkI,GAAP;;;AAGF,SAASgI,SAAT,CAAmBjV,MAAnB,EAA2B;MACrBjQ,OAAO,EAAX;MACIwR,QAAQvB,OAAOxD,IAAP,CAAYwL,MAAZ,CAAmBhI,OAAOtD,GAA1B,CAAZ;MACG,CAAC6E,MAAM,CAAN,CAAJ,EAAc,OAAO,KAAP;MACXA,MAAM,CAAN,EAASI,KAAT,KAAmB,KAAtB,EACEJ,QAAQ,CAACA,MAAM,CAAN,CAAD,EAAWA,MAAM,CAAN,CAAX,CAAR;WACO2T,KAAT,CAAenb,EAAf,EAAmBmG,IAAnB,EAAyB;WAASA,KAAKxD,GAAL,CAASD,GAAT,KAAiB1C,EAAjB,GAAsBmG,KAAK1D,IAA3B,GAAkC0D,KAAKxD,GAA9C;;;OAEtB5R,IAAL,CAAUoqB,MAAMlV,OAAOvD,GAAb,EAAkB8E,MAAM,CAAN,CAAlB,CAAV,EAAuCvB,MAAvC,EAA+CkV,MAAMlV,OAAOvD,GAAb,EAAkB8E,MAAM,CAAN,CAAlB,CAA/C,EARyB;OASpBuN,IAAL,GAAY9O,OAAO8O,IAAnB;SACO/e,IAAP;;;AAGF,SAASgd,aAAT,CAAuBE,GAAvB,EAA4B;MACtB0B,MAAJ,CAAW5J,SAAX,GAAuBkI,IAAI0B,MAAJ,CAAW5J,SAAX,CAAqBnB,MAArB,CAA4B,gBAAQ;;WAElD7T,KAAK,CAAL,EAAQ6Y,MAAR,IAAkB7Y,KAAK,CAAL,EAAQ6Y,MAAjC;GAFqB,CAAvB;;SAKOqE,GAAP;;;AAGF,SAASH,eAAT,CAAyBG,GAAzB,EAA8B;;MAExBjhB,MAAM,EAAV;;MAEImpB,UAAU,CAAd;;MAEIxG,MAAJ,CAAW5J,SAAX,CAAqBsL,IAArB,CAA0B,UAAS5b,CAAT,EAAYkF,CAAZ,EAAe;WAChClF,EAAEqa,IAAF,GAASnV,EAAEmV,IAAlB;GADF;;MAIIH,MAAJ,CAAW5J,SAAX,CAAqB1D,OAArB,CAA6B,UAAStR,IAAT,EAAe;QACtC+U,WAAW,EAAf;QACIsQ,aAAa,EAAjB;QACIC,kBAAkB,CAAtB;;QAEGtlB,KAAK+e,IAAL,KAAcqG,OAAjB,EAA0B;iBACb,SAASplB,KAAK+e,IAAd,GAAqB,OAAhC;gBACU/e,KAAK+e,IAAf;;;SAGGzN,OAAL,CAAa,UAASvB,KAAT,EAAgB;UACvBrC,IAAJ;UACI8H,OAAOzF,MAAM5O,IAAN,IAAc4O,MAAM6B,KAA/B;UACIjB,MAAMZ,MAAMY,GAAhB;UACIrR,OAAOqR,MAAMZ,MAAMzQ,IAAZ,GAAmB,MAA9B;;UAEIimB,UAAU,CAACjmB,IAAD,CAAd;UACGqR,GAAH,EAAQ;gBACE5V,IAAR,CAAa4V,GAAb;gBACQ5V,IAAR,CAAa,UAAUgV,MAAMrD,GAA7B;OAFF,MAIK;gBACK3R,IAAR,CAAa,UAAWgV,MAAMpD,GAAN,CAAUD,GAArB,GAA2B,GAA3B,GAAiCqD,MAAMtD,IAAN,CAAWC,GAAzD;;;;;UAKCqD,MAAMgJ,SAAN,IAAmBhJ,MAAM8I,MAA5B,EACEyM;;UAEChmB,SAAS,MAAZ,EACEoO,OAAO,EAAC1D,IAAI+F,MAAMrD,GAAN,IAAW,EAAhB,EAAP,CADF,KAGEgB,OAAO,EAACoK,KAAK/H,MAAMpD,GAAN,CAAUD,GAAhB,EAAqBqL,KAAKhI,MAAMtD,IAAN,CAAWC,GAArC,EAAP;;UAEC,CAACtN,MAAMqM,UAAV,EACE4Z,cAAcG,SAASD,OAAT,EAAkB7X,IAAlB,EAAwB8H,IAAxB,CAAd,CADF,KAGE6P,cAAcI,eAAe1V,KAAf,EAAsBzQ,IAAtB,EAA4BqR,GAA5B,EAAiC6E,IAAjC,CAAd;KA5BJ;;QA+BIkQ,mBAAmB,UAAvB;wBACoBJ,mBAAmB,CAAnB,GAAuB,YAAvB,GAAsC,EAA1D;gBACY,eAAeI,gBAAf,GAAkC,IAAlC,GAAyCL,UAAzC,GAAsD,OAAlE;;;WAGOtQ,QAAP;GA9CF;;MAiDI0I,WAAJ,GAAkBxhB,GAAlB;;SAEOihB,GAAP;;;;WAISsI,QAAT,CAAkBD,OAAlB,EAA2B7X,IAA3B,EAAiCiY,IAAjC,EAAuC;YAC7Bpd,OAAR,CAAgB,MAAhB;QACIqd,YAAYL,QAAQM,IAAR,CAAa,GAAb,CAAhB;;QAEIC,WAAW1Z,OAAOC,IAAP,CAAYqB,IAAZ,EAAkBjD,GAAlB,CAAsB,UAASpQ,GAAT,EAAc;aAAQ,UAAUA,GAAV,GAAgB,IAAhB,GAAuBqT,KAAKrT,GAAL,CAAvB,GAAmC,GAA1C;KAArC,EAAqFwrB,IAArF,CAA0F,GAA1F,CAAf;;WAEO,mBAAmBD,SAAnB,GAA+B,GAA/B,GACAE,QADA,GAEA,0BAFA,GAGAH,IAHA,GAGO,SAHd;;;WAMOF,cAAT,CAAwB1V,KAAxB,EAA+BzQ,IAA/B,EAAqCqR,GAArC,EAA0CgV,IAA1C,EAAgD;QAC1CI,SAAS,EAAb;QACIC,QAAQ,EAAZ;;QAEGrV,QAAQ,QAAX,EAAqB;eACV,qCAAmCZ,MAAMrD,GAAzC,GAA6C,sCAAtD;KADF,MAGK,IAAGpN,SAAS,MAAZ,EAAoB;cACf,OAAOA,IAAP,GAAc,GAAtB;eACS,qCAAmCyQ,MAAMrD,GAAzC,GAA6C,6DAAtD;;;WAGK,MAAMiZ,IAAN,GAAaK,KAAb,GAAqBD,MAA5B;;;;;;AASJ,AAcA,AAaA,SAASlI,mBAAT,CAA6BnJ,YAA7B,EAA2C;MACrCzY,MAAM,EAAV;;;;WAISgqB,aAAT,CAAuBtV,GAAvB,EAA4B;QACtBnO,QAAQuK,EAAEmS,QAAF,CAAWrL,MAAX,CAAkB,UAASpT,IAAT,EAAe;aAAQA,KAAKkQ,GAAL,KAAaA,GAApB;KAAlC,EAA4DlG,GAA5D,CAAgEvO,KAAK,MAAL,CAAhE,CAAZ;QACIb,UAAUmH,MAAM8J,MAAN,CAAa,UAACC,GAAD,EAAMlN,CAAN;aAAYkN,2BAAwBlN,CAAxB,QAAZ;KAAb,EAAwD,EAAxD,CAAd;8BACwBsR,GAAxB,eAAqCtV,OAArC;;;MAGE6qB,SAAS,EAAb;MACIC,UAAU,EAAd;;;;MAIGzR,aAAaM,SAAb,CAAuBla,MAA1B,EAAkC;iBACnBka,SAAb,CAAuB1D,OAAvB,CACE,aAAK;iBACQ,KAAX;QACEwD,MAAF,CAASxD,OAAT,CAAiB,UAACgE,IAAD,EAAO1a,CAAP;eAAaurB,WAAWC,aAAa9Q,IAAb,EAAmBA,KAAK7V,KAAxB,EAA+B7E,CAA/B,IAAoC,GAA5D;OAAjB;iBACW,MAAX;KAJJ;;;;MASEma,WAAWL,aAAaJ,OAA5B;;WAESQ,MAAT,CAAgBxD,OAAhB,CAAwB,UAASgE,IAAT,EAAe1a,CAAf,EAAkB;eAC7BwrB,aAAa9Q,IAAb,EAAmBA,KAAK7V,KAAxB,EAA+B7E,CAA/B,IAAoC,GAA/C;GADF;;MAIG,CAACurB,OAAJ,EAAa;;GAAb,MAEO;;;;;MAKH7Q,OAAOP,SAASH,KAAT,CAAe,CAAf,CAAX;MACIyR,QAAQ,EAAZ;MACG/Q,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;YACf8mB,aAAa9Q,IAAb,EAAmBgR,gBAAgBhR,KAAK3E,GAArB,EAA0B2E,KAAKjb,GAA/B,CAAnB,CAAR;GADF,MAGK,IAAGib,KAAKhW,IAAL,KAAc,SAAjB,EAA4B;YACvB8mB,aAAa9Q,IAAb,EAAmBiR,gBAAgBjR,KAAK3E,GAArB,EAA0B2E,KAAKjb,GAA/B,CAAnB,CAAR;GADG,MAGA,IAAGib,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;YACpB8mB,aAAa9Q,IAAb,EAAmBkR,gBAAgBlR,KAAKjb,GAArB,CAAnB,CAAR;;;aAGSgsB,KAAX;;;;QAKMF,UAAUD,MAAhB,CAxDyC;;;MA2DrCO,WAAWra,OAAOC,IAAP,CAAYwD,IAAZ,CAAf;WACSyB,OAAT,CAAiB,UAASX,GAAT,EAAc;;GAA/B;;;;;;;SASO1U,GAAP;;;;WAISqqB,eAAT,CAAyB3V,GAAzB,EAA8BtW,GAA9B,EAAmC;;;QAG7BqsB,WAAWT,cAActV,GAAd,EAAmBtW,GAAnB,CAAf;;QAEGsW,QAAQ,OAAX,EAAoB;aACX,4BAA0BA,GAA1B,mBAA2CtW,GAA3C,8FACoDqsB,QAD3D;;;;QAKC/V,QAAQ,QAAX,EAAqB;;UAEftV,UAAU,CAAC,UAAD,EAAa,UAAb,EAAyB,SAAzB,EAAoC,KAApC,EAA2C,SAA3C,EAAsD,aAAtD,EAAqE,cAArE,CAAd;aACOsrB,iBAAiB,MAAjB,EAAyBtrB,OAAzB,CAAP;;;;;;;;;;;;WAYKkrB,eAAT,CAAyB5V,GAAzB,EAA8BtW,GAA9B,EAAmC;;QAE7BgB,UAAU,CAAC,QAAD,EAAW,KAAX,EAAkB,OAAlB,EAA2B,SAA3B,EAAsC,SAAtC,EAAiD,KAAjD,CAAd;WACOsrB,iBAAiBtsB,GAAjB,EAAsBgB,OAAtB,CAAP;;;WAQOsrB,gBAAT,CAA0B3c,EAA1B,EAA8BgK,EAA9B,EAAkC;;;;;WAIzBA,GAAG1H,MAAH,CAAU,UAACC,GAAD,EAAM2H,CAAN;aAAY3H,6BAA0B2H,CAA1B,8BAAoDlK,EAApD,WAA2DkK,CAA3D,eAAqEA,CAArE,UAAZ;KAAV,EAAoG,EAApG,CAAP;;;WAIOsS,eAAT,CAAyBnsB,GAAzB,EAA8B;QACxB4B,MAAM,gBAAe5B,GAAf,GAAoB,sBAApB,GAA4CA,GAA5C,GAAiD,yBAA3D;WACO4B,GAAP;;;WAGOmqB,YAAT,CAAsB9Q,IAAtB,EAA4B7V,KAA5B,EAAmC0T,KAAnC,EAA0C;;QACpCwS,OAAO,EAAX;;QAEGrQ,KAAKjb,GAAL,KAAa,SAAhB,EAA2B;UACtBib,KAAK7V,KAAL,IAAcmnB,OAAOC,SAAP,CAAiB1T,KAAjB,CAAjB,EAA0C;;gBAEhC,QAAQmC,KAAK7V,KAAb,GAAqB,MAA7B;OAFF,MAGO;gBACGA,QAAQ,GAAhB;;KALJ,MAQK,IAAG6V,KAAKjb,GAAL,KAAa,MAAhB,EAAwB;;cAEnBoF,KAAR;;KAFG,MAKA,IAAG6V,KAAKjb,GAAL,KAAa,QAAhB,EAA0B;cACrBoF,QAAQ,GAAhB;KADG,MAGA,IAAG6V,KAAKhW,IAAL,KAAc,SAAjB,EAA4B;UAC5B,CAACsnB,OAAOC,SAAP,CAAiB1T,KAAjB,CAAJ,EAA6B;;gBAEnB,MAAR;gBACQ1T,KAAR;;;;;;;;;;;;;KAJC,MAkBA,IAAG6V,KAAKhW,IAAL,KAAc,MAAjB,EAAyB;cACpB,aAAR;cACQG,QAAQ,GAAhB;KAFG,MAIA;aACI,MAAMA,KAAN,GAAc,GAArB;;;WAGKkmB,IAAP;;;;AAIJ,AAKA,SAASmB,SAAT,CAAmB9S,EAAnB,EAAuBC,EAAvB,EAA2B;SAClBD,GAAGH,MAAH,CAAU,UAASK,CAAT,EAAY;WACpBD,GAAGzH,OAAH,CAAW0H,CAAX,MAAkB,CAAC,CAA1B;GADK,CAAP;;;;AASF,SAAS6S,QAAT,GAAoB;;;MAGdC,SAAS5nB,MAAM+L,IAAN,CAAWV,GAAX,CAAe,UAASwI,GAAT,EAAc;+GAGiCA,GAFzE;GADW,EAMV4S,IANU,CAML,EANK,CAAb;;QAQA,CAAW,UAAX,EAAuBmB,MAAvB;;;MAGIC,SAASH,UAAU1a,OAAOC,IAAP,CAAYjN,MAAMiM,OAAlB,CAAV,EAAsCjM,MAAM+L,IAA5C,EAAkDmV,IAAlD,EAAb;MACI4G,YAAY,aAAaD,OAAOpB,IAAP,CAAY,mBAAZ,CAAb,GAAgD,WAAhE;QACA,CAAW,WAAX,EAAwBqB,SAAxB;;;;;ACxtCF,IAAMC,gBAAgB,SAAhBA,aAAgB,OAAkB;MAAhBhd,UAAgB,QAAhBA,UAAgB;;SAEpC;;;;YACE;;;KADF;;;QAIW,SAAM,6BAAf;;;;;OAAA;;cAEE;UAAQ,SAAS;mBAAMA,WAAW,OAAX,CAAN;WAAjB;;;KANJ;;;;;KAAA;;;QAUO,IAAG,WAAR,EAAoB,yBAAyB,EAACzI,QAAQgc,0BAAT,EAA7C;;;GAXJ;CADF,CAkBA;;AChBA,IAAM0J,UAAU,SAAVA,OAAU,GAAM;SAElB;;;;YACE;;;KADF;;;;;KAAA;eAGO,IAAG,WAAR;mBACkBpN,oBADlB;kBAEiBE,sBAFjB;eAGc1W,eAHd;eAIcA,eAJd;+BAK8B,EAAC9B,QAAQ8b,mBAAT,EAL9B;GAJJ;CADF,CAgBA;;;;;;ACrBA,IAAM6J,aAAa,SAAbA,UAAa,CAAC5rB,KAAD,EAAW;MACxB6rB,eAAe7rB,MAAM8rB,cAAN,CAAqB/a,OAArB,CAA6B/Q,MAAM+rB,UAAnC,CAAnB;;MAEMC,kBAAkB;aACb,MADa;gBAEV,QAFU;YAGd,QAHc;YAId;GAJV;;MAOMC,eAAe;aACV,cADU;WAEZjsB,MAAMksB,IAAN,IAAc,KAFF;YAGXlsB,MAAMksB,IAAN,IAAa,KAHF;gBAIPL,iBAAiB,CAAC,CAAlB,GAAsB7rB,MAAMmsB,QAA5B,GAAuCnsB,MAAMumB,KAJtC;kBAKL,KALK;iBAMN,MANM;kBAOLsF,iBAAiB,CAAC,CAAlB,GAAsB,iBAAtB,GAA0C;GAP1D;;MAUMO,aAAa;kBACHP,iBAAiB,CAAC,CAAlB,GAAsB,iBAAtB,GAA0C;GAD1D;;SAKE;;MAAK,OAAOG,eAAZ;eACO,OAAOC,YAAZ,GADF;;;QAEQ,SAAS;iBAAMjsB,MAAMqsB,YAAN,CAAmBrsB,MAAM+rB,UAAzB,CAAN;SAAf,EAA2D,OAAOK,UAAlE;YAAqFztB;;GAHzF;CAxBF,CAgCA;;AC1BA,IAAM2tB,cAAc,CAAC;QACP,OADO;SAEN,SAFM;YAGH,MAHG;cAID;CAJA,EAMhB;QACU,YADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAVA,EAYhB;QACU,OADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAhBA,EAkBhB;QACU,SADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAtBA,EAwBhB;QACU,SADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CA5BA,EA8BhB;QACU,cADV;SAEW,SAFX;YAGc,MAHd;cAIgB;CAlCA,CAApB;;AAsCA,IAAMC,cAAc,CAAC;QACP,cADO;cAED,cAFC;SAGN;CAHK,EAKhB;QACU,MADV;cAEgB,MAFhB;SAGW;CARK,EAUhB;QACU,UADV;cAEgB,UAFhB;SAGW;CAbK,EAehB;QACU,WADV;cAEgB,WAFhB;SAGW;CAlBK,EAoBhB;QACU,KADV;cAEgB,KAFhB;SAGW;CAvBK,CAApB;;;;IA8BMC;;;;;;;;;;;;;;qLACJ7oB,QAAQ;sBACU;aAIlB0oB,eAAe,UAACjU,MAAD,EAAY;UACrBqU,cAAc,MAAK9oB,KAAL,CAAWmoB,cAA7B;UACIY,gBAAgBD,YAAY1b,OAAZ,CAAoBqH,MAApB,CAApB;;;UAGIsU,kBAAkB,CAAC,CAAvB,EAA0B;oBACZ3hB,MAAZ,CAAmB2hB,aAAnB,EAAkC,CAAlC;cACKzoB,QAAL,CAAc,EAAC6nB,gBAAgBW,WAAjB,EAAd;OAFF,MAIK;cACExoB,QAAL,cACK,MAAKN,KADV;sDAEsB,MAAKA,KAAL,CAAWmoB,cAA/B,IAA+C1T,MAA/C;;;;;aAKG0J,UAAP,GAAoB,MAAKne,KAAL,CAAWmoB,cAA/B;;;;aAMFa,cAAc,YAAM;aACXL,YAAYtd,GAAZ,CAAgB;eACrB;oBAAA;uBACMhK,IADN;kBAEO,MAFP;0BAGgB,MAAKqnB,YAHrB;4BAIoB,MAAK1oB,KAAL,CAAWmoB;;eAEvBpmB;SAPa;OAAhB,CAAP;aAWFknB,gBAAgB,YAAM;aACbL,YAAYvd,GAAZ,CAAgB;eACrB;oBAAA;uBACMhK,IADN;kBAEO,MAFP;4BAGoB,MAAKrB,KAAL,CAAWmoB,cAH/B;0BAIgB,MAAKO;;eAEb3mB;SAPa;OAAhB,CAAP;;;;;;gCAYO;aAEL;;UAAK,SAAM,QAAX;;;YAGW,SAAM,iBAAf;;;cACW,SAAM,gBAAf,EAAgC,OAAO,EAACmnB,cAAc,MAAf,EAAvC;;oBACC;;;aADD;iBAEQF,WAAL;WAHL;;;cAOW,SAAM,gBAAf,EAAgC,OAAO,EAACG,aAAa,MAAd,EAAvC;;oBACE;;;aADF;iBAEQF,aAAL;;SAZP;;;YAkBW,SAAM,eAAf;;kBACE;;;;SAnBJ;;;YAwBW,SAAM,cAAf;;kBACE;;;WADF;;;;;WAAA;;;;;WAAA;;;;;WAAA;;;;;WAAA;;;;;;;OAzBJ;;;;EAvDiB9e,WA8FrB;;;;AChKE;AACF,IAAMif,qBAAsB;;;;;;;GAAA;;;;;GAAA;;;;;GAAA;;;;;GAAA;;;;;;CAA5B;;AAQA,IAAMC,SAAS;;;;;;;GAAA;;;;;;CAAf;;AAMA,IAAMC,QAAQ,SAARA,KAAQ,GAAM;SAEhB;;MAAK,SAAM,OAAX;;YACE;;;KADF;;;QAGO,IAAG,QAAR,EAAiB,SAAOtpB,MAAMyN,KAAN,GAAc,MAAd,GAAuB,EAA/C;;;UACQ,IAAG,OAAT,EAAiB,UAAUrJ,KAA3B,EAAsC,SAAM,aAA5C;;;;;SAAA;;;;;SAAA;qBAIS,MAAK,OAAZ,EAAoB,IAAG,OAAvB,EAA+B,MAAK,MAApC,EAA2C,aAAY,OAAvD,EAA+D,SAAM,wBAArE,GAJF;;;;;SAAA;qBAOS,MAAK,MAAZ,EAAmB,IAAG,MAAtB,EAA6B,MAAK,MAAlC,EAAyC,aAAY,MAArD,EAA4D,SAAM,wBAAlE,GAPF;;;;;SAAA;;;YAUU,MAAK,aAAb,EAA2B,IAAG,aAA9B,EAA4C,SAAM,cAAlD;;;cACU,OAAM,UAAd;;WADF;;;cAEU,OAAM,aAAd;;WAFF;;;cAGU,OAAM,cAAd;;;SAbJ;;;;;SAAA;;;;;SAAA;;;;;SAAA;;gBAuBE;YAAQ,MAAK,QAAb,EAAsB,aAAY,MAAlC;;mBACK,SAAM,0BAAT,EAAoC,eAAY,MAAhD;;;KA5BR;;;QAiCO,IAAG,WAAR,EAAoB,SAAOpE,MAAMyN,KAAN,GAAc,EAAd,GAAmB,MAA9C;OAEAsH,MAAMG,OAAN,CAAcQ,MAAd,CAAqBha,MAAtB,IAAgC2tB,MAF/B;;;UAIQ,IAAG,kBAAT,EAA4B,UAAUjlB,YAAtC;mBACO,yBAAyB,EAAC9B,QAAQkc,gBAAT,EAA9B,GADF;cAGGtJ,OAAN,CAAcM,KAAd,CAAoB9Z,MAApB,KAA+B,CAA/B,IAAoC0tB,kBAHjC;;gBAKE;YAAQ,MAAK,QAAb,EAAsB,aAAY,MAAlC;;;cACK,SAASnU,gBAAZ,EAA8B,OAAO,EAACsU,WAAW,MAAZ,EAAoBlrB,MAAM,SAA1B,EAArC;qBACK,SAAM,yBAAT,EAAmC,eAAY,MAA/C,GADF;;WADF;;mBAMK,SAAM,0BAAT,EAAoC,eAAY,MAAhD;;;;GAjDV;CADF,CA4DA;;ICzEMmrB;;;;;;;;;;;;;;uLACJxpB,QAAQ;mBACO;aAgBf+K,aAAa,UAAC0e,OAAD,EAAa;YACnBnpB,QAAL,CAAc;qBACCmpB;OADf;;;aAOFC,qBAAqB,YAAM;cAClB,MAAK1pB,KAAL,CAAW6K,WAAlB;;aAEO,MAAL;iBACU,EAAC,IAAD,IAAM,YAAY,MAAKE,UAAvB,GAAR;;aAEG,OAAL;iBACS,EAAC,KAAD,OAAP;;aAEG,SAAL;iBACS,EAAC4e,MAAD,OAAP;;aAEG,cAAL;iBACU,EAAC,OAAD,OAAR;;aAEG,kBAAL;iBACU,EAAC,aAAD,IAAe,YAAY,MAAK5e,UAAhC,GAAR;;aAEG,OAAL;iBACS,EAAC,KAAD,OAAP;;;iBAGO,EAAC,IAAD,OAAP;;;;;;;wCA3Cc;;;;aAIXA,UAAP,GAAoB,KAAKA,UAAL,CAAgBsU,IAAhB,CAAqB,IAArB,CAApB;;;;yCAImB;;;;;;gCAuCZ;aAEL;;UAAO,SAAM,SAAb;;;YAGW,SAAM,oBAAf;;;cACM,SAAM,iBAAV;;WADF;;;cAEK,SAAM,qBAAX;;WAFA;eAGQqK,kBAAL;SANL;UASG,MAAD,IAAQ,aAAa,KAAK1pB,KAAL,CAAW6K,WAAhC,EAA6C,YAAY,KAAKE,UAA9D;OAVJ;;;;EArDkBZ,WAsEtB;;ACjDA,SAAS4R,MAAT,GAAgB;;;;MAIXmC,OAAO0L,QAAP,CAAgBC,IAAhB,CAAqB5Z,KAArB,CAA2B,CAA3B,EAA8B,CAA9B,MAAqC,WAAxC,EAAqD;QAChDiO,OAAO0L,QAAP,CAAgBE,IAAnB,EACE9pB,MAAMmM,SAAN,GAAkB+R,OAAO0L,QAAP,CAAgBE,IAAhB,CAAqB7Z,KAArB,CAA2B,CAA3B,CAAlB,CADF,KAGEjQ,MAAMmM,SAAN,GAAkB,IAAlB;;;MAGD+R,OAAO0L,QAAP,CAAgBG,MAAnB,EAA2B;UACnB7d,KAAN,GAAcgS,OAAO0L,QAAP,CAAgBG,MAAhB,CAAuBla,MAAvB,CAA8B,CAA9B,EAAiCrT,KAAjC,CAAuC,GAAvC,EAA4C0Q,MAA5C,CAAmD,UAASC,GAAT,EAAc6c,IAAd,EAAoB;UAC/EjuB,IAAIiuB,KAAKxtB,KAAL,CAAW,GAAX,CAAR;UACIT,EAAE,CAAF,CAAJ,IAAYA,EAAE,CAAF,CAAZ;aACOoR,GAAP;KAHY,EAIX,EAJW,CAAd;QAKGnN,MAAMkM,KAAN,CAAY2H,GAAf,EACE7T,MAAM+L,IAAN,GAAa,CAAC/L,MAAMkM,KAAN,CAAY2H,GAAb,CAAb,CADF,KAEK,IAAG7T,MAAMkM,KAAN,CAAYH,IAAf,EACH/L,MAAM+L,IAAN,GAAa/L,MAAMkM,KAAN,CAAYH,IAAZ,CAAiBvP,KAAjB,CAAuB,GAAvB,CAAb;;;;;;;WAOK8M,EAAT,GAAc;;;;;;WAMLA,EAAT;;;;;;eAMUiV,YAAV,EAvCc;;;AA0ChB,SAAS0L,OAAT,GAAmB;;IAEjB,CAAO,UAAP,EAAmBvnB,gBAAnB,CAAoC,OAApC,EAA6C0B,cAA7C;IACA,CAAO,UAAP,EAAmB1B,gBAAnB,CAAoC,WAApC,EAAiDyY,kBAAjD;IACA,CAAO,UAAP,EAAmBzY,gBAAnB,CAAoC,UAApC,EAAgD0Y,iBAAhD;IACA,CAAO,QAAP,EAAiB1Y,gBAAjB,CAAkC,QAAlC,EAA4C0B,aAA5C;;;WAGS1B,gBAAT,CAA0B,SAA1B,EAAqC0B,cAArC;;;;;;AAQF,AAAO;;;;AC5FP;;;;;;;AAOA,AAIA,AACA,AAEA,AAEA,AACA,AACA8Z,OAAOgM,IAAP,GAAcA,mBAAd;AACAhM,OAAOiM,IAAP,GAAcA,cAAd;;AAGApO;;AAEA,IAAIqO,aAAJ;AACA,IAAIC,WAAW,SAAXA,QAAW;SAAMD,OAAOppB,OAAO5F,EAAEouB,OAAF,EAAW,IAAX,CAAP,EAAyB/lB,SAASoT,cAAT,CAAwB,SAAxB,CAAzB,EAA6DuT,IAA7D,CAAb;CAAf;;AAEAE,aAAUD,QAAV"}